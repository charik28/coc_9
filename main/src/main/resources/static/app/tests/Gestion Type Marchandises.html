<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Gestion Type Marchandises</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- AdminLTE + Bootstrap -->
  <link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css" />
  <link rel="stylesheet" href="../../dist/css/adminlte.min.css" />
  <style>
    body {
      background-color: #f4f6f9;
    }
    .tree-panel {
      height: 75vh;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
      background: #fff;
    }
    .child-panel {
      height: 75vh;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
      background: #fff;
    }
    .node-item {
      cursor: pointer;
      padding: 4px 6px;
      border-radius: 4px;
    }
    .node-item:hover {
      background-color: #f0f0f0;
    }
    .selected {
      background-color: #007bff;
      color: #fff;
    }
  </style>
</head>
<body class="hold-transition sidebar-mini">
<div class="wrapper p-3">

  <section class="content">
    <div class="container-fluid">
      <div class="row">
        <!-- Left side: Tree -->
        <div class="col-md-4">
          <div class="tree-panel">
            <h5 class="mb-3"><i class="fas fa-sitemap"></i> الفئات الرئيسية</h5>
            <ul id="tree" class="list-unstyled"></ul>
          </div>
        </div>

        <!-- Right side: Child list -->
        <div class="col-md-8">
          <div class="child-panel">
            <h5 class="mb-3"><i class="fas fa-layer-group"></i> العناصر الفرعية</h5>
            <table class="table table-bordered table-sm">
              <thead class="table-light">
              <tr>
                <th>المرجع</th>
                <th>الاسم بالعربية</th>
                <th>الوحدة</th>
                <th>رمز</th>
                <th></th>
              </tr>
              </thead>
              <tbody id="childTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Bottom form -->
      <div class="row mt-3">
        <div class="col-md-12">
          <div class="card card-outline card-primary">
            <div class="card-header">
              <h5 class="card-title"><i class="fas fa-edit"></i> تعديل / إضافة عنصر</h5>
            </div>
            <div class="card-body">
              <form id="nodeForm">
                <input type="hidden" id="id" />
                <div class="row">
                  <div class="col-md-3">
                    <label>الاسم بالعربية</label>
                    <input type="text" id="article_name_ar" class="form-control" />
                  </div>
                  <div class="col-md-3">
                    <label>الاسم بالفرنسية</label>
                    <input type="text" id="article_name" class="form-control" />
                  </div>
                  <div class="col-md-2">
                    <label>الوحدة</label>
                    <input type="text" id="unit" class="form-control" />
                  </div>
                  <div class="col-md-2">
                    <label>رمز المرجع</label>
                    <input type="text" id="reference_number" class="form-control" />
                  </div>
                  <div class="col-md-2">
                    <label>رمز المقال</label>
                    <input type="text" id="article_number" class="form-control" />
                  </div>
                </div>
                <div class="mt-3 text-end">
                  <button type="button" class="btn btn-success" onclick="saveNode()">
                    <i class="fas fa-save"></i> حفظ
                  </button>
                  <button type="button" class="btn btn-secondary" onclick="resetForm()">
                    <i class="fas fa-plus"></i> جديد
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

    </div>
  </section>
</div>

<!-- JS Dependencies -->
<script src="../../plugins/jquery/jquery.min.js"></script>
<script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../../dist/js/adminlte.min.js"></script>

<script>
  // --- Fake data example, replace with AJAX fetch from backend ---
  const nodes = [
    { id: '1', article_name_ar: 'مواد غذائية', groupe_level: 0, groupe_parent: null },
    { id: '2', article_name_ar: 'مشروبات', groupe_level: 0, groupe_parent: null },
    { id: '3', article_name_ar: 'مياه معدنية', groupe_level: 1, groupe_parent: '2' },
    { id: '4', article_name_ar: 'عصائر', groupe_level: 1, groupe_parent: '2' },
  ];

  // Build tree
  function buildTree() {
    const topLevel = nodes.filter(n => !n.groupe_parent);
    $('#tree').empty();
    topLevel.forEach(node => {
      const li = $('<li>').append(
        $('<div>')
          .addClass('node-item')
          .text(node.article_name_ar)
          .click(() => selectNode(node.id))
      );
      $('#tree').append(li);
    });
  }

  // Show children on right side
  function selectNode(id) {
    $('.node-item').removeClass('selected');
    event.target.classList.add('selected');
    const childs = nodes.filter(n => n.groupe_parent === id);
    const tbody = $('#childTable').empty();
    childs.forEach(ch => {
      const tr = $('<tr>')
        .append($('<td>').text(ch.reference_number || ''))
        .append($('<td>').text(ch.article_name_ar))
        .append($('<td>').text(ch.unit || ''))
        .append($('<td>').text(ch.article_number || ''))
        .append(
          $('<td>').html(`<button class="btn btn-sm btn-info" onclick="editNode('${ch.id}')"><i class="fas fa-edit"></i></button>`)
        );
      tbody.append(tr);
    });
  }

  function editNode(id) {
    const n = nodes.find(n => n.id === id);
    $('#id').val(n.id);
    $('#article_name_ar').val(n.article_name_ar);
    $('#article_name').val(n.article_name);
    $('#unit').val(n.unit);
    $('#reference_number').val(n.reference_number);
    $('#article_number').val(n.article_number);
  }

  function saveNode() {
    alert('Saving node (you will replace this with AJAX call)');
  }

  function resetForm() {
    $('#nodeForm')[0].reset();
    $('#id').val('');
  }

  $(document).ready(buildTree);
</script>
</body>
</html>

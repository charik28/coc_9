<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="alpass.ipt.clr.pdr.dre.mapper.ClrTfrtAplyInfoReqstMapper">

    <!--
    Consulter la demande des informations de l'application du tarif douanier.
     !== CLRI_관세율적용정보요청 조회 ==!
    (Generated)
    -->
    <select id="selectClrTfrtAplyInfoReqst" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrTfrtAplyInfoReqstVo" resultType="alpass.ipt.clr.pdr.dre.vo.ClrTfrtAplyInfoReqstVo">
        /* ClrTfrtAplyInfoReqst_selectClrTfrtAplyInfoReqst */
        SELECT
            A.tfrt_aply_info_no          /** N° des informations de l'application de tarif !== 관세율적용정보번호 ==! */
             , A.dtl_dcsh_no                /** Numero de la déclaration en détail !== 상세신고서번호 ==! */
             , A.trif_aply_info_reqst_ttle       /** Titre de demande de renseignement concernant l'application du tarif !== 관세적용정보요청제목 ==! */
             , A.reqst_atch_file_id         /** ID de fichiers à joindre avec la demande !== 요청첨부파일ID ==! */
             , A.cstm_cmdt_dtl_desc         /** Description détaillée des marchandises par les services !== 세관물품상세설명 ==! */
             , A.ispr_clsf_opin_cn          /** Avis du classement de l'inspecteur vérificateur !== 검사자분류의견 ==! */
             , A.ipcoc_hdor_clsf_opin_cn       /** Avis du classement de l'IPCOC !== IPCOC조직장분류의견 ==! */
             , A.idd_hdor_clsf_opin_cn       /** Avis du classement du CID !== IDD조직장분류의견 ==! */
             , A.drd_hdor_clsf_opin_cn       /** Avis du classement du DR !== DRD조직장분류의견 ==! */
             , A.dgd_cmdt_dtl_desc          /** Description de la marchandise par DGD !== DGD물품상세설명 ==! */
             , A.dgd_expc_hs_cd_cn          /** Sous positions tarifaires envisagées par DGD !== DGD예상HS코드 ==! */
             , A.dgd_trif_clsf_cn           /** Classement tarifaire par DGD !== DGD관세분류 ==! */
             , A.dgd_atch_file_id           /** ID de fichiers joints par DGD !== DGD첨부파일ID ==! */
             , A.prcs_stts_cd               /** Code De Statut De Traitement !== 처리상태코드 ==! */
             , A.del_yn                     /** Suppression On !== 삭제여부 ==! */
             , A.frst_regst_id              /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
             , A.frst_rgsr_dttm             /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , A.last_chpr_id               /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , A.last_chg_dttm              /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        FROM   TB_CLRI_TFRT_APLY_INFO_REQST A
        WHERE  del_yn = 'N'                /** Suppression ON !== 삭제여부 ==! */
          AND  A.tfrt_aply_info_no = #{tfrtAplyInfoNo}       /** N° des informations de l'application de tarif !== 관세율적용정보번호 ==! */
    </select>



    <!--
    Consulter la demande des informations de l'application du tarif douanier.[LIST]
     !== CLRI_관세율적용정보요청 목록 조회 ==!
    (Generated)
    -->
    <select id="selectClrTfrtAplyInfoReqstList" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrTfrtAplyInfoReqstVo" resultType="alpass.ipt.clr.pdr.dre.vo.ClrTfrtAplyInfoReqstVo">
        /* ClrTfrtAplyInfoReqst_selectClrTfrtAplyInfoReqstList */
        <include refid="pagination.header" ></include>
        SELECT
            A.tfrt_aply_info_no          /** N° des informations de l'application de tarif !== 관세율적용정보번호 ==! */
            , A.dtl_dcsh_no                /** Numero de la déclaration en détail !== 상세신고서번호 ==! */
            , A.trif_aply_info_reqst_ttle       /** Titre de demande de renseignement concernant l'application du tarif !== 관세적용정보요청제목 ==! */
            , A.reqst_atch_file_id         /** ID de fichiers à joindre avec la demande !== 요청첨부파일ID ==! */
            , A.cstm_cmdt_dtl_desc         /** Description détaillée des marchandises par les services !== 세관물품상세설명 ==! */
            , A.ispr_clsf_opin_cn          /** Avis du classement de l'inspecteur vérificateur !== 검사자분류의견 ==! */
            , A.ipcoc_hdor_clsf_opin_cn       /** Avis du classement de l'IPCOC !== IPCOC조직장분류의견 ==! */
            , A.idd_hdor_clsf_opin_cn       /** Avis du classement du CID !== IDD조직장분류의견 ==! */
            , A.drd_hdor_clsf_opin_cn       /** Avis du classement du DR !== DRD조직장분류의견 ==! */
            , A.dgd_cmdt_dtl_desc          /** Description de la marchandise par DGD !== DGD물품상세설명 ==! */
            , A.dgd_expc_hs_cd_cn          /** Sous positions tarifaires envisagées par DGD !== DGD예상HS코드 ==! */
            , A.dgd_trif_clsf_cn           /** Classement tarifaire par DGD !== DGD관세분류 ==! */
            , A.dgd_atch_file_id           /** ID de fichiers joints par DGD !== DGD첨부파일ID ==! */
            , A.prcs_stts_cd               /** Code De Statut De Traitement !== 처리상태코드 ==! */
            , FN_GET_CD_VDVAL_NM('CLR_0167', A.PRCS_STTS_CD, #{langCd}) AS PRCS_STTS_NM
            , to_char(A.frst_rgsr_dttm, 'DD/MM/YYYY') AS RQST_DT /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
            , A.del_yn                     /** Suppression On !== 삭제여부 ==! */
            , A.frst_regst_id              /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
            , A.frst_rgsr_dttm             /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
            , A.last_chpr_id               /** Id Du Modificateur Final !== 최종변경자ID ==! */
            , A.last_chg_dttm              /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        FROM  TB_CLRI_TFRT_APLY_INFO_REQST A
            LEFT JOIN TB_CLRI_DED_COMN B ON A.DTL_DCSH_NO = B.DTL_DCSH_NO
        WHERE  A.del_yn = 'N'                /** Suppression ON !== 삭제여부 ==! */
            <if test="tfrtAplyInfoNo != null and tfrtAplyInfoNo != ''">
              AND  A.tfrt_aply_info_no = #{tfrtAplyInfoNo}       /** N° des informations de l'application de tarif !== 관세율적용정보번호 ==! */
            </if>
            <if test="dtlDcshNo != null and dtlDcshNo != ''">
                AND  A.dtl_dcsh_no = #{dtlDcshNo}       /** Numero de la déclaration en détail !== 상세신고서번호 ==! */
            </if>
            <if test="prcsSttsCd != null and prcsSttsCd != ''">
                AND  A.prcs_stts_cd = #{prcsSttsCd}       /** Code De Statut De Traitement !== 처리상태코드 ==! */
            </if>
            <if test="rqstDtFrom != null and rqstDtFrom != '' and rqstDtTo != null and rqstDtTo != ''">
                AND to_char(A.frst_rgsr_dttm, 'YYYYMMDD') BETWEEN TO_CHAR(TO_DATE(#{rqstDtFrom}, 'DD/MM/YYYY'), 'YYYYMMDD') AND TO_CHAR(TO_DATE(#{rqstDtTo}, 'DD/MM/YYYY'), 'YYYYMMDD')
            </if>
            <if test="frstRegstId != null and frstRegstId != ''">
                AND  A.frst_regst_id = #{frstRegstId}
            </if>
            <if test="audtDeptCd != null and audtDeptCd != ''">
                AND  B.audt_dept_cd = #{audtDeptCd}
            </if>
            <if test="dclrCstmCd != null and dclrCstmCd != ''">
                AND  B.dclr_cstm_cd = #{dclrCstmCd}
            </if>
            <if test="drdCd != null and drdCd != ''">
                AND  B.dclr_cstm_cd like SUBSTR(#{drdCd}, 0, 3) || '%'
            </if>
            <if test="!prcsSttsCdSet.isEmpty()">
                AND A.prcs_stts_cd in
                <foreach collection="prcsSttsCdSet" item="prcsSttsCd" index="index" separator="," open="(" close=")">
                    #{prcsSttsCd}
                </foreach>
            </if>
        ORDER BY tfrt_aply_info_no desc
        <include refid="pagination.footer" ></include>
    </select>


    <!--
    Enregistrer la demande des informations de l'application du tarif douanier
    !== CLRI_관세율적용정보요청 등록 ==!
    (Generated)
    -->
    <insert id="mergeInsertClrTfrtAplyInfoReqst" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrTfrtAplyInfoReqstVo">
        /* insertClrTfrtAplyInfoReqst */
        INSERT INTO TB_CLRI_TFRT_APLY_INFO_REQST (
                   tfrt_aply_info_no                      /** N° des informations de l'application de tarif !== 관세율적용정보번호 ==! */
                 , dtl_dcsh_no                              /** Numero de la déclaration en détail !== 상세신고서번호 ==! */
                 , trif_aply_info_reqst_ttle                /** Titre de demande de renseignement concernant l'application du tarif !== 관세적용정보요청제목 ==! */
                 , reqst_atch_file_id                       /** ID de fichiers à joindre avec la demande !== 요청첨부파일ID ==! */
                 , cstm_cmdt_dtl_desc                       /** Description détaillée des marchandises par les services !== 세관물품상세설명 ==! */
                 , ispr_clsf_opin_cn                        /** Avis du classement de l'inspecteur vérificateur !== 검사자분류의견 ==! */
                 , ipcoc_hdor_clsf_opin_cn                  /** Avis du classement de l'IPCOC !== IPCOC조직장분류의견 ==! */
                 , idd_hdor_clsf_opin_cn                    /** Avis du classement du CID !== IDD조직장분류의견 ==! */
                 , drd_hdor_clsf_opin_cn                    /** Avis du classement du DR !== DRD조직장분류의견 ==! */
                 , dgd_cmdt_dtl_desc                        /** Description de la marchandise par DGD !== DGD물품상세설명 ==! */
                 , dgd_expc_hs_cd_cn                        /** Sous positions tarifaires envisagées par DGD !== DGD예상HS코드 ==! */
                 , dgd_trif_clsf_cn                         /** Classement tarifaire par DGD !== DGD관세분류 ==! */
                 , dgd_atch_file_id                         /** ID de fichiers joints par DGD !== DGD첨부파일ID ==! */
                 , prcs_stts_cd                             /** Code De Statut De Traitement !== 처리상태코드 ==! */
                 , del_yn                                   /** Suppression On !== 삭제여부 ==! */
                 , frst_regst_id                            /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
                 , frst_rgsr_dttm                              /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
                 , last_chpr_id                             /** Id Du Modificateur Final !== 최종변경자ID ==! */
                 , last_chg_dttm                               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        ) VALUES (
                   #{tfrtAplyInfoNo}                      /** N° des informations de l'application de tarif !== 관세율적용정보번호 ==! */
                 , #{dtlDcshNo}                         /** Numero de la déclaration en détail !== 상세신고서번호 ==! */
                 , #{trifAplyInfoReqstTtle}             /** Titre de demande de renseignement concernant l'application du tarif !== 관세적용정보요청제목 ==! */
                 , #{reqstAtchFileId}                   /** ID de fichiers à joindre avec la demande !== 요청첨부파일ID ==! */
                 , #{cstmCmdtDtlDesc}                   /** Description détaillée des marchandises par les services !== 세관물품상세설명 ==! */
                 , #{isprClsfOpinCn}                    /** Avis du classement de l'inspecteur vérificateur !== 검사자분류의견 ==! */
                 , #{ipcocHdorClsfOpinCn}               /** Avis du classement de l'IPCOC !== IPCOC조직장분류의견 ==! */
                 , #{iddHdorClsfOpinCn}                 /** Avis du classement du CID !== IDD조직장분류의견 ==! */
                 , #{drdHdorClsfOpinCn}                 /** Avis du classement du DR !== DRD조직장분류의견 ==! */
                 , #{dgdCmdtDtlDesc}                    /** Description de la marchandise par DGD !== DGD물품상세설명 ==! */
                 , #{dgdExpcHsCdCn}                     /** Sous positions tarifaires envisagées par DGD !== DGD예상HS코드 ==! */
                 , #{dgdTrifClsfCn}                     /** Classement tarifaire par DGD !== DGD관세분류 ==! */
                 , #{dgdAtchFileId}                     /** ID de fichiers joints par DGD !== DGD첨부파일ID ==! */
                 , #{prcsSttsCd}                        /** Code De Statut De Traitement !== 처리상태코드 ==! */
                 , 'N'                                      /** Suppression On !== 삭제여부 ==! */
                 , #{frstRegstId}                       /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
                 , SYSTIMESTAMP                                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
                 , #{lastChprId}                        /** Id Du Modificateur Final !== 최종변경자ID ==! */
                 , SYSTIMESTAMP                                /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
                 )
            ON CONFLICT ( tfrt_aply_info_no )
        DO UPDATE SET
            dtl_dcsh_no = #{dtlDcshNo}                            /** Numero de la déclaration en détail !== 상세신고서번호 ==! */
           ,trif_aply_info_reqst_ttle = #{trifAplyInfoReqstTtle}     /** Titre de demande de renseignement concernant l'application du tarif !== 관세적용정보요청제목 ==! */
           ,reqst_atch_file_id = #{reqstAtchFileId}                  /** ID de fichiers à joindre avec la demande !== 요청첨부파일ID ==! */
           ,cstm_cmdt_dtl_desc = #{cstmCmdtDtlDesc}                  /** Description détaillée des marchandises par les services !== 세관물품상세설명 ==! */
           ,ispr_clsf_opin_cn = #{isprClsfOpinCn}                    /** Avis du classement de l'inspecteur vérificateur !== 검사자분류의견 ==! */
           ,ipcoc_hdor_clsf_opin_cn = #{ipcocHdorClsfOpinCn}         /** Avis du classement de l'IPCOC !== IPCOC조직장분류의견 ==! */
           ,idd_hdor_clsf_opin_cn = #{iddHdorClsfOpinCn}             /** Avis du classement du CID !== IDD조직장분류의견 ==! */
           ,drd_hdor_clsf_opin_cn = #{drdHdorClsfOpinCn}             /** Avis du classement du DR !== DRD조직장분류의견 ==! */
           ,dgd_cmdt_dtl_desc = #{dgdCmdtDtlDesc}                    /** Description de la marchandise par DGD !== DGD물품상세설명 ==! */
           ,dgd_expc_hs_cd_cn = #{dgdExpcHsCdCn}                     /** Sous positions tarifaires envisagées par DGD !== DGD예상HS코드 ==! */
           ,dgd_trif_clsf_cn = #{dgdTrifClsfCn}                      /** Classement tarifaire par DGD !== DGD관세분류 ==! */
           ,dgd_atch_file_id = #{dgdAtchFileId}                      /** ID de fichiers joints par DGD !== DGD첨부파일ID ==! */
           ,prcs_stts_cd = #{prcsSttsCd}                             /** Code De Statut De Traitement !== 처리상태코드 ==! */
           ,last_chpr_id = #{lastChprId}                             /** Id Du Modificateur Final !== 최종변경자ID ==! */
           , last_chg_dttm = SYSTIMESTAMP                               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
    </insert>


    <!--
    Supprimer la demande des informations de l'application du tarif douanier
    !== CLRI_관세율적용정보요청 삭제 ==!
    (Generated)
    -->
    <update id="deleteClrTfrtAplyInfoReqst" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrTfrtAplyInfoReqstVo">
        /* ClrTfrtAplyInfoReqst_deleteClrTfrtAplyInfoReqst */
        UPDATE  TB_CLRI_TFRT_APLY_INFO_REQST SET
            del_yn = 'Y'                  /** Suppression ON !== 삭제여부 ==! */
            ,  last_chpr_id = #{lastChprId}          /** ID du modificateur final !== 최종변경자ID ==! */
            ,  last_chg_dttm = SYSTIMESTAMP          /** Date et heure de modification finale !== 최종변경일시 ==! */
        WHERE  del_yn = 'N'                  /** Suppression ON !== 삭제여부 ==! */
          AND  tfrt_aply_info_no = #{tfrtAplyInfoNo}         /** N° des informations de l'application de tarif !== 관세율적용정보번호 ==! */
    </update>


    <select id="selectOrgnHdorList" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrTfrtAplyInfoReqstVo" resultType="alpass.ipt.com.user.vo.ComUserVo">
        SELECT PBSR_NO
             , EMP_NM
             , EMP_FMNM
             , (SELECT ORGN_NM||' ('||ORGN_MGMT_CD||')' FROM TB_POTI_ORGN WHERE DEL_YN = 'N' AND ORGN_MGMT_CD = A.ORGN_MGMT_CD) AS ORGN_MGMT_CD
             , (SELECT FONC_CD_NM FROM TB_POTI_FONC_CD_LANG WHERE LANG_CD = 'KO' AND FONC_CD = A.FONC_CD) AS FONC_CD
        FROM TB_POTI_EMP A
        WHERE DEL_YN = 'N'
          <choose>
              <when test="foncCd != null and foncCd != ''">
                  AND FONC_CD = #{foncCd}
              </when>
              <otherwise>
                  AND FONC_CD in
                  <foreach collection="foncCdList" item="foncCd" index="index" separator="," open="(" close=")">
                      #{foncCd}
                  </foreach>
              </otherwise>
          </choose>
          <choose>
              <when test="orgnCd != null and orgnCd != ''">
                  AND ORGN_MGMT_CD = (select orgn_mgmt_cd from tb_poti_orgn where orgn_cd = #{orgnCd})
              </when>
              <otherwise>
                  AND ORGN_MGMT_CD in
                    <foreach collection="orgnCdList" item="orgnCd" index="index" separator="," open="(" close=")">
                      (select orgn_mgmt_cd from tb_poti_orgn where orgn_cd = #{orgnCd})
                    </foreach>
              </otherwise>
          </choose>
    </select>
</mapper>

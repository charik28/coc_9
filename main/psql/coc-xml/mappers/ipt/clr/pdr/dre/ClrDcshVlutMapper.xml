<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="alpass.ipt.clr.pdr.dre.mapper.ClrDcshVlutMapper">
    <!--
		* SQL 설명 : Consulter la modification o/n des champs de l'estimation de la valeur
		!== 가격평가항목 수정 여부 조회 ==!
	-->
    <select id="selectVlutAtrYn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedSrchVo" resultType="java.lang.String" >
        /* selectVlutAtrYn */
        SELECT 1 AS VLUT_ATR_YN
        FROM DUAL
        WHERE EXISTS
            (
                SELECT
                    A.INVC_CURR_CD
                     , A.INVC_FXRT
                     , A.INVC_AMT
                     , A.INVC_NCY_AMT
                     /* , A.INVC_USD_AMT */
                     , A.CACH_AMT
                     , A.CACH_NCY_AMT
                     , A.INFEE_AMT
                     , A.INFEE_NCY_AMT
                     , A.OTCST_AMT
                     , A.OTCST_NCY_AMT
                     , A.DDCT_AMT
                     , A.DDCT_RT
                     , A.DDCT_NCY_AMT
                     , A.TTXBS_NCY_AMT
                     /*, A.TTXBS_USD_AMT */
                     , B.IMPPN_IDFY_NO
                     , B.TXPR_IDFY_NO
                FROM TB_CLRI_DED_VLUT_COMN A
                   , TB_CLRI_DED_COMN B
                WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO
                  AND A.DEL_YN = 'N'
                  AND A.DEL_YN = 'N'
                  AND A.DTL_DCSH_NO = #{dtlDcshNo}
                MINUS
                SELECT
                ASED_INVC_CURR_CD
            , ASED_INVC_FXRT
            , ASED_INVC_AMT
            , ASED_INVC_NCY_AMT
            /*, ASED_INVC_USD_AMT */
            , ASED_CACH_AMT
            , ASED_CACH_NCY_AMT
            , ASED_INFEE_AMT
            , ASED_INFEE_NCY_AMT
            , ASED_OTCST_AMT
            , ASED_OTCST_NCY_AMT
            , ASED_DDCT_AMT
            , ASED_DDCT_RT
            , ASED_DDCT_NCY_AMT
            , ASED_TTXBS_NCY_AMT
            /*, ASED_TTXBS_USD_AMT */
            , ASED_IMPPN_IDFY_NO
            , ASED_TXPR_IDFY_NO
                FROM TB_CLRI_DED_VLUT_AUDT_COMN
                WHERE DTL_DCSH_NO = #{dtlDcshNo}
                    AND DEL_YN = 'N'
                    AND LAST_YN = 'Y'
            )
           OR EXISTS
            (
                SELECT

                    A.HS_CD
                     , A.ORCY_CNTY_CD
                     , A.APC_CD
                     , A.PRVL_CD
                     , A.PRC_DTRM_MEAN_CD
                     , A.PDLS_TTWG
                     , A.PDLS_NTWG
                     , B.PDLS_INVC_AMT
                     , B.PDLS_INVC_NCY_AMT
                     /*, B.PDLS_INVC_USD_AMT */
                     , B.PDLS_CACH_AMT
                     , B.PDLS_CACH_NCY_AMT
                     , B.PDLS_INFEE_AMT
                     , B.PDLS_INFEE_NCY_AMT
                     , B.PDLS_OTCST_AMT
                     , B.PDLS_OTCST_NCY_AMT
                     , B.PDLS_DDCT_AMT
                     , B.PDLS_DDCT_NCY_AMT
                     , B.PDLS_TXBS_NCY_AMT
                     /*, B.PDLS_TXBS_USD_AMT */
                FROM TB_CLRI_DED_PDLS A
                   , TB_CLRI_DED_VLUT_PDLS B
                WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO
                  AND A.PDLS_NO = B.PDLS_NO
                  AND A.DEL_YN = 'N'
                  AND B.DEL_YN = 'N'
                  AND A.DTL_DCSH_NO = #{dtlDcshNo}
                MINUS
                SELECT ASED_HS_CD
            , ASED_ORCY_CNTY_CD
            , ASED_APC_CD
            , ASED_PRVL_CD
            , ASED_PRC_DTRM_MEAN_CD
            , ASED_PDLS_TTWG
            , ASED_PDLS_NTWG
            , ASED_PDLS_INVC_AMT
            , ASED_PDLS_INVC_NCY_AMT
            /*, ASED_PDLS_INVC_USD_AMT */
            , ASED_PDLS_CACH_AMT
            , ASED_PDLS_CACH_NCY_AMT
            , ASED_PDLS_INFEE_AMT
            , ASED_PDLS_INFEE_NCY_AMT
            , ASED_PDLS_OTCST_AMT
            , ASED_PDLS_OTCST_NCY_AMT
            , ASED_PDLS_DDCT_AMT
            , ASED_PDLS_DDCT_NCY_AMT
            , ASED_PDLS_TXBS_NCY_AMT
            /*, ASED_PDLS_TXBS_USD_AMT */
                FROM   TB_CLRI_DED_VLUT_AUDT_PDLS
                WHERE DTL_DCSH_NO = #{dtlDcshNo}
                    AND PRC_EV_DGCNT = (SELECT PRC_EV_DGCNT FROM TB_CLRI_DED_VLUT_AUDT_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} AND DEL_YN = 'N' AND LAST_YN = 'Y')
            )
           OR EXISTS
            (
                SELECT
                    QTY
                     , QTY_UT_CD
                     , UT_PRC
                     , INVC_AMT
                FROM TB_CLRI_DED_MDL_STSZ
                WHERE DTL_DCSH_NO = #{dtlDcshNo}
                  AND DEL_YN = 'N'
                MINUS
                SELECT
                ASED_QTY
            , ASED_QTY_UT_CD
            , ASED_UT_PRC
            , ASED_INVC_PRC
                FROM TB_CLRI_DED_VLUT_AUDT_MDL_STSZ
                WHERE DTL_DCSH_NO = #{dtlDcshNo}
                    AND DEL_YN = 'N'
                    AND PRC_EV_DGCNT = (SELECT PRC_EV_DGCNT FROM TB_CLRI_DED_VLUT_AUDT_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} AND DEL_YN = 'N' AND LAST_YN = 'Y')
            )

           OR EXISTS
            (
                (
                    SELECT CNTR_NO
                         , CNTR_TP_CD
                         , CNTR_STFN_STTS_CD
                         , SEAL_NO1
                         , SEAL_NO2
                         , SEAL_NO3
                         ,seal_chpn1
                         ,seal_chpn2
                         ,seal_chpn3
                    FROM TB_CLRI_VLUT_CNTR
                    WHERE DTL_DCSH_NO       = #{dtlDcshNo}
                      AND PRC_EV_DGCNT = ( SELECT PRC_EV_DGCNT FROM TB_CLRI_DED_VLUT_AUDT_COMN
                                           WHERE DTL_DCSH_NO = #{dtlDcshNo}
                                             AND DEL_YN = 'N'
                                             AND LAST_YN = 'Y'
                    )
                      AND DEL_YN       = 'N'
                        MINUS
                    SELECT CNTR_NO
                            , CNTR_TP_CD
                            , CNTR_STFN_STTS_CD
                            , SEAL_NO1
                            , SEAL_NO2
                            , SEAL_NO3
                            ,seal_chpn1
                            ,seal_chpn2
                            ,seal_chpn3
                    FROM TB_CLRI_DED_CNTR
                    WHERE DTL_DCSH_NO       = #{dtlDcshNo}
                      AND DEL_YN       = 'N'
                )
                UNION ALL
                (
                    SELECT CNTR_NO
                         , CNTR_TP_CD
                         , CNTR_STFN_STTS_CD
                         , SEAL_NO1
                         , SEAL_NO2
                         , SEAL_NO3
                         ,seal_chpn1
                         ,seal_chpn2
                         ,seal_chpn3
                    FROM TB_CLRI_DED_CNTR
                    WHERE DTL_DCSH_NO       = #{dtlDcshNo}
                      AND DEL_YN = 'N'
                        MINUS
                    SELECT CNTR_NO
                            , CNTR_TP_CD
                            , CNTR_STFN_STTS_CD
                            , SEAL_NO1
                            , SEAL_NO2
                            , SEAL_NO3
                            ,seal_chpn1
                            ,seal_chpn2
                            ,seal_chpn3
                    FROM TB_CLRI_VLUT_CNTR
                    WHERE DTL_DCSH_NO       = #{dtlDcshNo}
                      AND PRC_EV_DGCNT = ( SELECT PRC_EV_DGCNT FROM TB_CLRI_DED_VLUT_AUDT_COMN
                        WHERE DTL_DCSH_NO = #{dtlDcshNo}
                      AND DEL_YN = 'N'
                      AND LAST_YN = 'Y'
                        )
                      AND DEL_YN       = 'N'
                )
            )
    </select>

    <!-- 가격평가 처리상태 조회  -->
    <select id="selectVlutPrcsStts" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedSrchVo" resultType="java.lang.String">
        /* selectVlutPrcsStts */
        SELECT VLUT_PRCS_STTS_CD
        FROM TB_CLRI_DED_VLUT_AUDT_COMN
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND LAST_YN = 'Y'
          AND DEL_YN = 'N'
    </select>

    <!-- Réinitialisation de commun du contrôle de la liquidation de la valeur de DED !== DED 가격평가심사 공통 초기화 ==! -->
    <update id="updateMergeVlutAudtComn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateMergeVlutAudtComn */
        with upsert as (
            SELECT
                A.DTL_DCSH_NO
                 , A.IMPPN_IDFY_NO_TP_CD
                 , A.IMPPN_IDFY_NO
                 , A.TXPR_IDFY_NO
                 , A.EPC_CD
                 , B.INVC_AMT
                 , B.INVC_CURR_CD
                 , B.INVC_FXRT
                 , B.INVC_NCY_AMT
                 , B.INVC_USD_AMT
                 , B.CACH_AMT
                 , B.CACH_CURR_CD
                 , B.CACH_FXRT
                 , B.CACH_NCY_AMT
                 , B.INFEE_AMT
                 , B.INFEE_CURR_CD
                 , B.INFEE_FXRT
                 , B.INFEE_NCY_AMT
                 , B.OTCST_AMT
                 , B.OTCST_CURR_CD
                 , B.OTCST_FXRT
                 , B.OTCST_NCY_AMT
                 , B.DDCT_AMT
                 , B.DDCT_RT
                 , B.DDCT_CURR_CD
                 , B.DDCT_FXRT
                 , B.DDCT_NCY_AMT
                 , B.TTXBS_NCY_AMT
                 , B.TTXBS_USD_AMT
                 , B.TVLUT_NCY_AMT
                 , B.TVLUT_USD_AMT
            FROM TB_CLRI_DED_COMN A
               , TB_CLRI_DED_VLUT_COMN B
            WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO
              AND A.DEL_YN = 'N'
              AND A.DTL_DCSH_NO = #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
        )
           , UPDATE_OPTION AS (
            UPDATE TB_CLRI_DED_VLUT_AUDT_COMN A SET
                A.ASED_INVC_CURR_CD 	     = B.INVC_CURR_CD
                , A.ASED_INVC_FXRT            = B.INVC_FXRT
                , A.ASED_INVC_AMT             = B.INVC_AMT
                , A.ASED_INVC_NCY_AMT         = B.INVC_NCY_AMT
                , A.ASED_INVC_USD_AMT         = B.INVC_USD_AMT
                , A.ASED_CACH_CURR_CD         = B.CACH_CURR_CD
                , A.ASED_CACH_FXRT            = B.CACH_FXRT
                , A.ASED_CACH_AMT             = B.CACH_AMT
                , A.ASED_CACH_NCY_AMT         = B.CACH_NCY_AMT
                , A.ASED_INFEE_AMT            = B.INFEE_AMT
                , A.ASED_INFEE_CURR_CD        = B.INFEE_CURR_CD
                , A.ASED_INFEE_FXRT           = B.INFEE_FXRT
                , A.ASED_INFEE_NCY_AMT        = B.INFEE_NCY_AMT
                , A.ASED_OTCST_AMT            = B.OTCST_AMT
                , A.ASED_OTCST_CURR_CD        = B.OTCST_CURR_CD
                , A.ASED_OTCST_FXRT           = B.OTCST_FXRT
                , A.ASED_OTCST_NCY_AMT        = B.OTCST_NCY_AMT
                , A.ASED_DDCT_AMT             = B.DDCT_AMT
                , A.ASED_DDCT_RT             = B.DDCT_RT
                , A.ASED_DDCT_CURR_CD         = B.DDCT_CURR_CD
                , A.ASED_DDCT_FXRT            = B.DDCT_FXRT
                , A.ASED_DDCT_NCY_AMT         = B.DDCT_NCY_AMT
                , A.ASED_TTXBS_NCY_AMT        = B.TTXBS_NCY_AMT
                , A.ASED_TTXBS_USD_AMT        = B.TTXBS_USD_AMT
                , A.ASED_IMPPN_IDFY_NO_TP_CD  = B.IMPPN_IDFY_NO_TP_CD
                , A.ASED_IMPPN_IDFY_NO		 = B.IMPPN_IDFY_NO
                , A.ASED_TXPR_IDFY_NO		 = B.TXPR_IDFY_NO
                , A.ASED_EPC_CD				 = B.EPC_CD
                , A.ASED_TVLUT_NCY_AMT        = B.TVLUT_NCY_AMT
                , A.ASED_TVLUT_USD_AMT 		 = B.TVLUT_USD_AMT
                , A.DEL_YN = 'N'
                , A.LAST_CHPR_ID = #{lastChprId}
                , A.LAST_CHG_DTTM = SYSTIMESTAMP
                FROM upsert B
                WHERE LAST_YN = 'Y' AND A.DTL_DCSH_NO = B.DTL_DCSH_NO
        )select * from upsert;
    </update>

    <!-- Réinitialisation des articles de la liquidation de la valeur de DED (ensemble des articles) !== DED 가격평가 품목 초기화 (품목 전체) ==! -->
    <update id="updateMergeVlutAudtPdlsAll" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateMergeVlutAudtPdlsAll */
        with upsert as (
            SELECT
                A.DTL_DCSH_NO
                 , A.PDLS_NO
                 , A.HS_CD
                 , A.QTY_UT_CD
                 , A.ORCY_CNTY_CD
                 , A.QTA_APRE_NO
                 , (SELECT EPC_CD FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = A.DTL_DCSH_NO AND DEL_YN = 'N') AS EPC_CD
                 , A.APC_CD
                 , A.PRVL_CD
                 , A.PRC_DTRM_MEAN_CD
                 , A.PDLS_TTWG
                 , A.PDLS_NTWG
                 , B.PDLS_INVC_CURR_CD
                 , B.PDLS_INVC_FXRT
                 , B.PDLS_INVC_AMT
                 , B.PDLS_INVC_NCY_AMT
                 , B.PDLS_INVC_USD_AMT
                 , B.PDLS_CACH_CURR_CD
                 , B.PDLS_CACH_FXRT
                 , B.PDLS_CACH_AMT
                 , B.PDLS_CACH_NCY_AMT
                 , B.PDLS_INFEE_CURR_CD
                 , B.PDLS_INFEE_FXRT
                 , B.PDLS_INFEE_AMT
                 , B.PDLS_INFEE_NCY_AMT
                 , B.PDLS_OTCST_CURR_CD
                 , B.PDLS_OTCST_FXRT
                 , B.PDLS_OTCST_AMT
                 , B.PDLS_OTCST_NCY_AMT
                 , B.PDLS_DDCT_CURR_CD
                 , B.PDLS_DDCT_FXRT
                 , B.PDLS_DDCT_AMT
                 , B.PDLS_DDCT_NCY_AMT
                 , B.PDLS_TXBS_NCY_AMT
                 , B.PDLS_TXBS_USD_AMT
                 , B.PDLS_VLUT_NCY_AMT
                 , B.PDLS_VLUT_USD_AMT
                 , B.PDLS_MPRC_TP_CD
                 , B.PDLS_MPRC_CURR_CD
                 , B.PDLS_MPRC_BASE_VAL
                 , B.PDLS_MPRC_UT_AMT
                 , B.PDLS_MPRC_NCY_AMT
                 , B.PDLS_MPRC_USD_AMT
                 , C.PRC_EV_DGCNT
            FROM TB_CLRI_DED_PDLS A
               , TB_CLRI_DED_VLUT_PDLS B
               , TB_CLRI_DED_VLUT_AUDT_COMN C
            WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO
              AND A.PDLS_NO = B.PDLS_NO
              AND A.DTL_DCSH_NO = C.DTL_DCSH_NO
              AND C.LAST_YN = 'Y'
              AND A.DEL_YN = 'N'
              AND B.DEL_YN = 'N'
              AND C.DEL_YN = 'N'
              AND A.DTL_DCSH_NO = #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
        )
           , UPDATE_OPTION AS (
            UPDATE TB_CLRI_DED_VLUT_AUDT_PDLS A SET
                A.ASED_HS_CD = B.HS_CD
                , A.ASED_ORCY_CNTY_CD = B.ORCY_CNTY_CD
                , A.ASED_APC_CD = B.APC_CD
                , A.ASED_PRVL_CD = B.PRVL_CD
                , A.ASED_PRC_DTRM_MEAN_CD = B.PRC_DTRM_MEAN_CD
                , A.ASED_PDLS_TTWG = B.PDLS_TTWG
                , A.ASED_PDLS_NTWG = B.PDLS_NTWG
                , A.ASED_PDLS_INVC_CURR_CD = B.PDLS_INVC_CURR_CD
                , A.ASED_PDLS_INVC_FXRT = B.PDLS_INVC_FXRT
                , A.ASED_PDLS_INVC_AMT = B.PDLS_INVC_AMT
                , A.ASED_PDLS_INVC_NCY_AMT = B.PDLS_INVC_NCY_AMT
                , A.ASED_PDLS_INVC_USD_AMT = B.PDLS_INVC_USD_AMT
                , A.ASED_PDLS_CACH_CURR_CD = B.PDLS_CACH_CURR_CD
                , A.ASED_PDLS_CACH_FXRT = B.PDLS_CACH_FXRT
                , A.ASED_PDLS_CACH_AMT = B.PDLS_CACH_AMT
                , A.ASED_PDLS_CACH_NCY_AMT = B.PDLS_CACH_NCY_AMT
                , A.ASED_PDLS_INFEE_CURR_CD = B.PDLS_INFEE_CURR_CD
                , A.ASED_PDLS_INFEE_FXRT = B.PDLS_INFEE_FXRT
                , A.ASED_PDLS_INFEE_AMT = B.PDLS_INFEE_AMT
                , A.ASED_PDLS_INFEE_NCY_AMT = B.PDLS_INFEE_NCY_AMT
                , A.ASED_PDLS_OTCST_CURR_CD = B.PDLS_OTCST_CURR_CD
                , A.ASED_PDLS_OTCST_FXRT = B.PDLS_OTCST_FXRT
                , A.ASED_PDLS_OTCST_AMT = B.PDLS_OTCST_AMT
                , A.ASED_PDLS_OTCST_NCY_AMT = B.PDLS_OTCST_NCY_AMT
                , A.ASED_PDLS_DDCT_FXRT = B.PDLS_DDCT_FXRT
                , A.ASED_PDLS_DDCT_AMT = B.PDLS_DDCT_AMT
                , A.ASED_PDLS_DDCT_NCY_AMT = B.PDLS_DDCT_NCY_AMT
                , A.ASED_PDLS_TXBS_NCY_AMT = B.PDLS_TXBS_NCY_AMT
                , A.ASED_PDLS_TXBS_USD_AMT = B.PDLS_TXBS_USD_AMT
                , A.ASED_PDLS_VLUT_NCY_AMT = B.PDLS_VLUT_NCY_AMT
                , A.ASED_PDLS_VLUT_USD_AMT = B.PDLS_VLUT_USD_AMT
                , A.ASED_PDLS_MPRC_TP_CD   = B.PDLS_MPRC_TP_CD
                , A.ASED_PDLS_MPRC_CURR_CD = B.PDLS_MPRC_CURR_CD
                , A.ASED_PDLS_MPRC_BASE_VAL = B.PDLS_MPRC_BASE_VAL
                , A.ASED_PDLS_MPRC_UT_AMT = B.PDLS_MPRC_UT_AMT
                , A.ASED_PDLS_MPRC_NCY_AMT = B.PDLS_MPRC_NCY_AMT
                , A.ASED_PDLS_MPRC_USD_AMT = B.PDLS_MPRC_USD_AMT
                , A.LAST_CHPR_ID = #{lastChprId}
                , A.LAST_CHG_DTTM = SYSTIMESTAMP
                FROM upsert B
                WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO AND A.PDLS_NO = B.PDLS_NO
                    AND A.PRC_EV_DGCNT = B.PRC_EV_DGCNT
        )select * from upsert;

    </update>

    <!-- Réinitialisation des modèles de la liquidation de la valeur de DED (ensemble) !== DED 가격평가 모델규격 초기화 (전체) ==! -->
    <update id="updateMergeVlutAudtMdlStszAll" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateMergeVlutAudtMdlStszAll */
        with upsert as (
            SELECT
                A.DTL_DCSH_NO
                 , A.PDLS_NO
                 , A.MDL_STSZ_NO
                 , A.QTY
                 , A.QTY_UT_CD
                 , A.UT_PRC
                 , A.INVC_AMT
                 , C.PRC_EV_DGCNT
            FROM TB_CLRI_DED_MDL_STSZ A
               , TB_CLRI_DED_VLUT_AUDT_MDL_STSZ B
               , TB_CLRI_DED_VLUT_AUDT_COMN C
            WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO
              AND A.PDLS_NO = B.PDLS_NO
              AND A.MDL_STSZ_NO = B.MDL_STSZ_NO
              AND A.DTL_DCSH_NO = C.DTL_DCSH_NO
              AND B.PRC_EV_DGCNT = C.PRC_EV_DGCNT
              AND C.LAST_YN = 'Y'
              AND A.DEL_YN = 'N'
              AND B.DEL_YN = 'N'
              AND C.DEL_YN = 'N'
              AND A.DTL_DCSH_NO = #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
        )
           , UPDATE_OPTION AS (
            UPDATE TB_CLRI_DED_VLUT_AUDT_MDL_STSZ A SET
                A.ASED_QTY = B.QTY
                , A.ASED_QTY_UT_CD = B.QTY_UT_CD
                , A.ASED_UT_PRC = B.UT_PRC
                , A.ASED_INVC_PRC = B.INVC_AMT
                , A.PRC_EV_CN = NULL
                , A.LAST_CHPR_ID = #{lastChprId}
                , A.LAST_CHG_DTTM = SYSTIMESTAMP
                FROM upsert B
                WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO AND A.PDLS_NO = B.PDLS_NO
                    AND A.MDL_STSZ_NO = B.MDL_STSZ_NO
                    AND A.PRC_EV_DGCNT = B.PRC_EV_DGCNT
        )select * from upsert;
    </update>

    <!-- Réinitialisation des taxes du contrôle de la liquidation de la valeur de DED !== DED 가격평가심사 세금 초기화 ==! -->
    <delete id="deleteVlutAudtTax" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtPdlsDcshVo">
        /* deleteVlutAudtTax */
        DELETE FROM TB_CLRI_DED_VLUT_AUDT_TAX
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND PRC_EV_DGCNT = ( SELECT PRC_EV_DGCNT
                               FROM TB_CLRI_DED_VLUT_AUDT_COMN
                               WHERE DTL_DCSH_NO = #{dtlDcshNo}
                                 AND LAST_YN ='Y'
                                 AND DEL_YN ='N'
        )

    </delete>

    <!-- Enregistrement des taxes du contrôle de la liquidation de la valeur de DED !== DED 가격평가심사 세금 등록 ==! -->
    <insert id="insertVlutAudtTax" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtPdlsDcshVo">
        /* insertVlutAudtTax */
        INSERT INTO TB_CLRI_DED_VLUT_AUDT_TAX
        (
            DTL_DCSH_NO
        , PRC_EV_DGCNT
        , PDLS_NO
        , TAX_CD
        , TXBS_AMT
        , TXRT
        , TAX_AMT
        , PAY_TAX_AMT
        , PAY_KND_CD
        , RDEX_PT_CD
        , RDEX_CD
        , RDEX_AMT
        , RDEX_BASE_AMT
        , RDEX_TXRT
        , MG_DSCN_APLY_AMT
        , bscs_txbs_amt
        , bscs_txrt
        , bscs_tax_amt
        , TFRT_CTGY_CD
        , DEL_YN
        , FRST_REGST_ID
        , FRST_RGSR_DTTM
        , LAST_CHPR_ID
        , LAST_CHG_DTTM
        )
        SELECT
            DTL_DCSH_NO
             , (SELECT PRC_EV_DGCNT FROM TB_CLRI_DED_VLUT_AUDT_COMN
                WHERE DTL_DCSH_NO = #{dtlDcshNo}
                  AND LAST_YN ='Y'
                  AND DEL_YN ='N'
        ) AS PRC_EV_DGCNT
             , PDLS_NO
             , TAX_CD
             , TXBS_AMT
             , TXRT
             , TAX_AMT
             , PAY_TAX_AMT
             , PAY_KND_CD
             , RDEX_PT_CD
             , RDEX_CD
             , RDEX_AMT
             , RDEX_BASE_AMT
             , RDEX_TXRT
             , MG_DSCN_APLY_AMT
             , bscs_txbs_amt
             , bscs_txrt
             , bscs_tax_amt
             , TFRT_CTGY_CD
             , DEL_YN
             , #{frstRegstId}
             , SYSTIMESTAMP
             , #{lastChprId}
             , SYSTIMESTAMP
        FROM TB_CLRI_DED_TAX
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND DEL_YN = 'N'


    </insert>

    <!-- Réinitialisation des articles de la liquidation de la valeur de DED !== DED 가격평가 품목 초기화 ==! -->
    <update id="updateMergeVlutAudtPdls" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtPdlsDcshVo">
        /* updateMergeVlutAudtPdls */
        with upsert as (
            SELECT
                A.DTL_DCSH_NO
                 , A.PDLS_NO
                 , A.HS_CD
                 , A.QTY_UT_CD
                 , A.ORCY_CNTY_CD
                 , A.QTA_APRE_NO
                 , (SELECT EPC_CD FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = A.DTL_DCSH_NO AND DEL_YN = 'N') AS EPC_CD
                 , A.APC_CD
                 , A.PRVL_CD
                 , A.PRC_DTRM_MEAN_CD
                 , A.PDLS_TTWG
                 , A.PDLS_NTWG
                 , B.PDLS_INVC_CURR_CD
                 , B.PDLS_INVC_FXRT
                 , B.PDLS_INVC_AMT
                 , B.PDLS_INVC_NCY_AMT
                 , B.PDLS_INVC_USD_AMT
                 , B.PDLS_CACH_CURR_CD
                 , B.PDLS_CACH_FXRT
                 , B.PDLS_CACH_AMT
                 , B.PDLS_CACH_NCY_AMT
                 , B.PDLS_INFEE_CURR_CD
                 , B.PDLS_INFEE_FXRT
                 , B.PDLS_INFEE_AMT
                 , B.PDLS_INFEE_NCY_AMT
                 , B.PDLS_OTCST_CURR_CD
                 , B.PDLS_OTCST_FXRT
                 , B.PDLS_OTCST_AMT
                 , B.PDLS_OTCST_NCY_AMT
                 , B.PDLS_DDCT_CURR_CD
                 , B.PDLS_DDCT_FXRT
                 , B.PDLS_DDCT_AMT
                 , B.PDLS_DDCT_NCY_AMT
                 , B.PDLS_TXBS_NCY_AMT
                 , B.PDLS_TXBS_USD_AMT
                 , B.PDLS_VLUT_NCY_AMT
                 , B.PDLS_VLUT_USD_AMT
                 , B.PDLS_MPRC_TP_CD
                 , B.PDLS_MPRC_CURR_CD
                 , B.PDLS_MPRC_BASE_VAL
                 , B.PDLS_MPRC_UT_AMT
                 , B.PDLS_MPRC_NCY_AMT
                 , B.PDLS_MPRC_USD_AMT
                 , C.PRC_EV_DGCNT
            FROM TB_CLRI_DED_PDLS A
               , TB_CLRI_DED_VLUT_PDLS B
               , TB_CLRI_DED_VLUT_AUDT_COMN C
            WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO
              AND A.PDLS_NO = B.PDLS_NO
              AND A.DTL_DCSH_NO = C.DTL_DCSH_NO
              AND C.LAST_YN = 'Y'
              AND A.DEL_YN = 'N'
              AND B.DEL_YN = 'N'
              AND C.DEL_YN = 'N'
            AND  A.DTL_DCSH_NO = #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
            AND A.PDLS_NO =  #{pdlsNo}
        )
           , UPDATE_OPTION AS (
            UPDATE TB_CLRI_DED_VLUT_AUDT_PDLS A SET
                A.ASED_HS_CD = B.HS_CD
                , A.ASED_ORCY_CNTY_CD = B.ORCY_CNTY_CD
                , A.ASED_APC_CD = B.APC_CD
                , A.ASED_PRVL_CD = B.PRVL_CD
                , A.ASED_PRC_DTRM_MEAN_CD = B.PRC_DTRM_MEAN_CD
                , A.ASED_PDLS_TTWG = B.PDLS_TTWG
                , A.ASED_PDLS_NTWG = B.PDLS_NTWG
                , A.ASED_PDLS_INVC_CURR_CD = B.PDLS_INVC_CURR_CD
                , A.ASED_PDLS_INVC_FXRT = B.PDLS_INVC_FXRT
                , A.ASED_PDLS_INVC_AMT = B.PDLS_INVC_AMT
                , A.ASED_PDLS_INVC_NCY_AMT = B.PDLS_INVC_NCY_AMT
                , A.ASED_PDLS_INVC_USD_AMT = B.PDLS_INVC_NCY_AMT
                , A.ASED_PDLS_CACH_CURR_CD = B.PDLS_CACH_CURR_CD
                , A.ASED_PDLS_CACH_FXRT = B.PDLS_CACH_FXRT
                , A.ASED_PDLS_CACH_AMT = B.PDLS_CACH_AMT
                , A.ASED_PDLS_CACH_NCY_AMT = B.PDLS_CACH_NCY_AMT
                , A.ASED_PDLS_INFEE_CURR_CD = B.PDLS_INFEE_CURR_CD
                , A.ASED_PDLS_INFEE_FXRT = B.PDLS_INFEE_FXRT
                , A.ASED_PDLS_INFEE_AMT = B.PDLS_INFEE_AMT
                , A.ASED_PDLS_INFEE_NCY_AMT = B.PDLS_INFEE_NCY_AMT
                , A.ASED_PDLS_OTCST_CURR_CD = B.PDLS_OTCST_CURR_CD
                , A.ASED_PDLS_OTCST_FXRT = B.PDLS_OTCST_FXRT
                , A.ASED_PDLS_OTCST_AMT = B.PDLS_OTCST_AMT
                , A.ASED_PDLS_OTCST_NCY_AMT = B.PDLS_OTCST_NCY_AMT
                , A.ASED_PDLS_DDCT_FXRT = B.PDLS_DDCT_FXRT
                , A.ASED_PDLS_DDCT_AMT = B.PDLS_DDCT_AMT
                , A.ASED_PDLS_DDCT_NCY_AMT = B.PDLS_DDCT_NCY_AMT
                , A.ASED_PDLS_TXBS_NCY_AMT = B.PDLS_TXBS_NCY_AMT
                , A.ASED_PDLS_TXBS_USD_AMT = B.PDLS_TXBS_USD_AMT
                , A.ASED_PDLS_VLUT_NCY_AMT = B.PDLS_VLUT_NCY_AMT
                , A.ASED_PDLS_VLUT_USD_AMT = B.PDLS_VLUT_USD_AMT
                , A.ASED_PDLS_MPRC_TP_CD   = B.PDLS_MPRC_TP_CD
                , A.ASED_PDLS_MPRC_CURR_CD = B.PDLS_MPRC_CURR_CD
                , A.ASED_PDLS_MPRC_BASE_VAL = B.PDLS_MPRC_BASE_VAL
                , A.ASED_PDLS_MPRC_UT_AMT = B.PDLS_MPRC_UT_AMT
                , A.ASED_PDLS_MPRC_NCY_AMT = B.PDLS_MPRC_NCY_AMT
                , A.ASED_PDLS_MPRC_USD_AMT = B.PDLS_MPRC_USD_AMT
                , A.LAST_CHPR_ID = #{lastChprId}
                , A.LAST_CHG_DTTM = SYSTIMESTAMP
                FROM upsert B
                WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO AND A.PDLS_NO = B.PDLS_NO
                    AND A.PRC_EV_DGCNT = B.PRC_EV_DGCNT
        )select * from upsert;
    </update>




    <!-- Réinitialisation des modèles de la liquidation de la valeur de DED (par article) !== DED 가격평가 모델규격 초기화 (품목별) ==! -->
    <update id="updateMergeVlutAudtMdlStszPrPdls" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtPdlsDcshVo">
        /* updateMergeVlutAudtMdlStszPrPdls */
        UPDATE TB_CLRI_DED_VLUT_AUDT_MDL_STSZ A SET
            A.ASED_QTY = B.QTY
          , A.ASED_QTY_UT_CD = B.QTY_UT_CD
          , A.ASED_UT_PRC = B.UT_PRC
          , A.ASED_INVC_PRC = B.INVC_AMT
          , A.PRC_EV_CN = NULL
          , A.LAST_CHPR_ID = #{lastChprId}
          , A.LAST_CHG_DTTM = SYSTIMESTAMP
        FROM (
                 SELECT
                     A.DTL_DCSH_NO
                      , A.PDLS_NO
                      , A.MDL_STSZ_NO
                      , A.QTY
                      , A.QTY_UT_CD
                      , A.UT_PRC
                      , A.INVC_AMT
                      , C.PRC_EV_DGCNT
                 FROM TB_CLRI_DED_MDL_STSZ A
                    , TB_CLRI_DED_VLUT_AUDT_MDL_STSZ B
                    , TB_CLRI_DED_VLUT_AUDT_COMN C
                 WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO
                   AND A.PDLS_NO = B.PDLS_NO
                   AND A.MDL_STSZ_NO = B.MDL_STSZ_NO
                   AND A.DTL_DCSH_NO = C.DTL_DCSH_NO
                   AND B.PRC_EV_DGCNT = C.PRC_EV_DGCNT
                   AND C.LAST_YN = 'Y'
                   AND A.DEL_YN = 'N'
                   AND B.DEL_YN = 'N'
                   AND C.DEL_YN = 'N'
                   AND A.DTL_DCSH_NO = #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
                   AND A.PDLS_NO =  #{pdlsNo}
             ) B
        WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO AND A.PDLS_NO = B.PDLS_NO
          AND A.MDL_STSZ_NO = B.MDL_STSZ_NO
          AND A.PRC_EV_DGCNT = B.PRC_EV_DGCNT;
    </update>






    <!-- Réinitialisation des modèles de la liquidation de la valeur de DED !== DED 가격평가 모델규격 초기화 ==! -->
    <update id="updateMergeVlutAudtMdlStsz" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtMdlStszDcshVo">
        /* updateMergeVlutAudtMdlStsz */
        with upsert as (
            SELECT
                A.DTL_DCSH_NO
                 , A.PDLS_NO
                 , A.MDL_STSZ_NO
                 , A.QTY
                 , A.QTY_UT_CD
                 , A.UT_PRC
                 , A.INVC_AMT
                 , C.PRC_EV_DGCNT
            FROM TB_CLRI_DED_MDL_STSZ A
               , TB_CLRI_DED_VLUT_AUDT_MDL_STSZ B
               , TB_CLRI_DED_VLUT_AUDT_COMN C
            WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO
              AND A.PDLS_NO = B.PDLS_NO
              AND A.MDL_STSZ_NO = B.MDL_STSZ_NO
              AND A.DTL_DCSH_NO = C.DTL_DCSH_NO
              AND C.LAST_YN = 'Y'
              AND A.DEL_YN = 'N'
              AND B.DEL_YN = 'N'
              AND C.DEL_YN = 'N'
            AND  DTL_DCSH_NO = #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
            AND A.PDLS_NO =  #{pdlsNo}
            AND A.MDL_STSZ_NO = #{mdlStszNo}
        )
           , UPDATE_OPTION AS (
            UPDATE TB_CLRI_DED_VLUT_AUDT_MDL_STSZ A SET
                A.ASED_QTY = B.QTY
                , A.ASED_QTY_UT_CD = B.QTY_UT_CD
                , A.ASED_UT_PRC = B.UT_PRC
                , A.ASED_INVC_PRC = B.INVC_AMT
                , A.PRC_EV_CN = NULL
                , A.DEL_YN = 'N'
                , A.LAST_CHPR_ID = #{lastChprId}
                , A.LAST_CHG_DTTM = SYSTIMESTAMP
                FROM upsert B
                WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO AND A.PDLS_NO = B.PDLS_NO
                    AND A.MDL_STSZ_NO = B.MDL_STSZ_NO
                    AND A.PRC_EV_DGCNT = B.PRC_EV_DGCNT

        )select * from upsert;
    </update>

    <!-- Mise à jour du contrôle commun de la liquidation de la valeur de DED !== DED 가격평가심사 공통 업데이트 ==! -->
    <update id="updateVlutAudtComn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateVlutAudtComn */
        UPDATE TB_CLRI_DED_VLUT_AUDT_COMN A
        SET  A.ASED_INVC_CURR_CD 	     = #{asedInvcCurrCd}
        , A.ASED_INVC_FXRT            = #{asedInvcFxrt}
        , A.ASED_INVC_AMT             = #{asedInvcAmt}
        , A.ASED_INVC_NCY_AMT         = #{asedInvcNcyAmt}
        , A.ASED_INVC_USD_AMT         = #{asedInvcUsdAmt}
        , A.ASED_CACH_CURR_CD         = #{asedCachCurrCd}
        , A.ASED_CACH_FXRT            = #{asedCachFxrt}
        , A.ASED_CACH_AMT             = #{asedCachAmt}
        , A.ASED_CACH_NCY_AMT         = #{asedCachNcyAmt}
        , A.ASED_INFEE_AMT            = #{asedInfeeAmt}
        , A.ASED_INFEE_CURR_CD        = #{asedInfeeCurrCd}
        , A.ASED_INFEE_FXRT           = #{asedInfeeFxrt}
        , A.ASED_INFEE_NCY_AMT        = #{asedInfeeNcyAmt}
        , A.ASED_OTCST_AMT            = #{asedOtcstAmt}
        , A.ASED_OTCST_CURR_CD        = #{asedOtcstCurrCd}
        , A.ASED_OTCST_FXRT           = #{asedOtcstFxrt}
        , A.ASED_OTCST_NCY_AMT        = #{asedOtcstNcyAmt}
        , A.ASED_DDCT_AMT             = #{asedDdctAmt}
        , A.ASED_DDCT_RT             = #{asedDdctRt}
        , A.ASED_DDCT_CURR_CD         = #{asedDdctCurrCd}
        , A.ASED_DDCT_FXRT            = #{asedDdctFxrt}
        , A.ASED_DDCT_NCY_AMT         = #{asedDdctNcyAmt}
        , A.ASED_TTXBS_NCY_AMT        = #{asedTtxbsNcyAmt}
        , A.ASED_TTXBS_USD_AMT        = #{asedTtxbsUsdAmt}
        , A.ASED_TVLUT_NCY_AMT		 = #{asedTvlutNcyAmt}
        , A.ASED_TVLUT_USD_AMT 		 = #{asedTvlutUsdAmt}
        <if test="asedEpcCd != null and asedEpcCd != ''">
            , A.ASED_EPC_CD = #{asedEpcCd}                  /** Code EPC liquide !== 평가된EPC코드 ==! */
        </if>
        <if test="asedImppnIdfyNo != null and asedImppnIdfyNo != ''">
            , A.ASED_IMPPN_IDFY_NO = #{asedImppnIdfyNo}                  /** N° D'Identification De L'Importateur Liquidé !== 평가된수입자식별번호 ==! */
        </if>
        <if test="asedTxprIdfyNo != null and asedTxprIdfyNo != ''">
            , A.ASED_TXPR_IDFY_NO = #{asedTxprIdfyNo}                  /** Niu Liquidé !== 평가된납세자식별번호 ==! */
        </if>
        , A.DEL_YN = 'N'
        , A.LAST_YN = 'Y'
        , A.LAST_CHPR_ID = #{lastChprId}
        , A.LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE A.DTL_DCSH_NO = #{dtlDcshNo}
        AND A.PRC_EV_DGCNT = ( SELECT MAX(PRC_EV_DGCNT)
        FROM TB_CLRI_DED_VLUT_AUDT_COMN
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
        AND DEL_YN = 'N'
        )

    </update>

    <!-- Mise à jour du contrôle des articles de la liquidation de la valeur de DED !== DED 가격평가심사 품목 업데이트 ==! -->
    <update id="updateVlutAudtPdls" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtPdlsDcshVo">
        /* updateVlutAudtPdls */
        UPDATE TB_CLRI_DED_VLUT_AUDT_PDLS
        SET
            ASED_PDLS_INVC_AMT 		= NVL(#{asedPdlsInvcAmt}, #{dcldPdlsInvcAmt})     /** Montant liquide de la facture de l'article !== 평가된품목송장금액 ==! */
          , ASED_PDLS_INVC_NCY_AMT 	= NVL(#{asedPdlsInvcNcyAmt}, #{dcldPdlsInvcNcyAmt})  /** Montant NCY liquide de la facture de l'article !== 평가된품목송장NCY금액 ==! */
          , ASED_PDLS_INVC_USD_AMT 	= NVL(#{asedPdlsInvcUsdAmt}, #{dcldPdlsInvcUsdAmt})  /** Montant USD liquide de la facture de l'article !== 평가된품목송장USD금액 ==! */
          , ASED_PDLS_CACH_AMT 		= NVL(#{asedPdlsCachAmt}, #{dcldPdlsCachAmt})     /** Montant liquide du fret de l'article !== 평가된품목운임금액 ==! */
          , ASED_PDLS_CACH_NCY_AMT 	= NVL(#{asedPdlsCachNcyAmt}, #{dcldPdlsCachNcyAmt})  /** Montant NCY liquide du fret de l'article !== 평가된품목운임NCY금액 ==! */
          , ASED_PDLS_INFEE_AMT 		= NVL(#{asedPdlsInfeeAmt}, #{dcldPdlsInfeeAmt})   /** Montant liquide de l'assurance de l'article !== 평가된품목보험료금액 ==! */
          , ASED_PDLS_INFEE_NCY_AMT 	= NVL(#{asedPdlsInfeeNcyAmt}, #{dcldPdlsInfeeNcyAmt})  /** Montant NCY liquide de l'assurance de l'article !== 평가된품목보험료NCY금액 ==! */
          , ASED_PDLS_OTCST_AMT 		= NVL(#{asedPdlsOtcstAmt}, #{dcldPdlsOtcstAmt})   /** Montant liquide des autres frais de l'article !== 평가된품목기타비용금액 ==! */
          , ASED_PDLS_OTCST_NCY_AMT 	= NVL(#{asedPdlsOtcstNcyAmt}, #{dcldPdlsOtcstNcyAmt})  /** Montant NCY liquide des autres frais de l'article !== 평가된품목기타비용NCY금액 ==! */
          , ASED_PDLS_DDCT_AMT 		= NVL(#{asedPdlsDdctAmt}, #{dcldPdlsDdctAmt})     /** Montant deduit liquide de l'article !== 평가된품목공제금액 ==! */
          , ASED_PDLS_DDCT_NCY_AMT 	= NVL(#{asedPdlsDdctNcyAmt}, #{dcldPdlsDdctNcyAmt})  /** Montant NCY deduit liquide de l'article !== 평가된품목공제NCY금액 ==! */
          , ASED_PDLS_TXBS_NCY_AMT 	= NVL(#{asedPdlsTxbsNcyAmt}, #{dcldPdlsTxbsNcyAmt})  /** Montant Ncy Liquidé De La Base Taxable De L'Article !== 평가된품목과세기준NCY금액 ==! */
          , ASED_PDLS_TXBS_USD_AMT 	= NVL(#{asedPdlsTxbsUsdAmt}, #{dcldPdlsTxbsUsdAmt})  /** Montant Usd Liquidé De La Base Taxable De L'Article !== 평가된품목과세기준USD금액 ==! */

          , ASED_PDLS_INVC_CURR_CD = #{asedPdlsInvcCurrCd}
          , ASED_PDLS_CACH_CURR_CD = #{asedPdlsCachCurrCd}
          , ASED_PDLS_INFEE_CURR_CD = #{asedPdlsInfeeCurrCd}
          , ASED_PDLS_OTCST_CURR_CD = #{asedPdlsOtcstCurrCd}
          , ASED_PDLS_DDCT_CURR_CD = #{asedPdlsDdctCurrCd}

          , ASED_PDLS_CACH_FXRT = #{asedPdlsCachFxrt}
          , ASED_PDLS_INFEE_FXRT = #{asedPdlsInfeeFxrt}
          , ASED_PDLS_OTCST_FXRT = #{asedPdlsOtcstFxrt}
          , ASED_PDLS_DDCT_FXRT = #{asedPdlsDdctFxrt}
          , ASED_PDLS_INVC_FXRT = #{asedPdlsInvcFxrt}

          , ASED_PDLS_VLUT_NCY_AMT = #{asedPdlsVlutNcyAmt}
          , ASED_PDLS_VLUT_USD_AMT = #{asedPdlsVlutUsdAmt}
          , ASED_PDLS_MPRC_BASE_VAL = #{asedPdlsMprcBaseVal}
          , ASED_PDLS_MPRC_UT_AMT = #{asedPdlsMprcUtAmt}
          , ASED_PDLS_MPRC_NCY_AMT = #{asedPdlsMprcNcyAmt}
          , ASED_PDLS_MPRC_USD_AMT = #{asedPdlsMprcUsdAmt}

          , ASED_HS_CD = #{asedHsCd}                    /** Code SH liquide !== 평가된HS코드 ==! */
          , ASED_ORCY_CNTY_CD = #{asedOrcyCntyCd}       /** Code liquide de pays d'origine  !== 평가된원산지국가코드 ==! */
          , ASED_APC_CD = #{asedApcCd}                  /** Code APC liquide !== 평가된APC코드 ==! */
          , ASED_PRVL_CD = #{asedPrvlCd}                /** Code preferentiel liquide !== 평가된특혜코드 ==! */
          , ASED_PRC_DTRM_MEAN_CD = #{asedPrcDtrmMeanCd}  /** Code liquide de methode d'evaluation  !== 평가된가격결정방법코드 ==! */
          , ASED_PDLS_TTWG = #{asedPdlsTtwg}            /** Poids net liquide de l'article !== 평가된품목총중량 ==! */
          , ASED_PDLS_NTWG = #{asedPdlsNtwg}            /** Poids net liquide de l'article !== 평가된품목순중량 ==! */

          , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
          , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
          , DEL_YN = 'N'
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND PDLS_NO = #{pdlsNo}                       /** N° d'article !== 품목번호 ==! */
          AND PRC_EV_DGCNT = ( SELECT MAX(PRC_EV_DGCNT) FROM TB_CLRI_DED_VLUT_AUDT_COMN
                               WHERE DTL_DCSH_NO = #{dtlDcshNo}
                                 AND DEL_YN = 'N'
        )


    </update>

    <!-- Mise à jour du contrôle des modèles de la liquidation de la valeur de DED !== DED 가격평가심사 모델규격 업데이트 ==! -->
    <update id="updateVlutAudtMdlStsz" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtMdlStszDcshVo">
        /* updateVlutAudtMdlStsz */
        UPDATE  TB_CLRI_DED_VLUT_AUDT_MDL_STSZ SET
            ASED_QTY = #{asedQty}                       /** Quantite liquidee !== 평가된수량 ==! */
             , ASED_QTY_UT_CD = #{asedQtyUtCd}             /** Code liquide de l'unite de quantite !== 평가된수량단위코드 ==! */
             , ASED_UT_PRC = #{asedUtPrc}                  /** Prix unitaire liquide !== 평가된단위가격 ==! */
             , ASED_INVC_PRC = #{asedInvcPrc}              /** Prix liquide de la facture !== 평가된송장가격 ==! */
             , PRC_EV_CN = #{prcEvCn}                      /** Contenu de l'evaluation de valeur !== 가격평가내용 ==! */
             , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
             , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
             , DEL_YN = 'N'
        WHERE DTL_DCSH_NO = #{dtlDcshNo}					   /** Numero du DAU !== DED번호 ==! */
          AND PDLS_NO = #{pdlsNo}                       /** N° d'article !== 품목번호 ==! */
          AND MDL_STSZ_NO = #{mdlStszNo}                /** N° de modele et specification !== 모델규격번호 ==! */
          AND PRC_EV_DGCNT = ( SELECT MAX(PRC_EV_DGCNT) FROM TB_CLRI_DED_VLUT_AUDT_COMN
                               WHERE DTL_DCSH_NO = #{dtlDcshNo}
                                 AND DEL_YN = 'N'
        )

    </update>

    <!--  DED 가격평가심사 세금 업데이트 -->
    <update id="updateVlutAudtTax" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtTaxVo">
        /* updateVlutAudtTax */
        UPDATE  TB_CLRI_DED_VLUT_AUDT_TAX SET
        <trim prefixOverrides="," >
            TXBS_AMT = #{txbsAmt}                       /** Montant de la valeur statistique !== 과세기준금액 ==! */
            , TXRT = #{txrt}                              /** Taux de taxation !== 세율 ==! */
            , TAX_AMT = #{taxAmt}                         /** Montant de la taxe !== 세금금액 ==! */
            , PAY_TAX_AMT = #{payTaxAmt}                  /** Montant de la taxe payée !== 납부세금금액 ==! */
            , PAY_KND_CD = #{payKndCd}                    /** Code de type de paiement !== 납부종류코드 ==! */
            , RDEX_PT_CD = #{rdexPtCd}                    /** Code de type d'abattement !== 감면유형코드 ==! */
            , RDEX_CD = #{rdexCd}                         /** Code additionnel !== 감면코드 ==! */
            , RDEX_AMT = #{rdexAmt}                       /** Montant abattu !== 감면금액 ==! */
            , RDEX_BASE_AMT = #{rdexBaseAmt}
            , RDEX_TXRT = #{rdexTxrt}
            , RDEX_BASE_AMT = #{rdexBaseAmt}
            , RDEX_TXRT = #{rdexTxrt}
            , MG_DSCN_APLY_AMT = #{mgDscnAplyAmt}         /** Montant de caution après abattement !== 담보할인적용금액 ==! */
            , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
            , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
        </trim>
        WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
        AND  DTL_DCSH_NO = #{dtlDcshNo}                           /** Numéro du DAU !== DED번호 ==! */
        AND  PRC_EV_DGCNT = (  SELECT PRC_EV_DGCNT FROM TB_CLRI_DED_VLUT_AUDT_COMN
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
        AND LAST_YN ='Y'
        AND DEL_YN ='N'
        )                    /** Degrée de l'évaluation de valeur !== 가격평가차수 ==! */
        AND  PDLS_NO = #{pdlsNo}                         /** N° d'article !== 품목번호 ==! */
        AND  TAX_CD = #{taxCd}                           /** Code De Taxe  !== 세금코드 ==! */

    </update>

    <!--  DED 가격평가심사 세금 업데이트  (품목번호 0 )-->
    <update id="mergeUpdateVlutAudtTax" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtTaxVo">
        /* mergeUpdateVlutAudtTax */
        with upsert as (
            SELECT
                DTL_DCSH_NO
                 , PRC_EV_DGCNT
                 , TAX_CD
                 , 0 AS PDLS_NO
                 , SUM(TXBS_AMT) AS TXBS_AMT
                 , SUM(TAX_AMT) AS TAX_AMT
                 , SUM(PAY_TAX_AMT) AS PAY_TAX_AMT
                 , SUM(RDEX_AMT) AS RDEX_AMT
                 , SUM(RDEX_BASE_AMT) AS RDEX_BASE_AMT
                 , SUM(MG_DSCN_APLY_AMT) AS MG_DSCN_APLY_AMT

            FROM TB_CLRI_DED_VLUT_AUDT_TAX
            WHERE DTL_DCSH_NO = #{dtlDcshNo}
              AND PRC_EV_DGCNT = (  SELECT MAX(PRC_EV_DGCNT) FROM TB_CLRI_DED_VLUT_AUDT_COMN
                                    WHERE DTL_DCSH_NO = #{dtlDcshNo}
                                      AND DEL_YN = 'N'
            )
              AND PDLS_NO != '0'
            GROUP BY DTL_DCSH_NO
                   , PRC_EV_DGCNT
                   , TAX_CD
        )
           , UPDATE_OPTION AS (
            UPDATE TB_CLRI_DED_VLUT_AUDT_TAX A SET
                A.TXBS_AMT = B.TXBS_AMT
                , A.TAX_AMT = B.TAX_AMT
                , A.PAY_TAX_AMT = B.PAY_TAX_AMT
                , A.RDEX_AMT = B.RDEX_AMT
                , A.RDEX_BASE_AMT = B.RDEX_BASE_AMT
                , A.MG_DSCN_APLY_AMT = B.MG_DSCN_APLY_AMT
                , A.LAST_CHPR_ID = #{lastChprId}
                , A.LAST_CHG_DTTM = SYSTIMESTAMP
                FROM upsert B
                WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO AND A.PDLS_NO = B.PDLS_NO
                    AND A.PRC_EV_DGCNT = B.PRC_EV_DGCNT AND A.TAX_CD = B.TAX_CD

        )select * from upsert;

    </update>

    <!-- 가격평가 컨테이너 등록  -->
    <insert id="mergeInsertDedVlutcntr" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrVlutCntrVo">
        /* mergeInsertDedVlutcntr */
        <selectKey keyProperty="prcEvDgcnt" resultType="BigDecimal" order="BEFORE">
            SELECT PRC_EV_DGCNT FROM TB_CLRI_DED_VLUT_AUDT_COMN WHERE DTL_DCSH_NO =  #{dtlDcshNo} AND LAST_YN = 'Y' AND DEL_YN = 'N'
        </selectKey>
        INSERT INTO TB_CLRI_VLUT_CNTR (
        dtl_dcsh_no                            /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
        , prc_ev_dgcnt                         /** Nombre De Fois De L'Évaluation De Valeur !== 가격평가차수 ==! */
        , cntr_srno                            /** N° De Séquence Du Conteneur !== 컨테이너일련번호 ==! */
        , cntr_no                              /** N° De Conteneur !== 컨테이너번호 ==! */
        , cntr_tp_cd                           /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
        , cntr_stfn_stts_cd                    /** Code De L'État D'Empotage Du Conteneur !== 컨테이너적입상태코드 ==! */
        , seal_no1                             /** N° De Scellé1 !== 봉인번호1 ==! */
        , seal_no2                             /** N° De Scellé1 !== 봉인번호2 ==! */
        , seal_no3                             /** N° De Scellé3 !== 봉인번호3 ==! */
        , seal_chpn1                         /** Code De La Personne Scellant !== 봉인담당자코드 ==! */
        , seal_chpn2                         /** Code De La Personne Scellant !== 봉인담당자코드 ==! */
        , seal_chpn3                         /** Code De La Personne Scellant !== 봉인담당자코드 ==! */
        , del_yn                               /** Suppression On !== 삭제여부 ==! */
        , frst_regst_id                        /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
        , frst_rgsr_dttm                              /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
        , last_chpr_id                         /** Id Du Modificateur Final !== 최종변경자ID ==! */
        , last_chg_dttm                               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        ) VALUES (
        #{dtlDcshNo}                           /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
        , #{prcEvDgcnt}                                /** Nombre De Fois De L'Évaluation De Valeur !== 가격평가차수 ==! */
        , #{cntrSrno}                                  /** N° De Séquence Du Conteneur !== 컨테이너일련번호 ==! */
        , #{cntrNo}                                    /** N° De Conteneur !== 컨테이너번호 ==! */
        , #{cntrTpCd}                                  /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
        , #{cntrStfnSttsCd}                            /** Code De L'État D'Empotage Du Conteneur !== 컨테이너적입상태코드 ==! */
        , #{sealNo1}                                   /** N° De Scellé1 !== 봉인번호1 ==! */
        , #{sealNo2}                                   /** N° De Scellé1 !== 봉인번호2 ==! */
        , #{sealNo3}                                   /** N° De Scellé3 !== 봉인번호3 ==! */
        , #{sealChpn1}                                /** Code De La Personne Scellant !== 봉인담당자코드 ==! */
        , #{sealChpn2}                                /** Code De La Personne Scellant !== 봉인담당자코드 ==! */
        , #{sealChpn3}                                /** Code De La Personne Scellant !== 봉인담당자코드 ==! */
        , 'N'                                          /** Suppression On !== 삭제여부 ==! */
        , #{frstRegstId}                               /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
        , SYSTIMESTAMP                                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
        , #{lastChprId}                                /** Id Du Modificateur Final !== 최종변경자ID ==! */
        , SYSTIMESTAMP                                /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        )
        ON CONFLICT ( dtl_dcsh_no,prc_ev_dgcnt,cntr_srno )
        DO UPDATE SET
          last_chpr_id = #{lastChprId}                         /** Id Du Modificateur Final !== 최종변경자ID ==! */
        , last_chg_dttm = SYSTIMESTAMP                               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */                      
        <if test="cntrNo != null">
            , CNTR_NO = #{cntrNo}
        </if>
        <if test="cntrTpCd != null">
            , CNTR_TP_CD = #{cntrTpCd}
        </if>
        <if test="cntrStfnSttsCd != null">
            , CNTR_STFN_STTS_CD = #{cntrStfnSttsCd}
        </if>
        <if test="sealNo1 != null">
            , SEAL_NO1 = #{sealNo1}
        </if>
        <if test="sealNo2 != null">
            , SEAL_NO2 = #{sealNo2}
        </if>
        <if test="sealNo3 != null">
            , SEAL_NO3 = #{sealNo3}
        </if>
        <if test="sealChpn1 != null">
            , SEAL_CHPN1 = #{sealChpn1}
        </if>
        <if test="sealChpn2 != null">
            , SEAL_CHPN2 = #{sealChpn2}
        </if>
        <if test="sealChpn3 != null">
            , SEAL_CHPN3 = #{sealChpn3}
        </if>
    </insert>


    <!-- 가격평가 컨테이너 삭제  -->
    <delete id="deleteDedVlutcntr" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrVlutCntrDcshVo" >
        /* deleteDedVlutcntr */
        DELETE FROM TB_CLRI_VLUT_CNTR
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND PRC_EV_DGCNT = #{prcEvDgcnt}

    </delete>

    <!--
        * SQL 설명 : Modification de l'état de traitement de la liquidation de la valeur !== 가격평가 처리상태 수정 ==!
        * 작성자 : 김기룡
    -->
    <update id="updateVlutPrcsStts" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtComnVo" >
        /* updateVlutPrcsStts */
        UPDATE TB_CLRI_DED_VLUT_AUDT_COMN
        SET VLUT_PRCS_STTS_CD = #{vlutPrcsSttsCd}
          , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
          , LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND PRC_EV_DGCNT = (SELECT PRC_EV_DGCNT FROM TB_CLRI_DED_VLUT_AUDT_COMN WHERE DTL_DCSH_NO =  #{dtlDcshNo} AND LAST_YN = 'Y' AND DEL_YN = 'N')
          AND DEL_YN = 'N'
    </update>

    <!--
        * SQL 설명 : Modification du statut de la liquidation en 'N' !== 가격평가수리처리여부 'N' 업데이트 ==!
        * 작성자 : 김기룡
    -->
    <update id="updateVlutAcptPrcsYn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedAdrtVo" >
        /* updateVlutAcptPrcsYn */
        UPDATE TB_CLRI_DED_ADRT
        SET VLUT_ACPT_PRCS_YN = 'N'
          , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
          , LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND PRC_EV_DGCNT = #{prcEvDgcnt}
          AND DEL_YN = 'N'
    </update>

    <!--
        * SQL 설명 : Mise à jour de numéro de notification du table du contrôle commun de la liquidation de la valeur !== 가격평가심사공통 테이블의 고지번호 업데이트 ==!
        * 작성자 : 김기룡
    -->
    <update id="updateDedVlutAudtComnNtfcNo" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo" >
        /* updateDedVlutAudtComnNtfcNo */
        UPDATE TB_CLRI_DED_VLUT_AUDT_COMN
        SET NTFC_NO = #{ntfcNo}
          , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
          , LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND PRC_EV_DGCNT = #{prcEvDgcnt}
          AND DEL_YN = 'N'
    </update>

    <!--
        * SQL 설명 : Modification de LAST_YN de contrôle commun de la liquidation de la valeur  (Y -> N) !== 가격평가심사공통 LAST_YN 수정 (Y -> N) ==!
        * 작성자 : 김기룡
    -->
    <update id="updateDedVlutAudtComnLastYn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateDedVlutAudtComnLastYn */
        UPDATE TB_CLRI_DED_VLUT_AUDT_COMN
        SET    LAST_YN = 'N'
          , LAST_CHPR_ID = #{lastChprId}
          , LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE  DTL_DCSH_NO = #{dtlDcshNo}
          AND    LAST_YN = 'Y'
          AND    DEL_YN = 'N'
    </update>

    <!--
    Consultation de la série séquentielle de l'estimation de la valeur finale
    !== 가격평가차수 조회 ==!
    -->
    <select id="selectPrcEvDgcnt" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedSrchVo" resultType="java.math.BigDecimal">
        /* selectPrcEvDgcnt */
        SELECT PRC_EV_DGCNT
        FROM TB_CLRI_DED_VLUT_AUDT_COMN
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND LAST_YN = 'Y'
          AND DEL_YN = 'N'
    </select>

    <!--
   Consulter l'ordre séquentielle suivante de l'estimation de la valeur
   !== 다음 가격평가차수 조회 ==!
   -->
    <select id="selectNextPrcEvDgcnt" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedSrchVo" resultType="java.math.BigDecimal">
        /* selectNextPrcEvDgcnt */
        SELECT MAX(PRC_EV_DGCNT) + 1 AS PRC_EV_DGCNT
        FROM TB_CLRI_DED_VLUT_AUDT_COMN
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND DEL_YN = 'N'
    </select>



    <!--
        * SQL 설명 : taxe pour l'estimation de la valeur [delete] !== 가격평가심사세금 delete ==!
        * 작성자 : 김기룡
    -->
    <delete id="deleteDedVlutAudtTax" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedSrchVo">
        /* deleteDedVlutAudtTax */
        DELETE FROM TB_CLRI_DED_VLUT_AUDT_TAX
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND PRC_EV_DGCNT = #{prcEvDgcnt}
    </delete>


    <!--
        * SQL 설명 : taxe pour l'estimation de la valeur [Merge] !== 가격평가심사세금 mergeInsert ==!
        * 작성자 : 김기룡
    -->
    <update id="mergeInsertDedVlutAudtTax" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtTaxVo">
        /* mergeInsertDedVlutAudtTax */
        INSERT INTO TB_CLRI_DED_VLUT_AUDT_TAX (
            dtl_dcsh_no                            /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
        , prc_ev_dgcnt                         /** Nombre De Fois De L'Évaluation De Valeur !== 가격평가차수 ==! */
        , pdls_no                              /** N° D'Article !== 품목번호 ==! */
        , tax_cd                               /** Code De Taxe !== 세금코드 ==! */
        , txbs_amt                             /** Montant de base d'imposition !== 과세기준금액 ==! */
        , tfrt_ctgy_cd                         /** Code de categorie du tarif !== 관세율카테고리코드 ==! */
        , txrt                                 /** Taux d'imposition !== 세율 ==! */
        , tax_amt                              /** Montant De La Taxe !== 세금금액 ==! */
        , pay_tax_amt                          /** Montant De La Taxe Payée !== 납부세금금액 ==! */
        , pay_knd_cd                           /** Code De Type De Paiement !== 납부종류코드 ==! */
        , rdex_pt_cd                           /** Code De Type D'Exonération !== 감면유형코드 ==! */
        , rdex_cd                              /** Code d'avantage fiscaux !== 감면코드 ==! */
        , rdex_amt                             /** Montant exonere !== 감면금액 ==! */
        , rdex_base_amt                        /** Montant de la base de l'exoneration !== 감면기준금액 ==! */
        , rdex_txrt                            /** Taux de taxation exonere !== 감면세율 ==! */
        , mg_dscn_aply_amt                     /** Montant de caution après l'exemption de la garantie !== 담보할인적용금액 ==! */
        , bscs_txbs_amt                        /** Montant De La Base Taxable Basique !== 기본과세기준금액 ==! */
        , bscs_txrt                            /** Taux d'imposition de base !== 기본세율 ==! */
        , bscs_tax_amt                         /** Montant De La Taxe Basique !== 기본세금금액 ==! */
        , del_yn                               /** Suppression On !== 삭제여부 ==! */
        , frst_regst_id                        /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
        , frst_rgsr_dttm                              /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
        , last_chpr_id                         /** Id Du Modificateur Final !== 최종변경자ID ==! */
        , last_chg_dttm                               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        ) VALUES (
             #{dtlDcshNo}                           /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
         , #{prcEvDgcnt}                                /** Nombre De Fois De L'Évaluation De Valeur !== 가격평가차수 ==! */
         , #{pdlsNo}                                    /** N° D'Article !== 품목번호 ==! */
         , #{taxCd}                                     /** Code De Taxe !== 세금코드 ==! */
         , #{txbsAmt}                                   /** Montant de base d'imposition !== 과세기준금액 ==! */
         , #{tfrtCtgyCd}                                /** Code de categorie du tarif !== 관세율카테고리코드 ==! */
         , #{txrt}                                      /** Taux d'imposition !== 세율 ==! */
         , #{taxAmt}                                    /** Montant De La Taxe !== 세금금액 ==! */
         , #{payTaxAmt}                                 /** Montant De La Taxe Payée !== 납부세금금액 ==! */
         , #{payKndCd}                                  /** Code De Type De Paiement !== 납부종류코드 ==! */
         , #{rdexPtCd}                                  /** Code De Type D'Exonération !== 감면유형코드 ==! */
         , #{rdexCd}                                    /** Code d'avantage fiscaux !== 감면코드 ==! */
         , #{rdexAmt}                                   /** Montant exonere !== 감면금액 ==! */
         , #{rdexBaseAmt}                               /** Montant de la base de l'exoneration !== 감면기준금액 ==! */
         , #{rdexTxrt}                                  /** Taux de taxation exonere !== 감면세율 ==! */
         , #{mgDscnAplyAmt}                             /** Montant de caution après l'exemption de la garantie !== 담보할인적용금액 ==! */
         , #{bscsTxbsAmt}                               /** Montant De La Base Taxable Basique !== 기본과세기준금액 ==! */
         , #{bscsTxrt}                                  /** Taux d'imposition de base !== 기본세율 ==! */
         , #{bscsTaxAmt}                                /** Montant De La Taxe Basique !== 기본세금금액 ==! */
         , 'N'                                          /** Suppression On !== 삭제여부 ==! */
         , #{frstRegstId}                               /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
         , SYSTIMESTAMP                                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
         , #{lastChprId}                                /** Id Du Modificateur Final !== 최종변경자ID ==! */
         , SYSTIMESTAMP                                /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
                 )
        ON CONFLICT ( dtl_dcsh_no,prc_ev_dgcnt,pdls_no,tax_cd )
            DO UPDATE SET
            txbs_amt = #{txbsAmt}                                 /** Montant de base d'imposition !== 과세기준금액 ==! */
            ,tfrt_ctgy_cd = #{tfrtCtgyCd}                         /** Code de categorie du tarif !== 관세율카테고리코드 ==! */
            ,txrt = #{txrt}                                       /** Taux d'imposition !== 세율 ==! */
            ,tax_amt = #{taxAmt}                                  /** Montant De La Taxe !== 세금금액 ==! */
            ,pay_tax_amt = #{payTaxAmt}                           /** Montant De La Taxe Payée !== 납부세금금액 ==! */
            ,pay_knd_cd = #{payKndCd}                             /** Code De Type De Paiement !== 납부종류코드 ==! */
            ,rdex_pt_cd = #{rdexPtCd}                             /** Code De Type D'Exonération !== 감면유형코드 ==! */
            ,rdex_cd = #{rdexCd}                                  /** Code d'avantage fiscaux !== 감면코드 ==! */
            ,rdex_amt = #{rdexAmt}                                /** Montant exonere !== 감면금액 ==! */
            ,rdex_base_amt = #{rdexBaseAmt}                       /** Montant de la base de l'exoneration !== 감면기준금액 ==! */
            ,rdex_txrt = #{rdexTxrt}                              /** Taux de taxation exonere !== 감면세율 ==! */
            ,mg_dscn_aply_amt = #{mgDscnAplyAmt}                  /** Montant de caution après l'exemption de la garantie !== 담보할인적용금액 ==! */
            ,bscs_txbs_amt = #{bscsTxbsAmt}                       /** Montant De La Base Taxable Basique !== 기본과세기준금액 ==! */
            ,bscs_txrt = #{bscsTxrt}                              /** Taux d'imposition de base !== 기본세율 ==! */
            ,bscs_tax_amt = #{bscsTaxAmt}                         /** Montant De La Taxe Basique !== 기본세금금액 ==! */
            ,last_chpr_id = #{lastChprId}                         /** Id Du Modificateur Final !== 최종변경자ID ==! */
            , last_chg_dttm = SYSTIMESTAMP                               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */

    </update>

    <!--
        * SQL 설명 : Consultation de contrôle/liquidation terminé o/n de la liquidation de la valeur !== 가격평가 평가/심사완료 여부 조회 ==!
        * 작성자 : 김기룡
    -->
    <select id="selectVlutEvAudtCmplYn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo" resultType="java.lang.String">
        /* selectVlutEvAudtCmplYn */
        SELECT 1 AS  VLUT_EV_AUDT_CMPL_YN
        FROM TB_CLRI_DED_VLUT_AUDT_COMN
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND DEL_YN = 'N'
          AND LAST_YN = 'Y'
          AND VLUT_PRCS_STTS_CD IN ('D03','D06','D08')
    </select>

    <!--
        * SQL 설명 : taxe pour l'estimation de la valeur[Comn Insert] !== DED 가격평가심사 공통 insert ==!
        * 작성자 : 김기룡
    -->
    <insert id="insertVlutAudtComn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* insertVlutAudtComn */
        INSERT
        INTO TB_CLRI_DED_VLUT_AUDT_COMN
        ( DTL_DCSH_NO                     /** Numéro du DAU !== DED번호 ==! */
        , PRC_EV_DGCNT               /** Degrée de l'évaluation de valeur !== 가격평가차수 ==! */
        , HIST_SRNO                  /** N° de séquence de l'histoire !== 이력일련번호 ==! */
        , VLUT_PRCS_STTS_CD          /** Code de statut de l'évaluation de valeur !== 가격평가처리상태코드 ==! */
        , dtl_dcsh_audt_rslt_rgsr_yn       /** Résultat de la vérification du DAU enregistré ON !== DED심사결과등록여부 ==! */
        , LAST_YN                    /** Final ON !== 최종여부 ==! */
        , DCLD_IMPPN_IDFY_NO_TP_CD   /** Code De Type De N° D'Identification De L'Importateur Déclaré !== 신고된수입자식별번호구분코드 ==! */
        , DCLD_IMPPN_IDFY_NO         /** N° D'Identification De L'Importateur Déclaré !== 신고된수입자식별번호 ==! */
        , DCLD_TXPR_IDFY_NO          /** N° D'Identification Du Contribuable Déclaré !== 신고된납세자식별번호 ==! */
        , DCLD_EPC_CD                /** Code EPC déclaré !== 신고된EPC코드 ==! */
        , DCLD_INVC_CURR_CD          /** Code de devise déclaré de la facture !== 신고된송장통화코드 ==! */
        , DCLD_INVC_FXRT             /** Taux de change déclaré de la facture !== 신고된송장환율 ==! */
        , DCLD_INVC_AMT              /** Montant déclaré de facture !== 신고된송장금액 ==! */
        , DCLD_INVC_NCY_AMT          /** Montant déclaré NCY de la facture !== 신고된송장NCY금액 ==! */
        , DCLD_INVC_USD_AMT          /** Montant déclaré de la facture  !== 신고된송장USD금액 ==! */
        , DCLD_CACH_CURR_CD          /** Code de devise déclaré du fret !== 신고된운임통화코드 ==! */
        , DCLD_CACH_FXRT             /** Taux de change déclaré du fret !== 신고된운임환율 ==! */
        , DCLD_CACH_AMT              /** Montant de fret déclaré !== 신고된운임금액 ==! */
        , DCLD_CACH_NCY_AMT          /** Montant NCY de fret déclaré !== 신고된운임NCY금액 ==! */
        , DCLD_INFEE_CURR_CD         /** Code déclaré de devise d'assurance !== 신고된보험료통화코드 ==! */
        , DCLD_INFEE_FXRT            /** Taux d'assurance déclaré d'assurance !== 신고된보험료환율 ==! */
        , DCLD_INFEE_AMT             /** Montant d'éassurance déclaré !== 신고된보험료금액 ==! */
        , DCLD_INFEE_NCY_AMT         /** Montant NCY d'assurance déclaré !== 신고된보험료NCY금액 ==! */
        , DCLD_OTCST_CURR_CD         /** Code de devise déclaré du montant des autres frais  !== 신고된기타비용통화코드 ==! */
        , DCLD_OTCST_FXRT            /** Taux de change déclaré des autres frais !== 신고된기타비용환율 ==! */
        , DCLD_OTCST_AMT             /** Montant déclaré des autres frais  !== 신고된기타비용금액 ==! */
        , DCLD_OTCST_NCY_AMT         /** Montant NCY déclaré des autres frais !== 신고된기타비용NCY금액 ==! */
        , DCLD_DDCT_CURR_CD          /** Code déclaré de devise déduite  !== 신고된공제통화코드 ==! */
        , DCLD_DDCT_FXRT             /** Taux de change de la déduction déclaré !== 신고된공제환율 ==! */
        , DCLD_DDCT_AMT              /** Montant déduit déclaré !== 신고된공제금액 ==! */
        , DCLD_DDCT_RT              /** Montant déduit déclaré !== 신고된공제금액 ==! */
        , DCLD_DDCT_NCY_AMT          /** Montant NCY déduit déclaré !== 신고된공제NCY금액 ==! */
        , DCLD_TTXBS_NCY_AMT         /** Montant total NCY déclaré de la valeur statistique !== 신고된총과세기준NCY금액 ==! */
        , DCLD_TTXBS_USD_AMT         /** Montant total USD déclaré de la valeur statistique !== 신고된총과세기준USD금액 ==! */
        , DCLD_TAX_TAMT              /** Montant total déclaré des taxes !== 신고된세금총금액 ==! */
        , DCLD_FVRFC_MG_AMT          /** Montant de caution valable déclaré !== 신고된검증용담보금액 ==! */
        , DCLD_FVRFC_MG_DSCN_AMT       /** Montant abattu de la caution valable déclarée !== 신고된검증용담보할인금액 ==! */
        , DCLD_FNVRFC_MG_AMT         /** Montant déclaré de caution non-valable !== 신고된비검증용담보금액 ==! */
        , DCLD_OTHS_PCFE_AMT         /** Montant déclaré des autres frais  !== 신고된기타수수료금액 ==! */
        , DCLD_PYMN_TAX_TAMT         /** Montant total déclaré des taxes payées !== 신고된지불세금총금액 ==! */
        , ASED_IMPPN_IDFY_NO_TP_CD   /** 	Code De Type De N° D'Identification De L'Importateur Liquidé !== 평가된수입자식별번호구분코드 ==! */
        , ASED_IMPPN_IDFY_NO         /** N° D'Identification De L'Importateur Liquidé !== 평가된수입자식별번호 ==! */
        , ASED_TXPR_IDFY_NO          /** Niu Liquidé !== 평가된납세자식별번호 ==! */
        , ASED_EPC_CD                /** Code EPC liquidé !== 평가된EPC코드 ==! */
        , ASED_INVC_CURR_CD          /** Code de devise liquidé de la facture !== 평가된송장통화코드 ==! */
        , ASED_INVC_FXRT             /** Taux de change liquidé de la facture !== 평가된송장환율 ==! */
        , ASED_INVC_AMT              /** Montant liquidé de la facture !== 평가된송장금액 ==! */
        , ASED_INVC_NCY_AMT          /** Montant NCY liquidé de la facture !== 평가된송장NCY금액 ==! */
        , ASED_INVC_USD_AMT          /** Montant USD liquidé de la facture !== 평가된송장USD금액 ==! */
        , ASED_CACH_CURR_CD          /** Code de devise liquidé du fret !== 평가된운임통화코드 ==! */
        , ASED_CACH_FXRT             /** Taux de change liquidé du fret !== 평가된운임환율 ==! */
        , ASED_CACH_AMT              /** Montant liquidé du fret !== 평가된운임금액 ==! */
        , ASED_CACH_NCY_AMT          /** Montant NCY liquidé du fret !== 평가된운임NCY금액 ==! */
        , ASED_INFEE_CURR_CD         /** Code de devise liquidé de l'assurance !== 평가된보험료통화코드 ==! */
        , ASED_INFEE_FXRT            /** Taux de change liquidé de l'assurance !== 평가된보험료환율 ==! */
        , ASED_INFEE_AMT             /** Montant liquidé de l'assurance !== 평가된보험료금액 ==! */
        , ASED_INFEE_NCY_AMT         /** Montant NCY liquidé de l'assurance !== 평가된보험료NCY금액 ==! */
        , ASED_OTCST_CURR_CD         /** Code de devise liquidé des autres frais !== 평가된기타비용통화코드 ==! */
        , ASED_OTCST_FXRT            /** Taux de change liquidé des autres frais !== 평가된기타비용환율 ==! */
        , ASED_OTCST_AMT             /** Montant liquidé des autres frais !== 평가된기타비용금액 ==! */
        , ASED_OTCST_NCY_AMT         /** Montant NCY liquidé des autres frais !== 평가된기타비용NCY금액 ==! */
        , ASED_DDCT_CURR_CD          /** Code de devise déduit liquidé !== 평가된공제통화코드 ==! */
        , ASED_DDCT_FXRT             /** Taux de change de la déduction liquidé !== 평가된공제환율 ==! */
        , ASED_DDCT_AMT              /** Montant liquidé  !== 평가된공제금액 ==! */
        , ASED_DDCT_RT              /** Montant liquidé  !== 평가된공제금액 ==! */
        , ASED_DDCT_NCY_AMT          /** Montant CNY déduit liquidé !== 평가된공제NCY금액 ==! */
        , ASED_TTXBS_NCY_AMT         /** Montant NCY total liquidé de la valeur statistique !== 평가된총과세기준NCY금액 ==! */
        , ASED_TTXBS_USD_AMT         /** Montant USD total liquidé de la valeur statistique  !== 평가된총과세기준USD금액 ==! */
        , ASED_TAX_TAMT              /** Montant total liquidé des taxes !== 평가된세금총금액 ==! */
        , ASED_FVRFC_MG_AMT          /** Montant liquidé de caution valable  !== 평가된검증용담보금액 ==! */
        , ASED_FVRFC_MG_DSCN_AMT     /** Montant liquidé abattu de la caution valable  !== 평가된검증용담보할인금액 ==! */
        , ASED_FNVRFC_MG_AMT         /** Montant liquidé de la caution non-valable !== 평가된비검증용담보금액 ==! */
        , ASED_OTHS_PCFE_AMT         /** Montant liquidé des autres commissions !== 평가된기타수수료금액 ==! */
        , ASED_PYMN_TAX_TAMT         /** Montant total liquidé des taxes payées !== 평가된지불세금총금액 ==! */
        , ASED_TVLUT_NCY_AMT
        , ASED_TVLUT_USD_AMT
        , NTFC_NO                    /** N° d'avis !== 고지번호 ==! */
        , DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
        , FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
        , FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
        , LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
        , LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
        )
        SELECT T1.DTL_DCSH_NO                     /** Numéro du DAU !== DED번호 ==! */
             , (SELECT NVL(MAX(PRC_EV_DGCNT)+1,1) FROM TB_CLRI_DED_VLUT_AUDT_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo})   /** Degrée de l'évaluation de valeur !== 가격평가차수 ==! */
             , t1.HIST_SRNO                  /** N° de séquence de l'histoire !== 이력일련번호 ==! */
             , 'D03'             /** Code de statut de l'évaluation de valeur !== 가격평가처리상태코드 ==! */
             , 'N'                           /** Résultat de la vérification du DAU enregistré ON !== DED심사결과등록여부 ==! */
             , 'Y'                           /** Final ON !== 최종여부 ==! */
             , t1.IMPPN_IDFY_NO_TP_CD        /** Code de type du N° d'identification de l'importateur !== 수입자식별번호구분코드 ==! */
             , t1.IMPPN_IDFY_NO              /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
             , t1.TXPR_IDFY_NO               /** NIU !== 납세자식별번호 ==! */
             , t1.EPC_CD                     /** Code EPC !== EPC코드 ==! */
             , t2.INVC_CURR_CD               /** Code de devise de la facture !== 송장통화코드 ==! */
             , t2.INVC_FXRT                  /** Taux de change de la facture !== 송장환율 ==! */
             , t2.INVC_AMT                   /** Montant de facture !== 송장금액 ==! */
             , t2.INVC_NCY_AMT               /** Montant NCY de facture !== 송장NCY금액 ==! */
             , t2.INVC_USD_AMT               /** Montant USD de facture !== 송장USD금액 ==! */
             , t2.CACH_CURR_CD               /** Code de devise du fret !== 운임통화코드 ==! */
             , t2.CACH_FXRT                  /** Taux de change du fret !== 운임환율 ==! */
             , t2.CACH_AMT                   /** Montant du fret !== 운임금액 ==! */
             , t2.CACH_NCY_AMT               /** Montant NCY du fret !== 운임NCY금액 ==! */
             , t2.INFEE_CURR_CD              /** Code de devise d'assurance !== 보험료통화코드 ==! */
             , t2.INFEE_FXRT                 /** Taux de change d'assurance !== 보험료환율 ==! */
             , t2.INFEE_AMT                  /** Montant d'assurance !== 보험료금액 ==! */
             , t2.INFEE_NCY_AMT              /** Montant NYC de l'assurance !== 보험료NCY금액 ==! */
             , t2.OTCST_CURR_CD              /** Code de devise des autres coûts !== 기타비용통화코드 ==! */
             , t2.OTCST_FXRT                 /** Taux de change des autres coûts !== 기타비용환율 ==! */
             , t2.OTCST_AMT                  /** Montant des autres coûts !== 기타비용금액 ==! */
             , t2.OTCST_NCY_AMT              /** Montant des autres coûts de NCY !== 기타비용NCY금액 ==! */
             , t2.DDCT_CURR_CD               /** Code de devise de la déduction !== 공제통화코드 ==! */
             , t2.DDCT_FXRT                  /** Taux de change de la déduction !== 공제환율 ==! */
             , t2.DDCT_AMT                   /** Montant déduit !== 공제금액 ==! */
             , t2.DDCT_RT                   /** Montant déduit !== 공제금액 ==! */
             , t2.DDCT_NCY_AMT               /** Montant NCY déduit !== 공제NCY금액 ==! */
             , t2.TTXBS_NCY_AMT              /** Montant NCY total de la valeur statistique  !== 총과세기준NCY금액 ==! */
             , t2.TTXBS_USD_AMT              /** Montant USD total de la valeur statistique  !== 총과세기준USD금액 ==! */
             , 0                             /** Montant abattu de la caution valable déclarée !== 신고된검증용담보할인금액 ==! */
             , 0                             /** Montant déclaré de caution non-valable !== 신고된비검증용담보금액 ==! */
             , 0                             /** Montant total déclaré des taxes !== 신고된세금총금액 ==! */
             , 0                             /** Montant total déclaré des taxes payées !== 신고된지불세금총금액 ==! */
             , 0                             /** Montant déclaré des autres frais  !== 신고된기타수수료금액 ==! */
             , 0                             /** Montant de caution valable déclaré !== 신고된검증용담보금액 ==! */
             , t1.IMPPN_IDFY_NO_TP_CD        /** Code de type du N° d'identification de l'importateur !== 수입자식별번호구분코드 ==! */
             , #{asedImppnIdfyNo}            /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
             , #{asedTxprIdfyNo}             /** NIU !== 납세자식별번호 ==! */
             , #{asedEpcCd}                  /** Code EPC !== EPC코드 ==! */
             , #{asedInvcCurrCd}             /** Code de devise de la facture !== 송장통화코드 ==! */
             , #{asedInvcFxrt}               /** Taux de change de la facture !== 송장환율 ==! */
             , #{asedInvcAmt}                /** Montant de facture !== 송장금액 ==! */
             , #{asedInvcNcyAmt}             /** Montant NCY de facture !== 송장NCY금액 ==! */
             , #{asedInvcUsdAmt}			 /** Montant USD de facture !== 송장USD금액 ==! */
             , #{asedCachCurrCd}			 /** Code de devise du fret !== 운임통화코드 ==! */
             , #{asedCachFxrt}				 /** Taux de change du fret !== 운임환율 ==! */
             , #{asedCachAmt}                /** Montant du fret !== 운임금액 ==! */
             , #{asedCachNcyAmt}             /** Montant NCY du fret !== 운임NCY금액 ==! */
             , #{asedInfeeCurrCd}            /** Code de devise d'assurance !== 보험료통화코드 ==! */
             , #{asedInfeeFxrt}              /** Taux de change d'assurance !== 보험료환율 ==! */
             , #{asedInfeeAmt}               /** Montant d'assurance !== 보험료금액 ==! */
             , #{asedInfeeNcyAmt}            /** Montant NYC de l'assurance !== 보험료NCY금액 ==! */
             , #{asedOtcstCurrCd}            /** Code de devise des autres coûts !== 기타비용통화코드 ==! */
             , #{asedOtcstFxrt}              /** Taux de change des autres coûts !== 기타비용환율 ==! */
             , #{asedOtcstAmt}               /** Montant des autres coûts !== 기타비용금액 ==! */
             , #{asedOtcstNcyAmt}            /** Montant des autres coûts de NCY !== 기타비용NCY금액 ==! */
             , #{asedDdctCurrCd}             /** Code de devise de la déduction !== 공제통화코드 ==! */
             , #{asedDdctFxrt}               /** Taux de change de la déduction !== 공제환율 ==! */
             , #{asedDdctAmt}                /** Montant déduit !== 공제금액 ==! */
             , #{asedDdctRt}                /** Montant déduit !== 공제금액 ==! */
             , #{asedDdctNcyAmt}             /** Montant NCY déduit !== 공제NCY금액 ==! */
             , #{asedTtxbsNcyAmt}    		 /** Montant NCY total de la valeur statistique  !== 총과세기준NCY금액 ==! */
             , #{asedTtxbsUsdAmt}    		 /** Montant USD total de la valeur statistique  !== 총과세기준USD금액 ==! */
             , 0                             /** Montant total liquidé des taxes !== 평가된세금총금액 ==! */
             , 0                             /** Montant liquidé de caution valable  !== 평가된검증용담보금액 ==! */
             , 0                             /** Montant liquidé abattu de la caution valable  !== 평가된검증용담보할인금액 ==! */
             , 0                             /** Montant liquidé de la caution non-valable !== 평가된비검증용담보금액 ==! */
             , 0                             /** Montant liquidé des autres commissions !== 평가된기타수수료금액 ==! */
             , 0                             /** Montant total liquidé des taxes payées !== 평가된지불세금총금액 ==! */
             , #{asedTvlutNcyAmt}
             , #{asedTvlutUsdAmt}
             , NULL                          /** N° d'avis !== 고지번호 ==! */
             , 'N'                           /** 삭제여부 */
             , #{frstRegstId}
             , SYSTIMESTAMP
             , #{lastChprId}
             , SYSTIMESTAMP
        FROM TB_CLRI_DED_COMN t1
           , TB_CLRI_DED_VLUT_COMN t2
        WHERE t1.DTL_DCSH_NO = #{dtlDcshNo}
          AND t1.DTL_DCSH_NO = t2.DTL_DCSH_NO
          AND t1.DEL_YN = 'N'
          AND t2.DEL_YN = 'N'
    </insert>

    <!--
        * SQL 설명 : Enregistrer le commun de l'article de contrôle de l'estimation de la valeur de la DED !== DED 가격평가심사 품목 insert ==!
        * 작성자 : 김기룡
    -->
    <insert id="insertVlutAudtPdls" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtPdlsDcshVo">
        /* insertVlutAudtPdls */
        INSERT
        INTO TB_CLRI_DED_VLUT_AUDT_PDLS
        ( DTL_DCSH_NO
        , PRC_EV_DGCNT
        , PDLS_NO
        , DCLD_HS_CD
        , DCLD_ORCY_CNTY_CD
        , DCLD_APC_CD
        , DCLD_PRVL_CD
        , DCLD_PRC_DTRM_MEAN_CD
        , DCLD_PDLS_TTWG
        , DCLD_PDLS_NTWG
        , DCLD_PDLS_INVC_CURR_CD
        , DCLD_PDLS_INVC_FXRT
        , DCLD_PDLS_INVC_AMT
        , DCLD_PDLS_INVC_NCY_AMT
        , DCLD_PDLS_INVC_USD_AMT
        , DCLD_PDLS_CACH_CURR_CD
        , DCLD_PDLS_CACH_FXRT
        , DCLD_PDLS_CACH_AMT
        , DCLD_PDLS_CACH_NCY_AMT
        , DCLD_PDLS_INFEE_CURR_CD
        , DCLD_PDLS_INFEE_FXRT
        , DCLD_PDLS_INFEE_AMT
        , DCLD_PDLS_INFEE_NCY_AMT
        , DCLD_PDLS_OTCST_CURR_CD
        , DCLD_PDLS_OTCST_FXRT
        , DCLD_PDLS_OTCST_AMT
        , DCLD_PDLS_OTCST_NCY_AMT
        , DCLD_PDLS_DDCT_CURR_CD
        , DCLD_PDLS_DDCT_FXRT
        , DCLD_PDLS_DDCT_AMT
        , DCLD_PDLS_DDCT_NCY_AMT
        , DCLD_PDLS_TXBS_NCY_AMT
        , DCLD_PDLS_TXBS_USD_AMT
        , DCLD_PDLS_VLUT_NCY_AMT
        , DCLD_PDLS_VLUT_USD_AMT
        , DCLD_PDLS_MPRC_BASE_VAL
        , DCLD_PDLS_MPRC_UT_AMT
        , DCLD_PDLS_MPRC_NCY_AMT
        , DCLD_PDLS_MPRC_USD_AMT
        , ASED_HS_CD
        , ASED_ORCY_CNTY_CD
        , ASED_APC_CD
        , ASED_PRVL_CD
        , ASED_PRC_DTRM_MEAN_CD
        , ASED_PDLS_TTWG
        , ASED_PDLS_NTWG
        , ASED_PDLS_INVC_CURR_CD
        , ASED_PDLS_INVC_FXRT
        , ASED_PDLS_INVC_AMT
        , ASED_PDLS_INVC_NCY_AMT
        , ASED_PDLS_INVC_USD_AMT
        , ASED_PDLS_CACH_CURR_CD
        , ASED_PDLS_CACH_FXRT
        , ASED_PDLS_CACH_AMT
        , ASED_PDLS_CACH_NCY_AMT
        , ASED_PDLS_INFEE_CURR_CD
        , ASED_PDLS_INFEE_FXRT
        , ASED_PDLS_INFEE_AMT
        , ASED_PDLS_INFEE_NCY_AMT
        , ASED_PDLS_OTCST_CURR_CD
        , ASED_PDLS_OTCST_FXRT
        , ASED_PDLS_OTCST_AMT
        , ASED_PDLS_OTCST_NCY_AMT
        , ASED_PDLS_DDCT_CURR_CD
        , ASED_PDLS_DDCT_FXRT
        , ASED_PDLS_DDCT_AMT
        , ASED_PDLS_DDCT_NCY_AMT
        , ASED_PDLS_TXBS_NCY_AMT
        , ASED_PDLS_TXBS_USD_AMT
        , ASED_PDLS_VLUT_NCY_AMT
        , ASED_PDLS_VLUT_USD_AMT
        , ASED_PDLS_MPRC_BASE_VAL
        , ASED_PDLS_MPRC_UT_AMT
        , ASED_PDLS_MPRC_NCY_AMT
        , ASED_PDLS_MPRC_USD_AMT
        , DEL_YN
        , FRST_REGST_ID
        , FRST_RGSR_DTTM
        , LAST_CHPR_ID
        , LAST_CHG_DTTM
        )
        SELECT t1.DTL_DCSH_NO
             , ( SELECT MAX(PRC_EV_DGCNT) FROM TB_CLRI_DED_VLUT_AUDT_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} )
             , t2.PDLS_NO
             , t1.HS_CD
             , t1.ORCY_CNTY_CD
             , t1.APC_CD
             , t1.PRVL_CD
             , t1.PRC_DTRM_MEAN_CD
             , t1.PDLS_TTWG
             , t1.PDLS_NTWG
             , t2.PDLS_INVC_CURR_CD
             , t2.PDLS_INVC_FXRT
             , t2.PDLS_INVC_AMT
             , t2.PDLS_INVC_NCY_AMT
             , t2.PDLS_INVC_USD_AMT
             , t2.PDLS_CACH_CURR_CD
             , t2.PDLS_CACH_FXRT
             , t2.PDLS_CACH_AMT
             , t2.PDLS_CACH_NCY_AMT
             , t2.PDLS_INFEE_CURR_CD
             , t2.PDLS_INFEE_FXRT
             , t2.PDLS_INFEE_AMT
             , t2.PDLS_INFEE_NCY_AMT
             , t2.PDLS_OTCST_CURR_CD
             , t2.PDLS_OTCST_FXRT
             , t2.PDLS_OTCST_AMT
             , t2.PDLS_OTCST_NCY_AMT
             , t2.PDLS_DDCT_CURR_CD
             , t2.PDLS_DDCT_FXRT
             , t2.PDLS_DDCT_AMT
             , t2.PDLS_DDCT_NCY_AMT
             , t2.PDLS_TXBS_NCY_AMT
             , t2.PDLS_TXBS_USD_AMT
             , t2.PDLS_VLUT_NCY_AMT
             , t2.PDLS_VLUT_USD_AMT
             , t2.PDLS_MPRC_BASE_VAL
             , t2.PDLS_MPRC_UT_AMT
             , t2.PDLS_MPRC_NCY_AMT
             , t2.PDLS_MPRC_USD_AMT
             , #{asedHsCd}
             , #{asedOrcyCntyCd}
             , #{asedApcCd}
             , #{asedPrvlCd}
             , #{asedPrcDtrmMeanCd}
             , #{asedPdlsTtwg}
             , #{asedPdlsNtwg}
             , #{asedPdlsInvcCurrCd}
             , #{asedPdlsInvcFxrt}
             , #{asedPdlsInvcAmt}
             , #{asedPdlsInvcNcyAmt}
             , #{asedPdlsInvcUsdAmt}
             , #{asedPdlsCachCurrCd}
             , #{asedPdlsCachFxrt}
             , #{asedPdlsCachAmt}
             , #{asedPdlsCachNcyAmt}
             , #{asedPdlsInfeeCurrCd}
             , #{asedPdlsInfeeFxrt}
             , #{asedPdlsInfeeAmt}
             , #{asedPdlsInfeeNcyAmt}
             , #{asedPdlsOtcstCurrCd}
             , #{asedPdlsOtcstFxrt}
             , #{asedPdlsOtcstAmt}
             , #{asedPdlsOtcstNcyAmt}
             , #{asedPdlsDdctCurrCd}
             , #{asedPdlsDdctFxrt}
             , #{asedPdlsDdctAmt}
             , #{asedPdlsDdctNcyAmt}
             , #{asedPdlsTxbsNcyAmt}
             , #{asedPdlsTxbsUsdAmt}
             , #{asedPdlsVlutNcyAmt}
             , #{asedPdlsVlutUsdAmt}
             , #{asedPdlsMprcBaseVal}
             , #{asedPdlsMprcUtAmt}
             , #{asedPdlsMprcNcyAmt}
             , #{asedPdlsMprcUsdAmt}
             , 'N'              			/** 삭제여부 */
             , #{frstRegstId}
             , SYSTIMESTAMP
             , #{lastChprId}
             , SYSTIMESTAMP
        FROM TB_CLRI_DED_PDLS t1
           , TB_CLRI_DED_VLUT_PDLS t2
        WHERE t1.DTL_DCSH_NO = #{dtlDcshNo}
          AND t1.PDLS_NO = #{pdlsNo}
          AND t1.DTL_DCSH_NO = t2.DTL_DCSH_NO
          AND t1.PDLS_NO = t2.PDLS_NO
          AND t1.DEL_YN = 'N'
          AND t2.DEL_YN = 'N'
        ORDER BY TO_NUMBER(t1.PDLS_NO)
    </insert>


    <!--
        * SQL 설명 : Enregsitrer les modèles de contrôle de l'estimation de la valeur de DED !== DED 가격평가심사 모델규격 insert ==!
        * 작성자 : 김기룡
    -->
    <insert id="insertVlutAudtMdlStsz" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtMdlStszDcshVo">
        /* insertVlutAudtMdlStsz */
        INSERT
        INTO TB_CLRI_DED_VLUT_AUDT_MDL_STSZ
        ( DTL_DCSH_NO
        , PRC_EV_DGCNT
        , PDLS_NO
        , MDL_STSZ_NO
        , DCLD_QTY
        , DCLD_QTY_UT_CD
        , DCLD_UT_PRC
        , DCLD_INVC_PRC
        , ASED_QTY
        , ASED_QTY_UT_CD
        , ASED_UT_PRC
        , ASED_INVC_PRC
        , DEL_YN
        , FRST_REGST_ID
        , FRST_RGSR_DTTM
        , LAST_CHPR_ID
        , LAST_CHG_DTTM
        )
        SELECT DTL_DCSH_NO
             , ( SELECT MAX(PRC_EV_DGCNT) FROM TB_CLRI_DED_VLUT_AUDT_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} )
             , PDLS_NO
             , MDL_STSZ_NO
             , QTY
             , QTY_UT_CD
             , UT_PRC
             , INVC_AMT
             , #{asedQty}
             , #{asedQtyUtCd}
             , #{asedUtPrc}
             , #{asedInvcPrc}
             , 'N'              /** 삭제여부 */
             , #{frstRegstId}
             , SYSTIMESTAMP
             , #{lastChprId}
             , SYSTIMESTAMP
        FROM TB_CLRI_DED_MDL_STSZ
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
          AND PDLS_NO = #{pdlsNo}
          AND MDL_STSZ_NO = #{mdlStszNo}
          AND DEL_YN = 'N'
        ORDER BY TO_NUMBER(MDL_STSZ_NO)
    </insert>

    <!--  !==심사결과 처리  가격평가공통 변경==! -->
    <update id="updateAudtCfrmVlutComn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateAudtCfrmVlutComn */
        with upsert as (
            SELECT
                DTL_DCSH_NO
                 , ASED_INVC_AMT              /** Montant liquidé de la facture !== 평가된송장금액 ==! */
                 , ASED_INVC_CURR_CD          /** Code de devise liquidé de la facture !== 평가된송장통화코드 ==! */
                 , ASED_INVC_FXRT             /** Taux de change liquidé de la facture !== 평가된송장환율 ==! */
                 , ASED_INVC_NCY_AMT          /** Montant NCY liquidé de la facture !== 평가된송장NCY금액 ==! */
                 , ASED_INVC_USD_AMT          /** Montant USD liquidé de la facture !== 평가된송장USD금액 ==! */
                 , ASED_CACH_AMT              /** Montant liquidé du fret !== 평가된운임금액 ==! */
                 , ASED_CACH_CURR_CD          /** Code de devise liquidé du fret !== 평가된운임통화코드 ==! */
                 , ASED_CACH_FXRT             /** Taux de change liquidé du fret !== 평가된운임환율 ==! */
                 , ASED_CACH_NCY_AMT          /** Montant NCY liquidé du fret !== 평가된운임NCY금액 ==! */
                 , ASED_INFEE_AMT             /** Montant liquidé de l'assurance !== 평가된보험료금액 ==! */
                 , ASED_INFEE_CURR_CD         /** Code de devise liquidé de l'assurance !== 평가된보험료통화코드 ==! */
                 , ASED_INFEE_FXRT            /** Taux de change liquidé de l'assurance !== 평가된보험료환율 ==! */
                 , ASED_INFEE_NCY_AMT         /** Montant NCY liquidé de l'assurance !== 평가된보험료NCY금액 ==! */
                 , ASED_OTCST_AMT             /** Montant liquidé des autres frais !== 평가된기타비용금액 ==! */
                 , ASED_OTCST_CURR_CD         /** Code de devise liquidé des autres frais !== 평가된기타비용통화코드 ==! */
                 , ASED_OTCST_FXRT            /** Taux de change liquidé des autres frais !== 평가된기타비용환율 ==! */
                 , ASED_OTCST_NCY_AMT         /** Montant NCY liquidé des autres frais !== 평가된기타비용NCY금액 ==! */
                 , ASED_DDCT_AMT              /** Montant liquidé  !== 평가된공제금액 ==! */
                 , ASED_DDCT_RT              /** Montant liquidé  !== 평가된공제금액 ==! */
                 , ASED_DDCT_CURR_CD          /** Code de devise déduit liquidé !== 평가된공제통화코드 ==! */
                 , ASED_DDCT_FXRT             /** Taux de change de la déduction liquidé !== 평가된공제환율 ==! */
                 , ASED_DDCT_NCY_AMT          /** Montant CNY déduit liquidé !== 평가된공제NCY금액 ==! */
                 , ASED_TTXBS_NCY_AMT         /** Montant NCY total liquidé de la valeur statistique !== 평가된총과세기준NCY금액 ==! */
                 , ASED_TTXBS_USD_AMT         /** Montant USD total liquidé de la valeur statistique  !== 평가된총과세기준USD금액 ==! */
                 , ASED_TVLUT_NCY_AMT
                 , ASED_TVLUT_USD_AMT
                 , LAST_CHPR_ID
            FROM   TB_CLRI_DED_VLUT_AUDT_COMN
            WHERE  DEL_YN = 'N'
            AND  DTL_DCSH_NO = #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
            AND  PRC_EV_DGCNT = #{prcEvDgcnt}
        )
           , UPDATE_OPTION AS (
            UPDATE TB_CLRI_DED_VLUT_COMN A SET
                A.INVC_AMT         = B.ASED_INVC_AMT
                , A.INVC_CURR_CD   = B.ASED_INVC_CURR_CD
                , A.INVC_FXRT      = B.ASED_INVC_FXRT
                , A.INVC_NCY_AMT   = B.ASED_INVC_NCY_AMT
                , A.INVC_USD_AMT   = B.ASED_INVC_USD_AMT
                , A.CACH_AMT       = B.ASED_CACH_AMT
                , A.CACH_CURR_CD   = B.ASED_CACH_CURR_CD
                , A.CACH_FXRT      = B.ASED_CACH_FXRT
                , A.CACH_NCY_AMT   = B.ASED_CACH_NCY_AMT
                , A.INFEE_AMT      = B.ASED_INFEE_AMT
                , A.INFEE_CURR_CD  = B.ASED_INFEE_CURR_CD
                , A.INFEE_FXRT     = B.ASED_INFEE_FXRT
                , A.INFEE_NCY_AMT  = B.ASED_INFEE_NCY_AMT
                , A.OTCST_AMT      = B.ASED_OTCST_AMT
                , A.OTCST_CURR_CD  = B.ASED_OTCST_CURR_CD
                , A.OTCST_FXRT     = B.ASED_OTCST_FXRT
                , A.OTCST_NCY_AMT  = B.ASED_OTCST_NCY_AMT
                , A.DDCT_AMT       = B.ASED_DDCT_AMT
                , A.DDCT_RT       = B.ASED_DDCT_RT
                , A.DDCT_CURR_CD   = B.ASED_DDCT_CURR_CD
                , A.DDCT_FXRT      = B.ASED_DDCT_FXRT
                , A.DDCT_NCY_AMT   = B.ASED_DDCT_NCY_AMT
                , A.TTXBS_NCY_AMT  = B.ASED_TTXBS_NCY_AMT
                , A.TTXBS_USD_AMT  = B.ASED_TTXBS_USD_AMT
                , A.TVLUT_NCY_AMT  = B.ASED_TVLUT_NCY_AMT
                , A.TVLUT_USD_AMT  = B.ASED_TVLUT_USD_AMT
                , A.LAST_CHPR_ID = #{lastChprId}
                , A.LAST_CHG_DTTM = SYSTIMESTAMP
                FROM upsert B
                WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO

        )select * from upsert;
    </update>

    <!--  !==심사결과 처리  가격평가 품목 변경==! -->
    <update id="updateAudtCfrmVlutPdls" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateAudtCfrmVlutPdls */
        with upsert as (
            SELECT
                DTL_DCSH_NO
                 , PDLS_NO
                 ,PRC_EV_DGCNT
                 , ASED_PDLS_INVC_CURR_CD
                 , ASED_PDLS_INVC_FXRT
                 , ASED_PDLS_INVC_AMT
                 , ASED_PDLS_INVC_NCY_AMT
                 , ASED_PDLS_INVC_USD_AMT
                 , ASED_PDLS_CACH_CURR_CD
                 , ASED_PDLS_CACH_FXRT
                 , ASED_PDLS_CACH_AMT
                 , ASED_PDLS_CACH_NCY_AMT
                 , ASED_PDLS_INFEE_CURR_CD
                 , ASED_PDLS_INFEE_FXRT
                 , ASED_PDLS_INFEE_AMT
                 , ASED_PDLS_INFEE_NCY_AMT
                 , ASED_PDLS_OTCST_CURR_CD
                 , ASED_PDLS_OTCST_FXRT
                 , ASED_PDLS_OTCST_AMT
                 , ASED_PDLS_OTCST_NCY_AMT
                 , ASED_PDLS_DDCT_CURR_CD
                 , ASED_PDLS_DDCT_FXRT
                 , ASED_PDLS_DDCT_AMT
                 , ASED_PDLS_DDCT_NCY_AMT
                 , ASED_PDLS_TXBS_NCY_AMT
                 , ASED_PDLS_TXBS_USD_AMT
                 , ASED_PDLS_VLUT_NCY_AMT
                 , ASED_PDLS_VLUT_USD_AMT
                 , ASED_PDLS_MPRC_BASE_VAL
                 , ASED_PDLS_MPRC_UT_AMT
                 , ASED_PDLS_MPRC_NCY_AMT
                 , ASED_PDLS_MPRC_USD_AMT
                 , ASED_PDLS_MPRC_TP_CD
                 , ASED_PDLS_MPRC_CURR_CD
                 , LAST_CHPR_ID
            FROM   TB_CLRI_DED_VLUT_AUDT_PDLS
            WHERE  DEL_YN = 'N'
            AND  DTL_DCSH_NO = #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
            AND  PRC_EV_DGCNT = #{prcEvDgcnt}
        )
           , UPDATE_OPTION AS (
            UPDATE TB_CLRI_DED_VLUT_PDLS A SET
                A.PDLS_INVC_CURR_CD    = B.ASED_PDLS_INVC_CURR_CD
                , A.PDLS_INVC_FXRT     = B.ASED_PDLS_INVC_FXRT
                , A.PDLS_INVC_AMT      = B.ASED_PDLS_INVC_AMT
                , A.PDLS_INVC_NCY_AMT  = B.ASED_PDLS_INVC_NCY_AMT
                , A.PDLS_INVC_USD_AMT  = B.ASED_PDLS_INVC_USD_AMT
                , A.PDLS_CACH_CURR_CD  = B.ASED_PDLS_CACH_CURR_CD
                , A.PDLS_CACH_FXRT     = B.ASED_PDLS_CACH_FXRT
                , A.PDLS_CACH_AMT      = B.ASED_PDLS_CACH_AMT
                , A.PDLS_CACH_NCY_AMT  = B.ASED_PDLS_CACH_NCY_AMT
                , A.PDLS_INFEE_CURR_CD = B.ASED_PDLS_INFEE_CURR_CD
                , A.PDLS_INFEE_FXRT    = B.ASED_PDLS_INFEE_FXRT
                , A.PDLS_INFEE_AMT     = B.ASED_PDLS_INFEE_AMT
                , A.PDLS_INFEE_NCY_AMT = B.ASED_PDLS_INFEE_NCY_AMT
                , A.PDLS_OTCST_CURR_CD = B.ASED_PDLS_OTCST_CURR_CD
                , A.PDLS_OTCST_FXRT    = B.ASED_PDLS_OTCST_FXRT
                , A.PDLS_OTCST_AMT     = B.ASED_PDLS_OTCST_AMT
                , A.PDLS_OTCST_NCY_AMT = B.ASED_PDLS_OTCST_NCY_AMT
                , A.PDLS_DDCT_CURR_CD  = B.ASED_PDLS_DDCT_CURR_CD
                , A.PDLS_DDCT_FXRT     = B.ASED_PDLS_DDCT_FXRT
                , A.PDLS_DDCT_AMT      = B.ASED_PDLS_DDCT_AMT
                , A.PDLS_DDCT_NCY_AMT  = B.ASED_PDLS_DDCT_NCY_AMT
                , A.PDLS_TXBS_NCY_AMT  = B.ASED_PDLS_TXBS_NCY_AMT
                , A.PDLS_TXBS_USD_AMT  = B.ASED_PDLS_TXBS_USD_AMT
                , A.PDLS_VLUT_NCY_AMT  = B.ASED_PDLS_VLUT_NCY_AMT
                , A.PDLS_VLUT_USD_AMT  = B.ASED_PDLS_VLUT_USD_AMT
                , A.PDLS_MPRC_BASE_VAL = B.ASED_PDLS_MPRC_BASE_VAL
                , A.PDLS_MPRC_UT_AMT   = B.ASED_PDLS_MPRC_UT_AMT
                , A.PDLS_MPRC_NCY_AMT  = B.ASED_PDLS_MPRC_NCY_AMT
                , A.PDLS_MPRC_USD_AMT  = B.ASED_PDLS_MPRC_USD_AMT
                , A.PDLS_MPRC_TP_CD  = B.ASED_PDLS_MPRC_TP_CD
                , A.PDLS_MPRC_CURR_CD  = B.ASED_PDLS_MPRC_CURR_CD
                , A.LAST_CHPR_ID = #{lastChprId}
                , A.LAST_CHG_DTTM = SYSTIMESTAMP
                FROM upsert B
                WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO AND A.PDLS_NO = B.PDLS_NO

        )select * from upsert;
    </update>

    <!--  !==심사결과 처리  모델 변경==! -->
    <update id="updateAudtCfrmMdlStsz" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateAudtCfrmMdlStsz */
        with upsert as (
            SELECT
                DTL_DCSH_NO                       /** Numéro du DAU !== DED번호 ==! */
                 , PDLS_NO                    /** N° d'article !== 품목번호 ==! */
                 , MDL_STSZ_NO                /** N° de modèle et spécification !== 모델규격번호 ==! */
                 , ASED_QTY                   /** Quantité liquidée !== 평가된수량 ==! */
                 , ASED_QTY_UT_CD             /** Code liquidé de l'unité de quantité !== 평가된수량단위코드 ==! */
                 , ASED_UT_PRC                /** Prix unitaire liquidé !== 평가된단위가격 ==! */
                 , ASED_INVC_PRC              /** Prix liquidé de la facture !== 평가된송장가격 ==! */
                 , LAST_CHPR_ID
            FROM   TB_CLRI_DED_VLUT_AUDT_MDL_STSZ
            WHERE  DEL_YN = 'N'
            AND  DTL_DCSH_NO = #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
            AND  PRC_EV_DGCNT = #{prcEvDgcnt}
        )
           , UPDATE_OPTION AS (
            UPDATE TB_CLRI_DED_MDL_STSZ A SET
                A.QTY = B.ASED_QTY
                , A.QTY_UT_CD = B.ASED_QTY_UT_CD
                , A.UT_PRC = B.ASED_UT_PRC
                , A.INVC_AMT = B.ASED_INVC_PRC
                , A.LAST_CHPR_ID = #{lastChprId}
                , A.LAST_CHG_DTTM = SYSTIMESTAMP
                FROM upsert B
                WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO AND A.PDLS_NO = B.PDLS_NO AND A.MDL_STSZ_NO = B.MDL_STSZ_NO

        )select * from upsert;
    </update>

    <!--  !==심사결과 처리 기존 DED 컨테이너 삭제==! -->
    <delete id="deleteAudtCfrmCntr" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        DELETE TB_CLRI_DED_CNTR
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
    </delete>

    <!--  !==심사결과 처리  컨테이너 변경==! -->
    <update id="updateAudtCfrmCntr" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateAudtCfrmCntr */
        with EXCLUDED as (
            SELECT
                DTL_DCSH_NO                       /** Numéro du DAU !== DED번호 ==! */
                 , CNTR_SRNO                  /** N° de séquence du conteneur !== 컨테이너일련번호 ==! */
                 , CNTR_NO                    /** N° de conteneur !== 컨테이너번호 ==! */
                 , CNTR_TP_CD                 /** Code de type de conteneur !== 컨테이너구분코드 ==! */
                 , CNTR_STFN_STTS_CD          /** Code de l'état d'empotage du conteneur !== 컨테이너적입상태코드 ==! */
                 , SEAL_NO1                   /** N°1 de scellé !== 봉인번호1 ==! */
                 , SEAL_NO2                   /** N°2 de scellé !== 봉인번호2 ==! */
                 , SEAL_NO3                   /** N°3 de scellé !== 봉인번호3 ==! */
                 , SEAL_CHPN1
                 , SEAL_CHPN2
                 , SEAL_CHPN3
                 , LAST_CHPR_ID
            FROM   TB_CLRI_VLUT_CNTR
            WHERE  DEL_YN = 'N'
            AND  DTL_DCSH_NO = #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
            AND  PRC_EV_DGCNT = #{prcEvDgcnt}
        ) INSERT INTO TB_CLRI_DED_CNTR SELECT dtl_dcsh_no, cntr_srno, cntr_no, cntr_tp_cd,
                                              cntr_stfn_stts_cd, seal_no1, seal_no2, seal_no3, '', 'N',
                                              #{frstRegstId}  , SYSTIMESTAMP, #{lastChprId}, SYSTIMESTAMP, seal_chpn1,seal_chpn2,seal_chpn3  from EXCLUDED
        ON CONFLICT  (dtl_dcsh_no, cntr_srno) DO UPDATE SET
            CNTR_NO             = EXCLUDED.CNTR_NO
          , CNTR_TP_CD        = EXCLUDED.CNTR_TP_CD
          , CNTR_STFN_STTS_CD = EXCLUDED.CNTR_STFN_STTS_CD
          , SEAL_NO1          = EXCLUDED.SEAL_NO1
          , SEAL_NO2          = EXCLUDED.SEAL_NO2
          , SEAL_NO3          = EXCLUDED.SEAL_NO3
          , SEAL_CHPN1      = EXCLUDED.SEAL_CHPN1
          , SEAL_CHPN2      = EXCLUDED.SEAL_CHPN2
          , SEAL_CHPN3      = EXCLUDED.SEAL_CHPN3
          , LAST_CHPR_ID = #{lastChprId}
          , LAST_CHG_DTTM = SYSTIMESTAMP;
    </update>

    <!--  !==심사결과 처리  세금 삭제==! -->
    <delete id="deleteAudtCfrmTax" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* deleteAudtCfrmTax */
        DELETE TB_CLRI_DED_TAX
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
    </delete>

    <!--  !==심사결과 처리  세금 변경==! -->
    <update id="updateAudtCfrmTax" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateAudtCfrmTax */
        with EXCLUDED as (
            SELECT
                DTL_DCSH_NO
                 , PDLS_NO                    /** N° d'article !== 품목번호 ==! */
                 , TAX_CD
                 , TXBS_AMT                   /** Montant de la valeur statistique !== 과세기준금액 ==! */
                 , TFRT_CTGY_CD
                 , TXRT                       /** Taux de taxation !== 세율 ==! */
                 , TAX_AMT                    /** Montant de la taxe !== 세금금액 ==! */
                 , PAY_TAX_AMT                /** Montant de la taxe payée !== 납부세금금액 ==! */
                 , PAY_KND_CD                 /** Code de type de paiement !== 납부종류코드 ==! */
                 , RDEX_PT_CD                 /** Code de type d'abattement !== 감면유형코드 ==! */
                 , RDEX_CD                    /** Code additionnel !== 감면코드 ==! */
                 , RDEX_AMT                   /** Montant abattu !== 감면금액 ==! */
                 , RDEX_BASE_AMT                /** Montant de la base de l'exonération !== 감면기준금액 ==! */
                 , RDEX_TXRT                    /** Taux de taxation exonéré !== 감면세율 ==! */
                 , MG_DSCN_APLY_AMT           /** Montant de caution après abattement !== 담보할인적용금액 ==! */
                 , BSCS_TXBS_AMT                /** Montant de la base taxable basique !== 기본과세기준금액 ==! */
                 , BSCS_TXRT                    /** Taux de taxation basique !== 기본세율 ==! */
                 , BSCS_TAX_AMT                 /** Montant de la taxe basique !== 기본세금금액 ==! */
                 , LAST_CHPR_ID
            FROM   TB_CLRI_DED_VLUT_AUDT_TAX
            WHERE  DEL_YN = 'N'
            AND  DTL_DCSH_NO = #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
            AND  PRC_EV_DGCNT = #{prcEvDgcnt}
        ) INSERT INTO TB_CLRI_DED_TAX
        SELECT
            B.DTL_DCSH_NO                       /** Numéro du DAU !== DED번호 ==! */
             , B.PDLS_NO                      /** N° d'article !== 품목번호 ==! */
             , B.TAX_CD                       /** Code de taxe !== 세금코드 ==! */
             , B.TXBS_AMT                     /** Montant de la base taxable !== 과세기준금액 ==! */
             , B.TFRT_CTGY_CD                 /** Code de catégorie du tarif !== 관세율카테고리코드 ==! */
             , B.TXRT                         /** Taux de taxation !== 세율 ==! */
             , B.TAX_AMT                      /** Montant de la taxe !== 세금금액 ==! */
             , B.PAY_TAX_AMT                  /** Montant de la taxe payée !== 납부세금금액 ==! */
             , B.PAY_KND_CD                   /** Code de type de paiement !== 납부종류코드 ==! */
             , B.RDEX_PT_CD                   /** Code de type d'exonération !== 감면유형코드 ==! */
             , B.RDEX_CD                      /** Code additionnel !== 감면코드 ==! */
             , B.RDEX_AMT                     /** Montant exonéré !== 감면금액 ==! */
             , B.RDEX_BASE_AMT                /** Montant de la base de l'exonération !== 감면기준금액 ==! */
             , B.RDEX_TXRT                    /** Taux de taxation exonéré !== 감면세율 ==! */
             , B.MG_DSCN_APLY_AMT             /** Montant de caution après abattement !== 담보할인적용금액 ==! */
             , B.BSCS_TXBS_AMT                /** Montant de la base taxable basique !== 기본과세기준금액 ==! */
             , B.BSCS_TXRT                    /** Taux de taxation basique !== 기본세율 ==! */
             , B.BSCS_TAX_AMT                 /** Montant de la taxe basique !== 기본세금금액 ==! */
             , 'N'                          /** Suppression ON !== 삭제여부 ==! */
             , #{frstRegstId}               /** ID du premier enregistrant  !== 최초등록자ID ==! */
             , SYSTIMESTAMP                 /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
             , #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
             , SYSTIMESTAMP                 /** Date et heure de modification finale !== 최종변경일시 ==! */
        from EXCLUDED B
        ON CONFLICT  (dtl_dcsh_no, PDLS_NO,TAX_CD) DO UPDATE SET
            TXBS_AMT           = EXCLUDED.TXBS_AMT
           , TXRT             = EXCLUDED.TXRT
           , TAX_AMT          = EXCLUDED.TAX_AMT
           , PAY_TAX_AMT      = EXCLUDED.PAY_TAX_AMT
           , PAY_KND_CD       = EXCLUDED.PAY_KND_CD
           , RDEX_PT_CD       = EXCLUDED.RDEX_PT_CD
           , RDEX_CD          = EXCLUDED.RDEX_CD
           , RDEX_AMT         = EXCLUDED.RDEX_AMT
           , RDEX_BASE_AMT    = EXCLUDED.RDEX_BASE_AMT
           , RDEX_TXRT        = EXCLUDED.RDEX_TXRT
           , MG_DSCN_APLY_AMT = EXCLUDED.MG_DSCN_APLY_AMT
           , TFRT_CTGY_CD     = EXCLUDED.TFRT_CTGY_CD
           , LAST_CHPR_ID     = EXCLUDED.LAST_CHPR_ID
           , LAST_CHG_DTTM    = SYSTIMESTAMP
    </update>

    <!--  !==심사결과 처리  DED공통 변경==! -->
    <update id="updateAudtCfrmDedComn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateAudtCfrmDedComn */
        with EXCLUDED as (
            SELECT
                X.DTL_DCSH_NO
                 , X.ASED_IMPPN_IDFY_NO_TP_CD
                 , X.ASED_IMPPN_IDFY_NO
                 , X.ASED_TXPR_IDFY_NO
                 , X.ASED_EPC_CD
                 , (SELECT SUM(ASED_PDLS_TTWG) FROM TB_CLRI_DED_VLUT_AUDT_PDLS WHERE DTL_DCSH_NO = X.DTL_DCSH_NO AND PRC_EV_DGCNT = X.PRC_EV_DGCNT) AS AL_TTWG
                 , (SELECT SUM(ASED_PDLS_NTWG) FROM TB_CLRI_DED_VLUT_AUDT_PDLS WHERE DTL_DCSH_NO = X.DTL_DCSH_NO AND PRC_EV_DGCNT = X.PRC_EV_DGCNT) AS AL_NTWG
                 , LAST_CHPR_ID
                 , (SELECT COUNT(1) FROM TB_CLRI_VLUT_CNTR WHERE DTL_DCSH_NO = X.DTL_DCSH_NO AND PRC_EV_DGCNT =  X.PRC_EV_DGCNT AND DEL_YN = 'N') AS CNTR_GCNT
            FROM   TB_CLRI_DED_VLUT_AUDT_COMN X
            WHERE  X.DEL_YN = 'N'
            AND  DTL_DCSH_NO =  #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
            AND  PRC_EV_DGCNT = #{prcEvDgcnt}
        )
           , UPDATE_OPTION AS (
            UPDATE TB_CLRI_DED_COMN A SET
                A.IMPPN_IDFY_NO_TP_CD  = B.ASED_IMPPN_IDFY_NO_TP_CD
                , A.IMPPN_IDFY_NO      = B.ASED_IMPPN_IDFY_NO
                , A.TXPR_IDFY_NO       = B.ASED_TXPR_IDFY_NO
                , A.EPC_CD             = B.ASED_EPC_CD
                , A.AL_TTWG            = B.AL_TTWG
                , A.AL_NTWG            = B.AL_NTWG
                , A.LAST_CHPR_ID       = B.LAST_CHPR_ID
                , A.LAST_CHG_DTTM      = SYSTIMESTAMP
                , A.CNTR_GCNT          = B.CNTR_GCNT
                , A.HIST_SRNO          = #{histSrno}
                FROM EXCLUDED B
                WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO
                returning  *

        ) select * from UPDATE_OPTION;
    </update>


    <!--  !==심사결과 처리  DED업체정보 변경==! -->
    <update id="updateAudtCfrmDedCo" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedComnDcshVo">
        /* updateAudtCfrmDedCo */
        UPDATE TB_CLRI_DED_CO
        <trim prefix="SET" prefixOverrides=",">
            <if test="dedVlutAudtVo != null">
                <if test="dedVlutAudtVo.asedTxprIdfyNo != null and dedVlutAudtVo.dcldTxprIdfyNo != null">
                    <if test='!dedVlutAudtVo.dcldTxprIdfyNo.equals(dedVlutAudtVo.asedTxprIdfyNo)'>
                        TXPR_CO_NM     = ( SELECT DECODE(B.CO_NM, NULL, T.CO_NM, B.CO_NM) AS CO_NM
                        FROM   ALPASSEXT.tb_pote_nif T, TB_COM_CO B
                        WHERE  T.NIF = B.NIF(+)
                        AND    T.NIF = ( SELECT TXPR_IDFY_NO FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} )
                        AND    T.DEL_YN = 'N'
                        AND    B.DEL_YN(+) = 'N'
                        AND    T.NIF_STTS_CD != '0' )
                        , TXPR_ADDR     = ( SELECT DECODE(   B.CO_ADDR
                        , NULL
                        , (SELECT NVL(TX.CO_DTL_ADDR, TX.CO_NM) FROM   ALPASSEXT.TB_POTE_NIF TX
                        WHERE  TX.NIF = ( SELECT TXPR_IDFY_NO FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} )
                        )
                        , B.CO_ADDR
                        ) AS CO_ADDR
                        FROM   ALPASSEXT.TB_POTE_NIF T, TB_COM_CO B
                        WHERE  T.NIF = B.NIF(+)
                        AND    T.NIF = ( SELECT TXPR_IDFY_NO FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} )
                        AND    T.DEL_YN = 'N'
                        AND    B.DEL_YN(+) = 'N'
                        AND    T.NIF_STTS_CD != '0' )
                        , TXPR_TLPH_NO   = ( SELECT DECODE(B.RPRS_TLPH_NO, NULL, T.RPRS_TLPH_NO, B.RPRS_TLPH_NO) AS RPRS_TLPH_NO
                        FROM   ALPASSEXT.TB_POTE_NIF T, TB_COM_CO B
                        WHERE  T.NIF = B.NIF(+)
                        AND    T.NIF = ( SELECT TXPR_IDFY_NO FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} )
                        AND    T.DEL_YN = 'N'
                        AND    B.DEL_YN(+) = 'N'
                        AND    T.NIF_STTS_CD != '0' )
                        , TXPR_EML       = ( SELECT RPRS_EML     FROM TB_COM_CO WHERE NIF = ( SELECT TXPR_IDFY_NO FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} ) )
                    </if>
                </if>
            </if>
            <if test='imppnIdfyNoTpCd != null and imppnIdfyNoTpCd.equals("T")'>
                , IMPPN_CO_NM    = ( SELECT DECODE(B.CO_NM, NULL, T.CO_NM, B.CO_NM) AS CO_NM
                FROM   ALPASSEXT.TB_POTE_NIF T, TB_COM_CO B
                WHERE  T.NIF = B.NIF(+)
                AND    T.NIF = ( SELECT IMPPN_IDFY_NO FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} )
                AND    T.DEL_YN = 'N'
                AND    B.DEL_YN(+) = 'N'
                AND    T.NIF_STTS_CD != '0' )
                , IMPPN_ADDR     = ( SELECT DECODE(   B.CO_ADDR
                , NULL
                , (SELECT NVL(TX.CO_DTL_ADDR, TX.CO_NM) FROM   ALPASSEXT.TB_POTE_NIF TX
                WHERE  TX.NIF = ( SELECT TXPR_IDFY_NO FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} )
                )
                , B.CO_ADDR
                ) AS CO_ADDR
                FROM   ALPASSEXT.TB_POTE_NIF T, TB_COM_CO B
                WHERE  T.NIF = B.NIF(+)
                AND    T.NIF = ( SELECT IMPPN_IDFY_NO FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} )
                AND    T.DEL_YN = 'N'
                AND    B.DEL_YN(+) = 'N'
                AND    T.NIF_STTS_CD != '0' )
            </if>
            <if test='imppnIdfyNoTpCd != null and imppnIdfyNoTpCd.equals("F")'>
                , IMPPN_CO_NM    = ( SELECT OVRS_BUCN_CO_NM     FROM TB_COM_OVBC WHERE OVRS_BUCN_CD = ( SELECT IMPPN_IDFY_NO FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} ) )
                , IMPPN_ADDR     = ( SELECT OVRS_BUCN_ADDR      FROM TB_COM_OVBC WHERE OVRS_BUCN_CD = ( SELECT IMPPN_IDFY_NO FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} ) )
            </if>
            , LAST_CHPR_ID   = ( SELECT LAST_CHPR_ID FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = #{dtlDcshNo} )
            , LAST_CHG_DTTM  = SYSTIMESTAMP
        </trim>
        WHERE DTL_DCSH_NO = #{dtlDcshNo}
    </update>

    <!--  !==심사결과 처리  DED품목 변경==! -->
    <update id="updateAudtCfrmDedPdls" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedVlutAudtDcshVo">
        /* updateAudtCfrmDedPdls */
        with EXCLUDED as (
        SELECT
        DTL_DCSH_NO
        , PDLS_NO
        , ASED_HS_CD
        , ASED_ORCY_CNTY_CD
        , ASED_APC_CD
        , ASED_PRVL_CD
        , ASED_PRC_DTRM_MEAN_CD
        , ASED_PDLS_TTWG
        , ASED_PDLS_NTWG
        , ROUND(ASED_PDLS_MPRC_BASE_VAL, 3) AS ASED_PDLS_MPRC_BASE_VAL
        , ASED_PDLS_MPRC_TP_CD
        , ASED_PDLS_MPRC_UT_AMT
        , ASED_PDLS_MPRC_CURR_CD
        , ASED_PDLS_MPRC_NCY_AMT
        , LAST_CHPR_ID
        FROM   TB_CLRI_DED_VLUT_AUDT_PDLS
        WHERE  DEL_YN = 'N'
        AND  DTL_DCSH_NO =  #{dtlDcshNo}                         /** Numéro du DAU !== DED번호 ==! */
        AND  PRC_EV_DGCNT = #{prcEvDgcnt}
        )
        , UPDATE_OPTION AS (
        UPDATE TB_CLRI_DED_PDLS A SET
        A.HS_CD              = B.ASED_HS_CD
        , A.ORCY_CNTY_CD     = B.ASED_ORCY_CNTY_CD
        , A.APC_CD           = B.ASED_APC_CD
        , A.PRVL_CD          = B.ASED_PRVL_CD
        , A.PRC_DTRM_MEAN_CD = B.ASED_PRC_DTRM_MEAN_CD
        , A.PDLS_TTWG        = B.ASED_PDLS_TTWG
        , A.PDLS_NTWG        = B.ASED_PDLS_NTWG
        , A.PDLS_NM          = LEFT((
        SELECT HS_DESC FROM tb_clri_hs_cd WHERE HS_CD = B.ASED_HS_CD
        AND   HS_APLY_STRT_DT <![CDATA[ <= ]]> ( SELECT DCLR_DT FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = B.DTL_DCSH_NO )
        AND   HS_APLY_END_DT  <![CDATA[ >= ]]> ( SELECT DCLR_DT FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = B.DTL_DCSH_NO )
        ), 512)
        , A.QTY_UT_CD        = (
        SELECT C.qty_ut_cd FROM tb_clri_hs_cd C  WHERE C.HS_CD = B.ASED_HS_CD
        AND   C.HS_APLY_STRT_DT <![CDATA[ <= ]]> ( SELECT DCLR_DT FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = B.DTL_DCSH_NO )
        AND   C.HS_APLY_END_DT  <![CDATA[ >= ]]> ( SELECT DCLR_DT FROM TB_CLRI_DED_COMN WHERE DTL_DCSH_NO = B.DTL_DCSH_NO )
        )
        , A.TRIF_BASE_VAL    = B.ASED_PDLS_MPRC_TP_CD || ' : ' || B.ASED_PDLS_MPRC_UT_AMT || ' * ' || B.ASED_PDLS_MPRC_BASE_VAL || ' = '
        || B.ASED_PDLS_MPRC_UT_AMT*B.ASED_PDLS_MPRC_BASE_VAL || '(' || B.ASED_PDLS_MPRC_CURR_CD || ') ' || B.ASED_PDLS_MPRC_NCY_AMT || '(XAF)'
        , A.LAST_CHPR_ID     = B.LAST_CHPR_ID
        , A.LAST_CHG_DTTM    = SYSTIMESTAMP
        FROM EXCLUDED B
        WHERE A.DTL_DCSH_NO = B.DTL_DCSH_NO AND A.PDLS_NO = B.PDLS_NO
        returning  *
        ) select * from UPDATE_OPTION;
    </update>

    <!--
        !==결재 진행 중인 심사내역이 있는지 확인함.==!
     -->
    <select id="selectDedVlutAudtAprvPrcsCnt" parameterType="java.lang.String" resultType="java.lang.Integer">
        /** selectDedVlutAudtAprvPrcsCnt */
        SELECT
            COUNT(1) AS CNT
        FROM  TB_CLRI_DED_ADRT A
           , TB_POTI_APRV B
        WHERE A.APRV_ID = B.APRV_ID
          AND A.DEL_YN = 'N'
          AND B.DEL_YN = 'N'
          AND B.APRV_PRCS_STTS_CD IN ('I01', 'I03')   /** !== I01:결재요청, I03:결재진행중 ==! */
          AND A.DTL_DCSH_NO = #{dtlDcshNo}
    </select>

    <!--
        !== 가격평가에 대한 처리상태 조회 ==!
     -->
    <select id="selectDedVlutAudtSttsCd"  parameterType="java.lang.String" resultType="java.lang.String">
        /** selectDedVlutAudtSttsCd */
        SELECT
            VLUT_PRCS_STTS_CD
        FROM  TB_CLRI_DED_VLUT_AUDT_COMN A
        WHERE A.DEL_YN       = 'N'
          AND A.DTL_DCSH_NO       = #{dtlDcshNo}
          AND A.LAST_YN      = 'Y'
          AND ROWNUM         = 1
    </select>

    <!--
        Consultation du redevable de l'avis de paiement !== 고지서 납세자 조회 ==!
     -->
    <select id="selectNtshTxpr"  parameterType="java.lang.String" resultType="java.lang.String">
        /** selectNtshTxpr */
        SELECT A.TXPR_IDFY_NO
        FROM
            (
                SELECT TXPR_IDFY_NO
                FROM   TB_COLI_NTFC
                WHERE  DCLR_NO = #{dtlDcshNo}
                  AND    NTFC_PRCS_STTS_CD != 'H06'
                  AND    NTFC_PT_CD = 'G'
                ORDER BY FRST_RGSR_DTTM DESC
            ) A
        WHERE ROWNUM = 1
    </select>

    <!--
		* SQL 설명 : Mettre à jour le montant de taxes suite à la liquidation !== 세액계산 결과 세액금액 UPDATE ==!
	-->
    <update id="updateDedVlutAudtComnTaxAmt" parameterType="alpass.ipt.clr.com.vo.ClrDedAsedTaxAmtVo" >
        /* ClriCom_updateSadVlutAudtComnTaxAmt */
        UPDATE TB_CLRI_DED_VLUT_AUDT_COMN
        SET   ASED_TAX_TAMT = #{asedTaxTamt}
          , ASED_FVRFC_MG_AMT = #{asedFvrfcMgAmt}
          , ASED_FVRFC_MG_DSCN_AMT = #{asedFvrfcMgDscnAmt}
          , ASED_FNVRFC_MG_AMT = #{asedFnvrfcMgAmt}
          , ASED_OTHS_PCFE_AMT = #{asedOthsPcfeAmt}
          , ASED_PYMN_TAX_TAMT = #{asedPymnTaxTamt}
          , LAST_CHPR_ID = #{lastChprId}
          , LAST_CHG_DTTM =  SYSTIMESTAMP
        WHERE DTL_DCSH_NO       = #{dtlDcshNo}
          AND DEL_YN = 'N'
          AND PRC_EV_DGCNT = #{prcEvDgcnt}


    </update>

</mapper>
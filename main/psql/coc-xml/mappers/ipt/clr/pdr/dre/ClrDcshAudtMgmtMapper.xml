<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="alpass.ipt.clr.pdr.dre.mapper.ClrDcshAudtMgmtMapper">

  <!-- DED접수 목록 조회 -->
  <select id="selectDcshAudtList" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedSrchVo" resultType="alpass.ipt.clr.pdr.dre.vo.ClrDedAcapVo">
    /* selectDcshAudtList */
    SELECT TOT_CNT
    , RNUM
    , DTL_DCSH_NO
    , DCLR_DT
    , DCLR_DATE
    , DCLR_CSTM_CD
    , audt_dept_cd
    , dcsh_fm_cd
    , DCLR_PT_CD
    , CSCL_PLN_CD
    , EXP_CNTY_CD
    , EPC_CD
    , SELC_RSLT_CD
    , RLBR_CSTM_CD            /* 반출입세관*/
    , TRNP_METH_KND_CD        /* 운송수단종류코드 */
    , CSCL_PSTP_YN
    , PRCS_STTS_CD
    , ATR_DCLR_RCPN_YN
    , (SELECT PRCS_STTS_PR_PRFR_CD
    FROM TB_CLRI_DED_PRCS_BRKD
    WHERE DTL_DCSH_NO    = C.DTL_DCSH_NO
    AND PRCS_SRNO = (SELECT MAX(PRCS_SRNO) FROM TB_CLRI_DED_PRCS_BRKD WHERE DTL_DCSH_NO = C.DTL_DCSH_NO AND DEL_YN = 'N')
    ) AS PRCS_STTS_PR_PRFR_CD
    , (SELECT D.PRCS_STTS_PR_PRFR_CD ||'|'||E.CD_VDVAL_NM
    FROM TB_CLRI_DED_PRCS_BRKD D,
    TB_COM_COMN_CD_D_LANG E
    WHERE D.DTL_DCSH_NO    = C.DTL_DCSH_NO
    AND D.PRCS_SRNO = (SELECT MAX(PRCS_SRNO) FROM TB_CLRI_DED_PRCS_BRKD WHERE DTL_DCSH_NO = C.DTL_DCSH_NO AND DEL_YN = 'N')
    AND E.COMN_CD   = 'CLR_0012'
    AND E.DEL_YN    = 'N'
    AND E.CD_VDVAL  = D.PRCS_STTS_PR_PRFR_CD
    AND E.LANG_CD   = #{langCd}
    ) AS PRCS_STTS_PR_PRFR_NM
    FROM
    (
    <include refid="pagination.header" />

    SELECT T.*
    FROM
    (
    SELECT  A.DTL_DCSH_NO
    , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'),'DD/MM/YYYY') AS DCLR_DT
    , TO_DATE(A.DCLR_DT, 'YYYYMMDD') AS DCLR_DATE
    , A.DCLR_CSTM_CD
    , A.audt_dept_cd
    , A.DCLR_PT_CD
    , A.CSCL_PLN_CD
    , A.EXP_CNTY_CD
    , A.dcsh_fm_cd
    , A.EPC_CD
    , A.SELC_RSLT_CD
    , A.RLBR_CSTM_CD            /* 반출입세관*/
    , A.TRNP_METH_KND_CD        /* 운송수단종류코드 */
    , A.CSCL_PSTP_YN
    , A.PRCS_STTS_CD
    , NVL(A.ATR_DCLR_RCPN_YN,'N') AS ATR_DCLR_RCPN_YN
    FROM      TB_CLRI_DED_COMN A
    WHERE A.del_yn = 'N'
    <choose>
      <when test="dtlDcshNo != null and dtlDcshNo != '' ">
        AND  A.DTL_DCSH_NO LIKE #{dtlDcshNo}||'%'                        /** Numero du DAU !== DED번호 ==! */
      </when>
      <when test="reffNo != null and reffNo != '' ">
        AND A.REFF_NO LIKE #{reffNo}||'%'
      </when>
      <otherwise>
        <if test="dcshFmCd != null and dcshFmCd != ''">
          AND A.dcsh_fm_cd = #{dcshFmCd}
        </if>
        <if test="dclrCstmCd != null and dclrCstmCd != ''">
          AND A.DCLR_CSTM_CD = #{dclrCstmCd}
        </if>
        <if test="selcRsltCd != null and selcRsltCd != ''">
          AND A.selc_rslt_cd = #{selcRsltCd}
        </if>
        <if test="deptCd != null and deptCd != ''">
          AND A.DEPT_CD = #{deptCd}
        </if>
        <if test="dclrPtCd != null and dclrPtCd != ''">
          AND A.DCLR_PT_CD = #{dclrPtCd}
        </if>
        <if test="csclPlnCd != null and csclPlnCd != ''">
          AND A.CSCL_PLN_CD = #{csclPlnCd}
        </if>
        <if test="trnpMethKndCd != null and trnpMethKndCd != ''">
          AND A.TRNP_METH_KND_CD = #{trnpMethKndCd}
        </if>
        <if test="csclPstpYn != null and csclPstpYn != ''">
          AND A.CSCL_PSTP_YN = #{csclPstpYn}
        </if>
        <if test="prcsSttsCd != null and prcsSttsCd != ''">
          <choose>
              <when test="prcsSttsCd != null and prcsSttsCd == 'D01'">
              AND A.PRCS_STTS_CD IN ('D01', 'F01')
              </when>
              <otherwise>
                AND A.PRCS_STTS_CD = #{prcsSttsCd}
              </otherwise>
          </choose>
        </if>
        <if test='dedInqtTp != null and dedInqtTp == "CR"'>
          /* !== 쟁송등록 ==! */
          AND A.DPUT_YN = 'Y'
        </if>
        <if test='dedInqtTp != null and dedInqtTp == "CC"'>
          /* !== 쟁송완료 ==! */
          AND A.DPUT_YN = 'N'
        </if>
        <if test='dedInqtTp != null and dedInqtTp == "PR"'>
          /* !== 잠정신고 등록 (잠정승인신고여부 N ) ==! */
          AND A.PRVI_DCLR_APRE_YN = 'N'
        </if>
        <if test='dedInqtTp != null and dedInqtTp == "PC"'>
          /* !== 잠정신고 완료 (잠정승인신고여부 Y ) ==! */
          AND A.PRVI_DCLR_APRE_YN = 'Y'
        </if>
        <if test="exppnIdfyNo != null and exppnIdfyNo != ''">
          AND A.EXPPN_IDFY_NO = #{exppnIdfyNo}
        </if>

        <if test="imppnIdfyNo != null and imppnIdfyNo != ''">
          AND A.IMPPN_IDFY_NO = #{imppnIdfyNo}
        </if>
        <if test="iprtPrcsSttsCd != null and iprtPrcsSttsCd != ''">
          AND EXISTS (
              SELECT 1 FROM TB_CLRI_DED_INSC_RSLT L WHERE DEL_YN ='N' AND VIST_INSC_RQST_DGCNT = (SELECT MAX(VIST_INSC_RQST_DGCNT) FROM TB_CLRI_DED_INSC_RSLT K WHERE L.DTL_DCSH_NO = K.DTL_DCSH_NO )
              AND L.DTL_DCSH_NO = A.DTL_DCSH_NO
              AND L.DEL_YN = 'N'
              AND L.IPRT_PRCS_STTS_CD = #{iprtPrcsSttsCd}
          )
        </if>
        <if test="dcerCd != null and dcerCd != ''">
          AND A.DCER_CD = #{dcerCd}
        </if>

        <if test='dedInqtTp != null and dedInqtTp == "VR"'>
          /* !== 방문검사/통관 등록 ==! 검사장소구분코드 B,C 이고 검사가 완료 안된것 (E02 아닌것) */
          AND A.INSC_PLC_TP_CD IN ('B','C')
          AND ( EXISTS ( SELECT 1 FROM TB_CLRI_DED_INSC_RSLT
          WHERE DEL_YN = 'N'
          AND IPRT_PRCS_STTS_CD <![CDATA[ <> ]]> 'E02'
          AND DTL_DCSH_NO = A.DTL_DCSH_NO
          )
          OR
          NOT EXISTS ( SELECT 1 FROM TB_CLRI_DED_INSC_RSLT
          WHERE DEL_YN = 'N'
          AND DTL_DCSH_NO = A.DTL_DCSH_NO
          )
          )

        </if>
        <if test='dedInqtTp != null and dedInqtTp == "VC"'>
          /* !== 방문검사/통관 완료 ==! 검사장소구분코드 B,C 이고 검사가 완료 (E02) */
          AND A.INSC_PLC_TP_CD IN ('B','C')
          AND EXISTS ( SELECT 1 FROM TB_CLRI_DED_INSC_RSLT
          WHERE DEL_YN = 'N'
          AND IPRT_PRCS_STTS_CD = 'E02'
          AND DTL_DCSH_NO = A.DTL_DCSH_NO
          )
        </if>
        <if test="dclrDtFrom != null and dclrDtFrom != ''">
          AND		A.DCLR_DT <![CDATA[ >= ]]> TO_CHAR(TO_DATE(#{dclrDtFrom},'DD/MM/YYYY'),'YYYYMMDD')
          AND		A.DCLR_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE(#{dclrDtTo},'DD/MM/YYYY'),'YYYYMMDD')
        </if>
        <if test="prcsSttsPrPrfrCd != null and prcsSttsPrPrfrCd != ''">
          AND EXISTS(
          SELECT 1
          FROM TB_CLRI_DED_PRCS_BRKD
          WHERE DTL_DCSH_NO = A.DTL_DCSH_NO
          AND PRCS_SRNO = (SELECT MAX(PRCS_SRNO) FROM TB_CLRI_DED_PRCS_BRKD WHERE DTL_DCSH_NO = A.DTL_DCSH_NO AND DEL_YN = 'N')
          AND PRCS_STTS_PR_PRFR_CD = #{prcsSttsPrPrfrCd}
          AND DEL_YN ='N'
          )
        </if>
        <if test="hsCd != null and hsCd != ''">
           AND EXISTS (
           SELECT  1 FROM TB_CLRI_DED_PDLS
           WHERE A.DTL_DCSH_NO = DTL_DCSH_NO
           AND HS_CD = #{hsCd}
           AND DEL_YN ='N'
          )
        </if>
      </otherwise>
    </choose>
    <choose>
      <when test='userRoleTp != null and userRoleTp =="CHPN"'>
        /* !== 담당자 ==!*/
        <if test="userId != null and userId != ''">
          <if test="dclrCstmCd == '' and userCstmCd != null and userCstmCd != ''">
            AND A.DCLR_CSTM_CD = #{userCstmCd}
          </if>
          <if test="deptCd == '' and userDeptCd != null and userDeptCd != ''">
            AND A.DEPT_CD IN (SELECT ORGN_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD IN ( SELECT UNNEST(STRING_TO_ARRAY(ACTV_CSTM_CD,'|')) FROM TB_POTI_ORGN WHERE ORGN_CD = #{userDeptCd}) AND ORGN_TP_CD = 'BUD' )
          </if>
          AND A.AUDT_EMP_ID = #{userId}
        </if>

      </when>
      <otherwise>
        /* !== 관리자 ==!*/
        <choose>
          <when test='userRoleTp != null and userRoleTp =="SRVC"'>
            /* !== 부서장 ==!*/
            <if test="userCstmCd != null and userCstmCd != ''">
              AND A.DCLR_CSTM_CD = #{userCstmCd}
            </if>
            <if test="userDeptCd != null and userDeptCd != ''">
              AND A.audt_dept_cd = #{userDeptCd}
            </if>
          </when>
          <when test='userRoleTp != null and userRoleTp =="CSTM"'>
            /* !== 세관장 ==!*/
            <if test="userCstmCd != null and userCstmCd != ''">
              AND A.DCLR_CSTM_CD = #{userCstmCd}
            </if>
          </when>
        </choose>
      </otherwise>
    </choose>
    --AND (A.SELC_RSLT_CD, A.CSCL_PSTP_YN) NOT IN (('B','N'), ('G','N'))
    AND A.PRCS_STTS_CD IN ('D01','D02','D03','D16','H04','E02','D04','D07','F01','F02','F03','G02', 'E02')
    ) T
    WHERE 1 = 1
    ORDER BY DCLR_DATE DESC, DTL_DCSH_NO DESC
    <include refid="pagination.footer" />
    ) C
    ORDER BY C.DCLR_DATE, C.DTL_DCSH_NO
  </select>

  <!--
	Consulter la liste de prix unitaire
	!== 단위가격 목록 조회 ==!
	-->
  <select id="selectUtPrcList" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedUtPrcDcshVo" resultType="alpass.ipt.clr.pdr.dre.vo.ClrDedUtPrcDcshVo">
    <include refid="pagination.header" ></include>

    SELECT
    A.DTL_DCSH_NO                     /** Numero du DAU !== DED번호 ==! */
    , A.PDLS_NO                    /** N° d'article !== 품목번호 ==! */
    , A.MDL_STSZ_NO                /** N° de modele et specification !== 모델규격번호 ==! */
    , TO_CHAR(TO_DATE(A.RQST_DT, 'YYYYMMDD'),'DD/MM/YYYY') AS RQST_DT /** Date de demande !== 신청일자 ==! */
    , TO_CHAR(TO_DATE(A.PRC_EV_DT, 'YYYYMMDD'),'DD/MM/YYYY') AS PRC_EV_DT /** Date de l'evaluation de valeur !== 가격평가일자 ==! */
    , A.IMPPN_IDFY_NO              /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
    , A.IMPPN_CO_NM                /** Nom de societe de l'importateur !== 수입자업체명 ==! */
    , A.EXPPN_IDFY_NO              /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
    , A.EXPPN_CO_NM                /** Nom de societe de l'exportateur !== 수출자업체명 ==! */
    , A.DCLD_HS_CD                 /** Code SH declare !== 신고된HS코드 ==! */
    , A.ASED_HS_CD                 /** Code SH liquide !== 평가된HS코드 ==! */
    , A.PDLS_NM                    /** Nom de l'article !== 품목명 ==! */
    , A.BRND_NM                    /** Nom de la marque !== 브랜드명 ==! */
    , A.MDL_STSZ_NM                /** Nom du modele et de la specification !== 모델규격명 ==! */
    , A.INGR_NM                    /** Nom du composant !== 성분명 ==! */
    , A.PRC_DTRM_MEAN_CD           /** Code de methode d'evaluation de valeur !== 가격결정방법코드 ==! */
    , A.ORCY_CNTY_CD               /** Code de pays d'origine !== 원산지국가코드 ==! */
    , A.CSM_CNTY_CD                /** Code de pays d'expedition !== 탁송국가코드 ==! */
    , A.CURR_CD                    /** Code de devise !== 통화코드 ==! */
    , A.DCLD_INVC_NCY_AMT          /** Montant declare NCY de la facture !== 신고된송장NCY금액 ==! */
    , A.ASED_INVC_NCY_AMT          /** Montant NCY liquide de la facture !== 평가된송장NCY금액 ==! */
    , A.DCLD_NCY_UT_PRC            /** Prix NCY unitaire declare !== 신고된NCY단위가격 ==! */
    , A.ASED_NCY_UT_PRC            /** Prix unitaire NCY liquide !== 평가된NCY단위가격 ==! */
    , A.DCLD_INVC_USD_AMT          /** Montant declare de la facture  !== 신고된송장USD금액 ==! */
    , A.ASED_INVC_USD_AMT          /** Montant USD liquide de la facture !== 평가된송장USD금액 ==! */
    , A.DCLD_USD_UT_PRC            /** Prix USD unitaire declare !== 신고된USD단위가격 ==! */
    , A.ASED_USD_UT_PRC            /** Prix unitaire USD liquide !== 평가된USD단위가격 ==! */
    , A.QTY                        /** Quantite !== 수량 ==! */
    , A.QTY_UT_CD                  /** Code de l'unite de quantite !== 수량단위코드 ==! */
    , A.NTWG                       /** Poids net !== 순중량 ==! */
    , A.NWPR_SCAR_CMDT_CD          /** Code de produit neuf et usage !== 신상품중고물품코드 ==! */
    , TO_CHAR(TO_DATE(A.ACPT_DT, 'YYYYMMDD'),'DD/MM/YYYY') AS  ACPT_DT  /** Date de l'autorisation d'enlevement des marchandises !== 수리일자 ==! */
    , A.PRC_EV_CN                  /** Contenu de l'evaluation de valeur !== 가격평가내용 ==! */
    , ( SELECT FN_GET_FXRT_AMNT(
    (SELECT DCLR_DT FROM TB_CLRI_DED_COMN WHERE DEL_YN = 'N' AND DTL_DCSH_NO = A.DTL_DCSH_NO),
    (SELECT INVC_CURR_CD FROM TB_CLRI_DED_VLUT_COMN WHERE DEL_YN = 'N' AND DTL_DCSH_NO = A.DTL_DCSH_NO),
    A.ASED_NCY_UT_PRC
    ) FROM DUAL
    ) AS  ASED_UT_PRC

    FROM   TB_CLRI_DED_UT_PRC A
    WHERE  DEL_YN = 'N'
    <if test="dcldHsCd != null and dcldHsCd != ''">
      AND A.DCLD_HS_CD = REPLACE(#{dcldHsCd}, '.', '')
    </if>
    <if test="imppnCoNm != null and imppnCoNm != ''">
      AND A.IMPPN_CO_NM LIKE #{imppnCoNm}||'%'
    </if>
    <if test="exppnCoNm != null and exppnCoNm != ''">
      AND A.EXPPN_CO_NM LIKE #{exppnCoNm}||'%'
    </if>
    <if test="orcyCntyCd != null and orcyCntyCd != ''">
      AND A.ORCY_CNTY_CD = #{orcyCntyCd}
    </if>
    <choose>
      <when test='imppnIdfyNoTpCd != null and imppnIdfyNoTpCd == "T" '>
        <if test="imppnIdfyNo != null and imppnIdfyNo != '' ">
          AND A.IMPPN_IDFY_NO = #{imppnIdfyNo}
        </if>
      </when>
      <otherwise>
        <if test='imppnIdfyNoTpCd != null and imppnIdfyNoTpCd == "F" '>
          <if test="imppnIdfyNo != null and imppnIdfyNo != '' ">
            AND A.EXPPN_IDFY_NO = #{imppnIdfyNo}
          </if>
        </if>
      </otherwise>
    </choose>
    <if test="dtlDcshNo != null and dtlDcshNo != ''">
      AND A.DTL_DCSH_NO = #{dtlDcshNo}
    </if>
    <if test="brndNm != null and brndNm != ''">
      AND A.BRND_NM LIKE #{brndNm}||'%'
    </if>
    <if test="mdlStszNm != null and mdlStszNm != ''">
      AND A.MDL_STSZ_NM LIKE #{mdlStszNm}||'%'
    </if>
    <if test="currCd != null and currCd != ''">
      AND A.CURR_CD = #{currCd}
    </if>
    <if test="dcldMinInvcAmt != null and dcldMinInvcAmt >= 0 ">
      AND A.DCLD_INVC_NCY_AMT <![CDATA[ >= ]]> #{dcldMinInvcAmt}
    </if>
    <if test="dcldMaxInvcAmt != null and dcldMaxInvcAmt >= 0 ">
      AND A.DCLD_INVC_NCY_AMT <![CDATA[ <= ]]> #{dcldMaxInvcAmt}
    </if>
    <if test="asedMinInvcAmt != null and asedMinInvcAmt >= 0 ">
      AND A.ASED_INVC_NCY_AMT <![CDATA[ >= ]]> #{asedMinInvcAmt}
    </if>
    <if test="asedMaxInvcAmt != null and asedMaxInvcAmt >= 0 ">
      AND A.ASED_INVC_NCY_AMT <![CDATA[ <= ]]> #{asedMaxInvcAmt}
    </if>
    <if test="prcEvDtFrom != null and prcEvDtFrom != ''">
      AND	TO_DATE(TO_CHAR(TO_DATE(A.PRC_EV_DT, 'YYYYMMDD'),'DD/MM/YYYY'),'DD/MM/YYYY') <![CDATA[ >= ]]> TO_DATE(#{prcEvDtFrom},'DD/MM/YYYY')
      AND	TO_DATE(TO_CHAR(TO_DATE(A.PRC_EV_DT, 'YYYYMMDD'),'DD/MM/YYYY'),'DD/MM/YYYY') <![CDATA[ <= ]]> TO_DATE(#{prcEvDtTo},'DD/MM/YYYY')
    </if>

    <include refid="pagination.footer" ></include>

  </select>

  <!--
    [N° d'avis] Voir !== [고지번호] 조회 ==!
    Kim Kiryong
    -->
  <select id="selectNtfcInfo" parameterType="alpass.ipt.clr.com.vo.ClrAfdSrchVo" resultType="alpass.ipt.col.com.vo.ColNtfcVo">
    /* ClriAfdDcsh_selectNtfcInfo */
    SELECT NTFC_NO, RCVE_YN
    FROM
      (
        SELECT NTFC_NO, RCVE_YN  FROM TB_COLI_NTFC
        WHERE DEL_YN = 'N'
          AND REFF_NO =  #{dtlDcshNo}
          AND CNCL_YN = 'N'
        ORDER BY LAST_CHG_DTTM DESC
      )
    WHERE ROWNUM = 1
  </select>

  <!--
    [Date de l'inspection] Voir !== [검사일자] 조회 ==!
    -->
  <select id="selectInscDt" parameterType="alpass.ipt.clr.com.vo.ClrAfdSrchVo" resultType="java.lang.String">
    /* ClriAfdDcsh_selectInscDt */
    SELECT TO_CHAR(TO_DATE(INSC_DT,'YYYYMMDD'),'DD/MM/YYYY') AS INSC_DT
    FROM TB_CLRI_DED_INSC_RSLT
    WHERE DEL_YN = 'N'
      AND IPRT_PRCS_STTS_CD ='E02'
      AND DTL_DCSH_NO =  #{dtlDcshNo}
  </select>

  <!--
    [Annuler] Voir !== [취소] 조회 ==!
    -->
  <select id="selectCnclInfo" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedCldlCloaVo" resultType="alpass.ipt.clr.pdr.dre.vo.ClrDedCldlCloaVo">
    /* ClriAfdDcsh_selectCnclInfo */
    SELECT DTL_DCSH_NO
    , CNCL_TP_CD
    , TO_CHAR(CNCL_DTTM,'DD/MM/YYYY HH24:MI:SS') AS CNCL_DTTM
    , CNCL_RSN_CD
    , CNCL_CN
    FROM TB_CLRI_DED_CLDL_CLOA
    WHERE DEL_YN = 'N'
    AND DTL_DCSH_NO =  #{dtlDcshNo}
    <if test="cnclTpCd != null and cnclTpCd != ''">
      AND CNCL_TP_CD = #{cnclTpCd}
    </if>
    AND LAST_YN = 'Y'

  </select>

  <!--
    [Montant NCY total de la valeur statistique] Voir  !== [총과세기준금액] 조회 ==!
    -->
  <select id="selectTtxbsNcyAmt" parameterType="alpass.ipt.clr.com.vo.ClrAfdSrchVo" resultType="java.math.BigDecimal">
    /* ClriAfdDcsh_selectTtxbsNcyAmt */
    SELECT NVL(TTXBS_NCY_AMT,0) AS TTXBS_NCY_AMT
    FROM TB_CLRI_DED_VLUT_COMN
    WHERE DTL_DCSH_NO = #{dtlDcshNo}
      AND DEL_YN = 'N'
  </select>

  <!-- 담당자 여부 조회   -->
  <select id="selectAudtEmpYn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedSrchVo" resultType="java.lang.String">
    /* ClriCom_selectAudtEmpYn */
    SELECT 1 AS AUDT_EMP_YN
    FROM TB_CLRI_DED_COMN
    WHERE DTL_DCSH_NO = #{dtlDcshNo}
      AND DEL_YN = 'N'
      AND AUDT_EMP_ID = #{userId}
  </select>

  <!-- 심사결과  조회 -->
  <select id="selectAdrt" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedSrchVo" resultType="alpass.ipt.clr.pdr.dre.vo.ClrDedAdrtDcshVo">
    /* ClriDpsAdrt_selectAdrt */
    SELECT
      A.DTL_DCSH_NO                     /** Numero du DAU !== DED번호 ==! */
         , A.PRC_EV_DGCNT               /** !== 가격평가차수  ==! */
         , A.HIST_SRNO                  /** N° de sequence de l'histoire !== 이력일련번호 ==! */
         , A.AUDT_EMP_ID                /** ID de la personne verifiant !== 심사직원ID ==! */
         , A.AUDT_RSLT_RGSR_DT          /** Date de l'enregistrement du resultat de la verification !== 심사결과등록일자 ==! */
         , A.AUDT_RSLT_CN               /** Contenu du resultat de la verification !== 심사결과내용 ==! */
         , A.AUDT_CMPL_YN               /** Verification terminee ON !== 심사완료여부 ==! */
         , A.APRV_ID                    /** ID d'approbation  !== 결재ID ==! */
         , ( SELECT APRV_PRCS_STTS_CD
             FROM TB_POTI_APRV
             WHERE DEL_YN = 'N'
               AND APRV_ID = A.APRV_ID
    ) AS APRV_PRCS_STTS_CD
         , ( SELECT APRV_EMP_PBSR_NO
             FROM TB_POTI_APRV_D
             WHERE DEL_YN = 'N'
               AND APRV_ID = A.APRV_ID
             ORDER BY APRV_PRCS_DTTM DESC, APRV_SRNO ASC NULLS FIRST
               FETCH FIRST 1 ROW ONLY
    ) AS APRV_EMP_PBSR_NO		 /** !== 결재직원공무원번호 (우선순위 1.그 다음 결재 할 결재대기자 2. 모두 결재된 경우 최종 결재자) ==! */
    FROM   TB_CLRI_DED_ADRT A
    WHERE  DEL_YN = 'N'                  /** Suppression ON !== 삭제여부 ==! */
      AND DTL_DCSH_NO = #{dtlDcshNo}
      AND A.PRC_EV_DGCNT = #{prcEvDgcnt}
  </select>

</mapper>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="alpass.ipt.clr.pfp.pfp.mapper.ClrFfmnAffcInvgMgmtMapper">

  <!--
    Consultation de la liste des admissions temporaires !== 임시수입 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempImpList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrPfpPfpVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrPfpPfpVo">
    /* selectClrTempImpList */
    <include refid="pagination.header" ></include>
    SELECT
        A.DTL_DCSH_NO                                                      /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT   /** Date de déclaration !== 신고일자 ==! */
      , A.DCLR_PT_CD                                                       /** Code de type de déclaration !== 신고유형코드 ==! */
      , B.EXPPN_CO_NM                                                      /** Nom de société de l'exportateur !== 수출자업체명 ==! */
      , B.IMPPN_CO_NM                                                      /** Nom de société de l'importateur !== 수입자업체명 ==! */
      , A.IMPPN_IDFY_NO                                                    /** Code de type du N° d'identification de l'importateur !== 수입자식별번호구분코드 ==! */
      , A.EXP_CNTY_CD                                                      /** Code de pays exportateur !== 수출국가코드 ==! */
      , A.PDLS_GCNT                                                        /** Nombre d'articles !== 품목개수 ==! */
      , A.EPC_CD                                                           /** Code EPC !== EPC코드 ==! */
      , TO_CHAR(TO_DATE(C.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT  /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , D.TTXBS_NCY_AMT                                                    /** Montant NCY total de la valeur statistique  !== 총과세기준NCY금액 ==! */
      , A.AUDT_EMP_ID                                                      /** ID de la personne vérifiant !== 심사직원ID ==! */
      , (SELECT S.EMP_NM FROM TB_POTI_EMP S WHERE S.PBSR_NO = A.AUDT_EMP_ID) AS EMP_NM   /** Nom de l'employé !== 직원명 ==! */
    FROM
           TB_CLRI_PSMGT_COMN C
         , TB_CLRI_DED_COMN A
         , TB_CLRI_DED_CO B
         , TB_CLRI_DED_VLUT_COMN D
    WHERE
           C.DTL_DCSH_NO = A.DTL_DCSH_NO
    AND    C.DTL_DCSH_NO = B.DTL_DCSH_NO
    AND    C.DTL_DCSH_NO = D.DTL_DCSH_NO
    AND    A.DCLR_PT_CD = 'IM5'
    AND    C.DEL_YN = 'N'
    AND    A.DEL_YN = 'N'
    AND    B.DEL_YN = 'N'
    AND    D.DEL_YN = 'N'
    <if test="dclrDtFrom != null and dclrDtFrom != ''">
      AND    A.DCLR_DT <![CDATA[ >= ]]> TO_CHAR(TO_DATE( #{dclrDtFrom}, 'DD/MM/YYYY'), 'YYYYMMDD')
      AND    A.DCLR_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE( #{dclrDtTo}, 'DD/MM/YYYY'), 'YYYYMMDD')
    </if>
    <if test="dclrCstmCd != null and dclrCstmCd != ''">
      AND    A.DCLR_CSTM_CD = #{dclrCstmCd}
    </if>
    <if test="epcCd != null and epcCd != ''">
      AND    A.EPC_CD = #{epcCd}
    </if>
    <if test="imppnIdfyNo != null and imppnIdfyNo != ''">
      AND    A.IMPPN_IDFY_NO = #{imppnIdfyNo}
    </if>
    <if test="dtlDcshNo != null and dtlDcshNo != ''">
      AND    A.DTL_DCSH_NO = #{dtlDcshNo}
    </if>
    ORDER BY A.DCLR_DT DESC, A.FRST_RGSR_DTTM DESC
    <include refid="pagination.footer" ></include>
  </select>

  <!--
    Consultation en détail de l'admission temporaire !== 임시수입 상세 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempImp" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrPfpPfpVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrPfpPfpVo">
    /* selectClrTempImp */
    SELECT
        A.DTL_DCSH_NO                                                                           /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT                        /** Date de déclaration !== 신고일자 ==! */
      , A.DCLR_PT_CD                                                                            /** Code de type de déclaration !== 신고유형코드 ==! */
      , A.DCLR_CSTM_CD                                                                          /** Code de bureau de déclaration !== 신고세관코드 ==! */
      , B.EXPPN_CO_NM                                                                           /** Nom de société de l'exportateur !== 수출자업체명 ==! */
      , A.IMPPN_IDFY_NO || ' | ' || B.IMPPN_CO_NM AS IMPPN_CO_NM                                /** Nom de société de l'importateur !== 수입자업체명 ==! */
      , A.IMPPN_IDFY_NO                                                                         /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
      , A.EXP_CNTY_CD                                                                           /** Code de pays exportateur !== 수출국가코드 ==! */
      , A.PDLS_GCNT                                                                             /** Nombre d'articles !== 품목개수 ==! */
      , TO_CHAR(TO_DATE(C.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT  /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , D.TTXBS_NCY_AMT                                                                         /** Montant NCY total de la valeur statistique  !== 총과세기준NCY금액 ==! */
      , TO_CHAR(TO_DATE(C.PSMGT_FFMN_CMPL_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_CMPL_DT  /** Date de l'apurement de régime suspensif !== 사후관리이행완료일자 ==! */
      , DECODE(P.ASED_FVRFC_MG_DSCN_AMT, NULL, P.ASED_FVRFC_MG_AMT, P.ASED_FVRFC_MG_DSCN_AMT) AS MG_AMT /** Montant de caution != 담보금액 =! */
      , NVL((SELECT SUM(S.MG_RELE_AMT)
             FROM   TB_COLI_MG_RELE S
             WHERE     S.USE_REFF_NO = L.DTL_DCSH_NO
             AND    S.DEL_YN = 'N'), 0) AS MG_RELE_AMT                                          /** Montant rendu après la mainlevée  !== 담보해제금액 ==! */
      , C.MG_RELE_YN                                                                            /** Caution levée ON !== 담보해제여부 ==! */
      , L.MG_TP_CD                                                                              /** Code de type de caution !== 담보구분코드 ==! */
      , L.MG_AC_NO                                                                              /** N° de compte de caution !== 담보계좌번호 ==! */
      , A.NEW_SYS_YN                                                                            /** Nouveau système ON !== 신규시스템여부 ==! */
      , TO_CHAR(TO_DATE(A.ACPT_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS ACPT_DT
      , (SELECT SUM(TAMT)
         FROM TB_COLI_NTFC
         WHERE REFF_NO = A.DTL_DCSH_NO
         AND CNCL_YN = 'N'
         AND DEL_YN  = 'N'
        ) AS NTFC_AMT
    FROM
           TB_CLRI_PSMGT_COMN C
         , TB_CLRI_DED_COMN A
         , TB_CLRI_DED_CO B
         , TB_CLRI_DED_VLUT_COMN D
         , TB_CLRI_DED_MG L
         , TB_CLRI_DED_VLUT_AUDT_COMN P
    WHERE
           C.DTL_DCSH_NO = A.DTL_DCSH_NO
    AND    C.DTL_DCSH_NO = B.DTL_DCSH_NO
    AND    C.DTL_DCSH_NO = D.DTL_DCSH_NO
    AND    C.DTL_DCSH_NO = L.DTL_DCSH_NO(+)
    AND    C.DTL_DCSH_NO = P.DTL_DCSH_NO(+)
    AND    C.DEL_YN = 'N'
    AND    A.DEL_YN = 'N'
    AND    B.DEL_YN = 'N'
    AND    D.DEL_YN = 'N'
    AND    L.DEL_YN(+) = 'N'
    AND    P.DEL_YN(+) = 'N'
    AND    P.LAST_YN(+) = 'Y'
    AND    A.DTL_DCSH_NO = #{dtlDcshNo}
    AND    ROWNUM = 1
  </select>

  <!--
    Consultation des articles de l'admission temporaire !== 임시수입 품목 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempImpItmList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrPfpPfpVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrTempImpItmVo">
    /* selectClrTempImpItmList */
    SELECT
        G.PDLS_NO AS PDLS_NO                                                                                                       /** N° d'article !== 품목번호 ==! */
      , G.HS_CD                                                                                                                    /** Code SH !== HS코드 ==! */
      , H.HS_DESC                                                                                                                  /** Description du SH !== HS설명 ==! */
      , G.QTY                                                                                                                      /** Quantité !== 수량 ==! */
      , (CASE
         WHEN A.EPC_CD NOT LIKE 'ETP%' THEN NVL(G.QTY_UT_CD, (SELECT QTY_UT_CD FROM TB_CLRI_DED_PDLS WHERE DTL_DCSH_NO = G.DTL_DCSH_NO AND PDLS_NO = G.PDLS_NO))
         ELSE NVL(G.QTY_UT_CD, (SELECT QTY_UT_CD FROM TB_CLRI_DED_RIMEX_PRNG_PDLS WHERE DTL_DCSH_NO = G.DTL_DCSH_NO AND PRNG_PDLS_NO = G.PDLS_NO))
         END) AS QTY_UT_CD                                                                                                         /** Code de l'unité de quantité !== 수량단위코드 ==! */
      , A.EPC_CD                                                                                                                   /** Code EPC !== EPC코드 ==! */
      , (CASE
         WHEN A.EPC_CD NOT LIKE 'ETP%' THEN (SELECT APC_CD FROM TB_CLRI_DED_PDLS WHERE DTL_DCSH_NO = G.DTL_DCSH_NO AND PDLS_NO = G.PDLS_NO)
         ELSE NULL
         END) AS APC_CD                                                                                                            /** Code APC !== APC코드 ==! */
      , (CASE
         WHEN A.EPC_CD NOT LIKE 'ETP%' THEN (SELECT PDLS_TXBS_NCY_AMT FROM TB_CLRI_DED_VLUT_PDLS WHERE DTL_DCSH_NO = G.DTL_DCSH_NO AND PDLS_NO = G.PDLS_NO)
         ELSE NULL
         END) AS TTXBS_NCY_AMT                                                                                                     /** Montant Nyc De La Base Taxable De L'Article !== 품목과세기준NCY금액 ==! */
      , (SELECT SUM(S.FFMN_QTY) FROM TB_CLRI_PSMGT_PDLS_INVN_H S WHERE S.DTL_DCSH_NO = G.DTL_DCSH_NO AND S.PDLS_NO = G.PDLS_NO AND S.DEL_YN = 'N') AS FFMN_QTY  /** Quantité apurée !== 이행수량 ==! */
      , G.RSQTY_QTY                                                                                                                /** Quatité restante !== 잔량수량 ==! */
    FROM
             TB_CLRI_PSMGT_PDLS_INVN_H G
           , TB_CLRI_DED_COMN A
           , TB_CLRI_HS_CD H
    WHERE
             G.DTL_DCSH_NO = A.DTL_DCSH_NO
      AND    G.LAST_YN = 'Y'
      AND    G.DTL_DCSH_NO = #{dtlDcshNo}
      AND    G.HS_CD = H.HS_CD
      AND    A.DCLR_DT BETWEEN H.HS_APLY_STRT_DT AND H.HS_APLY_END_DT
    ORDER BY TO_NUMBER(G.PDLS_NO)
  </select>

  <!--
    Consultation de la déclaration d'apurement de l'admission temporaire !== 임시수입 이행신고서 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempImpFfmnDcshList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrTempImpItmVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrTempImpFfmnDcshVo">
    /* selectClrTempImpFfmnDcshList */
    SELECT
        A.DTL_DCSH_NO                                                    /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT /** Date de déclaration !== 신고일자 ==! */
      , A.DCLR_PT_CD                                                     /** Code de type de déclaration !== 신고유형코드 ==! */
      , A.DCLR_CSTM_CD                                                   /** Code de bureau de déclaration !== 신고세관코드 ==! */
      , A.TXPR_IDFY_NO                                                   /** NIU !== 납세자식별번호 ==! */
      , G.PDLS_NO                                                        /** N° d'article !== 품목번호 ==! */
      , E.HS_CD                                                          /** Code SH !== HS코드 ==! */
      , H.HS_DESC                                                        /** Description du SH !== HS설명 ==! */
      , A.EPC_CD                                                         /** Code EPC !== EPC코드 ==! */
      , G.FFMN_QTY                                                       /** Quantité apurée !== 이행수량 ==! */
      , E.QTY_UT_CD                                                      /** Code de l'unité de quantité !== 수량단위코드 ==! */
      , D.TTXBS_NCY_AMT                                                  /** Montant NCY total de la valeur statistique  !== 총과세기준NCY금액 ==! */
      , A.PRCS_STTS_CD                                                   /** Code de statut de traitement !== 처리상태코드 ==! */
      , E.PDLS_NO                                                        /** N° d'article !== 품목번호 ==! */
    FROM
           TB_CLRI_PSMGT_PDLS_INVN_H G
         , TB_CLRI_DED_COMN A
         , TB_CLRI_DED_VLUT_COMN D
         , TB_CLRI_DED_PDLS E
         , TB_CLRI_HS_CD H
    WHERE
           G.DTL_DCSH_NO = A.DTL_DCSH_NO
    AND    G.DTL_DCSH_NO = D.DTL_DCSH_NO
    AND    G.DTL_DCSH_NO = E.DTL_DCSH_NO
    AND    G.FFMN_PDLS_NO = E.PDLS_NO
    AND    E.HS_CD = H.HS_CD(+)
    AND    G.DTL_DCSH_NO = #{dtlDcshNo}
    AND    G.PDLS_NO = #{pdlsNo}
    AND    G.INVN_MVMN_TP_CD = 'OT'
    AND    G.DEL_YN = 'N'
    AND    A.DEL_YN = 'N'
    AND    D.DEL_YN = 'N'
    AND    E.DEL_YN = 'N'
    AND    H.DEL_YN(+) = 'N'
    AND    A.DCLR_DT BETWEEN H.HS_APLY_STRT_DT AND H.HS_APLY_END_DT
    ORDER BY A.DCLR_DT DESC, A.FRST_RGSR_DTTM DESC
  </select>

  <!--
    Main-levée finale O/N de la caution !== 담보 최종 해제 여부 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempImpLastReleYn" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrPfpPfpVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrTempImpMgReleVo">
    /* selectClrTempImpLastReleYn */
    SELECT
        L.MG_TP_CD
      , L.MG_AC_NO
      , NVL(CASE
            WHEN L.MG_TP_CD = 'A' THEN
              (SELECT 'Y'
               FROM   TB_COLI_MG_RELE S
               WHERE  S.MG_NO = L.MG_AC_NO
               AND    S.USE_REFF_NO = L.DTL_DCSH_NO
               AND    S.LAST_RELE_YN = 'Y'
               AND    S.DEL_YN = 'N'
              )
           ELSE
             (SELECT 'Y'
              FROM   TB_COLI_MG_AC_USE_RELE S
              WHERE  S.MG_AC_NO = L.MG_AC_NO
              AND    S.USE_REFF_NO = L.DTL_DCSH_NO
              AND    S.LAST_RELE_YN = 'Y'
              AND    S.DEL_YN = 'N'
             )
           END, 'N') AS LAST_RELE_YN
    FROM   TB_CLRI_DED_MG L
    WHERE  L.DTL_DCSH_NO = #{dtlDcshNo}
    AND    L.DEL_YN = 'N'
    AND    ROWNUM = 1
  </select>

  <!--
    Consultation des informations sur l'exigence à la main-levée de caution !== 담보해제 필요 정보 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempImpMgRele" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrPfpPfpVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrTempImpMgReleVo">
    /* selectClrTempImpMgRele */
    SELECT
        L.MG_AC_NO AS MG_NO                                                                     /** N° de caution !== 담보번호 ==! */
      , DECODE(A.DCLR_PT_CD, 'EX2', A.EXPPN_IDFY_NO, A.IMPPN_IDFY_NO) AS IDFY_NO_1              /** N° d'identification !== 식별번호 ==! */
      , A.TXPR_IDFY_NO AS IDFY_NO_2                                                             /** N° d'identification !== 식별번호 ==! */
      , A.DCER_CD AS IDFY_NO_3                                                                  /** N° d'identification !== 식별번호 ==! */
      , DECODE(P.ASED_FVRFC_MG_DSCN_AMT, NULL, P.ASED_FVRFC_MG_AMT, P.ASED_FVRFC_MG_DSCN_AMT)
      - NVL((SELECT SUM(S.MG_RELE_AMT)
             FROM   TB_COLI_MG_RELE S, TB_COLI_MG M
             WHERE  S.RQST_NO  = M.RQST_NO
             AND    M.MG_NO = L.MG_AC_NO
             AND    S.USE_REFF_NO = L.DTL_DCSH_NO
             AND    S.DEL_YN = 'N'), 0) AS MG_RELE_AMT                                          /** Montant rendu après la mainlevée  !== 담보해제금액 ==! */
      , A.DTL_DCSH_NO AS USE_REFF_NO                                                            /** Numéro De Référence Utilisé !== 사용참조번호 ==! */
      , G.FFMN_DED_NO AS REFF_NO                                                                /** N° de référence !== 참조번호 ==! */
      , A.AUDT_EMP_ID                                                                           /** ID de la personne vérifiant !== 심사직원ID ==! */
      , L.MG_TP_CD                                                                              /** Code de type de caution !== 담보구분코드 ==! */
      , A.DCLR_PT_CD                                                                            /** Code de type de déclaration !== 신고유형코드 ==! */
    FROM
        TB_CLRI_DED_COMN A
      , TB_CLRI_DED_MG L
      , (SELECT
             S.DTL_DCSH_NO
           , S.FFMN_DED_NO
         FROM
           (SELECT S1.DTL_DCSH_NO, S1.FFMN_DED_NO
            FROM   TB_CLRI_PSMGT_PDLS_INVN_H S1
            WHERE  S1.DTL_DCSH_NO = #{dtlDcshNo}
            AND    S1.LAST_YN = 'Y'
            AND    S1.DEL_YN = 'N'
            ORDER BY S1.LAST_CHG_DTTM DESC) S
         WHERE
         ROWNUM = 1
        ) G
      , TB_CLRI_DED_VLUT_AUDT_COMN P
    WHERE
             A.DTL_DCSH_NO = L.DTL_DCSH_NO
      AND    A.DTL_DCSH_NO = G.DTL_DCSH_NO
      AND    A.DTL_DCSH_NO = P.DTL_DCSH_NO
      AND    A.DCLR_PT_CD = 'IM5'
      AND    A.DEL_YN = 'N'
      AND    L.DEL_YN(+) = 'N'
      AND    L.MG_TP_CD(+) = 'C'
      AND    P.DEL_YN  = 'N'
      AND    P.LAST_YN = 'Y'
      AND    A.DTL_DCSH_NO = #{dtlDcshNo}
  </select>

  <!--
    Achèvement de l'apurement de l'admission temporaire !== 임시수입 이행 완료 ==!
    (Song JunYoung)
    -->
  <update id="updateClrTempImpFfmnCmpl" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrPfpPfpVo">
    /* updateClrTempImpFfmnCmpl */
    UPDATE  TB_CLRI_PSMGT_COMN SET
    <trim prefixOverrides="," >
      , MG_RELE_YN = 'Y'                                   /** Caution levée ON !== 담보해제여부 ==! */
      , LAST_CHPR_ID = #{lastChprId}                       /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                       /** Date et heure de modification finale !== 최종변경일시 ==! */
    </trim>
    WHERE  DEL_YN = 'N'                                    /** Suppression ON !== 삭제여부 ==! */
    AND  DTL_DCSH_NO = #{dtlDcshNo}                        /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
  </update>

  <!--
    Consultation de la liste des objets d'apurement de l'admission temporaire !== 임시수입 이행대상 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempImpFfmnTrgtList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrTempImpFfmnTrgtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrTempImpFfmnTrgtVo">
    /* selectClrTempImpFfmnTrgtList */
    <include refid="pagination.header" ></include>
    SELECT
        A.DTL_DCSH_NO
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT
      , A.DCLR_CSTM_CD
      , A.DCER_CD
      , NVL2(A.DCER_NM, A.DCER_CD || ' ' || A.DCER_NM, A.DCER_CD) AS DCER_NM
      , A.IMPPN_IDFY_NO
      , NVL2(A.IMPPN_CO_NM, A.IMPPN_IDFY_NO || ' ' || A.IMPPN_CO_NM, A.IMPPN_IDFY_NO) AS IMPPN_CO_NM
      , A.FFMN_PRCS_STTS_CD
      , A.EPC_CD
      , A.DCLR_PT_CD
      , TO_CHAR(TO_DATE(A.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT
      , A.PDLS_NO
      , A.QTY
      , A.QTY_UT_CD
      , A.PDLS_TXBS_NCY_AMT
      , TO_CHAR(TO_DATE(A.PSMGT_FFMN_CMPL_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_CMPL_DT
      , A.TXPR_IDFY_NO
      , A.TXPR_CO_NM
    FROM (
	      SELECT
	          A.DTL_DCSH_NO                                              /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
	        , A.DCLR_DT                                                  /** Date de déclaration !== 신고일자 ==! */
	        , A.DCLR_CSTM_CD                                             /** Code de bureau de déclaration !== 신고세관코드 ==! */
	        , A.DCER_CD                                                  /** Code du déclarant !== 신고인코드 ==! */
	        , (SELECT
                   S1.CO_NM
               FROM
                   TB_COM_CO S1
                 , TB_COM_CO_DCLR_CD S2
               WHERE
                    S1.NIF = S2.NIF
               AND  S2.CO_DCLR_TP_CD = 'H'
               AND  S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                /** Nom de l'entreprise !== 업체명 ==! */
	        , A.IMPPN_IDFY_NO                                            /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
	        , B.IMPPN_CO_NM                                              /** Nom de société de l'importateur !== 수입자업체명 ==! */
	        , CASE WHEN C.PSMGT_FFMN_CMPL_DT IS NOT NULL
	               THEN CASE WHEN C.PSMGT_FFMN_CMPL_DT <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
	                         THEN 'AVL'
	                         ELSE 'APL'
	                         END
	               ELSE CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
	                         THEN 'NAP'
	                         ELSE 'NAL'
	                         END
	               END AS FFMN_PRCS_STTS_CD                              /** Code de l'état de traitement de l'apurement !== 이행처리상태코드 ==! */
	        , A.EPC_CD                                                   /** Code EPC !== EPC코드 ==! */
	        , A.DCLR_PT_CD                                               /** Code de type de déclaration !== 신고유형코드 ==! */
	        , C.PSMGT_FFMN_XPIR_DT                                       /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
	        , E.PDLS_NO                                                  /** N° d'article !== 품목번호 ==! */
	        , E.QTY                                                      /** Quantité !== 수량 ==! */
	        , E.QTY_UT_CD                                                /** Code de l'unité de quantité !== 수량단위코드 ==! */
	        , M.PDLS_TXBS_NCY_AMT                                        /** Montant Nyc De La Base Taxable De L'Article !== 품목과세기준NCY금액 ==! */
	        , C.PSMGT_FFMN_CMPL_DT                                       /** Date de l'apurement de régime suspensif !== 사후관리이행완료일자 ==! */
	        , A.TXPR_IDFY_NO                                             /** NIU !== 납세자식별번호 ==! */
            , B.TXPR_CO_NM                                               /** Nom de société contribuable !== 납세자업체명 ==! */
	      FROM
	          TB_CLRI_PSMGT_COMN C
	        , TB_CLRI_DED_COMN A
	        , TB_CLRI_DED_CO B
	        , TB_CLRI_DED_VLUT_COMN D
	        , TB_CLRI_DED_PDLS E
	        , TB_CLRI_DED_VLUT_PDLS M
	      WHERE
	             C.DTL_DCSH_NO = A.DTL_DCSH_NO
	      AND    C.DTL_DCSH_NO = B.DTL_DCSH_NO
	      AND    C.DTL_DCSH_NO = D.DTL_DCSH_NO
	      AND    C.DTL_DCSH_NO = E.DTL_DCSH_NO
	      AND    E.DTL_DCSH_NO = M.DTL_DCSH_NO
          AND    E.PDLS_NO = M.PDLS_NO
	      AND    C.DEL_YN = 'N'
	      AND    A.DEL_YN = 'N'
	      AND    B.DEL_YN = 'N'
	      AND    D.DEL_YN = 'N'
	      AND    E.DEL_YN = 'N'
	      AND    M.DEL_YN = 'N'
	      AND    A.DCLR_PT_CD = 'IM5'
	      AND    A.EPC_CD NOT LIKE 'ATP%'
          <if test="dclrDtFrom != null and dclrDtFrom != ''">
          AND    TO_DATE(A.DCLR_DT,'YYYYMMDD') <![CDATA[ >= ]]> TO_DATE(#{dclrDtFrom}, 'DD/MM/YYYY')
          AND    TO_DATE(A.DCLR_DT,'YYYYMMDD') <![CDATA[ <= ]]> TO_DATE(#{dclrDtTo}, 'DD/MM/YYYY')
          </if>
          <if test="dclrCstmCd != null and dclrCstmCd != ''">
          AND    A.DCLR_CSTM_CD = #{dclrCstmCd}
          </if>
          <if test="dcerCd != null and dcerCd != ''">
          AND    A.DCER_CD = #{dcerCd}
          </if>
          <if test="imppnIdfyNo != null and imppnIdfyNo != ''">
          AND    A.IMPPN_IDFY_NO = #{imppnIdfyNo}
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'AVL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NOT NULL
          AND    C.PSMGT_FFMN_CMPL_DT <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'APL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NOT NULL
          AND    C.PSMGT_FFMN_CMPL_DT <![CDATA[ > ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'NAP'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NULL
          AND    TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'NAL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NULL
          AND    TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ > ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="dtlDcshNo != null and dtlDcshNo != ''">
	      AND    A.DTL_DCSH_NO = #{dtlDcshNo}
          </if>
          UNION ALL
          SELECT
              A.DTL_DCSH_NO                                              /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
            , A.DCLR_DT                                                  /** Date de déclaration !== 신고일자 ==! */
            , A.DCLR_CSTM_CD                                             /** Code de bureau de déclaration !== 신고세관코드 ==! */
            , A.DCER_CD                                                  /** Code du déclarant !== 신고인코드 ==! */
            , (SELECT
                   S1.CO_NM
               FROM
                   TB_COM_CO S1
                 , TB_COM_CO_DCLR_CD S2
               WHERE
                    S1.NIF = S2.NIF
               AND  S2.CO_DCLR_TP_CD = 'H'
               AND  S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                /** Nom de l'entreprise !== 업체명 ==! */
            , A.IMPPN_IDFY_NO                                            /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
            , B.IMPPN_CO_NM                                              /** Nom de société de l'importateur !== 수입자업체명 ==! */
            , CASE WHEN C.PSMGT_FFMN_CMPL_DT IS NOT NULL
                   THEN CASE WHEN C.PSMGT_FFMN_CMPL_DT <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
                             THEN 'AVL'
                             ELSE 'APL'
                             END
                   ELSE CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
                             THEN 'NAP'
                             ELSE 'NAL'
                             END
                   END AS FFMN_PRCS_STTS_CD                              /** Code de l'état de traitement de l'apurement !== 이행처리상태코드 ==! */
            , A.EPC_CD                                                   /** Code EPC !== EPC코드 ==! */
            , A.DCLR_PT_CD                                               /** Code de type de déclaration !== 신고유형코드 ==! */
            , C.PSMGT_FFMN_XPIR_DT                                       /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
            , R.PRNG_PDLS_NO                                             /** N° d'article !== 품목번호 ==! */
            , R.QTY                                                      /** Quantité !== 수량 ==! */
            , R.QTY_UT_CD                                                /** Code de l'unité de quantité !== 수량단위코드 ==! */
            , NULL AS PDLS_TXBS_NCY_AMT                                  /** Montant Nyc De La Base Taxable De L'Article !== 품목과세기준NCY금액 ==! */
            , C.PSMGT_FFMN_CMPL_DT                                       /** Date de l'apurement de régime suspensif !== 사후관리이행완료일자 ==! */
            , A.TXPR_IDFY_NO                                             /** NIU !== 납세자식별번호 ==! */
            , B.TXPR_CO_NM                                               /** Nom de société contribuable !== 납세자업체명 ==! */
          FROM
              TB_CLRI_PSMGT_COMN C
            , TB_CLRI_DED_COMN A
            , TB_CLRI_DED_CO B
            , TB_CLRI_DED_VLUT_COMN D
            , TB_CLRI_DED_RIMEX_PRNG_PDLS R
          WHERE
                 C.DTL_DCSH_NO = A.DTL_DCSH_NO
          AND    C.DTL_DCSH_NO = B.DTL_DCSH_NO
          AND    C.DTL_DCSH_NO = D.DTL_DCSH_NO
          AND    C.DTL_DCSH_NO = R.DTL_DCSH_NO
          AND    C.DEL_YN = 'N'
          AND    A.DEL_YN = 'N'
          AND    B.DEL_YN = 'N'
          AND    D.DEL_YN = 'N'
          AND    R.DEL_YN = 'N'
          AND    A.DCLR_PT_CD = 'IM5'
          AND    A.EPC_CD LIKE 'ATP%'
          <if test="dclrDtFrom != null and dclrDtFrom != ''">
          AND    TO_DATE(A.DCLR_DT,'YYYYMMDD') <![CDATA[ >= ]]> TO_DATE(#{dclrDtFrom}, 'DD/MM/YYYY')
          AND    TO_DATE(A.DCLR_DT,'YYYYMMDD') <![CDATA[ <= ]]> TO_DATE(#{dclrDtTo}, 'DD/MM/YYYY')
          </if>
          <if test="dclrCstmCd != null and dclrCstmCd != ''">
          AND    A.DCLR_CSTM_CD = #{dclrCstmCd}
          </if>
          <if test="dcerCd != null and dcerCd != ''">
          AND    A.DCER_CD = #{dcerCd}
          </if>
          <if test="imppnIdfyNo != null and imppnIdfyNo != ''">
          AND    A.IMPPN_IDFY_NO = #{imppnIdfyNo}
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'AVL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NOT NULL
          AND    C.PSMGT_FFMN_CMPL_DT <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'APL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NOT NULL
          AND    C.PSMGT_FFMN_CMPL_DT <![CDATA[ > ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'NAP'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NULL
          AND    TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'NAL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NULL
          AND    TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ > ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="dtlDcshNo != null and dtlDcshNo != ''">
	      AND    A.DTL_DCSH_NO = #{dtlDcshNo}
          </if>
          ) A
    ORDER BY A.DCLR_DT DESC, A.DTL_DCSH_NO DESC, A.PDLS_NO
    <include refid="pagination.footer" ></include>
  </select>

  <!-- Prolongation du délai de réexportation 재수출 기간연장 -->
  
  <!--
    Consultation de la liste des prologation du délai de réexportation !== 재수출 기간연장 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrExpxtnsList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsVo">
    /* selectClrExpxtnsList */
    <include refid="pagination.header" ></include>
    SELECT
        ROWNUM AS RNUM
      , A.DTL_DCSH_NO
      , A.PSMGT_PRID_XTNS_RQST_NO
      , A.IMPPN_IDFY_NO
      , A.IMPPN_CO_NM
      , TO_CHAR(TO_DATE(A.PRID_XTNS_RGSR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PRID_XTNS_RGSR_DT
      , TO_CHAR(A.APRV_RQST_DTTM, 'DD/MM/YYYY') AS APRV_RSOF_DT
      , TO_CHAR(A.APRV_PRCS_CMPL_DTTM, 'DD/MM/YYYY') AS APRE_DT
      , A.PRID_XTNS_EMP_ID
      , A.PRCS_STTS_CD
      , A.APRV_PRCS_STTS_CD
      , A.PDLS_NO
      , A.PDLS_NM
      , A.HS_CD
      , A.APC_CD
      , TO_CHAR(TO_DATE(A.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT
      , TO_CHAR(TO_DATE(A.EXTD_PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS EXTD_PSMGT_FFMN_XPIR_DT
    FROM (
          SELECT
              A.DTL_DCSH_NO                                                                                 /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
            , I.PSMGT_PRID_XTNS_RQST_NO                                                                     /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
            , A.IMPPN_IDFY_NO                                                                               /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
            , B.IMPPN_CO_NM                                                                                 /** Nom de société de l'importateur !== 수입자업체명 ==! */
            , I.PRID_XTNS_RGSR_DT                                                                           /** Date de prorogation d'échéance !== 신청일자 ==! */
            , F.APRV_RQST_DTTM                                                                              /** Date de demande d'appobation !== 결재신청일시 ==! */
            , DECODE(I.PRCS_STTS_CD, 'D08', (SELECT MAX(S.APRV_PRCS_DTTM)
                                             FROM   TB_POTI_APRV_D S
                                             WHERE  S.APRV_ID = F.APRV_ID
                                             AND    S.DEL_YN = 'N'), NULL) AS APRV_PRCS_CMPL_DTTM           /** Date et heure du traitement de l'approbation !== 결재처리일시 ==! */
            , I.PRID_XTNS_EMP_ID                                                                            /** ID de l'inspecteur !== 세관직원ID ==! */
            , I.PRCS_STTS_CD                                                                                /** Code de statut de traitement !== 처리상태코드 ==! */
            , F.APRV_PRCS_STTS_CD                                                                           /** Code de statut du traitement d'approbation !== 결재처리상태코드 ==! */
            , G.PDLS_NO                      																/** N° D'Article !== 품목번호 ==! */
            , H.PDLS_NM 					   																/** Nom de l'article !== 품목명 ==! */
            , H.HS_CD 					   																	/** Code SH !== HS코드 ==! */
            , H.APC_CD 					   																	/** Code APC !== APC코드 ==! */
            , G.PSMGT_FFMN_XPIR_DT                                                                          /** Date d'echeance de l'apurement de regime suspensif !== 사후관리이행만료일자 ==! */
            , G.EXTD_PSMGT_FFMN_XPIR_DT                                                                     /** Date d'echeance prorogee de l'apurement de regime suspensif !== 연장된사후관리이행만료일자 ==! */
          FROM
              TB_CLRI_PSMGT_PRID_XTNS I
            , TB_CLRI_DED_COMN A
            , TB_CLRI_DED_CO B
            , TB_POTI_APRV F
            , ALPASSINT.TB_CLRI_PSMGT_PRID_XTNS_PDLS G
            , TB_CLRI_DED_PDLS H
          WHERE
                 I.DTL_DCSH_NO = A.DTL_DCSH_NO
          AND    I.DTL_DCSH_NO = B.DTL_DCSH_NO
          AND    I.APRV_ID = F.APRV_ID(+)
          AND    I.PSMGT_PRID_XTNS_RQST_NO = G.PSMGT_PRID_XTNS_RQST_NO
          AND    I.DTL_DCSH_NO = H.DTL_DCSH_NO
          AND    G.PDLS_NO = H.PDLS_NO
          AND    I.DEL_YN = 'N'
          AND    A.DEL_YN = 'N'
          AND    B.DEL_YN = 'N'
          AND    F.DEL_YN(+) = 'N'
          AND    A.DCLR_PT_CD = 'IM5'
          AND    I.PRCS_STTS_CD IN ('D01', 'D08', 'D09', 'I01')
          <if test="pridXtnsRgsrDtFrom != null and pridXtnsRgsrDtFrom != ''">
          AND    I.PRID_XTNS_RGSR_DT <![CDATA[ >= ]]> TO_CHAR(TO_DATE(#{pridXtnsRgsrDtFrom}, 'DD/MM/YYYY'), 'YYYYMMDD')
          AND    I.PRID_XTNS_RGSR_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE(#{pridXtnsRgsrDtTo}, 'DD/MM/YYYY'), 'YYYYMMDD')
          </if>
          <if test="dclrCstmCd != null and dclrCstmCd != ''">
          AND    A.DCLR_CSTM_CD = #{dclrCstmCd}
          </if>
          <if test="imppnIdfyNo != null and imppnIdfyNo != ''">
          AND    A.IMPPN_IDFY_NO = #{imppnIdfyNo}
          </if>
          <if test="prcsSttsCd != null and prcsSttsCd != ''">
          AND    I.PRCS_STTS_CD = #{prcsSttsCd}
          </if>
          <if test="dtlDcshNo != null and dtlDcshNo != ''">
		  AND    A.DTL_DCSH_NO = #{dtlDcshNo}
          </if>
          ORDER BY I.FRST_RGSR_DTTM DESC
          ) A
    ORDER BY RNUM
    <include refid="pagination.footer" ></include>
  </select>
    
  <!--
    Consultation en détail de la prolongation du délai de réexportation !== 재수출 기간연장 상세 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrExpxtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsDtlVo">
    /* selectClrExpxtns */
    SELECT
        A.DTL_DCSH_NO                                                                                         /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
      , I.PSMGT_PRID_XTNS_RQST_NO                                                                             /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT                                      /**  Date de déclaration !== 신고일자 ==! */
      , A.DCER_CD                                                                                             /** Code du déclarant !== 신고인코드 ==! */
      , (SELECT
                NVL2(MAX(S1.CO_NM), A.DCER_CD || ' | ' || MAX(S1.CO_NM), A.DCER_CD)
         FROM
                TB_COM_CO S1
              , TB_COM_CO_DCLR_CD S2
         WHERE
                S1.NIF = S2.NIF
         AND    S2.CO_DCLR_TP_CD = 'H'
         AND    S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                                                         /** Nom de l'entreprise !== 업체명 ==! */
      , A.IMPPN_IDFY_NO                                                                                       /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
      , A.IMPPN_IDFY_NO || ' | ' || B.IMPPN_CO_NM AS IMPPN_CO_NM                                              /** Nom de société de l'importateur !== 수입자업체명 ==! */
      , A.CSCL_PLN_CD                                                                                         /** Code de plan de dédouanement !== 통관계획코드 ==! */
      , A.DCLR_PT_CD                                                                                          /** Code de type de déclaration !== 신고유형코드 ==! */
      , A.EXP_CNTY_CD                                                                                         /** Code de pays exportateur !== 수출국가코드 ==! */
      , D.TTXBS_NCY_AMT                                                                                       /** Montant NCY total de la valeur statistique !== 총과세기준NCY금액 ==! */
      , TO_CHAR(TO_DATE(I.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT                /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , TO_CHAR(TO_DATE(I.PRID_XTNS_RGSR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PRID_XTNS_RGSR_DT                  /** Date de prorogation d'échéance !== 신청일자 ==! */
      , TO_CHAR(TO_DATE(I.EXTD_PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS EXTD_PSMGT_FFMN_XPIR_DT      /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , I.PRID_XTNS_RSN_CN                                                                                    /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , I.ATCH_FILE_ID                                                                                        /** ID de la pièce jointe !== 첨부파일ID ==! */
      , I.APRV_ID                                                                                             /** ID d'approbation !== 결재ID ==! */
      , I.AUDT_OPIN_CN                                                                                        /** Contenu de l'opinion à la suite de la vérification !== 심사의견내용 ==! */
      , I.REPN_ID                                                                                             /** ID de la personne demandant !== 신청자ID ==! */
      , I.PRCS_STTS_CD                                                                                        /** Code de statut de traitement !== 처리상태코드 ==! */
      , A.DCLR_CSTM_CD                                                                                        /** Code de bureau de déclaration !== 신고세관코드 ==! */
      , FN_GET_ORGN_NM(A.DCLR_CSTM_CD) AS DCLR_CSTM_NM
      , F.APRV_PRCS_STTS_CD                                                                                   /** Code de statut du traitement d'approbation !== 결재처리상태코드 ==! */
      , A.REFF_NO                                                                                             /** N° de reference !== 참조번호 ==! */
      , A.NEW_SYS_YN                                                                                          /** Nouveau système ON !== 신규시스템여부 ==! */
      , A.EPC_CD
      , DECODE((SELECT COUNT(DTL_DCSH_NO) FROM TB_CLRI_DED_PDLS WHERE DTL_DCSH_NO = A.DTL_DCSH_NO AND VHCL_YN = 'Y' AND DEL_YN = 'N'), 0, 'N', 'Y') AS VHCL_YN
      , G.PDLS_NO                      																		  /** N° D'Article !== 품목번호 ==! */
      , H.PDLS_NM 					   																		  /** Nom de l'article !== 품목명 ==! */
      , H.HS_CD 					   																		  /** Code SH !== HS코드 ==! */
      , H.APC_CD 					   																		  /** Code APC !== APC코드 ==! */
      , TO_CHAR(TO_DATE(G.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT                /** Date d'echeance de l'apurement de regime suspensif !== 사후관리이행만료일자 ==! */
      , TO_CHAR(TO_DATE(G.EXTD_PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS EXTD_PSMGT_FFMN_XPIR_DT      /** Date d'echeance prorogee de l'apurement de regime suspensif !== 연장된사후관리이행만료일자 ==! */
    FROM
            TB_CLRI_PSMGT_PRID_XTNS I
          , TB_CLRI_DED_COMN A
          , TB_CLRI_DED_CO B
          , TB_CLRI_PSMGT_COMN C
          , TB_CLRI_DED_VLUT_COMN D
          , TB_POTI_APRV F
          , ALPASSINT.TB_CLRI_PSMGT_PRID_XTNS_PDLS G
          , TB_CLRI_DED_PDLS H
    WHERE
            I.DTL_DCSH_NO = A.DTL_DCSH_NO
    AND     I.DTL_DCSH_NO = B.DTL_DCSH_NO
    AND     I.DTL_DCSH_NO = C.DTL_DCSH_NO
    AND     I.DTL_DCSH_NO = D.DTL_DCSH_NO
    AND     I.PSMGT_PRID_XTNS_RQST_NO = G.PSMGT_PRID_XTNS_RQST_NO
    AND     I.DTL_DCSH_NO = H.DTL_DCSH_NO
    AND     G.PDLS_NO = H.PDLS_NO
    AND     I.APRV_ID = F.APRV_ID(+)
    AND     I.PRCS_STTS_CD IN ('D01', 'D08', 'D09', 'I01')
    AND     I.DEL_YN = 'N'
    AND     A.DEL_YN = 'N'
    AND     B.DEL_YN = 'N'
    AND     C.DEL_YN = 'N'
    AND     D.DEL_YN = 'N'
    AND     F.DEL_YN(+) = 'N'
    AND     A.DCLR_PT_CD = 'IM5'
    AND     I.PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}
  </select>
    
  <!--
    Vérification de la possibilité d'enregistrement d'une prolongation du délai de réexportation et vérification de traitement  !== 재수출 기간연장 등록 가능 및 처리 여부 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrExpxtnsChkExist" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsSrchVo">
    /* selectClrExpxtnsChkExist */
    SELECT
        A.DTL_DCSH_NO                 /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
      , C.PSMGT_FFMN_CMPL_DT          /** Date de l'apurement de régime suspensif !== 사후관리이행완료일자 ==! */
      , C.PSMGT_FFMN_CMPL_YN          /** Régime suspensif apuré ON !== 사후관리이행완료여부 ==! */
      , A.DCLR_PT_CD                  /** Code de type de déclaration !== 신고유형코드 ==! */
      , (CASE WHEN I.PRCS_STTS_CD IN ('D08', 'D09') THEN NULL ELSE I.PSMGT_PRID_XTNS_RQST_NO END) AS PSMGT_PRID_XTNS_RQST_NO     /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      , C.DEL_YN                      /** Suppression ON !== 삭제여부 ==! */
      , IP.PRCS_STTS_CD               /** Code de statut de traitement !== 처리상태코드 ==! */
    FROM (SELECT
              A.DTL_DCSH_NO
            , A.DCLR_PT_CD
            , MAX(I.PSMGT_PRID_XTNS_RQST_NO) AS PSMGT_PRID_XTNS_RQST_NO
          FROM
                 TB_CLRI_DED_COMN A
               , TB_CLRI_PSMGT_PRID_XTNS I
          WHERE
                 A.DTL_DCSH_NO = I.DTL_DCSH_NO(+)
          AND    A.DTL_DCSH_NO = #{dtlDcshNo}
          AND    I.PRCS_STTS_CD(+) IN ('D01', 'D08', 'D09', 'I01')
          AND    A.DEL_YN = 'N'
          AND    I.DEL_YN(+) = 'N'
          <if test="repnId != null and repnId != ''">
          AND    I.REPN_ID(+) = #{repnId}
          </if>
          GROUP BY A.DTL_DCSH_NO, A.DCLR_PT_CD) A
        , TB_CLRI_PSMGT_PRID_XTNS I
        , TB_CLRI_PSMGT_COMN C
        , (SELECT
               I.DTL_DCSH_NO
             , I.PSMGT_PRID_XTNS_RQST_NO
             , I.PRCS_STTS_CD
           FROM
                 (SELECT
                      DTL_DCSH_NO
                    , PSMGT_PRID_XTNS_RQST_NO
                    , PRCS_STTS_CD
                  FROM
                         TB_CLRI_PSMGT_PRID_XTNS
                  WHERE
                         DEL_YN = 'N'
                  AND    DTL_DCSH_NO = #{dtlDcshNo}
                  AND    PRCS_STTS_CD != 'A01'
                  ORDER BY FRST_RGSR_DTTM DESC) I
           WHERE ROWNUM = 1
           ) IP
    WHERE  A.DTL_DCSH_NO = I.DTL_DCSH_NO(+)
    AND    A.DTL_DCSH_NO = C.DTL_DCSH_NO(+)
    AND    A.PSMGT_PRID_XTNS_RQST_NO = I.PSMGT_PRID_XTNS_RQST_NO(+)
    AND    A.DTL_DCSH_NO = IP.DTL_DCSH_NO(+)
    AND    I.DEL_YN(+) = 'N'
    AND    C.DEL_YN(+) = 'N'
  </select>
    
  <!--
    Consultation des informations de la déclaration en détail lors du non-enregistrement de la prolongation du délai de réexportation !== 재수출 기간연장 미등록 시 상세신고서정보 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrExpxtnsNotExist" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsDtlVo">
    /* selectClrExpxtnsNotExist */
    SELECT
        A.DTL_DCSH_NO                                                                                 /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT                              /** Date de déclaration !== 신고일자 ==! */
      , A.DCER_CD                                                                                     /** Code du déclarant !== 신고인코드 ==! */
      , (SELECT
                NVL2(MAX(S1.CO_NM), A.DCER_CD || ' | ' || MAX(S1.CO_NM), A.DCER_CD)
         FROM
                TB_COM_CO S1
              , TB_COM_CO_DCLR_CD S2
         WHERE
                S1.NIF = S2.NIF
         AND    S2.CO_DCLR_TP_CD = 'H'
         AND    S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                                                 /** Nom de l'entreprise !== 업체명 ==! */
      , A.IMPPN_IDFY_NO                                                                               /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
      , B.IMPPN_CO_NM                                                                                 /** Nom de société de l'importateur !== 수입자업체명 ==! */
      , A.CSCL_PLN_CD                                                                                 /** Code de plan de dédouanement !== 통관계획코드 ==! */
      , A.DCLR_PT_CD                                                                                  /** Code de type de déclaration !== 신고유형코드 ==! */
      , (SELECT
                E1.PDLS_NM
         FROM
                TB_CLRI_DED_PDLS E1
         WHERE
                E1.DTL_DCSH_NO = A.DTL_DCSH_NO
         AND    E1.PDLS_NO = (SELECT
                                     MIN(E11.PDLS_NO)
                              FROM
                                     TB_CLRI_DED_PDLS E11
                              WHERE
                                     E11.DTL_DCSH_NO = E1.DTL_DCSH_NO
                              AND    E11.DEL_YN = 'N')
         AND    E1.DEL_YN = 'N'
         ) AS PDLS_NM                                                                                 /** Nom de l'article !== 품목명 ==! */
      , A.EXP_CNTY_CD                                                                                 /** Code de pays exportateur !== 수출국가코드 ==! */
      , D.TTXBS_NCY_AMT                                                                               /** Montant NCY total de la valeur statistique !== 총과세기준NCY금액 ==! */
      , TO_CHAR(TO_DATE(C.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT        /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , A.DCLR_CSTM_CD                                                                                /** Code de bureau de déclaration !== 신고세관코드 ==! */
      , A.NEW_SYS_YN                                                                                  /** Nouveau système ON !== 신규시스템여부 ==! */
    FROM
            TB_CLRI_DED_COMN A
          , TB_CLRI_DED_CO B
          , TB_CLRI_PSMGT_COMN C
          , TB_CLRI_DED_VLUT_COMN D
    WHERE
            A.DTL_DCSH_NO = B.DTL_DCSH_NO
    AND     A.DTL_DCSH_NO = C.DTL_DCSH_NO
    AND     A.DTL_DCSH_NO = D.DTL_DCSH_NO
    AND     A.DTL_DCSH_NO = #{dtlDcshNo}
    AND     A.DEL_YN = 'N'
    AND     B.DEL_YN = 'N'
    AND     C.DEL_YN = 'N'
    AND     D.DEL_YN = 'N'
    AND     A.DCLR_PT_CD = 'IM5'
  </select>
    
  <!--
    Enregistrement de la prolongation du délai de réexportation !== 재수출 기간연장 등록 ==!
    (Song JunYoung)
    -->
  <insert id="insertClrExpxtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsDtlVo">
    /* insertClrExpxtns */
    WITH UPSERT AS (
      UPDATE TB_CLRI_PSMGT_PRID_XTNS SET
          DTL_DCSH_NO = #{dtlDcshNo}                  /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
        , REPN_ID = #{repnId}                         /** ID de la personne demandant !== 신청자ID ==! */
        , PSMGT_FFMN_XPIR_DT = TO_CHAR(TO_DATE(#{psmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')     /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
        , EXTD_PSMGT_FFMN_XPIR_DT = TO_CHAR(TO_DATE(#{extdPsmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')  /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
        , PRID_XTNS_RSN_CN = #{pridXtnsRsnCn}         /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
        , ATCH_FILE_ID = #{atchFileId}                /** ID de la pièce jointe !== 첨부파일ID ==! */
        , PRCS_STTS_CD = #{prcsSttsCd}                /** Code de statut de traitement !== 처리상태코드 ==! */
        , PRID_XTNS_EMP_ID = #{pridXtnsEmpId}         /** ID de l'inspecteur !== 세관직원ID ==! */
        , DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
        , FRST_REGST_ID = #{frstRegstId}              /** ID du premier enregistrant  !== 최초등록자ID ==! */
        , FRST_RGSR_DTTM = SYSTIMESTAMP               /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
        , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
        , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
      WHERE PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}  /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      RETURNING *
    )
    INSERT INTO TB_CLRI_PSMGT_PRID_XTNS
      (
        PSMGT_PRID_XTNS_RQST_NO      /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      , DTL_DCSH_NO                  /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
      , REPN_ID                      /** ID de la personne demandant !== 신청자ID ==! */
      , PRID_XTNS_RGSR_DT            /** Date de prorogation d'échéance !== 신청일자 ==! */
      , PSMGT_FFMN_XPIR_DT           /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , EXTD_PSMGT_FFMN_XPIR_DT      /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , PRID_XTNS_RSN_CN             /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , ATCH_FILE_ID                 /** ID de la pièce jointe !== 첨부파일ID ==! */
      , PRCS_STTS_CD                 /** Code de statut de traitement !== 처리상태코드 ==! */
      , PRID_XTNS_EMP_ID             /** ID de l'inspecteur !== 세관직원ID ==! */
      , DEL_YN                       /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID                /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM               /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID                 /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM                /** Date et heure de modification finale !== 최종변경일시 ==! */
      )
    SELECT
        #{psmgtPridXtnsRqstNo}       /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      , #{dtlDcshNo}                 /** Numero de la déclaration en détail!! !== 상세신고서번호 ==! */
      , #{repnId}                    /** ID de la personne demandant !== 신청자ID ==! */
      , TO_CHAR(SYSDATE, 'YYYYMMDD') /** Date de prorogation d'échéance !== 신청일자 ==! */
      , TO_CHAR(TO_DATE(#{psmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')           /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , TO_CHAR(TO_DATE(#{extdPsmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')       /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , #{pridXtnsRsnCn}             /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , #{atchFileId}                /** ID de la pièce jointe !== 첨부파일ID ==! */
      , #{prcsSttsCd}                /** Code de statut de traitement !== 처리상태코드 ==! */
      , #{pridXtnsEmpId}             /** ID de l'inspecteur !== 세관직원ID ==! */
      , 'N'                          /** Suppression ON !== 삭제여부 ==! */
      , #{frstRegstId}               /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE NOT EXISTS(SELECT * FROM UPSERT)
  </insert>
	
  <!--
    Modification de la prolongation du délai de réexportation !== 재수출 기간연장 수정 ==!
    (Song JunYoung)
    -->
  <update id="updateClrExpxtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsDtlVo">
    /* updateClrExpxtns */
    UPDATE  TB_CLRI_PSMGT_PRID_XTNS SET
    <trim prefixOverrides="," >
        LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
      <if test="prcsSttsCd != null and prcsSttsCd != ''">
      , PRCS_STTS_CD = #{prcsSttsCd}                /** Code de statut de traitement !== 처리상태코드 ==! */
      </if>
      <if test="pridXtnsEmpId != null and pridXtnsEmpId != ''">
      , PRID_XTNS_EMP_ID = #{pridXtnsEmpId}         /** ID de l'inspecteur !== 세관직원ID ==! */
      </if>
      <if test="aprvId != null and aprvId != ''">
      , APRV_ID = #{aprvId}                         /** ID d'approbation  !== 결재ID ==! */
      </if>
      <if test="aprvPrcsYn == null or aprvPrcsYn == ''">
      , EXTD_PSMGT_FFMN_XPIR_DT = TO_CHAR(TO_DATE(#{extdPsmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')  /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , PRID_XTNS_RSN_CN = #{pridXtnsRsnCn}         /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , ATCH_FILE_ID = #{atchFileId}                /** ID de la pièce jointe !== 첨부파일ID ==! */
      , AUDT_OPIN_CN = #{audtOpinCn}                /** Contenu de l'opinion à la suite de la vérification !== 심사의견내용 ==! */
      </if>
    </trim>
    WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
    <if test="psmgtPridXtnsRqstNo != null and psmgtPridXtnsRqstNo != ''">
    AND  PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}       /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
    </if>
    <if test='aprvId != null and aprvId != "" and aprvPrcsYn == "Y"'>
    AND  APRV_ID = #{aprvId}                                    /** ID d'approbation  !== 결재ID ==! */
    </if>
  </update>

  <!--
    Consultation de la prolongation du délai de réexportation avec l'identifiant approbateur !== 결재ID로 재수출 기간연장 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrExpxtnsSearchAprvId" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsDtlVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsDtlVo">
    /* selectClrExpxtnsSearchAprvId */
    SELECT
        I.DTL_DCSH_NO
      , A.REFF_NO
      , I.PSMGT_PRID_XTNS_RQST_NO
    FROM
           TB_CLRI_DED_COMN A
         , TB_CLRI_PSMGT_PRID_XTNS I
    WHERE
           A.DTL_DCSH_NO = I.DTL_DCSH_NO
    AND    A.DEL_YN = 'N'
    AND    I.DEL_YN = 'N'
    AND    I.APRV_ID = #{aprvId}
  </select>

  <!--
    Prolongation du délai de réexportation !== 재수출 기간연장 ==!
    (Song JunYoung)
    -->
  <update id="updateClrExpPsmgtComn" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsDtlVo">
    /* updateClrExpPsmgtComn */
    UPDATE  TB_CLRI_PSMGT_COMN SET
    <trim prefixOverrides="," >
        PSMGT_FFMN_XPIR_DT = (SELECT S.EXTD_PSMGT_FFMN_XPIR_DT FROM TB_CLRI_PSMGT_PRID_XTNS S WHERE S.PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo} )     /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
    </trim>
    WHERE  DEL_YN = 'N'                             /** Suppression ON !== 삭제여부 ==! */
    AND  DTL_DCSH_NO = #{dtlDcshNo}                 /** Numéro du DAU !== DED번호 ==! */
  </update>

  <!--
    Suppression de la prolongation du délai de réexportation !== 재수출 기간연장 삭제 ==!
    (Song JunYoung)
    -->
  <update id="deleteClrExpxtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsDtlVo">
    /* deleteClrExpxtns */
    UPDATE  TB_CLRI_PSMGT_PRID_XTNS SET
         DEL_YN = 'Y'                                  /** Suppression ON !== 삭제여부 ==! */
      ,  LAST_CHPR_ID = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
      ,  LAST_CHG_DTTM = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
    AND    PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}       /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
  </update>

  <!--
    Vérification de l'apurement O/N de la déclaration de réexportation !== 재수출 신고 이행 여부 체크 ==!
    (Song JunYoung)
    -->
  <select id="selectClrReexpDclrFfmnYnCfrm" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsDtlVo" resultType="string">
    /* selectClrReexpDclrFfmnYnCfrm */
    SELECT
           C.PSMGT_FFMN_CMPL_DT
    FROM
           TB_CLRI_PSMGT_COMN C
         , TB_CLRI_PSMGT_PRID_XTNS I
    WHERE
           C.DTL_DCSH_NO = I.DTL_DCSH_NO
    AND    C.DEL_YN = 'N'
    AND    I.DEL_YN = 'N'
    <choose>
      <when test="psmgtPridXtnsRqstNo != null and psmgtPridXtnsRqstNo != ''">
      AND    I.PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}
      </when>
      <otherwise>
      AND    C.DTL_DCSH_NO = #{dtlDcshNo}
      AND    ROWNUM = 1
      </otherwise>
    </choose>
  </select>

  <!--
    Consultation des informations nécessaires pour vérifier la durée de validité de la caution !== 담보 유효기간 체크 관련 필요 정보 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrReexpPridXtnsMgInfo" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsDtlVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReexpPridXtnsMgInfoVo">
    /* selectClrReexpPridXtnsMgInfo */
    SELECT
        L.MG_AC_NO AS MG_NO                                                                     /** N° de caution !== 담보번호 ==! */
      , DECODE(A.DCLR_PT_CD, 'EX2', A.EXPPN_IDFY_NO, A.IMPPN_IDFY_NO) AS IDFY_NO_1              /** N° d'identification !== 식별번호 ==! */
      , A.TXPR_IDFY_NO AS IDFY_NO_2                                                             /** N° d'identification !== 식별번호 ==! */
      , A.DCER_CD AS IDFY_NO_3                                                                  /** N° d'identification !== 식별번호 ==! */
      , ( SELECT NIF
          FROM   TB_COM_CO_DCLR_CD
          WHERE  CO_DCLR_CD = A.DCER_CD
          AND    ROWNUM = 1 ) AS IDFY_NO_3
      , 1 AS USE_PRNG_AMT                                                                       /** Montant à utiliser !== 사용예정금액 ==! */
      , A.DTL_DCSH_NO AS REFF_NO                                                                /** N° de référence !== 참조번호 ==! */
      , A.AUDT_EMP_ID                                                                           /** ID de la personne vérifiant !== 심사직원ID ==! */
      , L.MG_TP_CD                                                                              /** Code de type de caution !== 담보구분코드 ==! */
      , A.ACPT_DT AS USE_DTTM_FROM                                                              /**Option de la date de début de critère !== 기준시작일자 옵션 ==! */
    FROM
           TB_CLRI_DED_COMN A
         , TB_CLRI_DED_MG L
    WHERE
           A.DTL_DCSH_NO = L.DTL_DCSH_NO
    AND    A.DCLR_PT_CD = 'IM5'
    AND    A.DEL_YN = 'N'
    AND    L.DEL_YN = 'N'
    AND    A.DTL_DCSH_NO = #{dtlDcshNo}
  </select>
    
  <!-- Prolongation du délai de réexportation 재수출 기간연장 -->

  <!-- 임시수출 사후관리 -->
  <!--
    Consultation de la liste des exportations temporaires !== 임시수출 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempExpList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpVo">
    /* selectClrTempExpList */
    <include refid="pagination.header" ></include>
	SELECT
	    A.DTL_DCSH_NO                                                      /** Numéro du DAU !== DED번호 ==! */
	  , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT   /** Date de DAU !== DED일자 ==! */
	  , A.DCLR_PT_CD                                                       /** Code de type de déclaration !== 신고유형코드 ==! */
	  , B.EXPPN_CO_NM                                                      /** Nom de société de l'exportateur !== 수출자업체명 ==! */
	  , B.IMPPN_CO_NM                                                      /** Nom de société de l'importateur !== 수입자업체명 ==! */
	  , A.IMPPN_IDFY_NO                                                    /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
	  , A.EXPPN_IDFY_NO                                                    /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
	  , A.EXP_CNTY_CD                                                      /** Code de pays exportateur !== 수출국가코드 ==! */
	  , A.PDLS_GCNT                                                        /** Nombre d'articles !== 품목개수 ==! */
	  , A.EPC_CD                                                           /** Code EPC !== EPC코드 ==! */
	  , TO_CHAR(TO_DATE(C.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT  /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
	  , D.TTXBS_NCY_AMT                                                    /** Montant NCY total de la valeur statistique  !== 총과세기준NCY금액 ==! */
	  , A.AUDT_EMP_ID                                                      /** ID de la personne vérifiant !== 심사직원ID ==! */
	  , (SELECT S.EMP_NM FROM TB_POTI_EMP S WHERE S.PBSR_NO = A.AUDT_EMP_ID AND S.DEL_YN = 'N') AS EMP_NM   /** Nom de l'employé !== 직원명 ==! */
	FROM
           TB_CLRI_PSMGT_COMN C
         , TB_CLRI_DED_COMN A
         , TB_CLRI_DED_CO B
         , TB_CLRI_DED_VLUT_COMN D
	WHERE
	       C.DTL_DCSH_NO = A.DTL_DCSH_NO
	AND    C.DTL_DCSH_NO = B.DTL_DCSH_NO
	AND    C.DTL_DCSH_NO = D.DTL_DCSH_NO
	AND    A.DCLR_PT_CD = 'EX2'
	AND    C.DEL_YN = 'N'
	AND    A.DEL_YN = 'N'
	AND    B.DEL_YN = 'N'
	AND    D.DEL_YN = 'N'
	<if test="dclrDtFrom != null and dclrDtFrom != ''">
	AND    A.DCLR_DT <![CDATA[ >= ]]> TO_CHAR(TO_DATE( #{dclrDtFrom}, 'DD/MM/YYYY'), 'YYYYMMDD')
    AND    A.DCLR_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE( #{dclrDtTo}, 'DD/MM/YYYY'), 'YYYYMMDD')
    </if>
    <if test="dclrCstmCd != null and dclrCstmCd != ''">
	AND    A.DCLR_CSTM_CD = #{dclrCstmCd}
    </if>
    <if test="epcCd != null and epcCd != ''">
	AND    A.EPC_CD = #{epcCd}
    </if>
    <if test="exppnIdfyNo != null and exppnIdfyNo != ''">
	AND    A.EXPPN_IDFY_NO = #{exppnIdfyNo}
    </if>
    <if test="dtlDcshNo != null and dtlDcshNo != ''">
	AND    A.DTL_DCSH_NO = #{dtlDcshNo}
    </if>
    ORDER BY A.DCLR_DT DESC, A.FRST_RGSR_DTTM DESC
    <include refid="pagination.footer" ></include>
  </select>
    
  <!--
    Consultation en détail de l'exportation temporaire !== 임시수출 상세 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempExp" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpVo">
    /* selectClrTempExp */
    SELECT
        A.DTL_DCSH_NO                                                                           /** Numéro du DAU !== DED번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT                        /** Date de DAU !== DED일자 ==! */
      , A.DCLR_PT_CD                                                                            /** Code de type de déclaration !== 신고유형코드 ==! */
      , A.DCLR_CSTM_CD                                                                          /** Code de bureau de déclaration !== 신고세관코드 ==! */
      , A.EXPPN_IDFY_NO || ' | ' || B.EXPPN_CO_NM AS EXPPN_CO_NM                                /** Nom de société de l'exportateur !== 수출자업체명 ==! */
      , B.IMPPN_CO_NM                                                                           /** Nom de société de l'importateur !== 수입자업체명 ==! */
      , A.IMPPN_IDFY_NO                                                                         /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
      , A.EXPPN_IDFY_NO                                                                         /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
      , A.EXP_CNTY_CD                                                                           /** Code de pays exportateur !== 수출국가코드 ==! */
      , A.PDLS_GCNT                                                                             /** Nombre d'articles !== 품목개수 ==! */
      , TO_CHAR(TO_DATE(C.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT  /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , D.TTXBS_NCY_AMT                                                                         /** Montant NCY total de la valeur statistique  !== 총과세기준NCY금액 ==! */
      , TO_CHAR(TO_DATE(C.PSMGT_FFMN_CMPL_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_CMPL_DT  /** Date de l'apurement de régime suspensif !== 사후관리이행완료일자 ==! */
      , DECODE(P.ASED_FVRFC_MG_DSCN_AMT, NULL, P.ASED_FVRFC_MG_AMT, P.ASED_FVRFC_MG_DSCN_AMT) AS MG_AMT /** Montant de caution != 담보금액 =! */
      , NVL((SELECT SUM(S.MG_RELE_AMT)
             FROM   TB_COLI_MG_RELE S, TB_COLI_MG M
             WHERE S.RQST_NO  = M.RQST_NO
               AND    M.MG_NO = L.MG_AC_NO
               AND    S.USE_REFF_NO = L.DTL_DCSH_NO
               AND    S.DEL_YN = 'N'), 0) AS MG_RELE_AMT                                        /** Montant rendu après la mainlevée  !== 담보해제금액 ==! */
      , C.MG_RELE_YN                                                                            /** Caution levée ON !== 담보해제여부 ==! */
      , L.MG_TP_CD                                                                              /** Code de type de caution !== 담보구분코드 ==! */
      , L.MG_AC_NO                                                                              /** N° de compte de caution !== 담보계좌번호 ==! */
      , A.NEW_SYS_YN                                                                            /** Nouveau système ON !== 신규시스템여부 ==! */
      , TO_CHAR(TO_DATE(A.ACPT_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS ACPT_DT
      , (SELECT SUM(TAMT)
         FROM TB_COLI_NTFC
         WHERE REFF_NO = A.DTL_DCSH_NO
           AND CNCL_YN = 'N'
           AND DEL_YN  = 'N'
        ) AS NTFC_AMT
    FROM
           TB_CLRI_PSMGT_COMN C
         , TB_CLRI_DED_COMN A
         , TB_CLRI_DED_CO B
         , TB_CLRI_DED_VLUT_COMN D
         , TB_CLRI_DED_MG L
         , TB_CLRI_DED_VLUT_AUDT_COMN P
    WHERE
           C.DTL_DCSH_NO = A.DTL_DCSH_NO
    AND    C.DTL_DCSH_NO = B.DTL_DCSH_NO
    AND    C.DTL_DCSH_NO = D.DTL_DCSH_NO
    AND    C.DTL_DCSH_NO = L.DTL_DCSH_NO(+)
    AND    C.DTL_DCSH_NO = P.DTL_DCSH_NO(+)
    AND    C.DEL_YN = 'N'
    AND    A.DEL_YN = 'N'
    AND    B.DEL_YN = 'N'
    AND    D.DEL_YN = 'N'
    AND    L.DEL_YN(+) = 'N'
    AND    P.DEL_YN(+) = 'N'
    AND    P.LAST_YN(+) = 'Y'
    AND    A.DTL_DCSH_NO = #{dtlDcshNo}
    AND    ROWNUM = 1
  </select>
    
  <!--
    Consultation des articles de l'exportation temporaire !== 임시수출 품목 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempExpItmList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpItmVo">
    /* selectClrTempExpItmList */
    SELECT
        G.PDLS_NO AS PDLS_NO                                                                                                       /** N° d'article !== 품목번호 ==! */
      , G.HS_CD                                                                                                                    /** Code SH !== HS코드 ==! */
      , H.HS_DESC                                                                                                                  /** Description du SH !== HS설명 ==! */
      , G.QTY                                                                                                                      /** Quantité !== 수량 ==! */
      , (CASE
              WHEN A.EPC_CD NOT LIKE 'ETP%' THEN NVL(G.QTY_UT_CD, (SELECT QTY_UT_CD FROM TB_CLRI_DED_PDLS WHERE DTL_DCSH_NO = G.DTL_DCSH_NO AND PDLS_NO = G.PDLS_NO))
              ELSE NVL(G.QTY_UT_CD, (SELECT QTY_UT_CD FROM TB_CLRI_DED_RIMEX_PRNG_PDLS WHERE DTL_DCSH_NO = G.DTL_DCSH_NO AND PRNG_PDLS_NO = G.PDLS_NO))
         END) AS QTY_UT_CD                                                                                                         /** Code de l'unité de quantité !== 수량단위코드 ==! */
      , A.EPC_CD                                                                                                                   /** Code EPC !== EPC코드 ==! */
      , (CASE
              WHEN A.EPC_CD NOT LIKE 'ETP%' THEN (SELECT APC_CD FROM TB_CLRI_DED_PDLS WHERE DTL_DCSH_NO = G.DTL_DCSH_NO AND PDLS_NO = G.PDLS_NO)
              ELSE NULL
         END) AS APC_CD                                                                                                            /** Code APC !== APC코드 ==! */
      , (CASE
              WHEN A.EPC_CD NOT LIKE 'ETP%' THEN (SELECT PDLS_TXBS_NCY_AMT FROM TB_CLRI_DED_VLUT_PDLS WHERE DTL_DCSH_NO = G.DTL_DCSH_NO AND PDLS_NO = G.PDLS_NO)
              ELSE NULL
         END) AS TTXBS_NCY_AMT                                                                                                     /** Montant Nyc De La Base Taxable De L'Article !== 품목과세기준NCY금액 ==! */
      , (SELECT SUM(S.FFMN_QTY) FROM TB_CLRI_PSMGT_PDLS_INVN_H S WHERE S.DTL_DCSH_NO = G.DTL_DCSH_NO AND S.PDLS_NO = G.PDLS_NO AND S.DEL_YN = 'N') AS FFMN_QTY  /** Quantité apurée !== 이행수량 ==! */
      , G.RSQTY_QTY                                                                                                                /** Quatité restante !== 잔량수량 ==! */
    FROM
           TB_CLRI_PSMGT_PDLS_INVN_H G
         , TB_CLRI_DED_COMN A
         , TB_CLRI_HS_CD H
    WHERE
           G.DTL_DCSH_NO = A.DTL_DCSH_NO
    AND    G.LAST_YN = 'Y'
    AND    G.DTL_DCSH_NO = #{dtlDcshNo}
    AND    G.HS_CD = H.HS_CD(+)
    AND    A.DCLR_DT BETWEEN H.HS_APLY_STRT_DT AND H.HS_APLY_END_DT
    ORDER BY TO_NUMBER(G.PDLS_NO)
   </select>
    
  <!--
    Consultation de la déclaration d'apurement de l'exportation temporaire !== 임시수출 이행신고서 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempExpFfmnDcshList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpItmVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpFfmnDcshVo">
    /* selectClrTempExpFfmnDcshList */
    SELECT
        A.DTL_DCSH_NO                                                       /** Numéro du DAU !== DED번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT    /** Date de DAU !== DED일자 ==! */
      , A.DCLR_PT_CD                                                        /** Code de type de déclaration !== 신고유형코드 ==! */
      , A.DCLR_CSTM_CD                                                      /** Code de bureau de déclaration !== 신고세관코드 ==! */
      , A.TXPR_IDFY_NO                                                      /** NIU !== 납세자식별번호 ==! */
      , G.PDLS_NO                                                           /** N° d'article !== 품목번호 ==! */
      , E.HS_CD                                                             /** Code SH !== HS코드 ==! */
      , H.HS_DESC                                                           /** Description du SH !== HS설명 ==! */
      , A.EPC_CD                                                            /** Code EPC !== EPC코드 ==! */
      , G.FFMN_QTY                                                          /** Quantité apurée !== 이행수량 ==! */
      , E.QTY_UT_CD                                                         /** Code de l'unité de quantité !== 수량단위코드 ==! */
      , D.TTXBS_NCY_AMT                                                     /** Montant NCY total de la valeur statistique  !== 총과세기준NCY금액 ==! */
      , A.PRCS_STTS_CD                                                      /** Code de statut de traitement !== 처리상태코드 ==! */
      , E.PDLS_NO                                                           /** N° d'article !== 품목번호 ==! */
    FROM
           TB_CLRI_PSMGT_PDLS_INVN_H G
         , TB_CLRI_DED_COMN A
         , TB_CLRI_DED_VLUT_COMN D
         , TB_CLRI_DED_PDLS E
         , TB_CLRI_HS_CD H
    WHERE
           G.FFMN_DTL_DCSH_NO = A.DTL_DCSH_NO
    AND    G.FFMN_DTL_DCSH_NO = D.DTL_DCSH_NO
    AND    G.FFMN_DTL_DCSH_NO = E.DTL_DCSH_NO
    AND    G.FFMN_PDLS_NO = E.PDLS_NO
    AND    E.HS_CD = H.HS_CD(+)
    AND    G.DTL_DCSH_NO = #{dtlDcshNo}
    AND    G.PDLS_NO = #{pdlsNo}
    AND    G.INVN_MVMN_TP_CD = 'OT'
    AND    G.DEL_YN = 'N'
    AND    A.DEL_YN = 'N'
    AND    D.DEL_YN = 'N'
    AND    E.DEL_YN = 'N'
    AND    H.DEL_YN(+) = 'N'
    AND    A.DCLR_DT BETWEEN H.HS_APLY_STRT_DT AND H.HS_APLY_END_DT
    ORDER BY A.DCLR_DT DESC, A.FRST_RGSR_DTTM DESC
  </select>

  <!--
    Main-levée finale O/N de la caution !== 담보 최종 해제 여부 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempExpLastReleYn" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpMgReleVo">
    /* selectClrTempExpLastReleYn */
    SELECT L.MG_TP_CD
      , L.MG_AC_NO
      , NVL(
             CASE WHEN L.MG_TP_CD = 'A' THEN
                 (SELECT 'Y'
                  FROM   TB_COLI_MG_RELE S
                  WHERE  S.MG_NO = L.MG_AC_NO
                  AND    S.USE_REFF_NO = L.DTL_DCSH_NO
                  AND    S.LAST_RELE_YN = 'Y'
                  AND    S.DEL_YN = 'N'
                 )
             ELSE
                 (SELECT 'Y'
                  FROM   TB_COLI_MG_AC_USE_RELE S
                  WHERE  S.MG_AC_NO = L.MG_AC_NO
                  AND    S.USE_REFF_NO = L.DTL_DCSH_NO
                  AND    S.LAST_RELE_YN = 'Y'
                  AND    S.DEL_YN = 'N'
                 )
             END, 'N') AS LAST_RELE_YN
    FROM   TB_CLRI_DED_MG L
    WHERE  L.DTL_DCSH_NO = #{dtlDcshNo}
    AND    L.DEL_YN = 'N'
    AND    ROWNUM = 1
  </select>
    
  <!--
    Consultation des informations sur l'exigence à la main-levée de caution !== 담보해제 필요 정보 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrTempExpMgRele" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpMgReleVo">
    /* selectClrTempExpMgRele */
    SELECT
         L.MG_AC_NO AS MG_NO                                                                     /** N° de caution !== 담보번호 ==! */
       , DECODE(A.DCLR_PT_CD, 'EX2', A.EXPPN_IDFY_NO, A.IMPPN_IDFY_NO) AS IDFY_NO_1              /** N° d'identification !== 식별번호 ==! */
       , A.TXPR_IDFY_NO AS IDFY_NO_2                                                             /** N° d'identification !== 식별번호 ==! */
       , A.DCER_CD AS IDFY_NO_3                                                                  /** N° d'identification !== 식별번호 ==! */
       , DECODE(P.ASED_FVRFC_MG_DSCN_AMT, NULL, P.ASED_FVRFC_MG_AMT, P.ASED_FVRFC_MG_DSCN_AMT)
       - NVL((SELECT SUM(S.MG_RELE_AMT)
              FROM   TB_COLI_MG_RELE S, TB_COLI_MG M
              WHERE S.RQST_NO  = M.RQST_NO
              AND    M.MG_NO = L.MG_AC_NO
              AND    S.USE_REFF_NO = L.DTL_DCSH_NO
              AND    S.DEL_YN = 'N'), 0) AS MG_RELE_AMT                                          /** Montant rendu après la mainlevée  !== 담보해제금액 ==! */
       , A.DTL_DCSH_NO AS USE_REFF_NO                                                            /** Numéro De Référence Utilisé !== 사용참조번호 ==! */
       , G.FFMN_DTL_DCSH_NO AS REFF_NO                                                           /** N° de référence !== 참조번호 ==! */
       , A.AUDT_EMP_ID                                                                           /** ID de la personne vérifiant !== 심사직원ID ==! */
       , L.MG_TP_CD                                                                              /** Code de type de caution !== 담보구분코드 ==! */
       , A.DCLR_PT_CD                                                                            /** Code de type de déclaration !== 신고유형코드 ==! */
    FROM
           TB_CLRI_DED_COMN A
         , TB_CLRI_DED_MG L
         , (SELECT
                   S.DTL_DCSH_NO
                 , S.FFMN_DTL_DCSH_NO
            FROM
                  (SELECT S1.DTL_DCSH_NO, S1.FFMN_DTL_DCSH_NO
                   FROM   TB_CLRI_PSMGT_PDLS_INVN_H S1
                   WHERE  S1.DTL_DCSH_NO = #{dtlDcshNo}
                   AND    S1.LAST_YN = 'Y'
                   AND    S1.DEL_YN = 'N'
                   ORDER BY S1.LAST_CHG_DTTM DESC) S
            WHERE
                   ROWNUM = 1
           ) G
         , TB_CLRI_DED_VLUT_AUDT_COMN P
    WHERE
           A.DTL_DCSH_NO = L.DTL_DCSH_NO
    AND    A.DTL_DCSH_NO = G.DTL_DCSH_NO
    AND    A.DTL_DCSH_NO = P.DTL_DCSH_NO
    AND    A.DCLR_PT_CD = 'EX2'
    AND    A.DEL_YN  = 'N'
    AND    L.DEL_YN(+) = 'N'
    AND    L.MG_TP_CD(+) = 'C'
    AND    P.DEL_YN  = 'N'
    AND    P.LAST_YN = 'Y'
    AND    A.DTL_DCSH_NO = #{dtlDcshNo}
  </select>
    
  <!--
    Achèvement de l'apurement de l'exportation temporaire !== 임시수출 이행 완료 ==!
    (Song JunYoung)
    -->
  <update id="updateClrTempExpFfmnCmpl" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrTempExpVo">
    /* updateClrTempExpFfmnCmpl */
    UPDATE  TB_CLRI_PSMGT_COMN SET
      <trim prefixOverrides="," >
        , MG_RELE_YN = 'Y'                                   /** Caution levée ON !== 담보해제여부 ==! */
        , LAST_CHPR_ID = #{lastChprId}                       /** ID du modificateur final !== 최종변경자ID ==! */
        , LAST_CHG_DTTM = SYSTIMESTAMP                       /** Date et heure de modification finale !== 최종변경일시 ==! */
      </trim>
    WHERE  DEL_YN = 'N'                                      /** Suppression ON !== 삭제여부 ==! */
    AND    DTL_DCSH_NO = #{dtlDcshNo}                        /** Numéro du DAU !== DED번호 ==! */
  </update>
  <!-- 임시수출 사후관리 -->
  
  <!--
    Consultation de la liste des objets d'apurement de l'exportation temporaire !== 임시수출 이행대상 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrExpFfmnMgmtList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrExpFfmnMgmtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrExpFfmnMgmtVo">
    /* selectClrExpFfmnMgmtList */
    <include refid="pagination.header" ></include>
    SELECT
        A.DTL_DCSH_NO
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT
      , A.DCLR_CSTM_CD
      , A.DCER_CD
      , NVL2(A.DCER_NM, A.DCER_CD || ' ' || A.DCER_NM, A.DCER_CD) AS DCER_NM
      , A.IMPPN_IDFY_NO
      , A.EXPPN_IDFY_NO
      , A.IMPPN_CO_NM
      , NVL2(A.EXPPN_CO_NM, A.EXPPN_IDFY_NO || ' ' || A.EXPPN_CO_NM, A.EXPPN_IDFY_NO) AS EXPPN_CO_NM
      , A.FFMN_PRCS_STTS_CD
      , A.EPC_CD
      , A.DCLR_PT_CD
      , TO_CHAR(TO_DATE(A.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT
      , A.PDLS_NO
      , A.QTY
      , A.QTY_UT_CD
      , A.PDLS_TXBS_NCY_AMT
      , TO_CHAR(TO_DATE(A.PSMGT_FFMN_CMPL_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_CMPL_DT
      , A.TXPR_IDFY_NO
      , A.TXPR_CO_NM
    FROM (
		  SELECT
		      A.DTL_DCSH_NO                                                                             /** Numéro du DAU !== DED번호 ==! */
		    , A.DCLR_DT                                                                                 /** Date de DAU !== DED일자 ==! */
		    , A.DCLR_CSTM_CD                                                                            /** Code de bureau de déclaration !== 신고세관코드 ==! */
		    , A.DCER_CD                                                                                 /** Code du déclarant !== 신고인코드 ==! */
		    , (SELECT
                        S1.CO_NM
               FROM
                        TB_COM_CO S1
                      , TB_COM_CO_DCLR_CD S2
               WHERE
                      S1.NIF = S2.NIF
               AND    S2.CO_DCLR_TP_CD = 'H'
               AND    S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                                             /** Nom de l'entreprise !== 업체명 ==! */
		    , A.IMPPN_IDFY_NO                                                                           /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
		    , A.EXPPN_IDFY_NO                                                                           /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
		    , B.IMPPN_CO_NM                                                                             /** Nom de société de l'importateur !== 수입자업체명 ==! */
		    , B.EXPPN_CO_NM                                                                             /** Nom de société de l'exportateur !== 수출자업체명 ==! */
		    , CASE WHEN C.PSMGT_FFMN_CMPL_DT IS NOT NULL
		           THEN CASE WHEN C.PSMGT_FFMN_CMPL_DT <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
		                     THEN 'AVL'
		                     ELSE 'APL'
		                END
		           ELSE CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
		                     THEN 'NAP'
		                     ELSE 'NAL'
		                END
		      END AS FFMN_PRCS_STTS_CD                                                                  /** Code de l'état de traitement de l'apurement !== 이행처리상태코드 ==! */
		    , A.EPC_CD                                                                                  /** Code EPC !== EPC코드 ==! */
		    , A.DCLR_PT_CD                                                                              /** Code de type de déclaration !== 신고유형코드 ==! */
		    , C.PSMGT_FFMN_XPIR_DT                                                                      /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
		    , E.PDLS_NO                                                                                 /** N° d'article !== 품목번호 ==! */
		    , E.QTY                                                                                     /** Quantité !== 수량 ==! */
		    , E.QTY_UT_CD                                                                               /** Code de l'unité de quantité !== 수량단위코드 ==! */
		    , M.PDLS_TXBS_NCY_AMT                                                                       /** Montant Nyc De La Base Taxable De L'Article !== 품목과세기준NCY금액 ==! */
		    , C.PSMGT_FFMN_CMPL_DT                                                                      /** Date de l'apurement de régime suspensif !== 사후관리이행완료일자 ==! */
		    , A.TXPR_IDFY_NO                                                                            /** NIU !== 납세자식별번호 ==! */
            , B.TXPR_CO_NM                                                                              /** Nom de société contribuable !== 납세자업체명 ==! */
		  FROM
		         TB_CLRI_PSMGT_COMN C
		       , TB_CLRI_DED_COMN A
		       , TB_CLRI_DED_CO B
		       , TB_CLRI_DED_VLUT_COMN D
		       , TB_CLRI_DED_PDLS E
		       , TB_CLRI_DED_VLUT_PDLS M
		  WHERE
		         C.DTL_DCSH_NO = A.DTL_DCSH_NO
		  AND    C.DTL_DCSH_NO = B.DTL_DCSH_NO
		  AND    C.DTL_DCSH_NO = D.DTL_DCSH_NO
		  AND    C.DTL_DCSH_NO = E.DTL_DCSH_NO
		  AND    E.DTL_DCSH_NO = M.DTL_DCSH_NO
          AND    E.PDLS_NO = M.PDLS_NO
		  AND    C.DEL_YN = 'N'
		  AND    A.DEL_YN = 'N'
		  AND    B.DEL_YN = 'N'
		  AND    D.DEL_YN = 'N'
		  AND    E.DEL_YN = 'N'
		  AND    M.DEL_YN = 'N'
		  AND    A.DCLR_PT_CD = 'EX2'
		  AND    A.EPC_CD NOT LIKE 'ETP%'
	      <if test="dclrDtFrom != null and dclrDtFrom != ''">
          AND    TO_DATE(A.DCLR_DT,'YYYYMMDD') <![CDATA[ >= ]]> TO_DATE(#{dclrDtFrom}, 'DD/MM/YYYY')
          AND    TO_DATE(A.DCLR_DT,'YYYYMMDD') <![CDATA[ <= ]]> TO_DATE(#{dclrDtTo}, 'DD/MM/YYYY')
          </if>
          <if test="dclrCstmCd != null and dclrCstmCd != ''">
          AND    A.DCLR_CSTM_CD = #{dclrCstmCd}
          </if>
          <if test="dcerCd != null and dcerCd != ''">
          AND    A.DCER_CD = #{dcerCd}
          </if>
          <if test="exppnIdfyNo != null and exppnIdfyNo != ''">
          AND    A.EXPPN_IDFY_NO = #{exppnIdfyNo}
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'AVL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NOT NULL
          AND    C.PSMGT_FFMN_CMPL_DT <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'APL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NOT NULL
          AND    C.PSMGT_FFMN_CMPL_DT <![CDATA[ > ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'NAP'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NULL
          AND    TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'NAL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NULL
          AND    TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ > ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="dtlDcshNo != null and dtlDcshNo != ''">
		  AND    A.DTL_DCSH_NO = #{dtlDcshNo}
          </if>
          UNION ALL
		  SELECT
		      A.DTL_DCSH_NO                                                                             /** Numéro du DAU !== DED번호 ==! */
		    , A.DCLR_DT                                                                                 /** Date de DAU !== DED일자 ==! */
		    , A.DCLR_CSTM_CD                                                                            /** Code de bureau de déclaration !== 신고세관코드 ==! */
		    , A.DCER_CD                                                                                 /** Code du déclarant !== 신고인코드 ==! */
		    , (SELECT
                      S1.CO_NM
               FROM
                      TB_COM_CO S1
                    , TB_COM_CO_DCLR_CD S2
               WHERE
                      S1.NIF = S2.NIF
               AND    S2.CO_DCLR_TP_CD = 'H'
               AND    S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                                             /** Nom de l'entreprise !== 업체명 ==! */
		    , A.IMPPN_IDFY_NO                                                                           /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
		    , A.EXPPN_IDFY_NO                                                                           /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
		    , B.IMPPN_CO_NM                                                                             /** Nom de société de l'importateur !== 수입자업체명 ==! */
		    , B.EXPPN_CO_NM                                                                             /** Nom de société de l'exportateur !== 수출자업체명 ==! */
		    , CASE WHEN C.PSMGT_FFMN_CMPL_DT IS NOT NULL
		           THEN CASE WHEN C.PSMGT_FFMN_CMPL_DT <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
		                     THEN 'AVL'
		                     ELSE 'APL'
		                END
		           ELSE CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
		                     THEN 'NAP'
		                     ELSE 'NAL'
		                END
		      END AS FFMN_PRCS_STTS_CD                                                                  /** Code de l'état de traitement de l'apurement !== 이행처리상태코드 ==! */
		    , A.EPC_CD                                                                                  /** Code EPC !== EPC코드 ==! */
		    , A.DCLR_PT_CD                                                                              /** Code de type de déclaration !== 신고유형코드 ==! */
		    , C.PSMGT_FFMN_XPIR_DT                                                                      /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
		    , R.PRNG_PDLS_NO                                                                            /** N° d'article !== 품목번호 ==! */
		    , R.QTY                                                                                     /** Quantité !== 수량 ==! */
		    , R.QTY_UT_CD                                                                               /** Code de l'unité de quantité !== 수량단위코드 ==! */
		    , NULL AS PDLS_TXBS_NCY_AMT                                                                 /** Montant Nyc De La Base Taxable De L'Article !== 품목과세기준NCY금액 ==! */
		    , C.PSMGT_FFMN_CMPL_DT                                                                      /** Date de l'apurement de régime suspensif !== 사후관리이행완료일자 ==! */
		    , A.TXPR_IDFY_NO                                                                            /** NIU !== 납세자식별번호 ==! */
            , B.TXPR_CO_NM                                                                              /** Nom de société contribuable !== 납세자업체명 ==! */
		  FROM
		       TB_CLRI_PSMGT_COMN C
		     , TB_CLRI_DED_COMN A
		     , TB_CLRI_DED_CO B
		     , TB_CLRI_DED_VLUT_COMN D
		     , TB_CLRI_DED_RIMEX_PRNG_PDLS R
		  WHERE
		         C.DTL_DCSH_NO = A.DTL_DCSH_NO
		  AND    C.DTL_DCSH_NO = B.DTL_DCSH_NO
		  AND    C.DTL_DCSH_NO = D.DTL_DCSH_NO
		  AND    C.DTL_DCSH_NO = R.DTL_DCSH_NO
		  AND    C.DEL_YN = 'N'
		  AND    A.DEL_YN = 'N'
		  AND    B.DEL_YN = 'N'
		  AND    D.DEL_YN = 'N'
		  AND    R.DEL_YN = 'N'
		  AND    A.DCLR_PT_CD = 'EX2'
		  AND    A.EPC_CD LIKE 'ETP%'
	      <if test="dclrDtFrom != null and dclrDtFrom != ''">
          AND    TO_DATE(A.DCLR_DT,'YYYYMMDD') <![CDATA[ >= ]]> TO_DATE(#{dclrDtFrom}, 'DD/MM/YYYY')
          AND    TO_DATE(A.DCLR_DT,'YYYYMMDD') <![CDATA[ <= ]]> TO_DATE(#{dclrDtTo}, 'DD/MM/YYYY')
          </if>
          <if test="dclrCstmCd != null and dclrCstmCd != ''">
          AND    A.DCLR_CSTM_CD = #{dclrCstmCd}
          </if>
          <if test="dcerCd != null and dcerCd != ''">
          AND    A.DCER_CD = #{dcerCd}
          </if>
          <if test="exppnIdfyNo != null and exppnIdfyNo != ''">
          AND    A.EXPPN_IDFY_NO = #{exppnIdfyNo}
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'AVL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NOT NULL
          AND    C.PSMGT_FFMN_CMPL_DT <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'APL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NOT NULL
          AND    C.PSMGT_FFMN_CMPL_DT <![CDATA[ > ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'NAP'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NULL
          AND    TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'NAL'">
          AND    C.PSMGT_FFMN_CMPL_DT IS NULL
          AND    TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ > ]]> C.PSMGT_FFMN_XPIR_DT
          </if>
          <if test="dtlDcshNo != null and dtlDcshNo != ''">
		  AND    A.DTL_DCSH_NO = #{dtlDcshNo}
          </if>
          ) A
    ORDER BY A.DCLR_DT DESC, A.DTL_DCSH_NO DESC, A.PDLS_NO
    <include refid="pagination.footer" ></include>
  </select>

  <!-- 재수입 기간연장 Start -->
  <!--
    Consultation de la liste des prologation du délai de réimportation !== 재수입 기간연장 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrImpxtnsList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsVo">
    /* selectClrImpxtnsList */
    <include refid="pagination.header" ></include>
    SELECT
        ROWNUM AS RNUM
      , A.DTL_DCSH_NO
      , A.PSMGT_PRID_XTNS_RQST_NO
      , A.EXPPN_IDFY_NO
      , A.EXPPN_CO_NM
      , TO_CHAR(TO_DATE(A.PRID_XTNS_RGSR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PRID_XTNS_RGSR_DT
      , TO_CHAR(A.APRV_RQST_DTTM, 'DD/MM/YYYY') AS APRV_RSOF_DT
      , TO_CHAR(A.APRV_PRCS_CMPL_DTTM, 'DD/MM/YYYY') AS APRE_DT
      , A.PRID_XTNS_EMP_ID
      , A.PRCS_STTS_CD
      , A.APRV_PRCS_STTS_CD
      , A.PDLS_NO
      , A.PDLS_NM
      , A.HS_CD
      , A.APC_CD
      , TO_CHAR(TO_DATE(A.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT
      , TO_CHAR(TO_DATE(A.EXTD_PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS EXTD_PSMGT_FFMN_XPIR_DT
    FROM (
          SELECT
                 A.DTL_DCSH_NO                                                                                 /** Numéro du DAU !== DED번호 ==! */
               , I.PSMGT_PRID_XTNS_RQST_NO                                                                     /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
               , A.EXPPN_IDFY_NO                                                                               /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
               , B.EXPPN_CO_NM                                                                                 /** Nom de société de l'exportateur !== 수출자업체명 ==! */
               , I.PRID_XTNS_RGSR_DT                                                                           /** Date de prorogation d'échéance !== 신청일자 ==! */
               , F.APRV_RQST_DTTM                                                                              /** Date de demande d'appobation !== 결재신청일시 ==! */
               , DECODE(I.PRCS_STTS_CD, 'D08', (SELECT MAX(S.APRV_PRCS_DTTM)
                                                FROM   TB_POTI_APRV_D S
                                                WHERE  S.APRV_ID = F.APRV_ID
                                                AND    S.DEL_YN = 'N'), NULL) AS APRV_PRCS_CMPL_DTTM           /** Date et heure du traitement de l'approbation !== 결재처리일시 ==! */
               , I.PRID_XTNS_EMP_ID                                                                            /** ID de l'inspecteur !== 세관직원ID ==! */
               , I.PRCS_STTS_CD                                                                                /** Code de statut de traitement !== 처리상태코드 ==! */
               , F.APRV_PRCS_STTS_CD                                                                           /** Code de statut du traitement d'approbation !== 결재처리상태코드 ==! */
               , G.PDLS_NO                      															   /** N° D'Article !== 품목번호 ==! */
               , H.PDLS_NM 					   																   /** Nom de l'article !== 품목명 ==! */
               , H.HS_CD 					   																   /** Code SH !== HS코드 ==! */
               , H.APC_CD 					   																   /** Code APC !== APC코드 ==! */
               , G.PSMGT_FFMN_XPIR_DT                                                                          /** Date d'echeance de l'apurement de regime suspensif !== 사후관리이행만료일자 ==! */
               , G.EXTD_PSMGT_FFMN_XPIR_DT                                                                     /** Date d'echeance prorogee de l'apurement de regime suspensif !== 연장된사후관리이행만료일자 ==! */
          FROM
                 TB_CLRI_PSMGT_PRID_XTNS I
               , TB_CLRI_DED_COMN A
               , TB_CLRI_DED_CO B
               , TB_POTI_APRV F
               , ALPASSINT.TB_CLRI_PSMGT_PRID_XTNS_PDLS G
               , TB_CLRI_DED_PDLS H
          WHERE
                 I.DTL_DCSH_NO = A.DTL_DCSH_NO
          AND    I.DTL_DCSH_NO = B.DTL_DCSH_NO
          AND    I.APRV_ID = F.APRV_ID(+)
          AND    I.PSMGT_PRID_XTNS_RQST_NO = G.PSMGT_PRID_XTNS_RQST_NO
          AND    I.DTL_DCSH_NO = H.DTL_DCSH_NO
          AND    G.PDLS_NO = H.PDLS_NO
          AND    I.DEL_YN = 'N'
          AND    A.DEL_YN = 'N'
          AND    B.DEL_YN = 'N'
          AND    F.DEL_YN(+) = 'N'
          AND    A.DCLR_PT_CD = 'EX2'
          AND    I.PRCS_STTS_CD IN ('D01', 'D08', 'D09', 'I01')
          <if test="pridXtnsRgsrDtFrom != null and pridXtnsRgsrDtFrom != ''">
          AND    I.PRID_XTNS_RGSR_DT <![CDATA[ >= ]]> TO_CHAR(TO_DATE(#{pridXtnsRgsrDtFrom}, 'DD/MM/YYYY'), 'YYYYMMDD')
          AND    I.PRID_XTNS_RGSR_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE(#{pridXtnsRgsrDtTo}, 'DD/MM/YYYY'), 'YYYYMMDD')
          </if>
          <if test="dclrCstmCd != null and dclrCstmCd != ''">
          AND    A.DCLR_CSTM_CD = #{dclrCstmCd}
          </if>
          <if test="exppnIdfyNo != null and exppnIdfyNo != ''">
          AND    A.EXPPN_IDFY_NO = #{exppnIdfyNo}
          </if>
          <if test="prcsSttsCd != null and prcsSttsCd != ''">
          AND    I.PRCS_STTS_CD = #{prcsSttsCd}
          </if>
          <if test="dtlDcshNo != null and dtlDcshNo != ''">
		  AND    A.DTL_DCSH_NO = #{dtlDcshNo}
          </if>
          ORDER BY I.FRST_RGSR_DTTM DESC
          ) A
    ORDER BY RNUM
    <include refid="pagination.footer" ></include>
  </select>
    
  <!--
    Consultation des détails de la prorogation du délai de la réimportation !== 재수입 기간연장 상세 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrImpxtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsDtlVo">
    /* selectClrImpxtns */
    SELECT
        A.DTL_DCSH_NO                                                                                         /** Numéro du DAU !== DED번호 ==! */
      , I.PSMGT_PRID_XTNS_RQST_NO                                                                             /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT                                      /** Date de DAU !== DED일자 ==! */
      , A.DCER_CD                                                                                             /** Code du déclarant !== 신고인코드 ==! */
      , (SELECT
                NVL2(MAX(S1.CO_NM), A.DCER_CD || ' | ' || MAX(S1.CO_NM), A.DCER_CD)
         FROM
                TB_COM_CO S1
              , TB_COM_CO_DCLR_CD S2
         WHERE
                S1.NIF = S2.NIF
         AND    S2.CO_DCLR_TP_CD = 'H'
         AND    S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                                                         /** Nom de l'entreprise !== 업체명 ==! */
      , A.EXPPN_IDFY_NO                                                                                       /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
      , A.EXPPN_IDFY_NO || ' | ' || B.EXPPN_CO_NM AS EXPPN_CO_NM                                              /** Nom de société de l'exportateur !== 수출자업체명 ==! */
      , A.CSCL_PLN_CD                                                                                         /** Code de plan de dédouanement !== 통관계획코드 ==! */
      , A.DCLR_PT_CD                                                                                          /** Code de type de déclaration !== 신고유형코드 ==! */
      , A.EXP_CNTY_CD                                                                                         /** Code de pays exportateur !== 수출국가코드 ==! */
      , D.TTXBS_NCY_AMT                                                                                       /** Montant NCY total de la valeur statistique !== 총과세기준NCY금액 ==! */
      , TO_CHAR(TO_DATE(I.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT                /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , TO_CHAR(TO_DATE(I.PRID_XTNS_RGSR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PRID_XTNS_RGSR_DT                  /** Date de prorogation d'échéance !== 신청일자 ==! */
      , TO_CHAR(TO_DATE(I.EXTD_PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS EXTD_PSMGT_FFMN_XPIR_DT      /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , I.PRID_XTNS_RSN_CN                                                                                    /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , I.ATCH_FILE_ID                                                                                        /** ID de la pièce jointe !== 첨부파일ID ==! */
      , I.APRV_ID                                                                                             /** ID d'approbation !== 결재ID ==! */
      , I.AUDT_OPIN_CN                                                                                        /** Contenu de l'opinion à la suite de la vérification !== 심사의견내용 ==! */
      , I.REPN_ID                                                                                             /** ID de la personne demandant !== 신청자ID ==! */
      , I.PRCS_STTS_CD                                                                                        /** Code de statut de traitement !== 처리상태코드 ==! */
      , A.DCLR_CSTM_CD                                                                                        /** Code de bureau de déclaration !== 신고세관코드 ==! */
      , F.APRV_PRCS_STTS_CD                                                                                   /** Code de statut du traitement d'approbation !== 결재처리상태코드 ==! */
      , A.REFF_NO                                                                                             /** N° de reference !== 참조번호 ==! */
      , A.NEW_SYS_YN                                                                                          /** Nouveau système ON !== 신규시스템여부 ==! */
      , G.PDLS_NO                      																		  /** N° D'Article !== 품목번호 ==! */
      , H.PDLS_NM 					   																		  /** Nom de l'article !== 품목명 ==! */
      , H.HS_CD 					   																		  /** Code SH !== HS코드 ==! */
      , H.APC_CD 					   																		  /** Code APC !== APC코드 ==! */
      , TO_CHAR(TO_DATE(G.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT                /** Date d'echeance de l'apurement de regime suspensif !== 사후관리이행만료일자 ==! */
      , TO_CHAR(TO_DATE(G.EXTD_PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS EXTD_PSMGT_FFMN_XPIR_DT      /** Date d'echeance prorogee de l'apurement de regime suspensif !== 연장된사후관리이행만료일자 ==! */
    FROM
            TB_CLRI_PSMGT_PRID_XTNS I
          , TB_CLRI_DED_COMN A
          , TB_CLRI_DED_CO B
          , TB_CLRI_PSMGT_COMN C
          , TB_CLRI_DED_VLUT_COMN D
          , TB_POTI_APRV F
          , ALPASSINT.TB_CLRI_PSMGT_PRID_XTNS_PDLS G
          , TB_CLRI_DED_PDLS H
    WHERE
            I.DTL_DCSH_NO = A.DTL_DCSH_NO
    AND     I.DTL_DCSH_NO = B.DTL_DCSH_NO
    AND     I.DTL_DCSH_NO = C.DTL_DCSH_NO
    AND     I.DTL_DCSH_NO = D.DTL_DCSH_NO
    AND     I.PSMGT_PRID_XTNS_RQST_NO = G.PSMGT_PRID_XTNS_RQST_NO
    AND     I.DTL_DCSH_NO = H.DTL_DCSH_NO
    AND     G.PDLS_NO = H.PDLS_NO
    AND     I.APRV_ID = F.APRV_ID(+)
    AND     I.PRCS_STTS_CD IN ('D01', 'D08', 'D09', 'I01')
    AND     A.DCLR_PT_CD = 'EX2'
    AND     I.DEL_YN = 'N'
    AND     A.DEL_YN = 'N'
    AND     B.DEL_YN = 'N'
    AND     C.DEL_YN = 'N'
    AND     D.DEL_YN = 'N'
    AND     F.DEL_YN(+) = 'N'
    AND     I.PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}
    </select>
    
  <!--
    Vérification de la possibilité d'enregistrement d'une prolongation du délai de réimportation et vérification de traitement  !== 재수입 기간연장 등록 가능 및 처리 여부 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrImpxtnsChkExist" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsSrchVo">
    /* selectClrImpxtnsChkExist */
    SELECT
        A.DTL_DCSH_NO                 /** Numéro du DAU !== DED번호 ==! */
      , C.PSMGT_FFMN_CMPL_DT          /** Date de l'apurement de régime suspensif !== 사후관리이행완료일자 ==! */
      , C.PSMGT_FFMN_CMPL_YN          /** Régime suspensif apuré ON !== 사후관리이행완료여부 ==! */
      , A.DCLR_PT_CD                  /** Code de type de déclaration !== 신고유형코드 ==! */
      , (CASE WHEN I.PRCS_STTS_CD IN ('D08', 'D09') THEN NULL ELSE I.PSMGT_PRID_XTNS_RQST_NO END) AS PSMGT_PRID_XTNS_RQST_NO     /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      , C.DEL_YN                      /** Suppression ON !== 삭제여부 ==! */
      , IP.PRCS_STTS_CD               /** Code de statut de traitement !== 처리상태코드 ==! */
    FROM (SELECT
                 A.DTL_DCSH_NO
               , A.DCLR_PT_CD
               , MAX(I.PSMGT_PRID_XTNS_RQST_NO) AS PSMGT_PRID_XTNS_RQST_NO
          FROM
                 TB_CLRI_DED_COMN A
               , TB_CLRI_PSMGT_PRID_XTNS I
          WHERE
                 A.DTL_DCSH_NO = I.DTL_DCSH_NO(+)
          AND    A.DTL_DCSH_NO = #{dtlDcshNo}
          AND    I.PRCS_STTS_CD(+) IN ('D01', 'D08', 'D09', 'I01')
          AND    A.DEL_YN = 'N'
          AND    I.DEL_YN(+) = 'N'
          <if test="repnId != null and repnId != ''">
          AND    I.REPN_ID(+) = #{repnId}
          </if>
          GROUP BY A.DTL_DCSH_NO, A.DCLR_PT_CD) A
        , TB_CLRI_PSMGT_PRID_XTNS I
        , TB_CLRI_PSMGT_COMN C
        , (SELECT
                  I.DTL_DCSH_NO
                , I.PSMGT_PRID_XTNS_RQST_NO
                , I.PRCS_STTS_CD
           FROM
                (SELECT
                        DTL_DCSH_NO
                      , PSMGT_PRID_XTNS_RQST_NO
                      , PRCS_STTS_CD
                 FROM
                        TB_CLRI_PSMGT_PRID_XTNS
                 WHERE
                        DEL_YN = 'N'
                 AND    DTL_DCSH_NO =  #{dtlDcshNo}
                 AND    PRCS_STTS_CD != 'A01'
                 ORDER BY FRST_RGSR_DTTM DESC) I
           WHERE ROWNUM = 1 ) IP
    WHERE  A.DTL_DCSH_NO = I.DTL_DCSH_NO(+)
    AND    A.DTL_DCSH_NO = C.DTL_DCSH_NO(+)
    AND    A.PSMGT_PRID_XTNS_RQST_NO = I.PSMGT_PRID_XTNS_RQST_NO(+)
    AND    A.DTL_DCSH_NO = IP.DTL_DCSH_NO(+)
    AND    I.DEL_YN(+) = 'N'
    AND    C.DEL_YN(+) = 'N'
  </select>
    
  <!--
    Consultation des informations de la DED lors du non-enregistrement de la prolongation du délai de réimportation !== 재수입 기간연장 미등록 시 DED정보 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrImpxtnsNotExist" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsDtlVo">
    /* selectClrImpxtnsNotExist */
    SELECT
        A.DTL_DCSH_NO                                                                                 /** Numéro du DAU !== DED번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT                              /** Date de DAU !== DED일자 ==! */
      , A.DCER_CD                                                                                     /** Code du déclarant !== 신고인코드 ==! */
      , (SELECT
                NVL2(MAX(S1.CO_NM), A.DCER_CD || ' | ' || MAX(S1.CO_NM), A.DCER_CD)
         FROM
                TB_COM_CO S1
              , TB_COM_CO_DCLR_CD S2
         WHERE
                S1.NIF = S2.NIF
         AND    S2.CO_DCLR_TP_CD = 'H'
         AND    S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                                                 /** Nom de l'entreprise !== 업체명 ==! */
      , A.EXPPN_IDFY_NO                                                                               /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
      , B.EXPPN_CO_NM                                                                                 /** Nom de société de l'exportateur !== 수출자업체명 ==! */
      , A.CSCL_PLN_CD                                                                                 /** Code de plan de dédouanement !== 통관계획코드 ==! */
      , A.DCLR_PT_CD                                                                                  /** Code de type de déclaration !== 신고유형코드 ==! */
      , (SELECT
                E1.PDLS_NM
         FROM
                TB_CLRI_DED_PDLS E1
         WHERE
                E1.DTL_DCSH_NO = A.DTL_DCSH_NO
         AND    E1.PDLS_NO = (SELECT
                                     MIN(E11.PDLS_NO)
                              FROM
                                     TB_CLRI_DED_PDLS E11
                              WHERE
                                     E11.DTL_DCSH_NO = E1.DTL_DCSH_NO
                              AND E11.DEL_YN = 'N')
         AND    E1.DEL_YN = 'N'
         ) AS PDLS_NM                                                                                 /** Nom de l'article !== 품목명 ==! */
      , A.EXP_CNTY_CD                                                                                 /** Code de pays exportateur !== 수출국가코드 ==! */
      , D.TTXBS_NCY_AMT                                                                               /** Montant NCY total de la valeur statistique !== 총과세기준NCY금액 ==! */
      , TO_CHAR(TO_DATE(C.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT        /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , A.DCLR_CSTM_CD                                                                                /** Code de bureau de déclaration !== 신고세관코드 ==! */
      , A.NEW_SYS_YN                                                                                  /** Nouveau système ON !== 신규시스템여부 ==! */
    FROM
            TB_CLRI_DED_COMN A
          , TB_CLRI_DED_CO B
          , TB_CLRI_PSMGT_COMN C
          , TB_CLRI_DED_VLUT_COMN D
    WHERE
            A.DTL_DCSH_NO = B.DTL_DCSH_NO
    AND     A.DTL_DCSH_NO = C.DTL_DCSH_NO
    AND     A.DTL_DCSH_NO = D.DTL_DCSH_NO
    AND     A.DTL_DCSH_NO = #{dtlDcshNo}
    AND     A.DEL_YN = 'N'
    AND     B.DEL_YN = 'N'
    AND     C.DEL_YN = 'N'
    AND     D.DEL_YN = 'N'
    AND     A.DCLR_PT_CD = 'EX2'
  </select>
    
  <!--
    Enregistrement de la prorogation du délai de la réimportation !== 재수입 기간연장 등록 ==!
    (Song JunYoung)
    -->
  <insert id="insertClrImpxtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsDtlVo">
    /* insertClrImpxtns */
    WITH UPSERT AS (
      UPDATE TB_CLRI_PSMGT_PRID_XTNS SET
          DTL_DCSH_NO = #{dtlDcshNo}                  /** Numéro du DAU !== DED번호 ==! */
        , REPN_ID = #{repnId}                         /** ID de la personne demandant !== 신청자ID ==! */
        , PSMGT_FFMN_XPIR_DT = TO_CHAR(TO_DATE(#{psmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')     /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
        , EXTD_PSMGT_FFMN_XPIR_DT = TO_CHAR(TO_DATE(#{extdPsmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')  /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
        , PRID_XTNS_RSN_CN = #{pridXtnsRsnCn}         /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
        , ATCH_FILE_ID = #{atchFileId}                /** ID de la pièce jointe !== 첨부파일ID ==! */
        , PRCS_STTS_CD = #{prcsSttsCd}                /** Code de statut de traitement !== 처리상태코드 ==! */
        , PRID_XTNS_EMP_ID = #{pridXtnsEmpId}         /** ID de l'inspecteur !== 세관직원ID ==! */
        , DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
        , FRST_REGST_ID = #{frstRegstId}              /** ID du premier enregistrant  !== 최초등록자ID ==! */
        , FRST_RGSR_DTTM = SYSTIMESTAMP               /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
        , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
        , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
      WHERE PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}  /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      RETURNING *
    )
    INSERT INTO TB_CLRI_PSMGT_PRID_XTNS
      (
        PSMGT_PRID_XTNS_RQST_NO      /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      , DTL_DCSH_NO                  /** Numéro du DAU !== DED번호 ==! */
      , REPN_ID                      /** ID de la personne demandant !== 신청자ID ==! */
      , PRID_XTNS_RGSR_DT            /** Date de prorogation d'échéance !== 신청일자 ==! */
      , PSMGT_FFMN_XPIR_DT           /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , EXTD_PSMGT_FFMN_XPIR_DT      /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , PRID_XTNS_RSN_CN             /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , ATCH_FILE_ID                 /** ID de la pièce jointe !== 첨부파일ID ==! */
      , PRCS_STTS_CD                 /** Code de statut de traitement !== 처리상태코드 ==! */
      , PRID_XTNS_EMP_ID             /** ID de l'inspecteur !== 세관직원ID ==! */
      , DEL_YN                       /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID                /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM               /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID                 /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM                /** Date et heure de modification finale !== 최종변경일시 ==! */
      )
    SELECT
        #{psmgtPridXtnsRqstNo}       /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      , #{dtlDcshNo}                 /** Numéro du DAU !== DED번호 ==! */
      , #{repnId}                    /** ID de la personne demandant !== 신청자ID ==! */
      , TO_CHAR(SYSDATE, 'YYYYMMDD') /** Date de prorogation d'échéance !== 신청일자 ==! */
      , TO_CHAR(TO_DATE(#{psmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')           /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , TO_CHAR(TO_DATE(#{extdPsmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')       /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , #{pridXtnsRsnCn}             /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , #{atchFileId}                /** ID de la pièce jointe !== 첨부파일ID ==! */
      , #{prcsSttsCd}                /** Code de statut de traitement !== 처리상태코드 ==! */
      , #{pridXtnsEmpId}             /** ID de l'inspecteur !== 세관직원ID ==! */
      , 'N'                          /** Suppression ON !== 삭제여부 ==! */
      , #{frstRegstId}               /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE NOT EXISTS(SELECT * FROM UPSERT)
  </insert>

  <!--
    Modification de la prorogation du délai de la réimportation !== 재수입 기간연장 수정 ==!
    (Song JunYoung)
    -->
  <update id="updateClrImpxtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsDtlVo">
    /* updateClrImpxtns */
    UPDATE  TB_CLRI_PSMGT_PRID_XTNS SET
    <trim prefixOverrides="," >
        LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
      <if test="prcsSttsCd != null and prcsSttsCd != ''">
      , PRCS_STTS_CD = #{prcsSttsCd}                /** Code de statut de traitement !== 처리상태코드 ==! */
      </if>
      <if test="pridXtnsEmpId != null and pridXtnsEmpId != ''">
      , PRID_XTNS_EMP_ID = #{pridXtnsEmpId}         /** ID de l'inspecteur !== 세관직원ID ==! */
      </if>
      <if test="aprvId != null and aprvId != ''">
      , APRV_ID = #{aprvId}                         /** ID d'approbation  !== 결재ID ==! */
      </if>
      <if test="aprvPrcsYn == null or aprvPrcsYn == ''">
      , EXTD_PSMGT_FFMN_XPIR_DT = TO_CHAR(TO_DATE(#{extdPsmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')  /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , PRID_XTNS_RSN_CN = #{pridXtnsRsnCn}         /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , ATCH_FILE_ID = #{atchFileId}                /** ID de la pièce jointe !== 첨부파일ID ==! */
      , AUDT_OPIN_CN = #{audtOpinCn}                /** Contenu de l'opinion à la suite de la vérification !== 심사의견내용 ==! */
      </if>
    </trim>
    WHERE  DEL_YN = 'N'                             /** Suppression ON !== 삭제여부 ==! */
    <if test="psmgtPridXtnsRqstNo != null and psmgtPridXtnsRqstNo != ''">
    AND  PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}       /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
    </if>
    <if test='aprvId != null and aprvId != "" and aprvPrcsYn == "Y"'>
    AND  APRV_ID = #{aprvId}                                    /** ID d'approbation  !== 결재ID ==! */
    </if>
  </update>
    
  <!--
    Suppression de la prorogation du délia de la réimportation !== 재수입 기간연장 삭제 ==!
    (Song JunYoung)
    -->
  <update id="deleteClrImpxtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsDtlVo">
    /* deleteClrImpxtns */
    UPDATE  TB_CLRI_PSMGT_PRID_XTNS SET
         DEL_YN = 'Y'                                           /** Suppression ON !== 삭제여부 ==! */
      ,  LAST_CHPR_ID = #{lastChprId}                           /** ID du modificateur final !== 최종변경자ID ==! */
      ,  LAST_CHG_DTTM = SYSTIMESTAMP                           /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE  DEL_YN = 'N'                                         /** Suppression ON !== 삭제여부 ==! */
    AND  PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}       /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
  </update>
    
  <!--
    Vérification de l'apurement O/N de la réexportation !== 재수입 이행 여부 체크 ==!
    (Song JunYoung)
    -->
  <select id="selectClrPsmgtFfmn" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsDtlVo" resultType="string">
    /* selectClrPsmgtFfmn */
    SELECT
           C.PSMGT_FFMN_CMPL_DT
    FROM
           TB_CLRI_PSMGT_COMN C
         , TB_CLRI_PSMGT_PRID_XTNS I
    WHERE
           C.DTL_DCSH_NO = I.DTL_DCSH_NO
    AND    C.DEL_YN = 'N'
    AND    I.DEL_YN = 'N'
    <choose>
      <when test="psmgtPridXtnsRqstNo != null and psmgtPridXtnsRqstNo != ''">
      AND    I.PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}
      </when>
      <otherwise>
      AND    C.DTL_DCSH_NO = #{dtlDcshNo}
      AND    ROWNUM = 1
      </otherwise>
    </choose>
  </select>
    
  <!--
    Consultation des informations de prolongation du délai de réimportation par une recherche de l'identifiant approbateur !== 결재ID로 검색하여 재수입 기간연장 정보 조회  ==!
    (Song JunYoung)
    -->
  <select id="selectClrImpxtnsSearchAprvId" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsDtlVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsDtlVo">
    /* selectClrImpxtnsSearchAprvId */
    SELECT
        I.DTL_DCSH_NO
      , A.REFF_NO
      , I.PSMGT_PRID_XTNS_RQST_NO
    FROM
          TB_CLRI_DED_COMN A
        , TB_CLRI_PSMGT_PRID_XTNS I
    WHERE
           A.DTL_DCSH_NO = I.DTL_DCSH_NO
    AND    A.DEL_YN = 'N'
    AND    I.DEL_YN = 'N'
    AND    I.APRV_ID = #{aprvId}
  </select>
    
  <!--
    Prolongation du délai de réimportation !== 재수입 기간연장 ==!
    (Song JunYoung)
    -->
  <update id="updateClrImpPsmgtComn" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsDtlVo">
    /* updateClrImpPsmgtComn */
    UPDATE  TB_CLRI_PSMGT_COMN SET
    <trim prefixOverrides="," >
        PSMGT_FFMN_XPIR_DT = (SELECT S.EXTD_PSMGT_FFMN_XPIR_DT FROM TB_CLRI_PSMGT_PRID_XTNS S WHERE S.PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo} )     /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
    </trim>
    WHERE  DEL_YN = 'N'                             /** Suppression ON !== 삭제여부 ==! */
    AND  DTL_DCSH_NO = #{dtlDcshNo}                 /** Numéro du DAU !== DED번호 ==! */
  </update>
  
  <!--
    Consultation des informations nécessaires pour vérifier la durée de validité de la caution !== 담보 유효기간 체크 관련 필요 정보 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrImpxtnsMg" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsDtlVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrReimpPridXtnsMgInfoVo">
    /* selectClrImpxtnsMg */
    SELECT
        L.MG_AC_NO AS MG_NO                                                                     /** N° de caution !== 담보번호 ==! */
      , DECODE(A.DCLR_PT_CD, 'EX2', A.EXPPN_IDFY_NO, A.IMPPN_IDFY_NO) AS IDFY_NO_1              /** N° d'identification !== 식별번호 ==! */
      , A.TXPR_IDFY_NO AS IDFY_NO_2                                                             /** N° d'identification !== 식별번호 ==! */
      , ( SELECT NIF
          FROM   TB_COM_CO_DCLR_CD
          WHERE  CO_DCLR_CD = A.DCER_CD
          AND    ROWNUM = 1 ) AS IDFY_NO_3                                                      /** N° d'identification !== 식별번호 ==! */
      , 1 AS USE_PRNG_AMT                                                                       /** Montant à utiliser !== 사용예정금액 ==! */
      , A.DTL_DCSH_NO AS REFF_NO                                                                /** N° de référence !== 참조번호 ==! */
      , A.AUDT_EMP_ID                                                                           /** ID de la personne vérifiant !== 심사직원ID ==! */
      , L.MG_TP_CD                                                                              /** Code de type de caution !== 담보구분코드 ==! */
      , A.ACPT_DT AS USE_DTTM_FROM                                                              /**Option de la date de début de critère !== 기준시작일자 옵션 ==! */
    FROM
           TB_CLRI_DED_COMN A
         , TB_CLRI_DED_MG L
    WHERE
           A.DTL_DCSH_NO = L.DTL_DCSH_NO
    AND    A.DCLR_PT_CD = 'EX2'
    AND    A.DEL_YN = 'N'
    AND    L.DEL_YN = 'N'
    AND    A.DTL_DCSH_NO = #{dtlDcshNo}
  </select>
  <!-- 재수입 기간연장 End -->
  
  <!-- 통관미이행반입물품 사후관리 Start -->
  <!--
    Consultation de la liste des marchandises entrées sous régime suspensif !== 통관미이행반입물품 관리 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtVo">
    /* selectClrCsclInctFfmnBrngCmdtList */
    <include refid="pagination.header" ></include>
	SELECT
	    A.DTL_DCSH_NO                                                       /** Numéro du DAU !== DED번호 ==! */
	  , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT    /** Date de DAU !== DED일자 ==! */
	  , A.DCLR_PT_CD                                                        /** Code de type de déclaration !== 신고유형코드 ==! */
	  , B.EXPPN_CO_NM                                                       /** Nom de société de l'exportateur !== 수출자업체명 ==! */
	  , B.IMPPN_CO_NM                                                       /** Nom de société de l'importateur !== 수입자업체명 ==! */
	  , A.IMPPN_IDFY_NO                                                     /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
	  , A.EXPPN_IDFY_NO                                                     /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
	  , A.EXP_CNTY_CD                                                       /** Code de pays exportateur !== 수출국가코드 ==! */
	  , A.PDLS_GCNT                                                         /** Nombre d'articles !== 품목개수 ==! */
	  , A.EPC_CD                                                            /** Code EPC !== EPC코드 ==! */
	  , TO_CHAR(TO_DATE(C.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT  /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
	  , D.TTXBS_NCY_AMT                                                     /** Montant NCY total de la valeur statistique  !== 총과세기준NCY금액 ==! */
	  , A.AUDT_EMP_ID                                                       /** ID de la personne vérifiant !== 심사직원ID ==! */
	  , (SELECT S.EMP_NM FROM TB_POTI_EMP S WHERE S.PBSR_NO = A.AUDT_EMP_ID) AS EMP_NM   /** Nom de l'employé !== 직원명 ==! */
	  , A.BNBN_CMDT_WRHS_CD                                                 /** Code d'entrepôt de la marchandise sous douane !== 보세물품창고코드 ==! */
	FROM
		   TB_CLRI_PSMGT_COMN C
		 , TB_CLRI_DED_COMN A
		 , TB_CLRI_DED_CO B
		 , TB_CLRI_DED_VLUT_COMN D
	WHERE
	       C.DTL_DCSH_NO = A.DTL_DCSH_NO
	AND    C.DTL_DCSH_NO = B.DTL_DCSH_NO
	AND    C.DTL_DCSH_NO = D.DTL_DCSH_NO
	AND    C.DEL_YN = 'N'
	AND    A.DEL_YN = 'N'
	AND    B.DEL_YN = 'N'
	AND    D.DEL_YN = 'N'
	AND    A.DCLR_PT_CD IN ('IM7', 'IM8', 'EX9', 'IM9')
	<if test="dclrDtFrom != null and dclrDtFrom != ''">
	AND    A.DCLR_DT <![CDATA[ >= ]]> TO_CHAR(TO_DATE( #{dclrDtFrom}, 'DD/MM/YYYY'), 'YYYYMMDD')
    AND    A.DCLR_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE( #{dclrDtTo}, 'DD/MM/YYYY'), 'YYYYMMDD')
    </if>
    <if test="dclrCstmCd != null and dclrCstmCd != ''">
	AND    A.DCLR_CSTM_CD = #{dclrCstmCd}
    </if>
    <if test="epcCd != null and epcCd != ''">
	AND    A.EPC_CD = #{epcCd}
    </if>
    <if test="imppnIdfyNo != null and imppnIdfyNo != ''">
	AND    A.IMPPN_IDFY_NO = #{imppnIdfyNo}
    </if>
    <if test="dtlDcshNo != null and dtlDcshNo != ''">
	AND    A.DTL_DCSH_NO = #{dtlDcshNo}
    </if>
    ORDER BY A.DCLR_DT DESC, A.FRST_RGSR_DTTM DESC
    <include refid="pagination.footer" ></include>
  </select>
    
  <!--
    Consultation en détail des marchandises entrées sous régime suspensif !== 통관미이행반입물품 관리 상세 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdt" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtVo">
    /* selectClrCsclInctFfmnBrngCmdt */
    SELECT
        A.DTL_DCSH_NO                                                                           /** Numéro du DAU !== DED번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT                        /** Date de DAU !== DED일자 ==! */
      , A.DCER_CD                                                                               /** Code du déclarant !== 신고인코드 ==! */
      , (SELECT
                NVL2(MAX(S1.CO_NM), A.DCER_CD || ' | ' || MAX(S1.CO_NM), A.DCER_CD)
         FROM
                TB_COM_CO S1
              , TB_COM_CO_DCLR_CD S2
         WHERE
                S1.NIF = S2.NIF
         AND    S2.CO_DCLR_TP_CD = 'H'
         AND    S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                                           /** Nom de l'entreprise !== 업체명 ==! */
      , A.BNBN_CMDT_WRHS_CD                                                                     /** Code d'entrepôt de la marchandise sous douane !== 보세물품창고코드 ==! */
      , A.CSCL_PLN_CD                                                                           /** Code de plan de dédouanement !== 통관계획코드 ==! */
      , A.DCLR_PT_CD                                                                            /** Code de type de déclaration !== 신고유형코드 ==! */
      , A.EXP_CNTY_CD                                                                           /** Code de pays exportateur !== 수출국가코드 ==! */
      , D.TTXBS_NCY_AMT                                                                         /** Montant NCY total de la valeur statistique  !== 총과세기준NCY금액 ==! */
      , TO_CHAR(TO_DATE(C.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT  /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , TO_CHAR(TO_DATE(C.PSMGT_FFMN_CMPL_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_CMPL_DT  /** Date de l'apurement de régime suspensif !== 사후관리이행완료일자 ==! */
      , NVL((SELECT SUM(S.USE_AMT)
             FROM   TB_COLI_MG_USE S, TB_COLI_MG M
             WHERE S.RQST_NO  = M.RQST_NO
               AND    M.MG_NO = L.MG_AC_NO
               AND    S.REFF_NO = L.DTL_DCSH_NO
               AND    S.DEL_YN = 'N'), 0) AS MG_AMT                                             /** Montant de caution != 담보금액 =! */
      , NVL((SELECT SUM(S.MG_RELE_AMT)
             FROM   TB_COLI_MG_RELE S, TB_COLI_MG M
             WHERE S.RQST_NO  = M.RQST_NO
               AND    M.MG_NO = L.MG_AC_NO
               AND    S.USE_REFF_NO = L.DTL_DCSH_NO
               AND    S.DEL_YN = 'N'), 0) AS MG_RELE_AMT                                        /** Montant rendu après la mainlevée  !== 담보해제금액 ==! */
      , C.MG_RELE_YN                                                                            /** Caution levée ON !== 담보해제여부 ==! */
      , L.MG_TP_CD                                                                              /** Code de type de caution !== 담보구분코드 ==! */
      , L.MG_AC_NO                                                                              /** N° de compte de caution !== 담보계좌번호 ==! */
      , (SELECT
                NVL2(MAX(S.WRHS_NM), A.BNBN_CMDT_WRHS_CD || ' | ' || MAX(S.WRHS_NM), A.BNBN_CMDT_WRHS_CD)
         FROM
                TB_COM_WRHS S
         WHERE
                S.DEL_YN = 'N'
         AND    S.CO_DCLR_CD = A.BNBN_CMDT_WRHS_CD) AS BNBN_CMDT_WRHS_NM                         /** !== 보세창고명==! */
       , A.NEW_SYS_YN                                                                            /** Nouveau système ON !== 신규시스템여부 ==! */
      , TO_CHAR(TO_DATE(A.ACPT_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS ACPT_DT
      , (SELECT SUM(TAMT)
         FROM TB_COLI_NTFC
         WHERE REFF_NO = A.DTL_DCSH_NO
           AND CNCL_YN = 'N'
           AND DEL_YN  = 'N'
        ) AS NTFC_AMT
    FROM
           TB_CLRI_PSMGT_COMN C
         , TB_CLRI_DED_COMN A
         , TB_CLRI_DED_CO B
         , TB_CLRI_DED_VLUT_COMN D
         , TB_CLRI_DED_MG L
         , TB_CLRI_DED_VLUT_AUDT_COMN P
    WHERE
           C.DTL_DCSH_NO = A.DTL_DCSH_NO
    AND    C.DTL_DCSH_NO = B.DTL_DCSH_NO
    AND    C.DTL_DCSH_NO = D.DTL_DCSH_NO
    AND    C.DTL_DCSH_NO = L.DTL_DCSH_NO(+)
    AND    C.DTL_DCSH_NO = P.DTL_DCSH_NO(+)
    AND    C.DEL_YN = 'N'
    AND    A.DEL_YN = 'N'
    AND    B.DEL_YN = 'N'
    AND    D.DEL_YN = 'N'
    AND    L.DEL_YN(+) = 'N'
    AND    P.DEL_YN(+) = 'N'
    AND    P.LAST_YN(+) = 'Y'
    AND    A.DTL_DCSH_NO = #{dtlDcshNo}
    AND    ROWNUM = 1
  </select>
    
  <!--
    Consultation de l'article de la marchandise entrée sous régime suspensif !== 통관미이행반입물품 품목 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtPdlsList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPdlsVo">
    /* selectClrCsclInctFfmnBrngCmdtPdlsList */
    SELECT
        G.PDLS_NO AS PDLS_NO                                                                                                       /** N° d'article !== 품목번호 ==! */
      , G.HS_CD                                                                                                                    /** Code SH !== HS코드 ==! */
      , H.HS_DESC                                                                                                                  /** Description du SH !== HS설명 ==! */
      , E.ORCY_CNTY_CD                                                                                                             /** Code de pays d'origine !== 원산지국가코드 ==! */
      , G.QTY                                                                                                                      /** Quantité !== 수량 ==! */
      , NVL(G.QTY_UT_CD, E.QTY_UT_CD) AS QTY_UT_CD                                                                                 /** Code de l'unité de quantité !== 수량단위코드 ==! */
      , A.EPC_CD                                                                                                                   /** Code EPC !== EPC코드 ==! */
      , E.APC_CD                                                                                                                   /** Code APC !== APC코드 ==! */
      , (SELECT SUM(S.FFMN_QTY) FROM TB_CLRI_PSMGT_PDLS_INVN_H S WHERE S.DTL_DCSH_NO = G.DTL_DCSH_NO AND S.PDLS_NO = G.PDLS_NO AND S.DEL_YN = 'N' AND S.DEL_YN = 'N') AS FFMN_QTY  /** Quantité apurée !== 이행수량 ==! */
      , G.RSQTY_QTY                                                                                                                /** Quatité restante !== 잔량수량 ==! */
    FROM
           TB_CLRI_PSMGT_PDLS_INVN_H G
         , TB_CLRI_DED_COMN A
         , TB_CLRI_HS_CD H
         , TB_CLRI_DED_PDLS E
    WHERE
           G.DTL_DCSH_NO = A.DTL_DCSH_NO
    AND    G.DTL_DCSH_NO = E.DTL_DCSH_NO
    AND    G.PDLS_NO = E.PDLS_NO
    AND    G.LAST_YN = 'Y'
    AND    G.HS_CD = H.HS_CD(+)
    AND    A.DCLR_DT BETWEEN H.HS_APLY_STRT_DT AND H.HS_APLY_END_DT
    AND    G.DTL_DCSH_NO = #{dtlDcshNo}
    ORDER BY TO_NUMBER(G.PDLS_NO)
  </select>
    
  <!--
    Consultation de la déclaration d'apurement de la marchandise entrée sous régime suspensif !== 통관미이행반입물품 이행신고서 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtDcshList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPdlsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtDcshVo">
    /* selectClrCsclInctFfmnBrngCmdtDcshList */
    SELECT
        A.DTL_DCSH_NO                                                    /** Numéro du DAU !== DED번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT /** Date de DAU !== DED일자 ==! */
      , A.DCLR_PT_CD                                                     /** Code de type de déclaration !== 신고유형코드 ==! */
      , A.DCLR_CSTM_CD                                                   /** Code de bureau de déclaration !== 신고세관코드 ==! */
      , A.TXPR_IDFY_NO                                                   /** NIU !== 납세자식별번호 ==! */
      , G.PDLS_NO                                                        /** N° d'article !== 품목번호 ==! */
      , E.HS_CD                                                          /** Code SH !== HS코드 ==! */
      , H.HS_DESC                                                        /** Description du SH !== HS설명 ==! */
      , A.EPC_CD                                                         /** Code EPC !== EPC코드 ==! */
      , G.FFMN_QTY                                                       /** Quantité apurée !== 이행수량 ==! */
      , E.QTY_UT_CD                                                      /** Code de l'unité de quantité !== 수량단위코드 ==! */
      , D.TTXBS_NCY_AMT                                                  /** Montant NCY total de la valeur statistique  !== 총과세기준NCY금액 ==! */
      , A.PRCS_STTS_CD                                                   /** Code de statut de traitement !== 처리상태코드 ==! */
    FROM
           TB_CLRI_PSMGT_PDLS_INVN_H G
         , TB_CLRI_DED_COMN A
         , TB_CLRI_DED_VLUT_COMN D
         , TB_CLRI_DED_PDLS E
         , TB_CLRI_HS_CD H
    WHERE
           G.FFMN_DTL_DCSH_NO = A.DTL_DCSH_NO
    AND    G.FFMN_DTL_DCSH_NO = D.DTL_DCSH_NO
    AND    G.FFMN_DTL_DCSH_NO = E.DTL_DCSH_NO
    AND    G.FFMN_PDLS_NO = E.PDLS_NO
    AND    E.HS_CD = H.HS_CD(+)
    AND    G.DTL_DCSH_NO = #{dtlDcshNo}
    AND    G.PDLS_NO = #{pdlsNo}
    AND    G.INVN_MVMN_TP_CD = 'OT'
    AND    G.DEL_YN = 'N'
    AND    A.DEL_YN = 'N'
    AND    D.DEL_YN = 'N'
    AND    E.DEL_YN = 'N'
    AND    H.DEL_YN(+) = 'N'
    AND    A.DCLR_DT BETWEEN H.HS_APLY_STRT_DT AND H.HS_APLY_END_DT
    ORDER BY A.DCLR_DT DESC, A.FRST_RGSR_DTTM DESC
  </select>

  <!--
    Main-levée finale O/N de la caution !== 담보 최종 해제 여부 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtMgReleYn" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtMgReleVo">
    /* selectClrCsclInctFfmnBrngCmdtMgReleYn */
    SELECT
        L.MG_TP_CD
      , L.MG_AC_NO
      , NVL(
             CASE WHEN L.MG_TP_CD = 'A' THEN
                 (SELECT 'Y'
                  FROM   TB_COLI_MG_RELE S
                  WHERE  S.MG_NO = L.MG_AC_NO
                  AND    S.USE_REFF_NO = L.DTL_DCSH_NO
                  AND    S.LAST_RELE_YN = 'Y'
                  AND    S.DEL_YN = 'N'
                 )
             ELSE
                 (SELECT 'Y'
                  FROM   TB_COLI_MG_AC_USE_RELE S
                  WHERE  S.MG_AC_NO = L.MG_AC_NO
                  AND    S.USE_REFF_NO = L.DTL_DCSH_NO
                  AND    S.LAST_RELE_YN = 'Y'
                  AND    S.DEL_YN = 'N'
                 )
             END, 'N') AS LAST_RELE_YN
    FROM   TB_CLRI_DED_MG L
    WHERE  L.DTL_DCSH_NO = #{dtlDcshNo}
    AND    L.DEL_YN = 'N'
    AND    ROWNUM = 1
  </select>
    
  <!--
    Consultation des informations sur l'exigence à la main-levée de caution !== 담보해제 필요 정보 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtMgRele" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtMgReleVo">
    /* selectClrCsclInctFfmnBrngCmdtMgRele */
    SELECT
        L.MG_AC_NO AS MG_NO                                                                     /** N° de caution !== 담보번호 ==! */
      , DECODE(A.DCLR_PT_CD, 'EX2', A.EXPPN_IDFY_NO, A.IMPPN_IDFY_NO) AS IDFY_NO_1              /** N° d'identification !== 식별번호 ==! */
      , A.TXPR_IDFY_NO AS IDFY_NO_2                                                             /** N° d'identification !== 식별번호 ==! */
      , A.DCER_CD AS IDFY_NO_3                                                                  /** N° d'identification !== 식별번호 ==! */
      , CASE WHEN A.NEW_SYS_YN = 'N' THEN
               NVL((SELECT SUM(S.USE_AMT)
                    FROM   TB_COLI_MG_USE S, TB_COLI_MG M
                    WHERE  S.RQST_NO  = M.RQST_NO
                    AND    M.MG_NO = L.MG_AC_NO
                    AND    S.REFF_NO = L.DTL_DCSH_NO
                    AND    S.DEL_YN = 'N'), 0)
        ELSE
            DECODE(P.ASED_FVRFC_MG_DSCN_AMT, NULL, P.ASED_FVRFC_MG_AMT, P.ASED_FVRFC_MG_DSCN_AMT)
        END
        - NVL((SELECT SUM(S.MG_RELE_AMT)
               FROM   TB_COLI_MG_RELE S, TB_COLI_MG M
               WHERE  S.RQST_NO  = M.RQST_NO
               AND    M.MG_NO = L.MG_AC_NO
               AND    S.USE_REFF_NO = L.DTL_DCSH_NO
               AND    S.DEL_YN = 'N'), 0) AS MG_RELE_AMT                                        /** Montant rendu après la mainlevée  !== 담보해제금액 ==! */
      , A.DTL_DCSH_NO AS USE_REFF_NO                                                            /** Numéro De Référence Utilisé !== 사용참조번호 ==! */
      , G.FFMN_DTL_DCSH_NO AS REFF_NO                                                           /** N° de référence !== 참조번호 ==! */
      , A.AUDT_EMP_ID                                                                           /** ID de la personne vérifiant !== 심사직원ID ==! */
      , L.MG_TP_CD                                                                              /** Code de type de caution !== 담보구분코드 ==! */
      , A.DCLR_PT_CD                                                                            /** Code de type de déclaration !== 신고유형코드 ==! */
    FROM
           TB_CLRI_DED_COMN A
         , TB_CLRI_DED_MG L
         , (SELECT
                   S.DTL_DCSH_NO
                 , S.FFMN_DTL_DCSH_NO
            FROM
                  (SELECT S1.DTL_DCSH_NO, S1.FFMN_DTL_DCSH_NO
                   FROM   TB_CLRI_PSMGT_PDLS_INVN_H S1
                   WHERE  S1.DTL_DCSH_NO = #{dtlDcshNo}
                   AND    S1.LAST_YN = 'Y'
                   AND    S1.DEL_YN = 'N'
                   ORDER BY S1.LAST_CHG_DTTM DESC) S
            WHERE
                   ROWNUM = 1
           ) G
         , TB_CLRI_DED_VLUT_AUDT_COMN P
    WHERE
           A.DTL_DCSH_NO = L.DTL_DCSH_NO
    AND    A.DTL_DCSH_NO = G.DTL_DCSH_NO
    AND    A.DTL_DCSH_NO = P.DTL_DCSH_NO(+)
    AND    A.DCLR_PT_CD = 'IM7'
    AND    A.DEL_YN  = 'N'
    AND    L.DEL_YN  = 'N'
    AND    P.DEL_YN(+)  = 'N'
    AND    P.LAST_YN(+) = 'Y'
    AND    A.DTL_DCSH_NO = #{dtlDcshNo}
  </select>
    
  <!--
    Achèvement de l'apurement de la marchandise entrée sous régime suspensif !== 통관미이행반입물품 이행 완료 ==!
    (Song JunYoung)
    -->
  <update id="updateClrCsclInctFfmnBrngCmdtCmpl" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtVo">
    /* updateClrCsclInctFfmnBrngCmdtCmpl */
    UPDATE  TB_CLRI_PSMGT_COMN SET
    <trim prefixOverrides="," >
      , MG_RELE_YN = 'Y'                                   /** Caution levée ON !== 담보해제여부 ==! */
      , LAST_CHPR_ID = #{lastChprId}                       /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                       /** Date et heure de modification finale !== 최종변경일시 ==! */
    </trim>
    WHERE  DEL_YN = 'N'                                    /** Suppression ON !== 삭제여부 ==! */
    AND    DTL_DCSH_NO = #{dtlDcshNo}                      /** Numéro du DAU !== DED번호 ==! */
  </update>
  
  <!--
    Consultation de la liste des marchandises entrées sous régime suspensif faisant l'objet de l'apurement !== 통관미이행반인물품 이행대상 목록 조회= ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtFfmnTrgtList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtFfmnTrgtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtFfmnTrgtVo">
    /* selectClrCsclInctFfmnBrngCmdtFfmnTrgtList */
    <include refid="pagination.header" ></include>
	SELECT
	    A.DTL_DCSH_NO                                                                             /** Numéro du DAU !== DED번호 ==! */
	  , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT                          /** Date de DAU !== DED일자 ==! */
	  , A.DCLR_CSTM_CD                                                                            /** Code de bureau de déclaration !== 신고세관코드 ==! */
	  , A.DCER_CD                                                                                 /** Code du déclarant !== 신고인코드 ==! */
	  , (SELECT
                  NVL2(MAX(S1.CO_NM), A.DCER_CD || ' ' || MAX(S1.CO_NM), A.DCER_CD)
         FROM
                  TB_COM_CO S1
                , TB_COM_CO_DCLR_CD S2
         WHERE
                S1.NIF = S2.NIF
         AND    S2.CO_DCLR_TP_CD = 'H'
         AND    S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                                             /** Nom de l'entreprise !== 업체명 ==! */
	  , A.IMPPN_IDFY_NO                                                                           /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
	  , A.IMPPN_IDFY_NO || ' ' || B.IMPPN_CO_NM AS IMPPN_CO_NM                                    /** Nom de société de l'importateur !== 수입자업체명 ==! */
	  , CASE WHEN C.PSMGT_FFMN_CMPL_DT IS NOT NULL
	         THEN CASE WHEN C.PSMGT_FFMN_CMPL_DT <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
	                   THEN 'AVL'
	                   ELSE 'APL'
	              END
	         ELSE CASE WHEN TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
	                   THEN 'NAP'
	                   ELSE 'NAL'
	              END
	    END AS FFMN_PRCS_STTS_CD                                                                  /** Code de l'état de traitement de l'apurement !== 이행처리상태코드 ==! */
	  , A.EPC_CD                                                                                  /** Code EPC !== EPC코드 ==! */
	  , A.DCLR_PT_CD                                                                              /** Code de type de déclaration !== 신고유형코드 ==! */
	  , TO_CHAR(TO_DATE(C.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT    /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
	  , E.PDLS_NO                                                                                 /** N° d'article !== 품목번호 ==! */
	  , E.QTY                                                                                     /** Quantité !== 수량 ==! */
	  , E.QTY_UT_CD                                                                               /** Code de l'unité de quantité !== 수량단위코드 ==! */
	  , M.PDLS_TXBS_NCY_AMT                                                                       /** Montant Nyc De La Base Taxable De L'Article !== 품목과세기준NCY금액 ==! */
	  , TO_CHAR(TO_DATE(C.PSMGT_FFMN_CMPL_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_CMPL_DT    /** Date de l'apurement de régime suspensif !== 사후관리이행완료일자 ==! */
	  , A.TXPR_IDFY_NO                                                                            /** NIU !== 납세자식별번호 ==! */
	  , B.TXPR_CO_NM                                                                              /** Nom de société contribuable !== 납세자업체명 ==! */
	FROM
		   TB_CLRI_PSMGT_COMN C
		 , TB_CLRI_DED_COMN A
		 , TB_CLRI_DED_CO B
		 , TB_CLRI_DED_VLUT_COMN D
		 , TB_CLRI_DED_PDLS E
		 , TB_CLRI_DED_VLUT_PDLS M
	WHERE
	       C.DTL_DCSH_NO = A.DTL_DCSH_NO
	AND    C.DTL_DCSH_NO = B.DTL_DCSH_NO
	AND    C.DTL_DCSH_NO = D.DTL_DCSH_NO
	AND    C.DTL_DCSH_NO = E.DTL_DCSH_NO
    AND    E.DTL_DCSH_NO = M.DTL_DCSH_NO
    AND    E.PDLS_NO = M.PDLS_NO
	AND    C.DEL_YN = 'N'
	AND    A.DEL_YN = 'N'
	AND    B.DEL_YN = 'N'
	AND    D.DEL_YN = 'N'
	AND    E.DEL_YN = 'N'
	AND    M.DEL_YN = 'N'
	AND    A.DCLR_PT_CD = 'IM7'
	<if test="dclrDtFrom != null and dclrDtFrom != ''">
    AND    TO_DATE(A.DCLR_DT,'YYYYMMDD') <![CDATA[ >= ]]> TO_DATE(#{dclrDtFrom}, 'DD/MM/YYYY')
    AND    TO_DATE(A.DCLR_DT,'YYYYMMDD') <![CDATA[ <= ]]> TO_DATE(#{dclrDtTo}, 'DD/MM/YYYY')
    </if>
    <if test="dclrCstmCd != null and dclrCstmCd != ''">
    AND    A.DCLR_CSTM_CD = #{dclrCstmCd}
    </if>
    <if test="dcerCd != null and dcerCd != ''">
    AND    A.DCER_CD = #{dcerCd}
    </if>
    <if test="imppnIdfyNo != null and imppnIdfyNo != ''">
    AND    A.IMPPN_IDFY_NO = #{imppnIdfyNo}
    </if>
    <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'AVL'">
    AND    C.PSMGT_FFMN_CMPL_DT IS NOT NULL
    AND    C.PSMGT_FFMN_CMPL_DT <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
    </if>
    <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'APL'">
    AND    C.PSMGT_FFMN_CMPL_DT IS NOT NULL
    AND    C.PSMGT_FFMN_CMPL_DT <![CDATA[ > ]]> C.PSMGT_FFMN_XPIR_DT
    </if>
    <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'NAP'">
    AND    C.PSMGT_FFMN_CMPL_DT IS NULL
    AND    TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ <= ]]> C.PSMGT_FFMN_XPIR_DT
    </if>
    <if test="ffmnPrcsSttsCd != null and ffmnPrcsSttsCd != '' and ffmnPrcsSttsCd == 'NAL'">
    AND    C.PSMGT_FFMN_CMPL_DT IS NULL
    AND    TO_CHAR(SYSDATE, 'YYYYMMDD') <![CDATA[ > ]]> C.PSMGT_FFMN_XPIR_DT
    </if>
    <if test="dtlDcshNo != null and dtlDcshNo != ''">
	AND    A.DTL_DCSH_NO = #{dtlDcshNo}
    </if>
    ORDER BY A.DCLR_DT DESC, A.DTL_DCSH_NO DESC, TO_NUMBER(E.PDLS_NO)
    <include refid="pagination.footer" ></include>
  </select>

  <!--
    Consulation de la liste des prolongation du délai de sortie des marchandises entrées sous régime suspensif !== 통관미이행 반입물품 반출 기한 연장 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtPridXtnsList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsVo">
    /* selectClrCsclInctFfmnBrngCmdtPridXtnsList */
    <include refid="pagination.header" ></include>
    SELECT
        ROWNUM AS RNUM
      , A.DTL_DCSH_NO
      , A.PSMGT_PRID_XTNS_RQST_NO
      , A.IMPPN_IDFY_NO
      , A.IMPPN_CO_NM
      , A.BNBN_CMDT_WRHS_CD
      , TO_CHAR(TO_DATE(A.PRID_XTNS_RGSR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PRID_XTNS_RGSR_DT
      , TO_CHAR(A.APRV_RQST_DTTM, 'DD/MM/YYYY') AS APRV_RSOF_DT
      , TO_CHAR(A.APRV_PRCS_CMPL_DTTM, 'DD/MM/YYYY') AS APRE_DT
      , A.PRID_XTNS_EMP_ID
      , A.PRCS_STTS_CD
      , A.APRV_PRCS_STTS_CD
      , A.PDLS_NO
      , A.PDLS_NM
      , A.HS_CD
      , A.APC_CD
      , TO_CHAR(TO_DATE(A.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT
      , TO_CHAR(TO_DATE(A.EXTD_PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS EXTD_PSMGT_FFMN_XPIR_DT
    FROM (
          SELECT
                 A.DTL_DCSH_NO                                                                                 /** Numéro du DAU !== DED번호 ==! */
               , I.PSMGT_PRID_XTNS_RQST_NO                                                                     /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
               , A.IMPPN_IDFY_NO                                                                               /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
               , B.IMPPN_CO_NM                                                                                 /** Nom de société de l'importateur !== 수입자업체명 ==! */
               , A.BNBN_CMDT_WRHS_CD                                                                           /** Code d'entrepôt de la marchandise sous douane !== 보세물품창고코드 ==! */
               , I.PRID_XTNS_RGSR_DT                                                                           /** Date de prorogation d'échéance !== 신청일자 ==! */
               , F.APRV_RQST_DTTM                                                                              /** Date de demande d'appobation !== 결재신청일시 ==! */
               , DECODE(I.PRCS_STTS_CD, 'D08', (SELECT MAX(S.APRV_PRCS_DTTM)
                                                FROM   TB_POTI_APRV_D S
                                                WHERE  S.APRV_ID = F.APRV_ID), NULL) AS APRV_PRCS_CMPL_DTTM    /** Date et heure du traitement de l'approbation !== 결재처리일시 ==! */
               , I.PRID_XTNS_EMP_ID                                                                            /** ID de l'inspecteur !== 세관직원ID ==! */
               , I.PRCS_STTS_CD                                                                                /** Code de statut de traitement !== 처리상태코드 ==! */
               , F.APRV_PRCS_STTS_CD                                                                           /** Code de statut du traitement d'approbation !== 결재처리상태코드 ==! */
               , G.PDLS_NO                      															   /** N° D'Article !== 품목번호 ==! */
               , H.PDLS_NM 					   																   /** Nom de l'article !== 품목명 ==! */
               , H.HS_CD 					   																   /** Code SH !== HS코드 ==! */
               , H.APC_CD 					   																   /** Code APC !== APC코드 ==! */
               , G.PSMGT_FFMN_XPIR_DT                                                                          /** Date d'echeance de l'apurement de regime suspensif !== 사후관리이행만료일자 ==! */
               , G.EXTD_PSMGT_FFMN_XPIR_DT                                                                     /** Date d'echeance prorogee de l'apurement de regime suspensif !== 연장된사후관리이행만료일자 ==! */
          FROM
                 TB_CLRI_PSMGT_PRID_XTNS I
               , TB_CLRI_DED_COMN A
               , TB_CLRI_DED_CO B
               , TB_POTI_APRV F
               , ALPASSINT.TB_CLRI_PSMGT_PRID_XTNS_PDLS G
               , TB_CLRI_DED_PDLS H
          WHERE
                 I.DTL_DCSH_NO = A.DTL_DCSH_NO
          AND    I.DTL_DCSH_NO = B.DTL_DCSH_NO
          AND    I.APRV_ID = F.APRV_ID(+)
          AND    I.PSMGT_PRID_XTNS_RQST_NO = G.PSMGT_PRID_XTNS_RQST_NO
          AND    I.DTL_DCSH_NO = H.DTL_DCSH_NO
          AND    G.PDLS_NO = H.PDLS_NO
          AND    I.DEL_YN = 'N'
          AND    A.DEL_YN = 'N'
          AND    B.DEL_YN = 'N'
          AND    F.DEL_YN(+) = 'N'
          AND    A.DCLR_PT_CD = 'IM7'
          AND    I.PRCS_STTS_CD IN ('D01', 'D08', 'D09', 'I01')
          <if test="pridXtnsRgsrDtFrom != null and pridXtnsRgsrDtFrom != ''">
          AND    I.PRID_XTNS_RGSR_DT <![CDATA[ >= ]]> TO_CHAR(TO_DATE(#{pridXtnsRgsrDtFrom}, 'DD/MM/YYYY'), 'YYYYMMDD')
          AND    I.PRID_XTNS_RGSR_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE(#{pridXtnsRgsrDtTo}, 'DD/MM/YYYY'), 'YYYYMMDD')
          </if>
          <if test="dclrCstmCd != null and dclrCstmCd != ''">
          AND    A.DCLR_CSTM_CD = #{dclrCstmCd}
          </if>
          <if test="bnbnCmdtWrhsCd != null and bnbnCmdtWrhsCd != ''">
          AND    A.BNBN_CMDT_WRHS_CD = #{bnbnCmdtWrhsCd}
          </if>
          <if test="prcsSttsCd != null and prcsSttsCd != ''">
          AND    I.PRCS_STTS_CD = #{prcsSttsCd}
          </if>
          <if test="dtlDcshNo != null and dtlDcshNo != ''">
		  AND    A.DTL_DCSH_NO = #{dtlDcshNo}
          </if>
          ORDER BY I.FRST_RGSR_DTTM DESC
        ) A
    ORDER BY RNUM
    <include refid="pagination.footer" ></include>
  </select>
    
  <!--
    Consultation en détail de la prolongation du délai de sortie des marchandises entrées sous régime suspensif !== 통관미이행 반입물품 반출 기한 연장 상세 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtPridXtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsDtlVo">
    /* selectClrCsclInctFfmnBrngCmdtPridXtns */
    SELECT
        A.DTL_DCSH_NO                                                                                         /** Numéro du DAU !== DED번호 ==! */
      , I.PSMGT_PRID_XTNS_RQST_NO                                                                             /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT                                      /** Date de DAU !== DED일자 ==! */
      , A.DCER_CD                                                                                             /** Code du déclarant !== 신고인코드 ==! */
      , (SELECT
                NVL2(MAX(S1.CO_NM), A.DCER_CD || ' | ' || MAX(S1.CO_NM), A.DCER_CD)
         FROM
                TB_COM_CO S1
              , TB_COM_CO_DCLR_CD S2
         WHERE
                S1.NIF = S2.NIF
         AND    S2.CO_DCLR_TP_CD = 'H'
         AND    S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                                                         /** Nom de l'entreprise !== 업체명 ==! */
      , A.BNBN_CMDT_WRHS_CD                                                                                   /** Code d'entrepôt de la marchandise sous douane !== 보세물품창고코드 ==! */
      , NVL2(ED.WRHS_NM, A.BNBN_CMDT_WRHS_CD || ' | ' || ED.WRHS_NM, A.BNBN_CMDT_WRHS_CD) AS BNBN_CMDT_WRHS_NM  /** Code d'entrepôt de la marchandise sous douane !== 보세물품창고코드 ==! */
      , A.CSCL_PLN_CD                                                                                         /** Code de plan de dédouanement !== 통관계획코드 ==! */
      , A.DCLR_PT_CD                                                                                          /** Code de type de déclaration !== 신고유형코드 ==! */
      , A.EXP_CNTY_CD                                                                                         /** Code de pays exportateur !== 수출국가코드 ==! */
      , D.TTXBS_NCY_AMT                                                                                       /** Montant NCY total de la valeur statistique !== 총과세기준NCY금액 ==! */
      , TO_CHAR(TO_DATE(I.PRID_XTNS_RGSR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PRID_XTNS_RGSR_DT                  /** Date de prorogation d'échéance !== 신청일자 ==! */
      , I.PRID_XTNS_RSN_CN                                                                                    /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , I.ATCH_FILE_ID                                                                                        /** ID de la pièce jointe !== 첨부파일ID ==! */
      , I.APRV_ID                                                                                             /** ID d'approbation !== 결재ID ==! */
      , I.AUDT_OPIN_CN                                                                                        /** Contenu de l'opinion à la suite de la vérification !== 심사의견내용 ==! */
      , I.REPN_ID                                                                                             /** ID de la personne demandant !== 신청자ID ==! */
      , I.PRCS_STTS_CD                                                                                        /** Code de statut de traitement !== 처리상태코드 ==! */
      , A.DCLR_CSTM_CD                                                                                        /** Code de bureau de déclaration !== 신고세관코드 ==! */
      , F.APRV_PRCS_STTS_CD                                                                                   /** Code de statut du traitement d'approbation !== 결재처리상태코드 ==! */
      , A.REFF_NO                                                                                             /** N° de reference !== 참조번호 ==! */
      , A.NEW_SYS_YN                                                                                          /** Nouveau système ON !== 신규시스템여부 ==! */
      , G.PDLS_NO                      																		  /** N° D'Article !== 품목번호 ==! */
      , H.PDLS_NM 					   																		  /** Nom de l'article !== 품목명 ==! */
      , H.HS_CD 					   																		  /** Code SH !== HS코드 ==! */
      , H.APC_CD 					   																		  /** Code APC !== APC코드 ==! */
      , TO_CHAR(TO_DATE(G.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT                /** Date d'echeance de l'apurement de regime suspensif !== 사후관리이행만료일자 ==! */
      , TO_CHAR(TO_DATE(G.EXTD_PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS EXTD_PSMGT_FFMN_XPIR_DT      /** Date d'echeance prorogee de l'apurement de regime suspensif !== 연장된사후관리이행만료일자 ==! */
    FROM
           TB_CLRI_PSMGT_PRID_XTNS I
         , TB_CLRI_DED_COMN A
         , TB_CLRI_DED_CO B
         , TB_CLRI_PSMGT_COMN C
         , TB_CLRI_DED_VLUT_COMN D
         , TB_POTI_APRV F
         , TB_COM_WRHS ED
         , ALPASSINT.TB_CLRI_PSMGT_PRID_XTNS_PDLS G
         , TB_CLRI_DED_PDLS H
    WHERE
           I.DTL_DCSH_NO = A.DTL_DCSH_NO
    AND    I.DTL_DCSH_NO = B.DTL_DCSH_NO
    AND    I.DTL_DCSH_NO = C.DTL_DCSH_NO
    AND    I.DTL_DCSH_NO = D.DTL_DCSH_NO
    AND     I.PSMGT_PRID_XTNS_RQST_NO = G.PSMGT_PRID_XTNS_RQST_NO
    AND     I.DTL_DCSH_NO = H.DTL_DCSH_NO
    AND     G.PDLS_NO = H.PDLS_NO
    AND    I.APRV_ID = F.APRV_ID(+)
    AND    A.BNBN_CMDT_WRHS_CD = ED.CO_DCLR_CD(+)
    AND    I.PRCS_STTS_CD IN ('D01', 'D08', 'D09', 'I01')
    AND    A.DCLR_PT_CD = 'IM7'
    AND    I.DEL_YN = 'N'
    AND    A.DEL_YN = 'N'
    AND    B.DEL_YN = 'N'
    AND    C.DEL_YN = 'N'
    AND    D.DEL_YN = 'N'
    AND    F.DEL_YN(+) = 'N'
    AND    ED.DEL_YN(+) = 'N'
    AND    I.PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}
  </select>
    
  <!--
    Vérification de la possibilité d'enregistrement d'une prolongation du délai de sortie des marchandises entrées sous régime suspensif et vérification de traitement  !== 통관미이행 반입물품 반출 기한 연장 등록 가능 및 처리 여부 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtDcshInfo" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtDcshInfoVo">
    /* selectClrCsclInctFfmnBrngCmdtDcshInfo */
    SELECT
               A.DTL_DCSH_NO                 /** Numéro du DAU !== DED번호 ==! */
             , C.PSMGT_FFMN_CMPL_DT          /** Date de l'apurement de régime suspensif !== 사후관리이행완료일자 ==! */
             , C.PSMGT_FFMN_CMPL_YN          /** Régime suspensif apuré ON !== 사후관리이행완료여부 ==! */
             , A.DCLR_PT_CD                  /** Code de type de déclaration !== 신고유형코드 ==! */
             , (CASE WHEN I.PRCS_STTS_CD IN ('D08', 'D09') THEN NULL ELSE I.PSMGT_PRID_XTNS_RQST_NO END) AS PSMGT_PRID_XTNS_RQST_NO     /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
             , C.DEL_YN                      /** Suppression ON !== 삭제여부 ==! */
             , IP.PRCS_STTS_CD               /** Code de statut de traitement !== 처리상태코드 ==! */
    FROM (SELECT
              A.DTL_DCSH_NO
            , A.DCLR_PT_CD
            , MAX(I.PSMGT_PRID_XTNS_RQST_NO) AS PSMGT_PRID_XTNS_RQST_NO
          FROM
                 TB_CLRI_DED_COMN A
               , TB_CLRI_PSMGT_PRID_XTNS I
          WHERE
                 A.DTL_DCSH_NO = I.DTL_DCSH_NO(+)
          AND    A.DTL_DCSH_NO = #{dtlDcshNo}
          AND    I.PRCS_STTS_CD(+) IN ('D01', 'D08', 'D09', 'I01')
          AND    A.DEL_YN = 'N'
          AND    I.DEL_YN(+) = 'N'
          <if test="repnId != null and repnId != ''">
          AND    I.REPN_ID(+) = #{repnId}
          </if>
          GROUP BY A.DTL_DCSH_NO, A.DCLR_PT_CD) A
        , TB_CLRI_PSMGT_PRID_XTNS I
        , TB_CLRI_PSMGT_COMN C
        , (SELECT
               I.DTL_DCSH_NO
             , I.PSMGT_PRID_XTNS_RQST_NO
             , I.PRCS_STTS_CD
           FROM
                (SELECT
                        DTL_DCSH_NO
                      , PSMGT_PRID_XTNS_RQST_NO
                      , PRCS_STTS_CD
                 FROM
                        TB_CLRI_PSMGT_PRID_XTNS
                 WHERE
                        DEL_YN = 'N'
                 AND    DTL_DCSH_NO =  #{dtlDcshNo}
                 AND    PRCS_STTS_CD != 'A01'
                 ORDER BY FRST_RGSR_DTTM DESC) I
           WHERE ROWNUM = 1
           ) IP
    WHERE  A.DTL_DCSH_NO = I.DTL_DCSH_NO(+)
    AND    A.DTL_DCSH_NO = C.DTL_DCSH_NO(+)
    AND    A.PSMGT_PRID_XTNS_RQST_NO = I.PSMGT_PRID_XTNS_RQST_NO(+)
    AND    A.DTL_DCSH_NO = IP.DTL_DCSH_NO(+)
    AND    I.DEL_YN(+) = 'N'
    AND    C.DEL_YN(+) = 'N'
  </select>
    
  <!--
    Consultation des informations de la DED lors du non-enregistrement de la prolongation du délai de sortie des marchandises entrées sous régime suspensif  !== 통관미이행 반입물품 반출 기한 연장 미등록 시 DED정보 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtPridXtnsNotExist" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsDtlVo">
    /* selectClrCsclInctFfmnBrngCmdtPridXtnsNotExist */
    SELECT
        A.DTL_DCSH_NO                                                                                 /** Numéro du DAU !== DED번호 ==! */
      , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT                              /** Date de DAU !== DED일자 ==! */
      , A.DCER_CD                                                                                     /** Code du déclarant !== 신고인코드 ==! */
      , (SELECT
                NVL2(MAX(S1.CO_NM), A.DCER_CD || ' | ' || MAX(S1.CO_NM), A.DCER_CD)
         FROM
                TB_COM_CO S1
              , TB_COM_CO_DCLR_CD S2
         WHERE
                S1.NIF = S2.NIF
         AND    S2.CO_DCLR_TP_CD = 'H'
         AND    S2.CO_DCLR_CD = A.DCER_CD) AS DCER_NM                                                 /** Nom de l'entreprise !== 업체명 ==! */
      , A.BNBN_CMDT_WRHS_CD                                                                           /** Code d'entrepôt de la marchandise sous douane !== 보세물품창고코드 ==! */
      , NVL2(ED.WRHS_NM, A.BNBN_CMDT_WRHS_CD || ' | ' || ED.WRHS_NM, A.BNBN_CMDT_WRHS_CD) AS BNBN_CMDT_WRHS_NM  /** Code d'entrepôt de la marchandise sous douane !== 보세물품창고코드 ==! */
      , A.CSCL_PLN_CD                                                                                 /** Code de plan de dédouanement !== 통관계획코드 ==! */
      , A.DCLR_PT_CD                                                                                  /** Code de type de déclaration !== 신고유형코드 ==! */
      , A.EXP_CNTY_CD                                                                                 /** Code de pays exportateur !== 수출국가코드 ==! */
      , D.TTXBS_NCY_AMT                                                                               /** Montant NCY total de la valeur statistique !== 총과세기준NCY금액 ==! */
      , TO_CHAR(TO_DATE(C.PSMGT_FFMN_XPIR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS PSMGT_FFMN_XPIR_DT        /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , A.DCLR_CSTM_CD                                                                                /** Code de bureau de déclaration !== 신고세관코드 ==! */
      , A.NEW_SYS_YN                                                                                  /** Nouveau système ON !== 신규시스템여부 ==! */
    FROM
            TB_CLRI_DED_COMN A
          , TB_CLRI_DED_CO B
          , TB_CLRI_PSMGT_COMN C
          , TB_CLRI_DED_VLUT_COMN D
          , TB_COM_WRHS ED
    WHERE
            A.DTL_DCSH_NO = B.DTL_DCSH_NO
    AND     A.DTL_DCSH_NO = C.DTL_DCSH_NO
    AND     A.DTL_DCSH_NO = D.DTL_DCSH_NO
    AND     A.BNBN_CMDT_WRHS_CD = ED.CO_DCLR_CD(+)
    AND     A.DTL_DCSH_NO = #{dtlDcshNo}
    AND     A.DEL_YN = 'N'
    AND     B.DEL_YN = 'N'
    AND     C.DEL_YN = 'N'
    AND     D.DEL_YN = 'N'
    AND     ED.DEL_YN(+) = 'N'
    AND     A.DCLR_PT_CD = 'IM7'
  </select>
    
  <!--
    Enregistrement de la prolongation du délai de sortie des marchandises entrées sous régime suspensif  !== 통관미이행 반입물품 반출 기한 연장 등록 ==!
    (Song JunYoung)
    -->
  <insert id="insertClrCsclInctFfmnBrngCmdtPridXtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsDtlVo">
    /* insertClrCsclInctFfmnBrngCmdtPridXtns */
    WITH UPSERT AS (
    UPDATE TB_CLRI_PSMGT_PRID_XTNS SET
        DTL_DCSH_NO = #{dtlDcshNo}                  /** Numéro du DAU !== DED번호 ==! */
      , REPN_ID = #{repnId}                         /** ID de la personne demandant !== 신청자ID ==! */
      , PSMGT_FFMN_XPIR_DT = TO_CHAR(TO_DATE(#{psmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')     /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , EXTD_PSMGT_FFMN_XPIR_DT = TO_CHAR(TO_DATE(#{extdPsmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')  /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , PRID_XTNS_RSN_CN = #{pridXtnsRsnCn}         /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , ATCH_FILE_ID = #{atchFileId}                /** ID de la pièce jointe !== 첨부파일ID ==! */
      , PRCS_STTS_CD = #{prcsSttsCd}                /** Code de statut de traitement !== 처리상태코드 ==! */
      , PRID_XTNS_EMP_ID = #{pridXtnsEmpId}         /** ID de l'inspecteur !== 세관직원ID ==! */
      , DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID = #{frstRegstId}              /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM = SYSTIMESTAMP               /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}  /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
    RETURNING *
    )
    INSERT INTO TB_CLRI_PSMGT_PRID_XTNS
      (
        PSMGT_PRID_XTNS_RQST_NO      /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      , DTL_DCSH_NO                  /** Numéro du DAU !== DED번호 ==! */
      , REPN_ID                      /** ID de la personne demandant !== 신청자ID ==! */
      , PRID_XTNS_RGSR_DT            /** Date de prorogation d'échéance !== 신청일자 ==! */
      , PSMGT_FFMN_XPIR_DT           /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , EXTD_PSMGT_FFMN_XPIR_DT      /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , PRID_XTNS_RSN_CN             /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , ATCH_FILE_ID                 /** ID de la pièce jointe !== 첨부파일ID ==! */
      , PRCS_STTS_CD                 /** Code de statut de traitement !== 처리상태코드 ==! */
      , PRID_XTNS_EMP_ID             /** ID de l'inspecteur !== 세관직원ID ==! */
      , DEL_YN                       /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID                /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM               /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID                 /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM                /** Date et heure de modification finale !== 최종변경일시 ==! */
      )
    SELECT
        #{psmgtPridXtnsRqstNo}       /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
      , #{dtlDcshNo}                 /** Numéro du DAU !== DED번호 ==! */
      , #{repnId}                    /** ID de la personne demandant !== 신청자ID ==! */
      , TO_CHAR(SYSDATE, 'YYYYMMDD') /** Date de prorogation d'échéance !== 신청일자 ==! */
      , TO_CHAR(TO_DATE(#{psmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')           /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , TO_CHAR(TO_DATE(#{extdPsmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')       /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , #{pridXtnsRsnCn}             /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , #{atchFileId}                /** ID de la pièce jointe !== 첨부파일ID ==! */
      , #{prcsSttsCd}                /** Code de statut de traitement !== 처리상태코드 ==! */
      , #{pridXtnsEmpId}             /** ID de l'inspecteur !== 세관직원ID ==! */
      , 'N'                          /** Suppression ON !== 삭제여부 ==! */
      , #{frstRegstId}               /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE NOT EXISTS(SELECT * FROM UPSERT)
  </insert>
	
  <!--
    Modification de la prolongation du délai de sortie des marchandises entrées sous régime suspensif  !== 통관미이행 반입물품 반출 기한 연장 수정 ==!
    (Song JunYoung)
    -->
  <update id="updateClrCsclInctFfmnBrngCmdtPridXtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsDtlVo">
    /* updateClrCsclInctFfmnBrngCmdtPridXtns */
    UPDATE  TB_CLRI_PSMGT_PRID_XTNS SET
    <trim prefixOverrides="," >
        LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
      <if test="prcsSttsCd != null and prcsSttsCd != ''">
      , PRCS_STTS_CD = #{prcsSttsCd}                /** Code de statut de traitement !== 처리상태코드 ==! */
      </if>
      <if test="pridXtnsEmpId != null and pridXtnsEmpId != ''">
      , PRID_XTNS_EMP_ID = #{pridXtnsEmpId}         /** ID de l'inspecteur !== 세관직원ID ==! */
      </if>
      <if test="aprvId != null and aprvId != ''">
      , APRV_ID = #{aprvId}                         /** ID d'approbation  !== 결재ID ==! */
      </if>
      <if test="aprvPrcsYn == null or aprvPrcsYn == ''">
      , EXTD_PSMGT_FFMN_XPIR_DT = TO_CHAR(TO_DATE(#{extdPsmgtFfmnXpirDt}, 'DD/MM/YYYY'), 'YYYYMMDD')  /** Date d'échéance prorogée de l'apurement de régime suspensif !== 연장된사후관리이행만료일자 ==! */
      , PRID_XTNS_RSN_CN = #{pridXtnsRsnCn}         /** Motif de la prorogation d'échéance !== 신청사유내용 ==! */
      , ATCH_FILE_ID = #{atchFileId}                /** ID de la pièce jointe !== 첨부파일ID ==! */
      , AUDT_OPIN_CN = #{audtOpinCn}                /** Contenu de l'opinion à la suite de la vérification !== 심사의견내용 ==! */
      </if>
    </trim>
    WHERE  DEL_YN = 'N'                             /** Suppression ON !== 삭제여부 ==! */
    <if test="psmgtPridXtnsRqstNo != null and psmgtPridXtnsRqstNo != ''">
    AND  PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}       /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
    </if>
    <if test='aprvId != null and aprvId != "" and aprvPrcsYn == "Y"'>
    AND  APRV_ID = #{aprvId}                                    /** ID d'approbation  !== 결재ID ==! */
    </if>
  </update>
    
  <!--
    Suppression de la liste des prolongation du délai de sortie des marchandises entrées sous régime suspensif !== 통관미이행 반입물품 반출 기한 연장 목록조회 삭제 ==!
    (Song JunYoung)
    -->
  <update id="deleteClrCsclInctFfmnBrngCmdtPridXtns" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsDtlVo">
    /* deleteClrCsclInctFfmnBrngCmdtPridXtns */
    UPDATE  TB_CLRI_PSMGT_PRID_XTNS SET
         DEL_YN = 'Y'                                  /** Suppression ON !== 삭제여부 ==! */
      ,  LAST_CHPR_ID = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
      ,  LAST_CHG_DTTM = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
    AND    PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}       /** N° De Demande De Prorogation Du Délai De Suivi De Régime Suspensif !== 사후관리기간연장신청번호 ==! */
  </update>
    
  <!--
    Consultation des informations sur la prolongation du délai de sortie de la marchandise mise en zone sous douane avec une recherche d'identifiant approbateur  !== 결재ID로 검색하여 보세구역 반입물품 반출 기한 연장 정보 조회  ==!
    (Song JunYoung)
    -->
  <select id="selectClrRlsextnsSearchAprvId" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsDtlVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsDtlVo">
    /* selectClrRlsextnsSearchAprvId */
    SELECT
           I.DTL_DCSH_NO
         , A.REFF_NO
         , I.PSMGT_PRID_XTNS_RQST_NO
    FROM
           TB_CLRI_DED_COMN A
         , TB_CLRI_PSMGT_PRID_XTNS I
    WHERE  A.DTL_DCSH_NO = I.DTL_DCSH_NO
    AND    I.APRV_ID = #{aprvId}
  </select>
    
  <!--
    Pronlongation du délai de sortie de la marchandise mise en zone sous douane !== 보세구역 반입물품 반출 기한 연장 ==!
    (Lee Yunjeong)
    -->
  <update id="updateClrPsmgtComn" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsDtlVo">
    /* updateClrPsmgtComn */
    UPDATE  TB_CLRI_PSMGT_COMN SET
    <trim prefixOverrides="," >
        PSMGT_FFMN_XPIR_DT = (SELECT S.EXTD_PSMGT_FFMN_XPIR_DT FROM TB_CLRI_PSMGT_PRID_XTNS S WHERE S.PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo} )     /** Date d'échéance de l'apurement de régime suspensif !== 사후관리이행만료일자 ==! */
      , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
    </trim>
    WHERE  DEL_YN = 'N'                             /** Suppression ON !== 삭제여부 ==! */
    AND    DTL_DCSH_NO = #{dtlDcshNo}               /** Numéro du DAU !== DED번호 ==! */
  </update>

  <!--
    Vérification de la réalisation O/N de l'apurement de la marchandise mise en zone sous douane !== 보세물품 이행 여부 체크 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtFfmnYn" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsDtlVo" resultType="string">
    /* selectClrCsclInctFfmnBrngCmdtFfmnYn */
    SELECT
           C.PSMGT_FFMN_CMPL_DT
    FROM
           TB_CLRI_PSMGT_COMN C
         , TB_CLRI_PSMGT_PRID_XTNS I
    WHERE
           C.DTL_DCSH_NO = I.DTL_DCSH_NO
    AND    C.DEL_YN = 'N'
    AND    I.DEL_YN = 'N'
    <choose>
      <when test="psmgtPridXtnsRqstNo != null and psmgtPridXtnsRqstNo != ''">
      AND    I.PSMGT_PRID_XTNS_RQST_NO = #{psmgtPridXtnsRqstNo}
      </when>
      <otherwise>
      AND    C.DTL_DCSH_NO = #{dtlDcshNo}
      AND    ROWNUM = 1
      </otherwise>
    </choose>
  </select>
    
  <!--
    Consultation des informations nécessaires pour vérifier la durée de validité de la caution !== 담보 유효기간 체크 관련 필요 정보 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtMgInfo" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtPridXtnsDtlVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtMgInfoVo">
    /* selectClrCsclInctFfmnBrngCmdtMgInfo */
    SELECT
        L.MG_AC_NO AS MG_NO                                                                     /** N° de caution !== 담보번호 ==! */
      , DECODE(A.DCLR_PT_CD, 'EX2', A.EXPPN_IDFY_NO, A.IMPPN_IDFY_NO) AS IDFY_NO_1              /** N° d'identification !== 식별번호 ==! */
      , A.TXPR_IDFY_NO AS IDFY_NO_2                                                             /** N° d'identification !== 식별번호 ==! */
      , ( SELECT NIF
          FROM   TB_COM_CO_DCLR_CD
          WHERE  CO_DCLR_CD = A.DCER_CD
          AND    ROWNUM = 1 ) AS IDFY_NO_3                                                      /** N° d'identification !== 식별번호 ==! */
      , 1 AS USE_PRNG_AMT                                                                       /** Montant à utiliser !== 사용예정금액 ==! */
      , A.DTL_DCSH_NO AS REFF_NO                                                                /** N° de référence !== 참조번호 ==! */
      , A.AUDT_EMP_ID                                                                           /** ID de la personne vérifiant !== 심사직원ID ==! */
      , L.MG_TP_CD                                                                              /** Code de type de caution !== 담보구분코드 ==! */
      , A.ACPT_DT AS USE_DTTM_FROM                                                              /**Option de la date de début de critère !== 기준시작일자 옵션 ==! */
    FROM
           TB_CLRI_DED_COMN A
         , TB_CLRI_DED_MG L
    WHERE
           A.DTL_DCSH_NO = L.DTL_DCSH_NO
    AND    A.DCLR_PT_CD = 'IM7'
    AND    A.DEL_YN = 'N'
    AND    L.DEL_YN = 'N'
    AND    A.DTL_DCSH_NO = #{dtlDcshNo}
  </select>
    
  <!--
    Consultation de la liste des codes spécifiques !== 특별코드 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtSpelCdMgmtList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo">
    /* selectClrCsclInctFfmnBrngCmdtSpelCdMgmtList */
    <include refid="pagination.header" ></include>
	SELECT
        A.MAFC_CO_NIF                /** N° de RCCM de l'entreprise de transformation !== 가공업체사업자등록번호 ==! */
	  , A.CMDT_CLSF_SPEL_CD          /** Code specifique de classification de marchandise !== 물품분류특별코드 ==! */
	  , A.CMDT_CLSF_SPEL_CD_NM       /** Nom du code specifique de classification de marchandise !== 물품분류특별코드명 ==! */
	  , A.MAFC_CMDT_TP_CD            /** Code de type de produit transforme !== 가공물품구분코드 ==! */
	  , A.HS_CD                      /** Code SH !== HS코드 ==! */
	  , A.QTY_UT_CD                  /** Code de l'unite de quantite !== 수량단위코드 ==! */
	  , A.USE_YN                     /** Utilise ON !== 사용여부 ==! */
	  , A.DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
	  , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
	  , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
	  , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
	  , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
	  , FN_GET_CD_VDVAL_NM('CLR_0047',A.MAFC_CMDT_TP_CD, #{langCd}) AS MAFC_CMDT_TP_NM
      , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY') AS RGSR_DT
      , (SELECT DECODE(B.CO_NM, NULL, T.CO_NM, B.CO_NM) AS CO_NM
         FROM   TB_POTE_NIF T, TB_COM_CO B
         WHERE  T.NIF = B.NIF(+)
         AND    T.NIF = A.MAFC_CO_NIF
         AND    T.DEL_YN = 'N'
         AND    B.DEL_YN(+) = 'N'
         AND    T.NIF_STTS_CD != '0') AS MAFC_CO_NM
      , A.NNFL_TRGT_CMDT_YN          /** Les articles à non apurer !== 불이행대상물품여부 ==! */
    FROM   TB_CLRI_MFCM_CLSF_SPEL_CD A
	WHERE  A.DEL_YN = 'N'            /** Suppression ON !== 삭제여부 ==! */
	<if test="mafcCoNif != null and mafcCoNif != ''">
	AND    A.MAFC_CO_NIF = #{mafcCoNif}
	</if>
	<if test="cmdtClsfSpelCd != null and cmdtClsfSpelCd != ''">
	AND    A.CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
	</if>
	<if test="useYn != null and useYn != ''">
	AND    A.USE_YN = #{useYn}
	</if>
    <include refid="pagination.footer" ></include>
  </select>
    
  <!--
    Consultation des détails du code spécifique !== 특별코드 상세내역 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCsclInctFfmnBrngCmdtSpelCdMgmt" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo">
    /* selectClrCsclInctFfmnBrngCmdtSpelCdMgmt */
    SELECT
        A.MAFC_CO_NIF                /** N° de RCCM de l'entreprise de transformation !== 가공업체사업자등록번호 ==! */
      , A.CMDT_CLSF_SPEL_CD          /** Code specifique de classification de marchandise !== 물품분류특별코드 ==! */
      , A.CMDT_CLSF_SPEL_CD_NM       /** Nom du code specifique de classification de marchandise !== 물품분류특별코드명 ==! */
      , A.MAFC_CMDT_TP_CD            /** Code de type de produit transforme !== 가공물품구분코드 ==! */
      , A.HS_CD                      /** Code SH !== HS코드 ==! */
      , A.QTY_UT_CD                  /** Code de l'unite de quantite !== 수량단위코드 ==! */
      , A.USE_YN                     /** Utilise ON !== 사용여부 ==! */
      , A.DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
      , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
      , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
      , FN_GET_CD_VDVAL_NM('CLR_0047',A.MAFC_CMDT_TP_CD, #{langCd}) AS MAFC_CMDT_TP_NM
	  , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY') AS RGSR_DT
	  , (SELECT DECODE(B.CO_NM, NULL, T.CO_NM, B.CO_NM) AS CO_NM
         FROM   TB_POTE_NIF T, TB_COM_CO B
         WHERE  T.NIF = B.NIF(+)
         AND    T.NIF = A.MAFC_CO_NIF
         AND    T.DEL_YN = 'N'
         AND    B.DEL_YN(+) = 'N'
         AND    T.NIF_STTS_CD != '0') AS MAFC_CO_NM
      , A.NNFL_TRGT_CMDT_YN          /** Les articles à non apurer !== 불이행대상물품여부 ==! */
    FROM   TB_CLRI_MFCM_CLSF_SPEL_CD A
    WHERE  A.DEL_YN = 'N'
    <if test="mafcCoNif != null and mafcCoNif != ''">
    AND    A.MAFC_CO_NIF = #{mafcCoNif}
    </if>
    <if test="cmdtClsfSpelCd != null and cmdtClsfSpelCd != ''">
    AND    A.CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
    </if>
  </select>

  <!--
    Enregistrement des codes spécifiques !== 특별코드 등록 ==!
    (Song JunYoung)
    -->
  <insert id="insertClrCsclInctFfmnBrngCmdtSpelCdMgmt" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo">
    /* insertClrCsclInctFfmnBrngCmdtSpelCdMgmt */
    WITH UPSERT AS (
      UPDATE TB_CLRI_MFCM_CLSF_SPEL_CD SET
          DEL_YN = 'N'
        , CMDT_CLSF_SPEL_CD_NM = #{cmdtClsfSpelCdNm}
        , HS_CD = #{hsCd}
        , QTY_UT_CD = #{qtyUtCd}
        , USE_YN = #{useYn}
        , NNFL_TRGT_CMDT_YN = #{nnflTrgtCmdtYn}
        , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
        , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
      WHERE MAFC_CO_NIF = #{mafcCoNif}
      AND	CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
      RETURNING *
    )
    INSERT INTO TB_CLRI_MFCM_CLSF_SPEL_CD
      (
         MAFC_CO_NIF                  /** N° de RCCM de l'entreprise de transformation !== 가공업체사업자등록번호 ==! */
       , CMDT_CLSF_SPEL_CD            /** Code specifique de classification de marchandise !== 물품분류특별코드 ==! */
       , CMDT_CLSF_SPEL_CD_NM         /** Nom du code specifique de classification de marchandise !== 물품분류특별코드명 ==! */
       , MAFC_CMDT_TP_CD              /** Code de type de produit transforme !== 가공물품구분코드 ==! */
       , HS_CD                        /** Code SH !== HS코드 ==! */
       , QTY_UT_CD                    /** Code de l'unite de quantite !== 수량단위코드 ==! */
       , USE_YN                       /** Utilise ON !== 사용여부 ==! */
       , DEL_YN                       /** Suppression ON !== 삭제여부 ==! */
       , NNFL_TRGT_CMDT_YN
       , FRST_REGST_ID                /** ID du premier enregistrant  !== 최초등록자ID ==! */
       , FRST_RGSR_DTTM               /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
       , LAST_CHPR_ID                 /** ID du modificateur final !== 최종변경자ID ==! */
       , LAST_CHG_DTTM                /** Date et heure de modification finale !== 최종변경일시 ==! */
       )
    SELECT
         #{mafcCoNif}                 /** N° de RCCM de l'entreprise de transformation !== 가공업체사업자등록번호 ==! */
       , #{cmdtClsfSpelCd}            /** Code specifique de classification de marchandise !== 물품분류특별코드 ==! */
       , #{cmdtClsfSpelCdNm}          /** Nom du code specifique de classification de marchandise !== 물품분류특별코드명 ==! */
       , #{mafcCmdtTpCd}              /** Code de type de produit transforme !== 가공물품구분코드 ==! */
       , #{hsCd}                      /** Code SH !== HS코드 ==! */
       , #{qtyUtCd}                   /** Code de l'unite de quantite !== 수량단위코드 ==! */
       , #{useYn}                     /** Utilise ON !== 사용여부 ==! */
       , 'N'                          /** Suppression ON !== 삭제여부 ==! */
       , #{nnflTrgtCmdtYn}
       , #{frstRegstId}               /** ID du premier enregistrant  !== 최초등록자ID ==! */
       , SYSTIMESTAMP                 /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
       , #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
       , SYSTIMESTAMP                 /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE NOT EXISTS(SELECT * FROM UPSERT)
  </insert>

  <!--
    Modification des codes spécifiques !== 특별코드 수정 ==!
    (Song JunYoung)
    -->
  <update id="updateClrCsclInctFfmnBrngCmdtSpelCdMgmt" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo">
    /* updateClrCsclInctFfmnBrngCmdtSpelCdMgmt */
    UPDATE TB_CLRI_MFCM_CLSF_SPEL_CD
    SET CMDT_CLSF_SPEL_CD_NM = #{cmdtClsfSpelCdNm}  /** Nom du code specifique de classification de marchandise !== 물품분류특별코드명 ==! */
      , MAFC_CMDT_TP_CD = #{mafcCmdtTpCd}           /** Code de type de produit transforme !== 가공물품구분코드 ==! */
      , HS_CD = #{hsCd}                             /** Code SH !== HS코드 ==! */
      , QTY_UT_CD = #{qtyUtCd}                      /** Code de l'unite de quantite !== 수량단위코드 ==! */
      , USE_YN = #{useYn}                           /** Utilise ON !== 사용여부 ==! */
      , NNFL_TRGT_CMDT_YN = #{nnflTrgtCmdtYn}
      , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE  DEL_YN = 'N'                             /** Suppression ON !== 삭제여부 ==! */
    AND    MAFC_CO_NIF = #{mafcCoNif}               /** N° de RCCM de l'entreprise de transformation !== 가공업체사업자등록번호 ==! */
    AND    CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}    /** Code specifique de classification de marchandise !== 물품분류특별코드 ==! */
  </update>

  <!--
    Suppression des codes spécifiques !== 특별코드 삭제 ==!
    (Song JunYoung)
    -->
  <update id="deleteClrCsclInctFfmnBrngCmdtSpelCdMgmt" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo">
    /* deleteClrCsclInctFfmnBrngCmdtSpelCdMgmt */
    UPDATE  TB_CLRI_MFCM_CLSF_SPEL_CD
    SET  DEL_YN = 'Y'                                  /** Suppression ON !== 삭제여부 ==! */
      ,  LAST_CHPR_ID = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
      ,  LAST_CHG_DTTM = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
    AND  MAFC_CO_NIF = #{mafcCoNif}                    /** N° de RCCM de l'entreprise de transformation !== 가공업체사업자등록번호 ==! */
    AND  CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}         /** Code specifique de classification de marchandise !== 물품분류특별코드 ==! */
  </update>

  <!--
    Consultation des détails de la référence de quantité utilisée de la marchandise perfectionnée  !== 가공물품소요량기준내역 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrMfcmBprdcBaseList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrMfcmBprdcBaseVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrMfcmBprdcBaseVo">
    /* selectClrMfcmBprdcBaseList*/
	SELECT A.MAFC_CO_NIF             /** N° de RCCM de l'entreprise de transformation !== 가공업체사업자등록번호 ==! */
      , A.CMDT_CLSF_SPEL_CD          /** Code specifique de classification de marchandise !== 물품분류특별코드 ==! */
      , A.PRENT_CMDT_CLSF_SPEL_CD    /** Code specifique de classification de marchandise parentales !== 부모물품분류특별코드 ==! */
      , A.WRTR_RT                    /** Taux d'endommagement !== 손모율 ==! */
      , A.DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
      , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
      , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
      , A.UT_BPRDC_RQTY              /** Quantité consommée du résidu par unité !== 단위부산물소요량 ==! */
      , A.RWMS_BPRDC_TP_CD           /** Code de type de matière première et de résidu !== 원재료부산물구분코드 ==! */
	FROM   TB_CLRI_MFCM_RQTY_BASE A
	WHERE  A.DEL_YN = 'N'
	AND    A.MAFC_CO_NIF = #{mafcCoNif}
	AND    A.CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
  </select>
	
  <!--
    Consultation du code spécifique (pop-up) !== 특별코드조회(팝업) ==!
    (Song JunYoung)
    -->
  <select id="ClriPmtSpel_selectSpelCdList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo">
    /* ClriPmtSpel_selectSpelCdList */
    <include refid="pagination.header" ></include>
	SELECT
        A.MAFC_CO_NIF
	  , A.CMDT_CLSF_SPEL_CD
	  , A.CMDT_CLSF_SPEL_CD_NM
	  , A.MAFC_CMDT_TP_CD
	  , A.HS_CD
	  , A.QTY_UT_CD
	  , (SELECT CO_NM FROM TB_COM_CO WHERE NIF = A.MAFC_CO_NIF ) AS MAFC_CO_NM
	  , FN_GET_CD_VDVAL_NM('CLR_0047', A.MAFC_CMDT_TP_CD, #{langCd}) AS MAFC_CMDT_TP_NM
    FROM   TB_CLRI_MFCM_CLSF_SPEL_CD A
	WHERE  A.DEL_YN = 'N'
	AND    A.USE_YN = 'Y'
	<if test="mafcCoNif != null and mafcCoNif != ''">
	AND    A.MAFC_CO_NIF = #{mafcCoNif}
	</if>
	<if test="cmdtClsfSpelCd != null and cmdtClsfSpelCd != ''">
	AND    A.CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
	</if>
	<if test="cmdtClsfSpelCdNm != null and cmdtClsfSpelCdNm != ''">
	AND    A.CMDT_CLSF_SPEL_CD_NM = #{cmdtClsfSpelCdNm}
	</if>
	<if test="selTpCd != null and selTpCd != ''">
	  <choose>
	    <when test="'10'.equals(selTpCd)">
	    AND    A.MAFC_CMDT_TP_CD IN ('10', '11', '20')
	    </when>
	    <when test="'20'.equals(selTpCd)">
	    AND    A.MAFC_CMDT_TP_CD IN ('20', '30')
	    </when>
	    <when test="'11'.equals(selTpCd)">
	    AND    A.MAFC_CMDT_TP_CD IN ('11')
	    </when>
	    <when test="'30'.equals(selTpCd)">
	    AND    A.MAFC_CMDT_TP_CD IN ('30')
	    </when>
	  </choose>
	</if>
	ORDER BY A.MAFC_CMDT_TP_CD, A.CMDT_CLSF_SPEL_CD
    <include refid="pagination.footer" ></include>
  </select>

  <!--
    Consultation de la liste des produits finaux/produits intermédiaires par opérateur !== 업체별 완성품/반제품 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrCoMnfuList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo">
    /* selectClrCoMnfuList */
    <include refid="pagination.header" ></include>
	SELECT
        A.MAFC_CO_NIF
	  , A.CMDT_CLSF_SPEL_CD
	  , A.CMDT_CLSF_SPEL_CD_NM
	  , A.MAFC_CMDT_TP_CD
	  , A.HS_CD
	  , A.QTY_UT_CD
	  , A.USE_YN
	  , FN_GET_CD_VDVAL_NM('CLR_0047',A.MAFC_CMDT_TP_CD, #{langCd}) AS MAFC_CMDT_TP_NM
	  , (SELECT CO_NM FROM TB_COM_CO WHERE NIF = A.MAFC_CO_NIF) AS MAFC_CO_NM
    FROM   TB_CLRI_MFCM_CLSF_SPEL_CD A
	WHERE  A.DEL_YN = 'N'
	AND    A.USE_YN = 'Y'
	AND    A.MAFC_CMDT_TP_CD IN ('20', '30')
	<if test="mafcCoNif != null and mafcCoNif != ''">
	AND    A.MAFC_CO_NIF = #{mafcCoNif}
	</if>
	<if test="cmdtClsfSpelCd != null and cmdtClsfSpelCd != ''">
	AND    A.CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
	</if>
	ORDER BY  A.MAFC_CMDT_TP_CD DESC
    <include refid="pagination.footer" ></include>
  </select>
    
  <!--
    Consultation de la liste des matières premières/sous produits par code spécifique de la marchandise !== 물품분류특별코드별 원재료/부산물 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrRwmsList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrMafcCmdtRqtyBaseVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrMafcCmdtRqtyBaseVo">
    /* selectClrRwmsList */
    SELECT
        A.RWMS_BPRDC_TP_CD
	  , A.CMDT_CLSF_SPEL_CD
	  , B.CMDT_CLSF_SPEL_CD_NM
	  , B.HS_CD
	  , B.QTY_UT_CD
	  , A.WRTR_RT
	  , A.UT_BPRDC_RQTY
	  , ( SELECT COUNT(MAFC_CO_NIF)
	      FROM   TB_CLRI_MFCM_RQTY_BASE C
	      WHERE  C.DEL_YN = 'N'
	      AND    C.MAFC_CO_NIF = A.MAFC_CO_NIF
	      AND    C.PRENT_CMDT_CLSF_SPEL_CD = A.CMDT_CLSF_SPEL_CD
	      AND    C.RWMS_BPRDC_TP_CD = 'RA' ) AS CHILD_RWMS_CNT
	  , A.PRENT_CMDT_CLSF_SPEL_CD
	FROM   TB_CLRI_MFCM_RQTY_BASE A
		 , TB_CLRI_MFCM_CLSF_SPEL_CD B
	WHERE  A.DEL_YN = 'N'
	AND    B.DEL_YN = 'N'
	AND    A.MAFC_CO_NIF = #{mafcCoNif}
	AND    A.PRENT_CMDT_CLSF_SPEL_CD = #{prentCmdtClsfSpelCd}
	AND    A.MAFC_CO_NIF = B.MAFC_CO_NIF
	AND    A.CMDT_CLSF_SPEL_CD = B.CMDT_CLSF_SPEL_CD
	<if test="rwmsBprdcTpCd != null and rwmsBprdcTpCd != ''">
	AND    A.RWMS_BPRDC_TP_CD = #{rwmsBprdcTpCd}
	</if>
	<if test="cmdtClsfSpelCd != null and cmdtClsfSpelCd != ''">
	AND    A.CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
	</if>
  </select>

  <!--
    Enregistrement de la matrice de quantité utilisée !== 소요량 매트릭스 등록 ==!
    (Song JunYoung)
    -->
  <insert id="insertClrMfcmRqtyMtrx" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrMafcCmdtRqtyBaseVo">
    /*insertClrMfcmRqtyMtrx*/
    WITH UPSERT AS (
	  UPDATE TB_CLRI_MFCM_RQTY_BASE
      SET
          RWMS_BPRDC_TP_CD = #{rwmsBprdcTpCd}
        , UT_BPRDC_RQTY    = #{utBprdcRqty}
        , WRTR_RT          = #{wrtrRt}
        , DEL_YN           = 'N'
        , LAST_CHPR_ID     = #{lastChprId}
        , LAST_CHG_DTTM    = SYSTIMESTAMP
      WHERE MAFC_CO_NIF = #{mafcCoNif}
      AND CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
      AND PRENT_CMDT_CLSF_SPEL_CD = #{prentCmdtClsfSpelCd}
      RETURNING *
      )
	INSERT INTO TB_CLRI_MFCM_RQTY_BASE
	  (
	   	 MAFC_CO_NIF
       , CMDT_CLSF_SPEL_CD
       , PRENT_CMDT_CLSF_SPEL_CD
       , RWMS_BPRDC_TP_CD
       , UT_BPRDC_RQTY
       , WRTR_RT
       , DEL_YN
       , FRST_REGST_ID
       , FRST_RGSR_DTTM
       , LAST_CHPR_ID
       , LAST_CHG_DTTM
       )
      SELECT
          #{mafcCoNif}
        , #{cmdtClsfSpelCd}
        , #{prentCmdtClsfSpelCd}
        , #{rwmsBprdcTpCd}
        , #{utBprdcRqty}
        , #{wrtrRt}
        , 'N'
        , #{frstRegstId}
        , SYSTIMESTAMP
        , #{lastChprId}
        , SYSTIMESTAMP
    WHERE NOT EXISTS(SELECT * FROM UPSERT)
  </insert>
    
  <!--
    Modification de la matrice de quantité utilisée !== 소요량 매트릭스 수정 ==!
    (Song JunYoung)
    -->
  <update id="updateClrMfcmRqtyMtrx" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrMafcCmdtRqtyBaseVo">
    /*updateClrMfcmRqtyMtrx*/
    UPDATE TB_CLRI_MFCM_RQTY_BASE
    SET UT_BPRDC_RQTY    = #{utBprdcRqty}
      , WRTR_RT          = #{wrtrRt}
      , LAST_CHPR_ID     = #{lastChprId}
      , LAST_CHG_DTTM    = SYSTIMESTAMP
    WHERE  DEL_YN = 'N'
    AND    MAFC_CO_NIF = #{mafcCoNif}
    AND    CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
    AND    PRENT_CMDT_CLSF_SPEL_CD = #{prentCmdtClsfSpelCd}
  </update>
    
  <!--
    Suppression de la matrice de quantité utilisée !== 소요량 매트릭스 삭제 ==!
    (Song JunYoung)
    -->
  <update id="updateClrMfcmRqtyMtrxDelYn" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrMafcCmdtRqtyBaseVo">
    /*updateClrMfcmRqtyMtrxDelYn*/
	UPDATE TB_CLRI_MFCM_RQTY_BASE
	SET    DEL_YN           = 'Y'
	     , LAST_CHPR_ID     = #{lastChprId}
	     , LAST_CHG_DTTM    = SYSTIMESTAMP
	WHERE  DEL_YN = 'N'
	AND    MAFC_CO_NIF    = #{mafcCoNif}
	AND    CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
	AND    PRENT_CMDT_CLSF_SPEL_CD = #{prentCmdtClsfSpelCd}
  </update>
    
  <!--
    Vérification de l'existence du code supérieur de la marchandise sur la matrice de quantité utilisée !== 소요량 매트릭스에 상위물품코드 존재하는지 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrMtrxCnt" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrMafcCmdtRqtyBaseVo" resultType="int">
    /* selectClrMtrxCnt */
    SELECT COUNT(CMDT_CLSF_SPEL_CD) AS CNT
	FROM   TB_CLRI_MFCM_RQTY_BASE
	WHERE  DEL_YN = 'N'
	AND    MAFC_CO_NIF = #{mafcCoNif}
	AND    PRENT_CMDT_CLSF_SPEL_CD = #{prentCmdtClsfSpelCd}
  </select>
   
  <!--
    Suppression de la matrice !== 매트릭스 삭제 ==!
    (Song JunYoung)
    -->
  <update id="updateClrMtrxPrentDelYn" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrMafcCmdtRqtyBaseVo">
    /*updateClrMtrxPrentDelYn*/
	UPDATE TB_CLRI_MFCM_RQTY_BASE
	SET    DEL_YN           = 'Y'
	     , LAST_CHPR_ID     = #{lastChprId}
	     , LAST_CHG_DTTM    = SYSTIMESTAMP
	WHERE  DEL_YN = 'N'
	AND    MAFC_CO_NIF    = #{mafcCoNif}
	AND    CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
	AND    PRENT_CMDT_CLSF_SPEL_CD = '*'
  </update>

  <!--
    Consultation de la matrice de quantité utilisée BOM !== BOM 소요량 매트릭스 조회==!
    (Ko SeonHee)
    -->
  <select id="selectMfcmRqtyMtrxList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrMafcCmdtRqtyBaseVo">
    /*selectMfcmRqtyMtrxList*/
    SELECT
        B.RNUM
      , B.CMDT_CLSF_SPEL_CD_NM
      , B.RWMS_BPRDC_TP_CD
      , B.CMDT_CLSF_SPEL_CD
      , B.HS_CD
      , #{rqtyProtCnt} * ROUND(B.UT_BPRDC_RQTY * EXP(SUM(LN(NVL(TO_NUMBER(SUBSTRB(A.TEM,8,9)),1)))), 9) AS UT_BPRDC_RQTY
      , B.QTY_UT_CD
      , B.LEN
      , B.PRENT_CMDT_CLSF_SPEL_CD
    FROM (
          SELECT
              A.RNUM
            , A.CMDT_CLSF_SPEL_CD
            , A.LEN
            , A.CMDT_CLSF_SPEL_CD
            , B.LEN
            ,  MAX(LTRIM(TO_CHAR(B.RNUM,'0000000'))||LTRIM(TO_CHAR(B.UT_BPRDC_RQTY,'000000000'))||B.CMDT_CLSF_SPEL_CD) TEM
          FROM (
                SELECT RNUM, CMDT_CLSF_SPEL_CD, LEN
                FROM (
                      SELECT ROWNUM RNUM, CMDT_CLSF_SPEL_CD, LEV LEN
                      FROM (
                            SELECT LEVEL LEV, CMDT_CLSF_SPEL_CD
                            FROM   TB_CLRI_MFCM_RQTY_BASE
                            WHERE  DEL_YN = 'N'
                            START WITH MAFC_CO_NIF = #{mafcCoNif}
                            AND CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
                            CONNECT BY PRIOR CMDT_CLSF_SPEL_CD = PRENT_CMDT_CLSF_SPEL_CD
                            AND PRIOR MAFC_CO_NIF = MAFC_CO_NIF
                            )
                      )
                ) A
             , (
                SELECT RNUM, CMDT_CLSF_SPEL_CD, LEN, UT_BPRDC_RQTY
                FROM (
                      SELECT ROWNUM RNUM, CMDT_CLSF_SPEL_CD, LEV LEN, UT_BPRDC_RQTY
                      FROM (
                            SELECT LEVEL LEV, CMDT_CLSF_SPEL_CD, UT_BPRDC_RQTY
                            FROM   TB_CLRI_MFCM_RQTY_BASE
                            WHERE  DEL_YN = 'N'
                            START WITH MAFC_CO_NIF = #{mafcCoNif}
                            AND CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
                            CONNECT BY PRIOR CMDT_CLSF_SPEL_CD = PRENT_CMDT_CLSF_SPEL_CD
                            AND PRIOR MAFC_CO_NIF = MAFC_CO_NIF
                            )
                      )
                ) B
          WHERE B.RNUM(+) <![CDATA[ < ]]>  A.RNUM
          AND   B.LEN(+) <![CDATA[ < ]]> A.LEN
          GROUP BY A.RNUM, A.CMDT_CLSF_SPEL_CD, A.LEN, A.CMDT_CLSF_SPEL_CD, B.LEN
          ) A,
         (
          SELECT ROWNUM RNUM
               , B.CMDT_CLSF_SPEL_CD_NM
               /*, LPAD('.', DECODE(LEVEL,1,0,(LEVEL*8)-1),'.')||B.CMDT_CLSF_SPEL_CD_NM AS CMDT_CLSF_SPEL_CD_NM*/
               , LEVEL LEN
               , A.CMDT_CLSF_SPEL_CD
               , B.HS_CD
               , A.UT_BPRDC_RQTY
               , B.QTY_UT_CD
               , A.RWMS_BPRDC_TP_CD
               , A.PRENT_CMDT_CLSF_SPEL_CD
          FROM   TB_CLRI_MFCM_RQTY_BASE A
               , TB_CLRI_MFCM_CLSF_SPEL_CD B
          WHERE A.DEL_YN = 'N'
          AND   B.DEL_YN = 'N'
          AND   A.MAFC_CO_NIF = B.MAFC_CO_NIF
          AND   A.CMDT_CLSF_SPEL_CD = B.CMDT_CLSF_SPEL_CD
          START WITH A.MAFC_CO_NIF = #{mafcCoNif}
          AND   A.CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
          CONNECT BY PRIOR A.CMDT_CLSF_SPEL_CD = A.PRENT_CMDT_CLSF_SPEL_CD
          AND PRIOR A.MAFC_CO_NIF = A.MAFC_CO_NIF
          ) B
    WHERE B.RNUM = A.RNUM
    GROUP BY B.RNUM
           , B.CMDT_CLSF_SPEL_CD_NM
           , B.CMDT_CLSF_SPEL_CD
           , B.HS_CD
           , B.UT_BPRDC_RQTY
           , B.RWMS_BPRDC_TP_CD
           , B.QTY_UT_CD
           , B.LEN
           , B.PRENT_CMDT_CLSF_SPEL_CD
    ORDER BY B.RNUM ASC
  </select>

  <!--
    Consultation du code spécifique (pop-up) !== 특별코드조회(팝업) ==!
    (Song JunYoung)
    -->
  <select id="selectSpelCdList" parameterType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo" resultType="alpass.ipt.clr.pfp.pfp.vo.ClrCsclInctFfmnBrngCmdtSpelCdMgmtVo">
    /* selectSpelCdList */
    <include refid="pagination.header" ></include>
	SELECT A.MAFC_CO_NIF
	     , A.CMDT_CLSF_SPEL_CD
	     , A.CMDT_CLSF_SPEL_CD_NM
	     , A.MAFC_CMDT_TP_CD
	     , A.HS_CD
	     , A.QTY_UT_CD
	     , (SELECT CO_NM FROM TB_COM_CO WHERE NIF = A.MAFC_CO_NIF ) AS MAFC_CO_NM
	     , FN_GET_CD_VDVAL_NM('CLR_0047', A.MAFC_CMDT_TP_CD, #{langCd}) AS MAFC_CMDT_TP_NM
    FROM   TB_CLRI_MFCM_CLSF_SPEL_CD A
	WHERE  A.DEL_YN = 'N'
	AND    A.USE_YN = 'Y'
	<if test="mafcCoNif != null and mafcCoNif != ''">
	AND    A.MAFC_CO_NIF = #{mafcCoNif}
	</if>
	<if test="cmdtClsfSpelCd != null and cmdtClsfSpelCd != ''">
	AND    A.CMDT_CLSF_SPEL_CD = #{cmdtClsfSpelCd}
	</if>
	<if test="cmdtClsfSpelCdNm != null and cmdtClsfSpelCdNm != ''">
	AND    A.CMDT_CLSF_SPEL_CD_NM = #{cmdtClsfSpelCdNm}
	</if>
	<if test="selTpCd != null and selTpCd != ''">
	  <choose>
	   	<when test="'10'.equals(selTpCd)">
	    AND    A.MAFC_CMDT_TP_CD IN ('10', '11', '20')
	   	</when>
	   	<when test="'20'.equals(selTpCd)">
	    AND    A.MAFC_CMDT_TP_CD IN ('20', '30')
	   	</when>
	   	<when test="'11'.equals(selTpCd)">
	    AND    A.MAFC_CMDT_TP_CD IN ('11')
	    </when>
	    <when test="'30'.equals(selTpCd)">
	    AND    A.MAFC_CMDT_TP_CD IN ('30')
	   	</when>
	  </choose>
	</if>
    ORDER BY A.MAFC_CMDT_TP_CD, A.CMDT_CLSF_SPEL_CD
    <include refid="pagination.footer" ></include>
  </select>
  <!-- 통관미이행반입물품 사후관리 End -->
</mapper>

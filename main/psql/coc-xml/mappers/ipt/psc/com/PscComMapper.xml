<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!--
세금코드관리
@Author : Shin-Hyun Woo
-->
<mapper namespace="alpass.ipt.psc.com.mapper.PscComMapper">


	<select id="selectQtyUtCdList" parameterType="alpass.com.code.vo.ComHsCdVo" resultType="alpass.ipt.psc.com.vo.ClrItemInfVo">
		SELECT
			ITEM,
			ITEM_NM,
			ITEM_LABEL
		FROM
			(
				select   RANK() OVER(ORDER BY A.hs_aply_strt_dt DESC) RN,
						 A.qty_ut_cd AS ITEM,
						 fn_get_cd_vdval_nm('COM_0018', A.qty_ut_cd, #{langCd}) AS ITEM_NM,
						 fn_get_cd_vdval_nm('COM_0018', A.qty_ut_cd, #{langCd}) AS ITEM_LABEL
				from tb_clri_hs_cd A
				where A.del_yn = 'N'
				  AND A.hs_cd = #{hsCd}
				UNION
				select   RANK() OVER(ORDER BY B.hs_aply_strt_dt DESC) RN,
						 B.qty_ut_cd AS ITEM,
						 fn_get_cd_vdval_nm('COM_0018', B.qty_ut_cd, #{langCd}) AS ITEM_NM,
						 fn_get_cd_vdval_nm('COM_0018', B.qty_ut_cd, #{langCd}) AS ITEM_LABEL
				from tb_clri_hs_cd A, tb_clri_hs_qty_ut_cd B
				where A.hs_cd = B.hs_cd
				  AND A.hs_aply_strt_dt = B.hs_aply_strt_dt
				  AND A.del_yn = 'N' AND B.del_yn = 'N' AND B.use_yn = 'Y'
				  AND A.hs_cd = #{hsCd}
			)WHERE RN = 1
	</select>

	<!--
        @TODO:번역필요 !==HS코드에 따른 자동차여부 조회 ==!
        (Kim Kiryong)
    -->
	<select id="selectVhclYn" parameterType="alpass.com.code.vo.ComHsCdVo" resultType="java.lang.String">
		/** ClreCom_selectVhclYn */
		SELECT
			'Y' AS vhclYn
		FROM TB_CLRI_HS_PRFL
		WHERE DEL_YN = 'N'
		  AND USE_YN = 'Y'
		  AND HS_UPR_CLSF_CD = 'V'
		  AND HS_LWPR_CLSF_CD = 'V'
		  AND HS_CD = #{hsCd}
	</select>

	<select id="selectMsgTranslate" parameterType="alpass.ipt.psc.com.vo.ClrComMsgLangVo" resultType="alpass.ipt.psc.com.vo.ClrComMsgLangVo">
		/** selectMsgTranslate : 메시지 아이디로 메시지 정보를 조회하여 반환 **/
		SELECT
			MSG_ID
			 , LANG_CD
			 , MSG_NM
			 , DEL_YN
		FROM	TB_COM_MSG_LANG
		WHERE	LANG_CD = #{langCd}
		  AND		MSG_ID = #{msgId}
	</select>

	<select id="selectTaxCd" parameterType="alpass.ipt.psc.com.vo.ClrTaxCdVo" resultType="alpass.ipt.psc.com.vo.ClrTaxCdVo">
		/** selectTaxCd  세금 코드 조회*/
		<include refid="pagination.header" />
		SELECT
		A.TAX_CD                     /** Code De Taxe !== 세금코드 ==! */
		, NVL((SELECT TAX_CLCU_BASE_CN FROM TB_CLRI_TAX_CLCU_BASE WHERE TAX_CD = A.TAX_CD AND USE_YN = 'Y' AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN APLY_STRT_DT AND APLY_END_DT),(SELECT TAX_CLCU_BASE_CN FROM TB_CLRI_TAX_CLCU_BASE WHERE TAX_CD = A.TAX_CD AND USE_YN = 'Y' ORDER BY BASE_SRNO DESC LIMIT 1))  TAX_CLCU_BASE_CN
		, A.TAX_CD_NM                  /** Nom Du Code De Taxe !== 세금코드명 ==! */
		, A.TAX_CTGY_CD                /** Code De Catégorie De Taxe !== 세금카테고리코드 ==! */
		, (SELECT CD_VDVAL_NM FROM TB_COM_COMN_CD_D_LANG WHERE COMN_CD = 'CLR_0058' AND LANG_CD = #{langCd} AND CD_VDVAL = A.TAX_CTGY_CD) TAX_CTGY_NM
		, A.BDGT_CD                    /** Code De Budget !== 예산코드 ==! */
		, A.BDGT_DTL_NO                /** N° De Ligne Budgétaire !== 예산상세번호 ==! */
		, A.APLY_PROR_RNK              /** Priorité de l'application !== 적용우선순위 ==! */
		, A.USE_YN                     /** Utilisé ON !== 사용여부 ==! */
		, NVL((SELECT LSPR_TXBS_CN FROM TB_CLRI_TAX_CLCU_BASE C WHERE C.TAX_CD = A.TAX_CD AND TO_DATE(TO_CHAR(SYSTIMESTAMP,'YYYYMMDD'),'YYYYMMDD') BETWEEN TO_DATE(APLY_STRT_DT,'YYYYMMDD') AND TO_DATE(APLY_END_DT,'YYYYMMDD') ORDER BY BASE_SRNO DESC LIMIT 1),(SELECT LSPR_TXBS_CN FROM TB_CLRI_TAX_CLCU_BASE C WHERE C.TAX_CD = A.TAX_CD ORDER BY BASE_SRNO DESC LIMIT 1))  LSPR_TXBS_CN
		, NVL((SELECT CRLN_TXBS_CN FROM TB_CLRI_TAX_CLCU_BASE C WHERE C.TAX_CD = A.TAX_CD AND TO_DATE(TO_CHAR(SYSTIMESTAMP,'YYYYMMDD'),'YYYYMMDD') BETWEEN TO_DATE(APLY_STRT_DT,'YYYYMMDD') AND TO_DATE(APLY_END_DT,'YYYYMMDD') ORDER BY BASE_SRNO DESC LIMIT 1),(SELECT CRLN_TXBS_CN FROM TB_CLRI_TAX_CLCU_BASE C WHERE C.TAX_CD = A.TAX_CD ORDER BY BASE_SRNO DESC LIMIT 1))  CRLN_TXBS_CN
		FROM  TB_CLRI_TAX_CD A
		WHERE		USE_YN = 'Y'
		AND			DEL_YN = 'N'
		<if test="taxCd != null and taxCd != ''">
			AND REPLACE(TAX_CD,'.','') = REPLACE(UPPER(#{taxCd}),'.','')
		</if>
		<if test="taxCdNm != null and taxCdNm != ''">
			AND TAX_CD_NM LIKE #{taxCdNm} || '%'
		</if>
		<if test="taxCtgyCd != null and taxCtgyCd != ''">
			AND TAX_CTGY_CD = #{taxCtgyCd}
		</if>
		ORDER BY TAX_CD
		<include refid="pagination.footer" />
	</select>

	<select id="selectApcCd" parameterType="alpass.ipt.psc.com.vo.ClrApcCdVo" resultType="alpass.ipt.psc.com.vo.ClrApcCdVo">
		/** selectApcCd APC코드 조회*/
		<include refid="pagination.header" />
		SELECT
		A.APC_CD
		, A.APC_NM
		, A.PSMGT_YN
		, A.PSMGT_PRID
		, NVL(B.REGM_PERM_NEED_YN, 'N') AS REGM_PERM_NEED_YN
		, B.REGM_MDL_CD
		FROM
		TB_CLRI_APC_CD A,
		TB_CLRI_EPC_APC_CD_MPNG_BRKD B
		WHERE A.DEL_YN = 'N'
		AND B.APC_CD(+) = A.APC_CD
		AND B.DEL_YN(+) = 'N'
		<if test="psmgtYn != null and psmgtYn != ''">
			AND  A.PSMGT_YN = #{psmgtYn}
		</if>
		<if test="psmgtPrid != null and psmgtPrid != ''">
			AND  A.PSMGT_PRID = #{psmgtPrid}
		</if>
		<if test="epcCd != null and epcCd != ''">
			AND  EXISTS (
			SELECT 1 FROM TB_CLRI_EPC_APC_CD_MPNG_BRKD C
			WHERE A.APC_CD = C.APC_CD
			AND  C.EPC_CD = #{epcCd}
			AND  TO_CHAR(CURRENT_DATE, 'YYYYMMDD') BETWEEN C.MPNG_APLY_STRT_DT AND C.MPNG_APLY_END_DT  /** 신청일자 (입력조건) */
			)
		</if>
		<if test="regmPermNeedYn != null and regmPermNeedYn != ''">
			AND B.REGM_PERM_NEED_YN(+) = #{regmPermNeedYn}
		</if>
		<if test="apcCd != null and apcCd != ''">
			AND A.APC_CD = #{apcCd}
		</if>
		<if test="apcNm != null and apcNm != ''">
			AND A.APC_NM LIKE #{apcNm} || '%'
		</if>
		<if test="regmMdlCd != null and regmMdlCd != ''">
			AND B.REGM_MDL_CD = #{regmMdlCd}
		</if>
		ORDER BY A.APC_CD
		<include refid="pagination.footer" ></include>
	</select>

	<!--
		!==APC 코드 list(멀티선택) 조회 ==!
		Author: Park ByoungKyu
	-->
	<select id="selectApcCdMltList" parameterType="alpass.ipt.psc.com.vo.ClrApcCdVo" resultType="alpass.ipt.psc.com.vo.ClrApcCdVo">
		/** selectApcCdMltList APC코드 List 조회*/
		<include refid="pagination.header" />
		SELECT
		A.APC_CD
		, A.APC_NM
		, A.PSMGT_YN
		, A.PSMGT_PRID
		, NVL(B.REGM_PERM_NEED_YN, 'N') AS REGM_PERM_NEED_YN
		, B.REGM_MDL_CD
		FROM
		TB_CLRI_APC_CD A,
		TB_CLRI_EPC_APC_CD_MPNG_BRKD B
		WHERE A.DEL_YN = 'N'
		AND B.APC_CD(+) = A.APC_CD
		AND B.DEL_YN(+) = 'N'
		<if test="psmgtYn != null and psmgtYn != ''">
			AND  A.PSMGT_YN = #{psmgtYn}
		</if>
		<if test="psmgtPrid != null and psmgtPrid != ''">
			AND  A.PSMGT_PRID = #{psmgtPrid}
		</if>
		<if test="epcCd != null and epcCd != ''">
			AND  EXISTS (
			SELECT 1 FROM TB_CLRI_EPC_APC_CD_MPNG_BRKD C
			WHERE A.APC_CD = C.APC_CD
			AND  C.EPC_CD = #{epcCd}
			AND  TO_CHAR(CURRENT_DATE, 'YYYYMMDD') BETWEEN C.MPNG_APLY_STRT_DT AND C.MPNG_APLY_END_DT  /** 신청일자 (입력조건) */
			)
		</if>
		<if test="regmPermNeedYn != null and regmPermNeedYn != ''">
			AND B.REGM_PERM_NEED_YN(+) = #{regmPermNeedYn}
		</if>
		<if test="apcCd != null and apcCd != ''">
			AND A.APC_CD = #{apcCd}
		</if>
		<if test="apcNm != null and apcNm != ''">
			AND A.APC_NM LIKE #{apcNm} || '%'
		</if>
		<if test="regmMdlCd != null and regmMdlCd != ''">
			AND B.REGM_MDL_CD = #{regmMdlCd}
		</if>
		ORDER BY A.APC_CD
		<include refid="pagination.footer" />
	</select>

	<!--
        !==input APC 코드 list 조회 ==!
        Author: Park ByoungKyu
    -->
	<select id="selectInputApcCdList" parameterType="alpass.ipt.psc.com.vo.ClrApcCdVo" resultType="alpass.ipt.psc.com.vo.ClrApcCdVo">
		/** selectInputApcCdList : input APC 코드 List 조회*/
		SELECT
				APC_CD                     /** Code APC !== APC코드 ==! */
			  , APC_NM                     /** Nom de l'APC !== APC명 ==! */
		FROM	TB_CLRI_APC_CD
		WHERE 	DEL_YN = 'N'
		<choose>
			<when test="!apcCdSet.isEmpty()">
				AND APC_CD IN
				<foreach collection="apcCdSet" item="apcCd" index="index" separator="," open="(" close=")">
					#{apcCd}
				</foreach>
			</when>
			<otherwise>
				AND APC_CD = #{apcCd}
			</otherwise>
		</choose>
		ORDER BY APC_CD
	</select>

	<!--
        !==EPC코드 상세 조회 ==!
        Author: Kim kiryong
    -->
	<select id="selectEpcCdDetail" parameterType="alpass.ipt.psc.com.vo.ClrEpcCdVo" resultType="alpass.ipt.psc.com.vo.ClrEpcCdVo">
		/** ClriCom_selectEpcCdDetail */
		SELECT
			EPC_CD
			 , EPC_NM
			 , DCLR_PT_CD
			 , SORT_ORDR
			 , CAG_CMVL_YN
			 , EXFM_PRCS_YN
			 , TACP_RLSE_PRCS_TP_CD
			 , EPC_APLY_STRT_DT
			 , EPC_APLY_END_DT
		FROM
			TB_CLRI_EPC_CD
		WHERE DEL_YN = 'N'
		  AND EPC_CD = #{epcCd}
		  <choose>
			  <when test="epcAplyStrtDt != null and epcAplyStrtDt != ''">
				  AND EPC_APLY_STRT_DT = TO_CHAR(TO_DATE(#{epcAplyStrtDt}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  </when>
			  <otherwise>
				  AND TO_CHAR(CURRENT_DATE,'YYYYMMDD') BETWEEN EPC_APLY_STRT_DT AND EPC_APLY_END_DT
			  </otherwise>
		  </choose>
	</select>

	<select id="selectCsclPlnCdByEpc" parameterType="alpass.ipt.clr.com.vo.ClrEpcCdVo" resultType="alpass.ipt.clr.com.vo.ClrItemInfVo">
		select cscl_pln_cd as ITEM,
			   FN_GET_CD_VDVAL_NM('CLR_0006', cscl_pln_cd, #{langCd}) as ITEM_NM
		from TB_CLRI_DED_VRFC where epc_cd = #{epcCd} and DEL_YN = 'N';
	</select>

	<select id="selectEpcCd" parameterType="alpass.ipt.psc.com.vo.ClrEpcCdVo" resultType="alpass.ipt.psc.com.vo.ClrEpcCdVo">
		/** selectEpcCd : EPC코드 조회*/
		<include refid="pagination.header" />
		SELECT
		A.EPC_CD                     /** Code EPC !== EPC코드 ==! */
		, A.EPC_NM                     /** Nom de l'EPC !== EPC명 ==! */
		, A.DCLR_PT_CD                 /** Code de type de déclaration !== 신고유형코드 ==! */
		, A.CAG_CMVL_YN                /** Contrôle Manifeste On !== 화물대사여부 ==! */
		, A.EXFM_PRCS_YN               /** Apurement D'Exportation On !== 수출이행처리여부 ==! */
		, A.TACP_RLSE_PRCS_TP_CD       /** Code De Division Entre Le Traitement Au Niveau De L'Autorisation D'Enlèvement Et Le Traitement !== 수리시반출처리구분코드(CLR_0072) ==! */
		, CASE A.DCLR_PT_CD WHEN 'IM5' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0002')
		WHEN 'IM7' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0004')
		WHEN 'END' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0005')
		WHEN 'EX2' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0003')
		WHEN 'ZFI' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0006')
		WHEN 'ZFE' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0006')
		ELSE CASE A.EPC_CD WHEN 'EPCXXX' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0011')
		ELSE 0 END
		END AS PSMGT_FFMN_XPIR_PRID
		, TO_CHAR(TO_DATE(EPC_APLY_STRT_DT, 'YYYYMMDD'), 'DD/MM/YYYY') EPC_APLY_STRT_DT
		, TO_CHAR(TO_DATE(EPC_APLY_END_DT, 'YYYYMMDD'), 'DD/MM/YYYY') EPC_APLY_END_DT
		FROM
		TB_CLRI_EPC_CD A
		WHERE A.DEL_YN = 'N'
		<if test='currentYn == null or !currentYn.equals("Y")'>
			AND TO_CHAR(CURRENT_DATE,'YYYYMMDD') BETWEEN EPC_APLY_STRT_DT AND EPC_APLY_END_DT
		</if>
		<if test="dclrPtCd != null and dclrPtCd != ''">
			AND   A.DCLR_PT_CD = #{dclrPtCd}
		</if>
		<if test="epcCd != null and epcCd != ''">
			AND   A.EPC_CD LIKE #{epcCd} || '%'
		</if>
		<if test="epcNm != null and epcNm != ''">
			AND   A.EPC_NM LIKE #{epcNm} || '%'
		</if>
		<if test="dclrPtCds != null and dclrPtCds.size() != 0">
			AND A.DCLR_PT_CD IN
			<foreach collection="dclrPtCds" item="item" index="index" separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		ORDER BY A.SORT_ORDR
		<include refid="pagination.footer" />
	</select>

	<!--
        !==EPC 코드 list(멀티선택) 조회 ==!
        Author: Park ByoungKyu
    -->
	<select id="selectEpcCdMltList" parameterType="alpass.ipt.psc.com.vo.ClrEpcCdVo" resultType="alpass.ipt.psc.com.vo.ClrEpcCdVo">
		/** selectEpcCdMltList : EPC 코드 List 조회*/
		<include refid="pagination.header" />
		SELECT
		A.EPC_CD                     /** Code EPC !== EPC코드 ==! */
		, A.EPC_NM                     /** Nom de l'EPC !== EPC명 ==! */
		, A.DCLR_PT_CD                 /** Code de type de déclaration !== 신고유형코드 ==! */
		, A.CAG_CMVL_YN                /** Contrôle Manifeste On !== 화물대사여부 ==! */
		, A.EXFM_PRCS_YN               /** Apurement D'Exportation On !== 수출이행처리여부 ==! */
		, A.TACP_RLSE_PRCS_TP_CD       /** Code De Division Entre Le Traitement Au Niveau De L'Autorisation D'Enlèvement Et Le Traitement !== 수리시반출처리구분코드(CLR_0072) ==! */
		, CASE A.DCLR_PT_CD WHEN 'IM5' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0002')
		WHEN 'IM7' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0004')
		WHEN 'END' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0005')
		WHEN 'EX2' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0003')
		WHEN 'ZFI' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0006')
		WHEN 'ZFE' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0006')
		ELSE CASE A.EPC_CD WHEN 'EPCXXX' THEN (SELECT TO_NUMBER(prmt_val_cn) FROM tb_com_prmt WHERE prmt_id = 'CLR_0011')
		ELSE 0 END
		END AS PSMGT_FFMN_XPIR_PRID
		, TO_CHAR(TO_DATE(EPC_APLY_STRT_DT, 'YYYYMMDD'), 'DD/MM/YYYY') EPC_APLY_STRT_DT
		, TO_CHAR(TO_DATE(EPC_APLY_END_DT, 'YYYYMMDD'), 'DD/MM/YYYY') EPC_APLY_END_DT
		FROM
		TB_CLRI_EPC_CD A
		WHERE A.DEL_YN = 'N'
		AND TO_CHAR(CURRENT_DATE,'YYYYMMDD') BETWEEN EPC_APLY_STRT_DT AND EPC_APLY_END_DT
		<if test="dclrPtCd != null and dclrPtCd != ''">
			AND   A.DCLR_PT_CD = #{dclrPtCd}
		</if>
		<if test="epcCd != null and epcCd != ''">
			AND   A.EPC_CD LIKE #{epcCd} || '%'
		</if>
		<if test="epcNm != null and epcNm != ''">
			AND   A.EPC_NM LIKE #{epcNm} || '%'
		</if>
		ORDER BY A.SORT_ORDR
		<include refid="pagination.footer" />
	</select>

	<!--
        !==input EPC 코드 list 조회 ==!
        Author: Park ByoungKyu
    -->
	<select id="selectInputEpcCdList" parameterType="alpass.ipt.psc.com.vo.ClrEpcCdVo" resultType="alpass.ipt.psc.com.vo.ClrEpcCdVo">
		/** selectInputEpcCdList : input EPC 코드 List 조회*/
		SELECT
			    EPC_CD                     /** Code EPC !== EPC코드 ==! */
			  , EPC_NM                     /** Nom de l'EPC !== EPC명 ==! */
		FROM	TB_CLRI_EPC_CD
		WHERE 	DEL_YN = 'N'
		AND TO_CHAR(CURRENT_DATE,'YYYYMMDD') BETWEEN EPC_APLY_STRT_DT AND EPC_APLY_END_DT
		<choose>
			<when test="!epcCdSet.isEmpty()">
				AND EPC_CD IN
				<foreach collection="epcCdSet" item="epcCd" index="index" separator="," open="(" close=")">
					#{epcCd}
				</foreach>
			</when>
			<otherwise>
				AND EPC_CD = #{epcCd}
			</otherwise>
		</choose>
		ORDER BY EPC_CD
	</select>

	<!--
        !==동적 통관계획 목록 조회 ==!
        (Kim Kiryong)
    -->
	<select id="selectDedVrfcList" resultType="alpass.ipt.psc.vhcl.pdr.dre.vo.ClrDedComnDcshVo">
		SELECT
			EPC_CD
			 , SUBSTR(MAX(RPAD(LEVEL, 5) || SYS_CONNECT_BY_PATH(CSCL_PLN_CD, ', ')), 8) AS CSCL_PLN_CD
		FROM (
				 SELECT
					 EPC_CD, CSCL_PLN_CD, row_number() OVER(PARTITION BY EPC_CD ORDER BY CSCL_PLN_CD) AS RN
				 FROM TB_CLRI_DED_VRFC
				 WHERE DEL_YN = 'N'
			 )
				 CONNECT BY PRIOR RN = RN - 1
        AND PRIOR EPC_CD = EPC_CD
		GROUP BY EPC_CD
	</select>

	<select id="selectDedVrfcBase" parameterType="alpass.ipt.psc.com.vo.ClrDedVrfcBaseVo" resultType="alpass.ipt.psc.com.vo.ClrDedVrfcBaseVo">
		/** selectDedVrfcBase : 동적 필수 컬럼 조회*/
		SELECT
		EPC_CD
		, TRGT_TBL_NM
		, TRGT_COL_NM
		, lower(substr(replace(initcap(TRGT_COL_NM),'_'),1,1)) || substr(replace(initcap(TRGT_COL_NM),'_'),2,99) AS TRGT_COL_NM_CVT
		, ESNT_INP_VRFC_YN
		, USE_YN
		, CLUS_LEN_VRFC_YN
		, CLUS_LEN
		FROM
		TB_CLRI_DED_VRFC_BASE
		WHERE DEL_YN = 'N'
		<if test="epcCd != null and epcCd != ''">
			AND   EPC_CD = #{epcCd}
		</if>
		ORDER BY EPC_CD
	</select>

	<!--
		 @TODO:번역필요 * SQL 설명 : 보세창고코드 조회 / 물품위치코드 조회
		 (Kim Kiryong)
	 -->
	<select id="selectBnbnWrhsCdList" parameterType="alpass.com.co.vo.ComWrhsVo" resultType="alpass.com.co.vo.ComWrhsVo">
		SELECT
		*
		FROM tb_cari_ibobz
		WHERE DEL_YN = 'N'
		<if test="ibobzTpCd != null and ibobzTpCd != ''">
			AND    WRHS_TP_CD IN ( ${wrhsTpCd} )
		</if>
	</select>

	<select id="selectTaxCdDtl" parameterType="alpass.ipt.psc.com.vo.ClrTaxCdVo" resultType="alpass.ipt.psc.com.vo.ClrTaxCdVo">
		/** selectTaxCdDtl : 세금코드 정보 조회 **/
		SELECT
			A.TAX_CD                     /** Code De Taxe !== 세금코드 ==! */
			 , A.TAX_CD_NM                  /** Nom Du Code De Taxe !== 세금코드명 ==! */
			 , A.TAX_CLCU_BASE_CN
			 , A.TAX_CTGY_CD                /** Code De Catégorie De Taxe !== 세금카테고리코드 ==! */
			 , (
			SELECT
				CD_VDVAL_NM
			FROM		TB_COM_COMN_CD_D_LANG
			WHERE		COMN_CD = 'CLR_0058'
			  AND			LANG_CD = #{langCd}
			  AND			CD_VDVAL = A.TAX_CTGY_CD
		) TAX_CTGY_NM
			 , A.BDGT_CD                    /** Code De Budget !== 예산코드 ==! */
			 , (
			SELECT
				CD_VDVAL_NM
			FROM		TB_COM_COMN_CD_D_LANG
			WHERE		COMN_CD = 'COL_0028'
			  AND			LANG_CD = #{langCd}
			  AND			CD_VDVAL = A.BDGT_CD
		) BDGT_NM
			 , A.BDGT_DTL_NO                /** N° De Ligne Budgétaire !== 예산상세번호 ==! */
			 , A.USE_YN
			 , (
			SELECT
				CD_VDVAL_NM
			FROM		TB_COM_COMN_CD_D_LANG
			WHERE		COMN_CD = 'COM_0016'
			  AND			LANG_CD = #{langCd}
			  AND			CD_VDVAL = A.USE_YN
		) USE_YN_NM
			 , A.DEL_YN
			 , A.APLY_PROR_RNK              /** Priorite de l'application !== 적용우선순위 ==! */
			 , A.LSPR_TXBS_CN
			 , A.CRLN_TXBS_CN
			 , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
			 , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
			 , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
			 , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
		FROM (
				 SELECT
					 A.TAX_CD                     /** Code De Taxe !== 세금코드 ==! */
					  , A.TAX_CD_NM                  /** Nom Du Code De Taxe !== 세금코드명 ==! */
					  , NVL((SELECT TAX_CLCU_BASE_CN FROM TB_CLRI_TAX_CLCU_BASE WHERE TAX_CD = A.TAX_CD AND USE_YN = 'Y' AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN APLY_STRT_DT AND APLY_END_DT ORDER BY BASE_SRNO DESC LIMIT 1),(SELECT TAX_CLCU_BASE_CN FROM TB_CLRI_TAX_CLCU_BASE WHERE TAX_CD = A.TAX_CD AND USE_YN = 'Y' ORDER BY BASE_SRNO DESC LIMIT 1))  TAX_CLCU_BASE_CN
					  , A.TAX_CTGY_CD                /** Code De Catégorie De Taxe !== 세금카테고리코드 ==! */
					  , A.BDGT_CD                    /** Code De Budget !== 예산코드 ==! */
					  , A.BDGT_DTL_NO                /** N° De Ligne Budgétaire !== 예산상세번호 ==! */
					  , A.USE_YN
					  , A.DEL_YN
					  , A.APLY_PROR_RNK              /** Priorite de l'application !== 적용우선순위 ==! */
					  , NVL((SELECT LSPR_TXBS_CN FROM TB_CLRI_TAX_CLCU_BASE C WHERE C.TAX_CD = A.TAX_CD AND USE_YN = 'Y' AND TO_DATE(TO_CHAR(SYSTIMESTAMP,'YYYYMMDD'),'YYYYMMDD') BETWEEN TO_DATE(APLY_STRT_DT,'YYYYMMDD') AND TO_DATE(APLY_END_DT,'YYYYMMDD') ORDER BY BASE_SRNO DESC LIMIT 1),(SELECT LSPR_TXBS_CN FROM TB_CLRI_TAX_CLCU_BASE C WHERE C.TAX_CD = A.TAX_CD AND USE_YN = 'Y' ORDER BY BASE_SRNO DESC LIMIT 1))  LSPR_TXBS_CN
					  , NVL((SELECT CRLN_TXBS_CN FROM TB_CLRI_TAX_CLCU_BASE C WHERE C.TAX_CD = A.TAX_CD AND USE_YN = 'Y' AND TO_DATE(TO_CHAR(SYSTIMESTAMP,'YYYYMMDD'),'YYYYMMDD') BETWEEN TO_DATE(APLY_STRT_DT,'YYYYMMDD') AND TO_DATE(APLY_END_DT,'YYYYMMDD') ORDER BY BASE_SRNO DESC LIMIT 1),(SELECT CRLN_TXBS_CN FROM TB_CLRI_TAX_CLCU_BASE C WHERE C.TAX_CD = A.TAX_CD AND USE_YN = 'Y' ORDER BY BASE_SRNO DESC LIMIT 1))  CRLN_TXBS_CN
					  , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
					  , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
					  , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
					  , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
				 FROM		TB_CLRI_TAX_CD A
				 WHERE		A.DEL_YN = 'N'
			 ) A
		WHERE 	A.TAX_CD = #{taxCd}
	</select>

	<select id="selectOrgnInfoCnt" parameterType="alpass.ipt.psc.com.vo.ClrComOrgnInfoVo" resultType="int">
		/** ClriCom_selectOrgnInfoCnt */
		SELECT COUNT(A.ORGN_CD)
		FROM   TB_POTI_ORGN A
		WHERE  A.DEL_YN = 'N'
		<if test="orgnMgmtCd != null and orgnMgmtCd != ''">
			AND   A.ORGN_MGMT_CD = #{orgnMgmtCd}
		</if>
		<if test="orgnCd != null and orgnCd != ''">
			AND    A.ORGN_CD = #{orgnCd}
		</if>
		<if test="uprOrgnCd != null and uprOrgnCd != ''">
			AND    A.UPR_ORGN_MGMT_CD = (SELECT ORGN_MGMT_CD FROM TB_POTI_ORGN WHERE ORGN_CD = #{uprOrgnCd} AND DEL_YN = 'N')
		</if>
	</select>

	<!--
    @TODO 번역필요
    !== 라벨ID에 대한 라벨명 조회 ==!
    -->
	<select id="selectLblNm" parameterType="hashMap" resultType="java.lang.String">
		SELECT LBL_NM
		FROM TB_COM_LBL_LANG
		WHERE LBL_ID  = #{lblId}
		  AND LANG_CD = #{langCd}
		  AND DEL_YN  = 'N'
	</select>

	<!-- 선적지 하역지 명 조회   -->
	<select id="selectRegnNm" parameterType="alpass.com.code.vo.ComRegnCdVo" resultType="java.lang.String">
		SELECT
			B.REGN_NM
		FROM TB_COM_REGN_CD A, TB_COM_REGN_CD_LANG B
		WHERE A.REGN_CD = B.REGN_CD
		  AND   A.DEL_YN = 'N'
		  AND   B.DEL_YN = 'N'
		  AND   A.REGN_CD = #{regnCd}
		  AND   A.regn_tp_cd = B.regn_tp_cd
		  AND   B.LANG_CD =  #{langCd}
		<if test="regnTpCd != null and regnTpCd != ''">
		  <![CDATA[
			AND B.regn_tp_cd = #{regnTpCd}
			]]>
		</if>
	</select>

	<!--
		 @TODO:번역필요 !==환율리스트  조회 ==!
	 -->
	<select id="selectFxrtList" resultType="alpass.com.code.vo.ComBaseFxrtVo">
		SELECT TO_CHAR(TO_DATE(A.APLY_BGN_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS APLY_BGN_DT
			 , TO_CHAR(TO_DATE(A.APLY_END_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS APLY_END_DT
			 , B.CURR_CD
			 , FN_GET_CURR_NM(B.CURR_CD, #{langCd}) AS CURR_NM
			 , (SELECT RPRS_CNTY_CD FROM TB_COM_CURR_CD WHERE CURR_CD = B.CURR_CD) AS RPRS_CNTY_CD
			 , B.sel_amt
			 , B.buy_amt
			 , B.FXRT
		 FROM  TB_COM_FXRT A, TB_COM_FXRT_D B
		WHERE  A.RGSR_DT = B.RGSR_DT
		  AND  A.SRNO = B.SRNO
		  AND  A.DEL_YN = 'N'
		  AND  B.DEL_YN = 'N'
		  AND  B.FXRT_TP_CD = '01'
		  AND  (A.RGSR_DT, A.SRNO) = ( 	SELECT RGSR_DT
		  									 , (SELECT MAX(SRNO) FROM TB_COM_FXRT A WHERE A.RGSR_DT = B.RGSR_DT) AS SRNO
										FROM (SELECT MAX(RGSR_DT) AS RGSR_DT
												FROM TB_COM_FXRT WHERE DEL_YN = 'N'
												 AND XTRN_OFR_YN = 'Y'
										<choose>
											<when test="aplyBgnDt != null and aplyBgnDt != ''">
												 AND APLY_BGN_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE(REPLACE(#{aplyBgnDt}, '/', ''), 'DDMMYYYY'), 'YYYYMMDD')
											  ) B
											</when>
											<otherwise>
												 AND APLY_BGN_DT <![CDATA[ <= ]]> TO_CHAR(systimestamp(), 'YYYYMMDD')
											  ) B
											</otherwise>
										</choose>
									  )

		ORDER BY CURR_CD
	</select>

	<!--
      Consultation de l'existence O/N de sous position tarifaire !== HS코드 존재여부조회 ==!
      (Song JunYoung)
      -->
	<select id="selectExstHsCd" parameterType="alpass.ipt.psc.com.vo.ComHscdVo" resultType="alpass.ipt.psc.com.vo.ComHscdVo">
		/*ClriCom_selectExstHsCd*/
		SELECT HS_CD
				 , HS_APLY_STRT_DT
				 , HS_APLY_END_DT
				 , HS_CLSF_CD
				 , UPR_HS_CD
				 , UPR_HS_APLY_STRT_DT
				 , HS_DESC
				 , QTY_UT_CD QTY_UT1_CD
				 , BRND_NM_WRTE_YN
				 , INGR_WRTE_YN
				 , MRKT_PRC_CD
				 , DPRC_RT
				 , LAST_YN
		FROM   TB_CLRI_HS_CD
		WHERE  DEL_YN = 'N'
		  	<choose>
				<when test="hsAplyStrtDt != null and hsAplyStrtDt != '' and hsAplyEndDt != null and hsAplyEndDt != ''">
					AND  <![CDATA[HS_APLY_STRT_DT <= TO_CHAR(TO_DATE(#{hsAplyStrtDt}, 'DD/MM/YYYY'), 'YYYYMMDD') AND TO_CHAR(TO_DATE(#{hsAplyEndDt}, 'DD/MM/YYYY'), 'YYYYMMDD') <= HS_APLY_END_DT ]]>
				</when>
		  		<otherwise>
					AND    TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN HS_APLY_STRT_DT AND HS_APLY_END_DT
				</otherwise>
			</choose>

			AND    HS_CD = #{hsCd}
	</select>

	<select id="selectComCoDclrCdUserRel" parameterType="String" resultType="alpass.ipt.psc.com.vo.ClrUsrDclrInfoVo">

		SELECT
			A.NIF                        /** @TODO : 번역필요 !== 사업자등록번호 ==! */
			 , A.CO_DCLR_CD                 /** Code De Déclaration De L'Entreprise !== 업체신고코드 ==! */
			 , A.USER_ID                    /** Id D'Utilisateur !== 사용자ID ==! */
			 , (select rprs_eml from TB_COM_CO where DEL_YN = 'N' AND nif = A.NIF) as rprs_eml
			 , (select rprs_tlph_no from TB_COM_CO where DEL_YN = 'N' AND nif = A.NIF) as rprs_tlph_no
			 ,(SELECT CO_DCLR_TP_CD FROM TB_COM_CO_DCLR_CD C WHERE C.CO_DCLR_CD = A.CO_DCLR_CD AND C.NIF = A.NIF) AS CO_DCLR_TP_CD
			 , (SELECT COUNT(*) FROM TB_CLRE_DED_COMN B WHERE B.DCER_CD = A.CO_DCLR_CD) + 1 as DCLR_NM
		FROM   TB_COM_CO_DCLR_CD_USER_REL A
		WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
		  AND  A.USER_ID = #{userId}                       /** Id D'Utilisateur !== 사용자ID ==! */
	</select>

	<select id="selectClrDclrcdUserId" parameterType="String" resultType="alpass.ipt.psc.com.vo.ClrUsrDclrInfoVo">

">
		/** selectClrDclrcdUserId*/
		SELECT
			A.NIF                        /** @TODO : 번역필요 !== 사업자등록번호 ==! */
			 , A.CO_DCLR_CD                 /** Code De Déclaration De L'Entreprise !== 업체신고코드 ==! */
			 , A.USER_ID                    /** Id D'Utilisateur !== 사용자ID ==! */
			 , C.CO_DCLR_TP_CD
		FROM   TB_COM_CO_DCLR_CD_USER_REL A
		   	LEFT OUTER JOIN TB_COM_CO_DCLR_CD C
		ON (A.CO_DCLR_CD =C.CO_DCLR_CD AND  A.NIF = C.NIF )
		WHERE  A.DEL_YN = 'N'  /** Suppression ON !== 삭제여부 ==! */
		  AND  A.CO_DCLR_CD = #{coDclrCd}  /** Code De Déclaration De L'Entreprise !== 업체신고코드 ==! */
		  AND  C.CO_DCLR_TP_CD = 'H'
		  LIMIT 1
	</select>


    <!--
    @TODO:번역필요 !== 협정 코드명 조회 ==!
    (Kim Jaeki)
    -->
    <select id="selectCnvnCdDesc" parameterType="alpass.ipt.psc.com.vo.ClrCnvnCdVo" resultType="alpass.ipt.psc.com.vo.ClrCnvnCdVo">
        /** selectCnvnDesc */
        SELECT
              CNVN_CD
            , CNVN_DESC
            , TO_CHAR(TO_DATE(CNVN_APLY_STRT_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS CNVN_APLY_STRT_DT
            , TO_CHAR(TO_DATE(CNVN_APLY_END_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS CNVN_APLY_END_DT
            , USE_YN
            , LAST_YN
        FROM  TB_CLRI_CNVN_CD
        WHERE USE_YN = 'Y'
          AND DEL_YN = 'N'
          AND LAST_YN = 'Y'
          AND CNVN_CD = #{cnvnCd}
        ORDER BY CNVN_CD
    </select>

	<!--
	@TODO 번역필요
	!== 신고인 사업자번호 조회 ==!
	-->
	<select id="selectDcerNif" parameterType="java.lang.String" resultType="java.lang.String">
		/* ClriIbnSadCom_selectDcerTin */
		SELECT
			A.NIF                        /** @TODO : 번역필요 !== 사업자등록번호 ==! */
		FROM   TB_COM_CO_DCLR_CD_USER_REL A
		WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
		  AND  A.CO_DCLR_CD = #{dcerCd}
		  AND ROWNUM = 1
	</select>

	<!--
	On voit les informations sur 'système temps'. !==시스템 시간 정보를 조회한다.==!
	Kim Kiryong
	-->
	<select id="selectDbDateTime" parameterType="java.lang.String" resultType="java.lang.String">
		SELECT TO_CHAR(SYSTIMESTAMP, #{dateType}) FROM DUAL
	</select>

	<!--
    	!== 파라미터 값 조회 ==!
     -->
	<select id="selectPrmt" parameterType="String" resultType="String">
		/** ClriCom_selectPrmt */
		SELECT PRMT_VAL_CN
		FROM TB_COM_PRMT
		WHERE PRMT_ID = #{prmtId} AND DEL_YN = 'N' AND ROWNUM = 1
	</select>

	<!--
        !==신고서의 결재 진행 중인 내역이 있는지 확인함.==!
     -->
	<select id="selectDedAprvPrcsCfrm" parameterType="alpass.ipt.psc.vhcl.pdr.dre.vo.ClrDedCnclRtrnVo" resultType="java.util.Map">
		SELECT A.*
		FROM ( /******************************************************/
				 /* 통관업무의 결재대상 업무                           */
				 /******************************************************/

				 SELECT APRV_ID, 'T_DEPT_HNOT_CHG'            AS LBL_ID FROM TB_CLRI_DEPT_CHG_BRKD        WHERE DTL_DCSH_NO = #{dtlDcshNo,jdbcType=VARCHAR} AND DEL_YN = 'N' UNION ALL   /* 부서변경 */
				 SELECT APRV_ID, 'L_EXMP_PSMGT_END'           AS LBL_ID FROM TB_CLRI_PSMGT_CONC           WHERE DTL_DCSH_NO = #{dtlDcshNo,jdbcType=VARCHAR} AND DEL_YN = 'N' UNION ALL   /* 사후관리종결 */
				 SELECT APRV_ID, 'T_FFMN_TRGT_PRID_XTNS'      AS LBL_ID FROM TB_CLRI_PSMGT_PRID_XTNS      WHERE DTL_DCSH_NO = #{dtlDcshNo,jdbcType=VARCHAR} AND DEL_YN = 'N' UNION ALL   /* 사후관리기간연장 */
				 SELECT APRV_ID, 'T_EXMP_PSMGT_INSC_LST'      AS LBL_ID FROM TB_CLRI_PSMGT_RDEX_CMDT_IPRT WHERE DTL_DCSH_NO = #{dtlDcshNo,jdbcType=VARCHAR} AND DEL_YN = 'N' UNION ALL   /* 사후관리감면 */
				 SELECT APRV_ID, 'T_SAD_DCSH_ACAP_LST'        AS LBL_ID FROM TB_CLRI_DED_ADRT             WHERE DTL_DCSH_NO = #{dtlDcshNo,jdbcType=VARCHAR} AND DEL_YN = 'N' UNION ALL   /* SAD심사결과 */
				 SELECT APRV_ID, 'T_SAD_DCSH_CNCL_INQT'       AS LBL_ID FROM TB_CLRI_DED_CLDL_CLOA        WHERE DTL_DCSH_NO = #{dtlDcshNo,jdbcType=VARCHAR} AND DEL_YN = 'N' UNION ALL   /* SAD신고취소직권취소 */
				 SELECT APRV_ID, 'T_CSCL_PSTP_RGSR'           AS LBL_ID FROM TB_CLRI_DED_CSCL_PSTP        WHERE DTL_DCSH_NO = #{dtlDcshNo,jdbcType=VARCHAR} AND DEL_YN = 'N' UNION ALL   /* SAD통관보류 */
				 SELECT APRV_ID, 'T_LOAD_PRID_XTNS_ACAP_INFM' AS LBL_ID FROM TB_CLRI_DED_EXFM_PRID_XTNS   WHERE DTL_DCSH_NO = #{dtlDcshNo,jdbcType=VARCHAR} AND DEL_YN = 'N'        /* SAD수출이행기간연장 */
			 ) A,
			 TB_POTI_APRV B
		WHERE A.APRV_ID = B.APRV_ID
		  AND B.APRV_PRCS_STTS_CD IN ('I01', 'I03')
		  AND B.DEL_YN  = 'N'
	</select>

	<!--
    Consultation du bureau de douane de l'agent connecté !== 로그인한 직원의 세관조회 ==!
    * Kim kiryong
    -->
	<select id="selectEmpCstmCd" parameterType="java.lang.String" resultType="java.lang.String">
		/** ClriCom_selectEmpCstmCd */
		SELECT A.ORGN_CD
		FROM   TB_POTI_ORGN A
		WHERE  ORGN_MGMT_CD = (SELECT CSTM_MGMT_CD FROM TB_POTI_EMP WHERE PBSR_NO = #{pbsrNo})
	</select>

	<!--
    Consultation du chef du service !== 부서장 조회 ==!
    (Song JunYoung)
    -->
	<select id="selectDeptEmpList" parameterType="java.lang.String" resultType="java.lang.String">
		/* selectDeptEmpList */
		SELECT C.PBSR_NO          /** 해당 부서장 */
		FROM   TB_CLRI_DED_COMN A
			 , TB_POTI_ORGN B1
			 , TB_POTI_ORGN B2
			 , TB_POTI_EMP C
		WHERE  A.DEL_YN = 'N'
			AND    B1.DEL_YN = 'N'
			AND    B2.DEL_YN = 'N'
			AND    A.DTL_DCSH_NO = #{dtlDcshNo}
			AND    B1.ORGN_CD = A.DCLR_CSTM_CD
			AND    B1.ORGN_TP_CD = 'INS'
			AND    B2.ORGN_CD = A.DEPT_CD
			AND    B2.ORGN_TP_CD = 'BUR'
			AND    C.CLPS_CD = '25' /**  부서장 : 25 */
			AND    C.EMP_BWRK_STTS_CD IN ('A')  /** COM_0006 직원근무상태 A:정상 */
	</select>

	<!--
    Mise à jour des informations de déchargement(code de l'emplacement des marchandises, date de déchargement, date réel de l'arrivée) pour une déclaration DED avant le déchargement !== 하역전 DED 신고서에 대한 하역정보(물품장치위치코드, 하역일자, 실제도착일자) UPDATE ==!
    -->
	<update id="updateLdunCmplInfoCsclPlnBMD" parameterType="alpass.ipt.psc.vhcl.pdr.dre.vo.ClrDedSrchVo">
		/* ClriCom_updateLdunCmplInfoCsclPlnBMD */
		UPDATE TB_CLRI_DED_COMN
		SET    CMDT_STGE_LOCT_CD  = #{cmdtStgeLoctCd}
		  , LDUN_DT            = #{ldunDt}
		  , ARVL_DT            = #{arvlDt}
		  , LAST_CHPR_ID       = #{lastChprId}
		  , LAST_CHG_DTTM      = SYSTIMESTAMP
		WHERE  DEL_YN = 'N'
		  AND    CAG_MGMT_NO = #{cagMgmtNo}
		  AND    CSCL_PLN_CD = 'BMD'            /* 통관계획(BMD:하역전신고)*/
		  AND    CMDT_STGE_LOCT_CD IS NULL      /* 하역완료처리가 되지 않는 신고건에 한함. */
		  AND    NVL(DCRD_YN, 'N') <![CDATA[ <> ]]> 'Y'   /* 차상반출은 제외 */
	</update>

	<!--
    Mise à jour des informations de déchargement(code de l'emplacement des marchandises, date de déchargement, date réel de l'arrivée) pour une déclaration DED avant le déchargement !== 하역전 DED 신고서에 대한 하역정보(물품장치위치코드, 하역일자, 실제도착일자) UPDATE ==!
    -->
	<update id="updateLdunCmplInfoCsclPlnBMDEx" parameterType="alpass.ipt.psc.vhcl.pdr.dre.vo.ClrDedSrchVo">
		/* ClriCom_updateLdunCmplInfoCsclPlnBMD */
		UPDATE ALPASSEXT.TB_CLRE_DED_COMN
		SET    CMDT_STGE_LOCT_CD  = #{cmdtStgeLoctCd}
		  , LDUN_DT            = #{ldunDt}
		  , ARVL_DT            = #{arvlDt}
		  , LAST_CHPR_ID       = #{lastChprId}
		  , LAST_CHG_DTTM      = SYSTIMESTAMP
		WHERE  DEL_YN = 'N'
		  AND    CAG_MGMT_NO = #{cagMgmtNo}
		  AND    CSCL_PLN_CD = 'BMD'            /* 통관계획(BMD:하역전신고)*/
		  AND    CMDT_STGE_LOCT_CD IS NULL      /* 하역완료처리가 되지 않는 신고건에 한함. */
		  AND    NVL(DCRD_YN, 'N') <![CDATA[ <> ]]> 'Y'   /* 차상반출은 제외 */
	</update>

	<!--
    Calcul de taux de change en convertissant d'autre code monnaie par DZD !== 타 통화코드를 DZD로 환율 계산 ==!
     -->
	<select id="selectFxrtCaltToDzd" parameterType="java.util.Map" resultType="java.math.BigDecimal">
		/* ClriCom_selectFxrtCaltToXAF */
		SELECT
		ROUND(#{fxrtAplyTrgtAmt} * B.FXRT) AS FXRT
		FROM   TB_COM_FXRT A, TB_COM_FXRT_D B
		WHERE  A.RGSR_DT = B.RGSR_DT
		AND    A.SRNO = B.SRNO
		AND    A.DEL_YN = 'N'
		AND    B.DEL_YN = 'N'
		AND    A.XTRN_OFR_YN = 'Y'
		<choose>
			<when test="fxrtAplyDt != null and fxrtAplyDt != ''">
				AND    #{fxrtAplyDt} BETWEEN A.APLY_BGN_DT AND NVL(A.APLY_END_DT, '99991231')
			</when>
			<otherwise>
				AND    TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN A.APLY_BGN_DT AND NVL(A.APLY_END_DT, '99991231')
			</otherwise>
		</choose>
		AND    B.CURR_CD = #{currCd}
	</select>

	<!--
    Consultation de la liste des produits prohibés !== 금지 물품 리스트 조회 ==!
    (Generated)
    -->
	<select id="checkPrhbCmdt" parameterType="alpass.ipt.psc.vhcl.pdr.dre.vo.ClrDedPdlsSrchVo" resultType="String">
		SELECT 'Y'
		FROM   TB_CLRI_HS_PRFL_DTL A,
		TB_CLRI_HS_PRFL B
		WHERE  A.del_yn = 'N'                /** Suppression ON !== 삭제여부 ==! */
		AND B.del_yn = 'N'
		AND A.hs_upr_clsf_cd = B.hs_upr_clsf_cd
		AND A.hs_lwpr_clsf_cd = B.hs_lwpr_clsf_cd
		AND A.hs_cd = B.hs_cd
		AND B.use_yn = 'Y'
		AND A.aply_cstm_cd = #{dclrCstmCd}
		<if test="hsPrflTpCd != null and hsPrflTpCd != ''">
			AND A.hs_prfl_tp_cd = #{hsPrflTpCd}
		</if>
		AND #{dclrDt} BETWEEN B.APLY_STRT_DT AND B.APLY_END_DT
		AND  A.hs_upr_clsf_cd = 'P'           /** Code De Classification Supérieure Du Sh !== HS상위분류코드 ==! */
		<if test="dclrTpCd != null and dclrTpCd.startsWith('IM')">
			AND  A.hs_lwpr_clsf_cd = 'P1'         /** Code De Classification Inférieure Du Sh !== HS하위분류코드 ==! */
		</if>
		<if test="dclrTpCd != null and dclrTpCd.startsWith('EX')">
			AND  A.hs_lwpr_clsf_cd = 'P2'         /** Code De Classification Inférieure Du Sh !== HS하위분류코드 ==! */
		</if>
		AND  A.hs_cd = #{hsCd}                           /** Code Sh !== HS코드 ==! */
		<if test="csclYn != null and csclYn != ''">
			AND A.cscl_yn = #{csclYn}
		</if>
		LIMIT 1
	</select>

	<!--
		 Consultation de code de région !== 지역코드명 조회 ==!
	 -->
	<select id="selectBusiComRegnCdNm" parameterType="alpass.com.code.vo.ComRegnCdVo" resultType="java.lang.String">
		/** ComBusi_selectBusiComRegnCdNm */
		SELECT
		B.REGN_NM
		FROM TB_COM_REGN_CD A, TB_COM_REGN_CD_LANG B
		WHERE A.REGN_CD = B.REGN_CD
		AND   A.DEL_YN = 'N'
		AND   B.DEL_YN = 'N'
		AND   A.REGN_CD = #{regnCd}
		AND   B.LANG_CD = #{langCd}
		<if test="cntyCd != null and cntyCd != ''">
			AND   A.CNTY_CD = #{cntyCd}
		</if>
	</select>

	<!--
        @TODO:번역필요 !==HS코드목록 조회 ==!
        (Kim Kiryong)
    -->
	<select id="selectBusiComHsCdLangList" parameterType="alpass.com.code.vo.ComHsCdVo" resultType="alpass.com.code.vo.ComHsCdVo">
		/** ClreCom_selectBusiComHsCdLangList */
		<include refid="pagination.header" ></include>
		SELECT
		HS_CD
		, TO_CHAR(TO_DATE(HS_APLY_STRT_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS HS_APLY_STRT_DT
		, TO_CHAR(TO_DATE(HS_APLY_END_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS HS_APLY_END_DT
		, HS_CLSF_CD
		, UPR_HS_CD
		, TO_CHAR(TO_DATE(UPR_HS_APLY_STRT_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS UPR_HS_APLY_STRT_DT
		, HS_DESC
		, qty_ut_cd QTY_UT1_CD
		, BRND_NM_WRTE_YN
		, INGR_WRTE_YN
		, LAST_YN
		, MRKT_PRC_CD
		, DPRC_RT
		, hs_err_pvnt_val
		, adit_tx_qty_ut_cd

		FROM TB_CLRI_HS_CD
		WHERE 1 = 1

		<if test="hsCd != null and hsCd != ''">
			AND   HS_CD LIKE #{hsCd}||'%'
		</if>

		<if test="hsAplyStrtDt != null and hsAplyStrtDt != ''">
			AND   HS_APLY_STRT_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE(#{hsAplyStrtDt}, 'DD/MM/YYYY'), 'YYYYMMDD')
		</if>

		<if test="hsAplyEndDt != null and hsAplyEndDt != ''">
			AND   HS_APLY_END_DT >= TO_CHAR(TO_DATE(#{hsAplyEndDt}, 'DD/MM/YYYY'), 'YYYYMMDD')
		</if>

		<if test="hsClsfCd != null and hsClsfCd != ''">
			AND   HS_CLSF_CD = #{hsClsfCd}
		</if>

		<if test="hsDesc != null and hsDesc != ''">
			AND   HS_DESC LIKE '%'||#{hsDesc}||'%'
		</if>

		<if test="lastYn != null and lastYn != ''">
			AND   LAST_YN = #{lastYn}
		</if>
		ORDER  BY HS_CD, HS_APLY_STRT_DT
		<include refid="pagination.footer" ></include>
	</select>

	<!--
    Consultation de l'utilisateur(l'opérateur) !== 사용자(대표) 조회 ==!
    (Cha Joowon)
    -->
	<select id="selectUserInfoByNif" parameterType="alpass.com.co.vo.ComCoUserVo" resultType="alpass.com.co.vo.ComCoUserVo">
		/* ClriCom_selectUserInfoByTin */
		SELECT
			A.NIF
			 , B.CO_NM
			 , A.USER_ID
			 , A.USER_NM
			 , A.USER_TP_CD
			 , FN_GET_CD_VDVAL_NM('COM_0031',A.USER_TP_CD, #{langCd}) AS USER_TP_NM
			 , A.NAT_CD
			 , A.GNDR_CD
			 , FN_GET_CD_VDVAL_NM('COM_0027',A.GNDR_CD, #{langCd}) AS GNDR_NM
			 , A.TLPH_NO
			 , A.EML
			 , A.USER_ADDR
		FROM  TB_COM_CO_USER A, TB_COM_CO B
		WHERE A.NIF = B.NIF
		  AND	  A.DEL_YN = 'N'
		  AND	  B.DEL_YN = 'N'
		  AND   A.NIF = #{nif}
		  AND   A.USER_TP_CD = 'R'
	</select>

	<select id="selectEmpInfoDetail" parameterType="alpass.ipt.com.user.vo.ComUserVo" resultType="alpass.ipt.com.user.vo.ComUserVo">
	/** selectEmpInfoDetail*/
	SELECT A.PBSR_NO,
		   A.EMP_NM,
		   A.EMP_NM AS NAME,
		   A.INHB_RGSR_NO,
		   A.EML,
		   A.CLPS_CD,
		   A.CLAS_CD,
		   A.GNDR_CD,
		   A.MOBL_NO,
		   A.DEPT_TLPH_NO,
		   A.ORGN_MGMT_CD,
		   A.SCTR_MGMT_CD,
		   A.CSTM_MGMT_CD AS CSTM_ORGN_MGMT_CD,
		   A.DEPT_MGMT_CD,
		   A.EMP_ADDR AS ADDR,
		   (
			   SELECT
				   SQLRSLT.EMP_STTS_CD
			   FROM (
						SELECT EMP_STTS_CD FROM TB_POTI_EMP_BWRK_STTS_HIST
						WHERE
							DEL_YN = 'N'
						  AND PBSR_NO = #{pbsrNo}
						  AND TO_CHAR(SYSTIMESTAMP, 'YYYYMMDD') BETWEEN APLY_STRT_DT AND NVL(APLY_END_DT, '99991231')

					) SQLRSLT
			   OFFSET 1 ROWS FETCH NEXT 1 ROWS ONLY
		   ) AS EMP_STTS_CD
	FROM TB_POTI_EMP A,
		 TB_POTI_EMP_ACCT B
	WHERE A.PBSR_NO = B.PBSR_NO
	  AND A.DEL_YN = 'N'
	  AND B.DEL_YN = 'N'
	  AND A.PBSR_NO = #{pbsrNo}
	</select>

	<select id="selectAprvEmpIdList"  parameterType="alpass.ipt.psc.vhcl.pdr.dre.vo.ClrDedSrchVo" resultType="string">
		WITH A AS (
			SELECT *
			FROM
			(SELECT DENSE_RANK() over(PARTITION BY  DTL_DCSH_NO  ORDER BY PRC_EV_DGCNT DESC ) RN,
			 	    A.PRC_EV_DGCNT,
					A.DTL_DCSH_NO,
					A.APRV_ID,
					A.AUDT_EMP_ID,
					C.APRV_EMP_PBSR_NO
			 FROM TB_CLRI_DED_ADRT A,
				  TB_POTI_APRV B,
				  TB_POTI_APRV_D C
			 WHERE A.APRV_ID = b.APRV_ID(+)
			   AND A.APRV_ID = c.APRV_ID(+)
			   AND A.DTL_DCSH_NO = #{dtlDcshNo}
			)WHERE RN =1
		)
		SELECT A.AUDT_EMP_ID
		FROM A
		UNION
		SELECT A.APRV_EMP_PBSR_NO
		FROM A WHERE aprv_emp_pbsr_no IS NOT NULL
	</select>

	<!--
    Consultation de l'agent de visite !== 현장검사원 조회 ==!
    (Park Byoungkyu)
    -->
	<select id="selectComEmpList" parameterType="alpass.ipt.psc.com.vo.ClrComEmpVo" resultType="alpass.ipt.psc.com.vo.ClrComEmpVo">
		/* selectComEmpList */
		<include refid="pagination.header" ></include>
		SELECT
			  CSTM_CD
			, (SELECT A.CSTM_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.CSTM_CD AND ROWNUM=1)  AS CSTM_NM
			, DEPT_CD
			, (SELECT A.DEPT_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.DEPT_CD AND ROWNUM=1)  AS DEPT_NM
			, A.EMP_NM
			, A.PBSR_NO
			, A.CLPS_NM
		FROM (
			SELECT (SELECT ORGN_CD
					FROM   TB_POTI_ORGN
					WHERE  DEL_YN = 'N'
					AND    ORGN_TP_CD = 'INS'  /**지역관할세관*/
					AND    ROWNUM = 1
					START WITH ORGN_MGMT_CD = TPE.ORGN_MGMT_CD
					CONNECT BY PRIOR UPR_ORGN_MGMT_CD = ORGN_MGMT_CD) AS CSTM_CD
				, ( SELECT ORGN_CD
					FROM   TB_POTI_ORGN
					WHERE  DEL_YN = 'N'
					AND    ORGN_TP_CD IN('BRI')  /**브리가드*/
					AND    ROWNUM = 1
					START WITH ORGN_MGMT_CD = TPE.ORGN_MGMT_CD
					CONNECT BY PRIOR UPR_ORGN_MGMT_CD = ORGN_MGMT_CD) AS DEPT_CD
				, VPRU.PBSR_NO AS INSC_EMP_ID
				, VPRU.PBSR_NO
				, TPE.EMP_NM
				, FN_GET_CD_VDVAL_NM('COM_0064', TPE.CLPS_CD, 'KO') AS CLPS_NM
			FROM  VW_POTI_ROLE_UNFC VPRU
				, TB_POTI_EMP TPE
			WHERE
				TPE.DEL_YN = 'N'
			AND VPRU.PBSR_NO = TPE.PBSR_NO
			AND FN_GET_EMP_BWRK_STTS(TPE.PBSR_NO,'Y') = 'TRUE'   /** 부재중건이 없으면 근무중 상태로 봄 */
			<if test="roleId != null and roleId != ''">
				AND VPRU.ROLE_ID = #{roleId}   /**현장검사원 권한*/
			</if>
			) A
		WHERE
			1 = 1
			<if test="cstmCd != null and cstmCd != ''">
				AND A.CSTM_CD = #{cstmCd}
			</if>
			<if test="deptCd != null and deptCd != ''">
				AND A.DEPT_CD = #{deptCd}
			</if>
			<if test="pbsrNo != null and pbsrNo != ''">
				AND A.PBSR_NO = #{pbsrNo}
			</if>
			<if test="empNm != null and empNm != ''">
				AND UPPER(A.EMP_NM) LIKE '%'||UPPER(#{empNm})||'%'
			</if>
		ORDER  BY A.PBSR_NO
		<include refid="pagination.footer" ></include>
	</select>

	<!--
   @TODO 번역필요
   !== 휴일 여부를 조회한다. ==!
   -->
	<select id="selectHldyYn" resultType="int">
		/* alpass.batch.ipt.psc.com.mapper.ClrComServiceMapper.selectHldyYn */
		SELECT COUNT(*)
		FROM TB_COM_HLDY
		WHERE DEL_YN = 'N'
		  AND BASE_DT = #{baseDt}
	</select>

	<!--
    Consultation de l'inspecteur !== 심사자 조회 ==!
    (Kim Jaeki)
    -->
	<select id="selectComAdorEmpList" parameterType="alpass.ipt.psc.com.vo.ClrComEmpVo" resultType="alpass.ipt.psc.com.vo.ClrComEmpVo">
		/* selectComAdorEmpList */
		<include refid="pagination.header" ></include>
		SELECT DISTINCT A.PBSR_NO
			, A.EMP_NM
			, ( SELECT ORGN_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD = A.SCTR_MGMT_CD ) AS SCTR_CD
			, C.ORGN_CD AS CSTM_CD
			, (SELECT C.ORGN_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = C.ORGN_CD AND ROWNUM=1)  AS CSTM_NM
			, D.ORGN_CD AS DEPT_CD
			, (SELECT D.ORGN_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = D.ORGN_CD AND ROWNUM=1) AS DEPT_NM
			, C.ORGN_NM
			, FN_GET_CD_VDVAL_NM('COM_0064', A.CLPS_CD, 'KO') AS CLPS_NM
		FROM  TB_POTI_EMP A
			, TB_POTI_EMP_AUTH B
			, TB_POTI_ORGN C
			, TB_POTI_ORGN D
		WHERE A.DEL_YN = 'N'
		AND B.DEL_YN = 'N'
		AND B.USE_YN = 'Y'
		AND C.DEL_YN = 'N'
		AND D.DEL_YN = 'N'
		AND A.PBSR_NO = B.PBSR_NO
<!--		AND C.ORGN_TP_CD = 'INS'-->
<!--		AND D.ORGN_TP_CD = 'BUR'-->
		AND A.CSTM_MGMT_CD = C.ORGN_MGMT_CD
		AND A.DEPT_MGMT_CD = D.ORGN_MGMT_CD
		AND A.EMP_BWRK_STTS_CD IN ('A') /*COM_0006 직원근무상태 A:정상*/
		<if test="roleId != null and roleId != ''">
		AND B.ROLE_ID = #{roleId}
		</if>
		<if test="cstmCd != null and cstmCd != ''">
		AND C.ORGN_CD = #{cstmCd}
		</if>
		<if test="deptCd != null and deptCd != ''">
		AND D.ORGN_CD = #{deptCd}
		</if>
		<if test="pbsrNo != null and pbsrNo != ''">
		AND A.PBSR_NO = #{pbsrNo}
		</if>
		<if test="empNm != null and empNm != ''">
		AND UPPER(A.EMP_NM) LIKE '%'||UPPER(#{empNm})||'%'
		</if>
		<if test='regmAdorYn != null and regmAdorYn != "" and regmAdorYn.equals("Y")'>
			AND A.ORGN_MGMT_CD IN
			(
			SELECT ORGN_MGMT_CD
			FROM TB_POTI_ORGN START WITH ORGN_CD = #{cstmCd}
			CONNECT BY PRIOR ORGN_MGMT_CD = UPR_ORGN_MGMT_CD AND DEL_YN='N' AND ORGN_TP_CD = 'INP'
			)
		</if>
		ORDER BY A.PBSR_NO
		<include refid="pagination.footer" ></include>
	</select>

	<!--
    Rechercher le code d'organigramme de !== 조직코드로 상위 조직의 조직코드 검색 ==!
    (Generated)
    -->
	<select id="selectUprOrgnInfo" parameterType="alpass.com.cstm.vo.ComCstmOrgnVo" resultType="alpass.com.cstm.vo.ComCstmOrgnVo">
		select * from tb_poti_orgn
		where DEL_YN = 'N' AND
				orgn_mgmt_cd = (select upr_orgn_mgmt_cd from tb_poti_orgn where DEL_YN = 'N' AND orgn_cd = #{orgnCd})
	</select>

	<select id="selectCmdtClsfSpelCdList" resultType="alpass.ipt.clr.com.vo.ClrItemInfVo">
		select cmdt_clsf_spel_cd AS ITEM, cmdt_clsf_spel_cd_nm as ITEM_NM
		from tb_clri_mfcm_clsf_spel_cd
		WHERE DEL_YN = 'N' AND USE_YN = 'Y'
	</select>

	<select id="selectUsrOwnInfo" parameterType="java.lang.String" resultType="alpass.com.co.vo.ComCoUserVo">
		select * from tb_com_co_user where user_id =(SELECT frst_regst_id FROM ALPASSINT.TB_CLRI_DED_COMN WHERE dtl_dcsh_no = #{dtlDcshNo} limit 1 )
	</select>

	<select id="selectCstmOrgnCdList"
			resultType="alpass.com.comn.vo.ComItemVo">
		SELECT ORGN_CD AS ITEM,
			   ORGN_NM AS ITEM_NM,
			   '[' || ORGN_CD || '] ' || ORGN_NM AS ITEM_LABEL
		FROM TB_POTI_ORGN
		WHERE DEL_YN = 'N'
		ORDER BY ORGN_MGMT_CD
	</select>

	<!--
        @TODO : 번역필요 !==심자사권한설정이력 등록==!
       (Park Byoungkyu)
        -->
	<insert id="insertClrAdorAuthStupHist" parameterType="alpass.ipt.psc.com.vo.ClrAdorAuthStupHistVo">
		/* insertClrAdorAuthStupHist */
		INSERT INTO TB_CLRI_ADOR_AUTH_STUP_H
	    	(
		      AUDT_EMP_ID
	    	, HIST_SRNO
	    	, ADOR_AUTH_TP_CD
	    	, AUTH_ATHZ_CD
	    	, CSTM_CD
	    	, DEPT_CD
	    	, DEL_YN
	    	, FRST_REGST_ID
	    	, FRST_RGSR_DTTM
	    	, LAST_CHPR_ID
	    	, LAST_CHG_DTTM
	    	)
		VALUES
	    	(
		      #{audtEmpId}
	    	, (SELECT NVL(MAX(HIST_SRNO)+1,1) FROM TB_CLRI_ADOR_AUTH_STUP_H WHERE AUDT_EMP_ID = #{audtEmpId})
	    	, #{adorAuthTpCd}
	    	, #{authAthzCd}
	    	, #{cstmCd}
	    	, #{deptCd}
	    	, 'N'
	    	, #{frstRegstId}
	    	, SYSTIMESTAMP
	    	, #{lastChprId}
	    	, SYSTIMESTAMP
	    	)
	</insert>

	<!--
    Consultation de la liste des produits prohibés !== 금지 물품 리스트 조회 ==!
    (Generated)
    -->
	<!-- ClrHsPrflDtlVo selectClrHsPrflDtlInfo(ClrHsPrflDtlVo searchVo); -->
	<select id="selectPrhbCmdtList" parameterType="alpass.ipt.psc.vhcl.pdr.dre.vo.ClrDedPdlsSrchVo" resultType="alpass.ipt.psc.vhcl.pdr.dre.vo.ClrHsPrflDtlVo">
		SELECT
		ROW_NUMBER() OVER(PARTITION BY A.HS_CD,A.HS_UPR_CLSF_CD,A.HS_LWPR_CLSF_CD,A.APLY_STRT_DT ORDER BY A.DTL_SRNO  ) RNUM
		, A.hs_upr_clsf_cd           /** Code De Classification Supérieure Du Sh !== HS상위분류코드 ==! */
		, A.hs_lwpr_clsf_cd            /** Code De Classification Inférieure Du Sh !== HS하위분류코드 ==! */
		, A.hs_cd                      /** Code Sh !== HS코드 ==! */
		, TO_CHAR(TO_DATE(A.aply_strt_dt        , 'YYYYMMDD'),'DD/MM/YYYY') AS aply_strt_dt               /** Date De Début De L'Application !== 적용시작일자 ==! */
		, A.dtl_srno                   /** N° De Séquence Du Détail !== 상세일련번호 ==! */
		, A.hs_prfl_tp_cd              /** @TODO : 번역필요 !== HS프로파일구분코드 ==! */
		, (SELECT FN_GET_CD_VDVAL_NM('CLR_0090', A.hs_prfl_tp_cd ,#{langCd}) FROM DUAL) hs_prfl_tp_nm
		, A.aply_cstm_cd               /** Code De Douane Qui Applique !== 적용세관코드 ==! */
		,(SELECT  ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.APLY_CSTM_CD ) APLY_CSTM_NM
		, A.rela_cn                    /** Observations !== 관련내용 ==! */
		, A.cscl_yn                    /** @TODO : 번역필요 !== 통관여부 ==! */
		, A.del_yn                     /** Suppression On !== 삭제여부 ==! */
		, A.frst_regst_id              /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
		, TO_CHAR(A.frst_rgsr_dttm      , 'DD/MM/YYYY') AS frst_rgsr_dttm             /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
		, A.last_chpr_id               /** Id Du Modificateur Final !== 최종변경자ID ==! */
		, TO_CHAR(A.last_chg_dttm       , 'DD/MM/YYYY') AS last_chg_dttm              /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		FROM   TB_CLRI_HS_PRFL_DTL A
		WHERE  A.del_yn = 'N'                /** Suppression ON !== 삭제여부 ==! */
		<if test="dclrCstmCd != null and dclrCstmCd != ''">
			AND A.aply_cstm_cd = #{dclrCstmCd}
		</if>
		AND TO_CHAR(TO_DATE(#{dclrDt}, 'DD/MM/YYYY'), 'YYYYMMDD') BETWEEN A.APLY_STRT_DT AND '99991231'
		AND  A.hs_upr_clsf_cd = 'P'           /** Code De Classification Supérieure Du Sh !== HS상위분류코드 ==! */
		<if test="dclrTpCd != null and dclrTpCd.startsWith('IM')">
			AND  A.hs_lwpr_clsf_cd = 'P1'         /** Code De Classification Inférieure Du Sh !== HS하위분류코드 ==! */
		</if>
		<if test="dclrTpCd != null and dclrTpCd.startsWith('EX')">
			AND  A.hs_lwpr_clsf_cd = 'P2'         /** Code De Classification Inférieure Du Sh !== HS하위분류코드 ==! */
		</if>
		AND  A.hs_cd = #{hsCd}                           /** Code Sh !== HS코드 ==! */
	</select>

	<select id="selectHsExcpMtrCd" parameterType="alpass.com.code.vo.ComHsCdVo"  resultType="alpass.com.code.vo.ComComnCdVo">
		SELECT
			hs_excp_mtr_cd COMN_CD
			,(SELECT B.CD_VDVAL_NM FROM TB_COM_COMN_CD_D_LANG B WHERE B.COMN_CD = 'CLR_0126' AND B.LANG_CD = #{langCd} AND B.CD_VDVAL = A.hs_excp_mtr_cd) AS COMN_CD_NM
		FROM TB_CLRI_HS_EXCP_MTR_CD_MGMT A, TB_CLRI_HS_CD B
		WHERE B.HS_CD = #{hsCd}
		AND A.HS_CD = B.HS_CD
		AND TO_CHAR(CURRENT_DATE, 'YYYYMMDD') BETWEEN B.HS_APLY_STRT_DT AND B.HS_APLY_END_DT
	</select>

	<select id="selectINSOrgnCd" parameterType="alpass.com.cstm.vo.ComCstmOrgnVo"
			resultType="alpass.com.cstm.vo.ComCstmOrgnVo">
		WITH ORGN AS
		    (
				SELECT
					ORGN_MGMT_CD,
					ORGN_CD,
					ORGN_NM,
					ORGN_TP_CD
				FROM TB_POTI_ORGN
				START WITH ORGN_CD =#{orgnCd}
				CONNECT BY PRIOR  UPR_ORGN_MGMT_CD = ORGN_MGMT_CD
				AND DEL_YN ='N'
			)
			SELECT
				ORGN_MGMT_CD,
				ORGN_CD,
				ORGN_NM,
				ORGN_TP_CD
			FROM TB_POTI_ORGN WHERE orgn_cd = (SELECT ORGN_CD FROM ORGN WHERE ORGN_TP_CD ='INS')
	</select>
	<!--
    On voit les informations sur 'paramètres' 
    !== 파라미터 값 조회 ==!
    -->
    <select id="selectPrmtValue" parameterType="java.lang.String" resultType="java.lang.String">
        /* selectPrmtValue */
        SELECT PRMT_VAL_CN
          FROM TB_COM_PRMT
         WHERE PRMT_ID = #{prmtId}
           AND DEL_YN = 'N' 
           AND ROWNUM = 1
    </select>
    
    
  <select id="selectComCoInfo"
    parameterType="alpass.com.co.vo.ComCoVo"
    resultType="alpass.com.co.vo.ComCoVo">
    SELECT
          A.NIF,
          A.CONM AS CO_NM,
          A.CO_DTL_ADDR AS CO_ADDR,
          A.POST_CD AS CO_POST_CD,
          B.CMRC_REGS_NO   
    FROM TB_POTE_NIF A, TB_POTE_CMRC_REGS B
    WHERE A.NIF = B.NIF(+)
    AND A.DEL_YN = 'N'
    AND B.DEL_YN(+) = 'N'
    AND A.NIF = #{nif}

  </select>

  <insert id="mergeInsertAtdoc" parameterType="alpass.ipt.psc.com.vo.PscAtdocVo">
      /* mergeInsertAtdoc */
      INSERT INTO TB_PSCI_ATDOC (
          reff_no                            
      , atch_doc_srno                        /** N° De Séquence Du Document Joint !== 첨부문서일련번호 ==! */
      , doc_knd_cd                           /** Code De Type De Document !== 문서종류코드 ==! */
      , pdls_no                              /** N° D'Article !== 품목번호 ==! */
      , doc_no                               /** N° De Document !== 문서번호 ==! */
      , doc_desc                             /** Description De Document !== 문서설명 ==! */
      , atch_file_nm                         /** Nom Du Fichier Joint !== 첨부파일명 ==! */
      , pbls_itt_nm                          /** Nom De L'Organisme Émetteur !== 발행기관명 ==! */
      , pbls_dt                              /** Date D'Émission !== 발행일자 ==! */
      , atch_file_id                         /** Id Du Fichier Joint !== 첨부파일ID ==! */
      , del_yn                               /** Suppression On !== 삭제여부 ==! */
      , frst_regst_id                        /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
      , frst_rgsr_dttm                              /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
      , last_chpr_id                         /** Id Du Modificateur Final !== 최종변경자ID ==! */
      , last_chg_dttm                               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
      ) VALUES (
                   #{reffNo}                          
               , #{atchDocSrno}                               /** N° De Séquence Du Document Joint !== 첨부문서일련번호 ==! */
               , #{docKndCd}                                  /** Code De Type De Document !== 문서종류코드 ==! */
               , #{pdlsNo}                                    /** N° D'Article !== 품목번호 ==! */
               , #{docNo}                                     /** N° De Document !== 문서번호 ==! */
               , #{docDesc}                                   /** Description De Document !== 문서설명 ==! */
               , #{atchFileNm}                                /** Nom Du Fichier Joint !== 첨부파일명 ==! */
               , #{pblsIttNm}                                 /** Nom De L'Organisme Émetteur !== 발행기관명 ==! */
               , ''
               , #{atchFileId}                                /** Id Du Fichier Joint !== 첨부파일ID ==! */
               , 'N'                                          /** Suppression On !== 삭제여부 ==! */
               , #{frstRegstId}                               /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
               , SYSTIMESTAMP                                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
               , #{lastChprId}                                /** Id Du Modificateur Final !== 최종변경자ID ==! */
               , SYSTIMESTAMP                                /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
               )
      ON CONFLICT ( reff_no,atch_doc_srno )
          DO UPDATE SET
          doc_knd_cd = #{docKndCd}                              /** Code De Type De Document !== 문서종류코드 ==! */
                      ,pdls_no = #{pdlsNo}                                  /** N° D'Article !== 품목번호 ==! */
                      ,doc_no = #{docNo}                                    /** N° De Document !== 문서번호 ==! */
                      ,doc_desc = #{docDesc}                                /** Description De Document !== 문서설명 ==! */
                      ,atch_file_nm = #{atchFileNm}                         /** Nom Du Fichier Joint !== 첨부파일명 ==! */
                      ,pbls_itt_nm = #{pblsIttNm}                           /** Nom De L'Organisme Émetteur !== 발행기관명 ==! */
                      ,pbls_dt = ''                                         /** Date D'Émission !== 발행일자 ==! */
                      ,atch_file_id = #{atchFileId}                         /** Id Du Fichier Joint !== 첨부파일ID ==! */
                      ,last_chpr_id = #{lastChprId}                         /** Id Du Modificateur Final !== 최종변경자ID ==! */
                      , last_chg_dttm = SYSTIMESTAMP                               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
  </insert>
  
    <!--
        !==첨부문서 일괄삭제==!
        
    -->
    <delete id="deleteAdt" parameterType="alpass.ipt.psc.com.vo.PscAtdocVo">
        /* deleteAdt */
        DELETE TB_PSCI_ATDOC
        WHERE REFF_NO = #{reffNo}
    </delete>
    
    
    <select id="selectAtdList" parameterType="alpass.ipt.psc.com.vo.PscAtdocVo"
            resultType="alpass.ipt.psc.com.vo.PscAtdocVo">
        SELECT
            A.REFF_NO
             , A.ATCH_DOC_SRNO
             , A.DOC_KND_CD
             , A.PDLS_NO
             , A.DOC_NO
             , A.DOC_DESC
             , A.ATCH_FILE_NM
             , 'Y' AS RGSR_DOC_YN
             , A.PBLS_ITT_NM
             , A.ATCH_FILE_ID
        FROM TB_PSCI_ATDOC A
        WHERE A.REFF_NO = #{reffNo}
          AND A.DEL_YN = 'N'
        ORDER BY A.ATCH_DOC_SRNO
    </select>
    
</mapper>

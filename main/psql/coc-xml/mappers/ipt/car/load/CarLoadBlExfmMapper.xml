<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="alpass.ipt.car.load.mapper.CarLoadBlExfmMapper">

    <!--
    Voir la liste des Demande de Accomplissement d'exportation !==수출이행 목록 조회==!
    -->
    <select id="selectCarLoadBlExfmList"
            parameterType="alpass.ipt.car.load.vo.CarLoadBlExfmVo"
            resultType="alpass.ipt.car.load.vo.CarLoadBlExfmVo">
        /* selectCarLoadBlExfmList */
        <if test="pagination != null and  pagination == true ">
        SELECT #{totBlExfmCnt} AS TOT_CNT
             , SQLRSLT.*
             , ROWNUM as RNUM
          FROM (
        </if>
        SELECT A.LOAD_RQST_NO			 /** !==적재신청번호==! */
	         , A.BL_SRNO                 /** N° De Séquence De Ble !== BL일련번호 ==! */
	         , A.EXP_FFMN_SRNO           /** N° De Séquence De L'Apurement D'Exportation !== 수출이행일련번호 ==! */
	         , A.EXP_FFMN_TP_CD          /** Type D'Apurement D'Exportation !== 수출이행구분코드 ==! */
	         , A.EXP_CMDT_BRNG_PERM_NO   /** N° autorisation de l'introduction des marchandises à exporter !== 수출물품반입허가번호 ==! */
	         , A.EXP_FFMN_NO             /** N° D'Apurement D'Exportation !== 수출이행번호 ==! */
	         , A.DIVD_SHPM_YN            /** Chargement Partiel On !== 분할선적여부 ==! */
	         , A.DIVD_SHPM_DGCNT         /** Nombre De Chargement Partiel !== 분할선적차수 ==! */
	         , A.DIVD_SHPM_LAST_YN       /** Dernier Chargement Partiel On !== 분할선적최종여부 ==! */
	         , A.PCKG_GCNT               /** Nombre De Colis !== 포장개수 ==! */
	         , A.PCKG_UT_CD              /** Code De L'Unité De Colis !== 포장단위코드 ==! */
	         , A.TTWG                    /** Poids Brut !== 총중량 ==! */
	         , A.DEL_YN
	         , A.FRST_REGST_ID
	         , TO_CHAR(A.FRST_RGSR_DTTM,'DD/MM/YYYY HH24:MI:SS') AS FRST_RGSR_DTTM
	         , A.LAST_CHPR_ID
	         , TO_CHAR(A.LAST_CHG_DTTM,'DD/MM/YYYY HH24:MI:SS') AS LAST_CHG_DTTM
							FROM TB_CARI_LOAD_BL_EXFM A
						    WHERE A.DEL_YN = 'N'
							AND A.LOAD_RQST_NO = #{loadRqstNo}
							<if test="blSrno != null and blSrno != ''">
							AND	A.BL_SRNO = #{blSrno}
							</if>
							<if test="expFfmnNo != null and expFfmnNo != ''">
        AND	UPPER(A.EXP_FFMN_NO) LIKE UPPER(#{expFfmnNo})||'%'
       </if>
						ORDER BY A.EXP_FFMN_NO
						<include refid="pagination.footer" ></include>
    </select>

    <!--
    Enregistrement de la déclaration de Accomplissement d'exportation !== 수출이행 정보를 저장한다==!
    -->
    <insert id="insertCarLoadBlExfm" parameterType="alpass.ipt.car.load.vo.CarLoadBlExfmVo">
        /* insertCarLoadBlExfm */
        INSERT INTO TB_CARI_LOAD_BL_EXFM (
        	  LOAD_RQST_NO       	  /** !== 적재신청번호 ==! */
	        , BL_SRNO                 /** N° De Séquence De Ble !== BL일련번호 ==! */
	        , EXP_FFMN_SRNO           /** N° De Séquence De L'Apurement D'Exportation !== 수출이행일련번호 ==! */
	        , EXP_FFMN_TP_CD          /** Type D'Apurement D'Exportation !== 수출이행구분코드 ==! */
	        , EXP_CMDT_BRNG_PERM_NO   /** N° autorisation de l'introduction des marchandises à exporter !== 수출물품반입허가번호 ==! */
	        , EXP_FFMN_NO             /** N° D'Apurement D'Exportation !== 수출이행번호 ==! */
	        , DIVD_SHPM_YN            /** Chargement Partiel On !== 분할선적여부 ==! */
	        , DIVD_SHPM_DGCNT         /** Nombre De Chargement Partiel !== 분할선적차수 ==! */
	        , DIVD_SHPM_LAST_YN       /** Dernier Chargement Partiel On !== 분할선적최종여부 ==! */
	        , PCKG_GCNT               /** Nombre De Colis !== 포장개수 ==! */
	        , PCKG_UT_CD              /** Code De L'Unité De Colis !== 포장단위코드 ==! */
	        , TTWG                    /** Poids Brut !== 총중량 ==! */
	        , DEL_YN
            , FRST_REGST_ID
            , FRST_RGSR_DTTM
            , LAST_CHPR_ID
            , LAST_CHG_DTTM
        ) VALUES (
              #{loadRqstNo}
			, #{blSrno}                       /** N° De Séquence De Ble !== BL일련번호 ==! */
			, #{expFfmnSrno}                /** N° De Séquence De L'Apurement D'Exportation !== 수출이행일련번호 ==! */
			, #{expFfmnTpCd}                /** Type D'Apurement D'Exportation !== 수출이행구분코드 ==! */
			, REPLACE(#{expCmdtBrngPermNo},'-','')          /** N° autorisation de l'introduction des marchandises à exporter !== 수출물품반입허가번호 ==! */
			, REPLACE(#{expFfmnNo},'-','')                /** N° D'Apurement D'Exportation !== 수출이행번호 ==! */
			, #{divdShpmYn}                 /** Chargement Partiel On !== 분할선적여부 ==! */
			, #{divdShpmDgcnt}              /** Nombre De Chargement Partiel !== 분할선적차수 ==! */
			, #{divdShpmLastYn}             /** Dernier Chargement Partiel On !== 분할선적최종여부 ==! */
			, #{pckgGcnt}                   /** Nombre De Colis !== 포장개수 ==! */
			, #{pckgUtCd}                   /** Code De L'Unité De Colis !== 포장단위코드 ==! */
			, #{ttwg}                       /** Poids Brut !== 총중량 ==! */
			, 'N'
            , #{frstRegstId}
            , SYSTIMESTAMP
            , #{lastChprId}
            , SYSTIMESTAMP
        )
    </insert>

    <!--
    Supprimer la  déclaration de Accomplissement d'exportation  !==수출이행 정보를 삭제한다.==!
    -->
    <update id="deleteCarLoadBlExfm" parameterType="alpass.ipt.car.load.vo.CarLoadBlVo" >
        /* deleteCarLoadBlExfm */
        DELETE FROM TB_CARI_LOAD_BL_EXFM
        WHERE DEL_YN = 'N'
        AND LOAD_RQST_NO = #{loadRqstNo}
        AND	BL_SRNO = #{blSrno}
    </update>

</mapper>


























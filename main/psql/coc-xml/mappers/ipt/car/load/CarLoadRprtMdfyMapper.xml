<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="alpass.ipt.car.load.mapper.CarLoadRprtMdfyMapper">

    <!--
    'Rectifier le rapport de chargement (Export maritime)' !== 적재 보고 정정  ==!
    (Leem Jaewoo)
    -->
    <sql id ="selectItemCarLoadRprtMdfy">
    SELECT        T1.LDUN_RPRT_NO                                           AS ldun_rprt_no        /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
                , T1.LDUN_RPRT_MDFY_MGRN                        			AS ldun_rprt_mdfy_mgrn /** N° gestion de la rectification de rapport de chargement  != 정정보고관리번호 =! */
			    , T1.LDUN_RPRT_MDFY_NO                        			    AS ldun_rprt_mdfy_no   /** N° rectification de rapport de chargement  != 정정보고번호 =! */
                , T1.rprt_dgcnt                                             AS rprt_dgcnt          /** N° ordre de rapport !== 보고차수 ==! */
                , T1.mdfy_dgcnt                                             AS mdfy_dgcnt          /**  Fréquence de rectification !== 정정차수 ==!  */
                , T1.MDFY_RSN_CN                                            AS mdfy_rsn_cn         /**  Motif de rectification  					!== 정정사유내용 ==!  */
                , T1.co_rqst_no                                             AS co_rqst_no          /** N° de demande d'entreprise !== 업체신청번호 ==! */
                , T1.mrn                                                    AS mrn                 /** Mrn !== MRN ==! */
                , TO_CHAR(T1.trsn_dttm,'DD/MM/YYYY HH24:MI:SS')             AS trsn_dttm           /** Date et heure de transmission !== 전송일시 ==! */
                , T1.cag_rqst_tp_cd                                         AS cag_rqst_tp_cd      /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
                , T1.jrsd_orgn_cd                                           AS jrsd_orgn_cd        /** Code D'Unité Compétente !== 관할조직코드 ==! */
                , FN_GET_ORGN_NM(T1.JRSD_ORGN_CD)                           AS JRSD_ORGN_NM
                , T8.JRSD_CSTM_CD                                           AS JRSD_CSTM_CD		   /** !==관할세관코드==! */
                , FN_GET_ORGN_NM(T8.JRSD_CSTM_CD)                           AS JRSD_CSTM_NM
                , T1.trsn_co_cd                                             AS trsn_co_cd          /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
                , FN_CARI_GET_CO_NM(T1.TRSN_CO_CD)                          AS trsn_co_nm
                , TO_CHAR(T2.DPTR_DTTM,'DD/MM/YYYY')                        AS dptr_dttm
                , TO_CHAR(T1.real_ldun_strt_dttm,'DD/MM/YYYY HH24:MI')       AS real_ldun_strt_dttm     /** Date/Heure de début de déchargement effective !== 실제적재시작일시 ==! */
                , TO_CHAR(T1.real_ldun_end_dttm,'DD/MM/YYYY HH24:MI')        AS real_ldun_end_dttm          /** Date/Heure de fin de déchargement effective !== 실제적재종료일시 ==! */
                , T1.infm_cn                                                AS infm_cn             /** Contenu De Notification !== 통보내용 ==! */
                , T2.carr_cd                                                AS carr_cd             /** Code De Société De Transport !== 운송사코드 ==! */
                , ( SELECT DISTINCT(CO_NM)
                      FROM TB_COM_CO TT1
                         , TB_COM_CO_DCLR_CD TT2
                     WHERE TT1.NIF = TT2.NIF
                       AND TT2.CARR_CD = T2.CARR_CD
                       AND TT2.DEL_YN = 'N'
                       AND TT2.USE_YN = 'Y'
                       LIMIT 1
                  ) AS CARR_NM        /** Nom de société de transport !==운송사명==! */
                , T2.trnp_meth_nm                                           AS trnp_meth_nm        /** Nom De Moyen De Transport !== 운송수단명 ==! */
                , T2.trnp_meth_idfy_no                                      AS trnp_meth_idfy_no   /** N° D'Identification Du Moyen De Transport !== 운송수단식별번호 ==! */
                , T2.trnp_rfer_no                                           AS trnp_rfer_no        /** N° de référence de transport !== 운송참고번호 ==! */
                , T2.TRNP_METH_NAT_CD                                       AS trnp_meth_nat_cd    /** Code de pays du moyen de transport !==운송수단국적코드==! */
      		    , FN_GET_CNTY_NM(T2.TRNP_METH_NAT_CD, #{langCd})                 AS trnp_meth_nat_nm    /** Code de pays du moyen de transport !== 운송수단국적코드 ==! */
      		    , T2.DPTR_PORT_CD                       	                AS dptr_port_cd        /** Code de port de départ !==출발항구코드==! */
      		    , FN_CARI_GET_PORT_AIRPT_CITY_CD_NM(T2.DPTR_PORT_CD, #{langCd})  AS dptr_port_nm	       /** Code de port de départ !==출발항구명==! */
			    , T2.LDUN_PORT_CD                       	                AS ldun_port_cd        /** Code de port de déchargement !==하역항구코드==! */
      		    , FN_CARI_GET_PORT_AIRPT_CITY_CD_NM(T2.LDUN_PORT_CD, #{langCd})  AS ldun_port_nm	       /** Code de port de déchargement !==하역항구명==! */
                , T2.IMO_NO                                                 AS IMO_NO
                , TO_CHAR(T3.prcs_dttm,'DD/MM/YYYY HH24:MI:SS')             AS prcs_dttm           /** Date Et Heure De Traitement !== 처리일시 ==! */
                , T3.prcs_stts_cd                                           AS prcs_stts_cd        /** Code De Statut De Traitement !== 처리상태코드 ==! */
                , FN_GET_CD_VDVAL_NM('COM_0026', T3.prcs_stts_cd, #{langCd})     AS prcs_stts_nm        /** Code de statut de traitement !==처리상태코드==! */
                , T3.audt_emp_id                                            AS audt_emp_id         /** ID de l'vérificateur !== 검사직원ID ==! */
                , DD.audt_emp_nm                                            AS audt_emp_nm
                , T4.bl_nrml_gcnt                                           AS bl_nrml_gcnt
                , T4.bl_abnr_gcnt                                           AS bl_abnr_gcnt
                , T5.cntr_nrml_gcnt                                         AS cntr_nrml_gcnt
                , T5.cntr_abnr_gcnt                                         AS cntr_abnr_gcnt
                , HNOT.bfch_emp_id                                          AS bfch_emp_id         /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
                , HNOT.bfch_emp_nm                                          AS bfch_emp_nm         /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
                , HNOT.afch_emp_id                                          AS afch_emp_id         /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
                , HNOT.afch_emp_nm                                          AS afch_emp_nm         /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
                , HNOT.chg_rsn_cn                                           AS chg_rsn_cn          /** Motif De La Modification !== 변경사유내용 ==! */
                , T1.frst_regst_id                                          AS frst_regst_id       /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
                , TO_CHAR(T1.frst_rgsr_dttm,'DD/MM/YYYY HH24:MI:SS')        AS frst_rgsr_dttm      /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
                , T1.last_chpr_id                                           AS last_chpr_id        /** Id Du Modificateur Final !== 최종변경자ID ==! */
                , TO_CHAR(T1.last_chg_dttm,'DD/MM/YYYY HH24:MI:SS')         AS last_chg_dttm       /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
                , (select max(stvd_cd) from TB_CARI_LOAD x, TB_CARI_LOAD_BL y 
                    where x.LOAD_RQST_NO = t1.mrn and x.del_Yn = 'N' and y.del_yn = 'N' and x.LOAD_RQST_NO = y.LOAD_RQST_NO) as stvd_cd /** Code De Stevedoremanutentionnaire !== 하역업자코드 ==! */
                , T1.MDFY_ATCH_FILE_ID                 /** ID de pièce jointe de rectification !==정정첨부파일==! */
                ,(SELECT COUNT(*) FROM ALPASSEXT.TB_CARE_LOAD_BL_VHCL WHERE LOAD_RQST_MGMT_NO = (SELECT LOAD_RQST_MGMT_NO FROM ALPASSEXT.TB_CARE_LOAD WHERE LOAD_RQST_NO = T1.MRN)) AS AL_VHCL_GCNT        
             FROM TB_CARI_LDUN_RPRT_MDFY T1
              INNER JOIN TB_CARI_LOAD T7
               ON T1.MRN = T7.LOAD_RQST_NO 
               AND T7.DEL_YN = 'N'
            INNER JOIN TB_CARI_LOAD_SLNG_INFO T2
               ON T7.SLNG_RGSR_NO = T2.SLNG_RGSR_NO
               AND T2.DEL_YN = 'N'                                        /** Suppression ON !== 삭제여부 ==! */
             LEFT JOIN ( SELECT C1.ORGN_CD, C2.ORGN_CD JRSD_CSTM_CD
                        FROM ALPASSINT.TB_POTI_ORGN C1
                        LEFT JOIN  ALPASSINT.TB_POTI_ORGN C2
                        ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                        WHERE C1.DEL_YN = 'N'
                      ) T8
            ON T1.JRSD_ORGN_CD = T8.ORGN_CD
            LEFT JOIN TB_CARI_CAG_PRCS_BRKD T3                             /** CARI_화물_처리_내역 */
               ON T1.CAG_RQST_TP_CD = T3.CAG_RQST_TP_CD
              AND T1.LDUN_RPRT_MDFY_NO = T3.cag_rqst_no
              AND T3.del_yn = 'N'
             LEFT JOIN ( SELECT A.cag_rqst_no                                            AS cag_rqst_no         /** N° De Demande De Cargaison !== 화물신청번호 ==! */
                              , A.cag_rqst_tp_cd                                         AS cag_rqst_tp_cd      /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
                              , A.bfch_emp_id                                            AS bfch_emp_id         /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
                              , A.afch_emp_id                                            AS afch_emp_id         /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
                              , A.chg_rsn_cn                                             AS chg_rsn_cn          /** Motif De La Modification !== 변경사유내용 ==! */
                              , e1.EMP_FMNM || ' ' || e1.emp_nm                          AS bfch_emp_nm              /** Nom De L'Employé !== 직원명 ==! */
                              , e2.EMP_FMNM || ' ' || e2.emp_nm                          AS afch_emp_nm              /** Nom De L'Employé !== 직원명 ==! */
                           FROM TB_CARI_HNOT_CHG_H A
                          INNER JOIN ( SELECT cag_rqst_no
                                            , MAX(chg_hist_srno) chg_hist_srno
                                         FROM TB_CARI_HNOT_CHG_H
                                        GROUP BY cag_rqst_no
                                ) H
                             ON A.cag_rqst_no = h.cag_rqst_no
                            AND A.chg_hist_srno = h.chg_hist_srno
                           LEFT JOIN TB_POTI_EMP e1
                             ON e1.pbsr_no = A.bfch_emp_id
                           LEFT JOIN TB_POTI_EMP e2
                             ON e2.pbsr_no = A.afch_emp_id
                  ) HNOT
               ON HNOT.cag_rqst_no = t3.cag_rqst_no
              AND HNOT.cag_rqst_tp_cd = t3.cag_rqst_tp_cd
             LEFT JOIN ( SELECT D.pbsr_no                                                AS pbsr_no             /** Matricule Solde !== 공무원번호 ==! */
                              , D.EMP_FMNM || ' ' || D.emp_nm                            AS audt_emp_nm         /** Nom De L'Employé !== 직원명 ==! */
                              , E.orgn_cd                                                AS orgn_cd             /** Code De L'Organisme !== 조직코드 ==! */
                              , E.orgn_nm                                                AS orgn_nm             /** Nom D'Organisme !== 조직명 ==! */
                           FROM TB_POTI_EMP D
                           LEFT JOIN TB_POTI_ORGN E                                      /** POTI_조직 */
                             ON D.orgn_mgmt_cd = E.orgn_mgmt_cd
                          WHERE D.del_yn = 'N'
                            AND E.del_yn = 'N'
                  ) DD
               ON T3.audt_emp_id   = DD.pbsr_no
             LEFT JOIN ( SELECT LDUN_RPRT_MDFY_NO
                              , SUM(CASE WHEN dscr_tp_cd  ='OK' THEN 1 ELSE 0 END)  bl_nrml_gcnt
                              , SUM(CASE WHEN dscr_tp_cd !='OK' THEN 1 ELSE 0 END)  bl_abnr_gcnt
                           FROM TB_CARI_LDUN_RPRT_BL_MDFY TT1
                          WHERE TT1.del_yn ='N'
                          GROUP BY LDUN_RPRT_MDFY_NO
                  ) T4
               ON T1.LDUN_RPRT_MDFY_NO   = T4.LDUN_RPRT_MDFY_NO
             LEFT JOIN ( SELECT LDUN_RPRT_MDFY_NO
                              , SUM(CASE WHEN dscr_tp_cd  ='OK' THEN 1 ELSE 0 END)  cntr_nrml_gcnt
                              , SUM(CASE WHEN dscr_tp_cd !='OK' THEN 1 ELSE 0 END)  cntr_abnr_gcnt
                           FROM TB_CARI_LDUN_RPRT_CNTR_MDFY TT1
                          WHERE TT1.del_yn ='N'
                          GROUP BY LDUN_RPRT_MDFY_NO
                  ) T5
               ON T1.LDUN_RPRT_MDFY_NO   = T5.LDUN_RPRT_MDFY_NO
            WHERE T1.del_yn = 'N'
    </sql> 


    <!--
    Voir les détails de la 'Rectifier le rapport de chargement (Export maritime)' !== 적재 보고 정정 단건 조회 ==!
    (Leem Jaewoo)
    -->
    <select id="selectCarLoadRprtMdfyItem"  parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo" resultType="alpass.ipt.car.load.vo.CarLoadRprtVo">
        /* CarLoadRprtMdfy.selectCarLoadRprtMdfyItem */
        <include refid="selectItemCarLoadRprtMdfy" ></include>
             <if test="ldunRprtMdfyNo != null and ldunRprtMdfyNo != ''">
             AND  T1.LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo}   /** N° rectification de rapport de chargement  != 정정보고번호 =! */
             </if>
             ORDER BY T1.frst_rgsr_dttm DESC
             LIMIT 1
    </select> 


    <!--
    Voir la liste des 'Rectifier le rapport de chargement (Export maritime)' !== 적재 보고 정정 목록 조회 ==!
    (Leem Jaewoo)
    -->
    <select id="selectCarLoadRprtMdfyList" parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo" resultType="alpass.ipt.car.load.vo.CarLoadRprtVo">
        /* CarLoadRprtMdfy.selectCarLoadRprtMdfyList */
       <if test="pagination != null and  pagination == true ">
	        <include refid="pagination.header" ></include>
	        </if>
	        <include refid="selectItemCarLoadRprtMdfy" ></include>
	          AND  T1.MDFY_DGCNT &gt; 0         /**  Fréquence de rectification !== 정정차수 ==!  */
	        <if test="cagRqstTpCd != null and cagRqstTpCd != ''">
	          AND T1.CAG_RQST_TP_CD = #{ cagRqstTpCd }
	        </if>
	        <if test="jrsdOrgnCdList != null">
	          <if test="jrsdOrgnCdList.size == 0 and pbsrNo != null and pbsrNo != ''">
	            AND T3.audt_emp_id  = #{ pbsrNo }                  			/** ID de l'inspecteur !==검사직원ID==! */
	          </if>
	        </if>
			<if test="audtEmpId != null and audtEmpId != ''">
				AND	T3.audt_emp_id  = #{ audtEmpId }			 							/** ID de l'inspecteur !==검사직원ID==! */
			</if>
    		<if test="prcsDttmFrom != null and prcsDttmFrom != ''">		/** Date et heure de traitement !==처리일시==! */
		        AND T3.prcs_dttm <![CDATA[ >= ]]> TO_DATE(#{prcsDttmFrom},'DD/MM/YYYY')
            </if>
            <if test="prcsDttmTo != null and prcsDttmTo != ''">		/** Date et heure de traitement !==처리일시==! */
				AND T3.prcs_dttm <![CDATA[ < ]]> TO_DATE(#{prcsDttmTo},'DD/MM/YYYY')+1
			</if>
			<if test="realLdunDtFrom != null and realLdunDtFrom != ''">		/** Date effective de déchargement !==실제하역일자==! */
		  AND	T1.REAL_LDUN_END_DTTM <![CDATA[ >= ]]> TO_DATE(#{realLdunDtFrom},'DD/MM/YYYY')
            </if>
            <if test="realLdunDtTo != null and realLdunDtTo != ''">		    /** Date effective de déchargement !==실제하역일자==! */
				AND	T1.REAL_LDUN_END_DTTM <![CDATA[ < ]]> TO_DATE(#{realLdunDtTo},'DD/MM/YYYY')+1
			</if>
			<if test="mrn != null and mrn != ''">
				AND	UPPER(T1.mrn) like UPPER(#{mrn}) || '%'															/** MRN !==MRN==! */
			</if>
			<if test="carrNm != null and carrNm != ''">
				AND	UPPER(CC.carr_nm)  = UPPER(#{carrNm}) || '%'
			</if>
			<if test="trnpMethNm != null and trnpMethNm != ''">
				AND	UPPER(T2.trnp_meth_nm) like UPPER(#{trnpMethNm}) || '%'							/** Nom de moyen de transport !==운송수단명==! */
			</if>
			<if test="trnpMethIdfyNo != null and trnpMethIdfyNo != ''">
				AND	UPPER(T2.trnp_meth_idfy_no) like UPPER(#{trnpMethIdfyNo}) || '%'					/** N° d'identification du moyen de transport !==운송수단식별번호==! */
			</if>
			<if test="trnpRferNo != null and trnpRferNo != ''">
				AND	UPPER(T2.trnp_rfer_no) like UPPER(#{trnpRferNo}) || '%'							/** N° de voyage/N° de vol/N° d'itinéraire !==운송참고번호==! */
			</if>
			<if test="prcsSttsCd != null and prcsSttsCd != ''">
				AND	T3.prcs_stts_cd= #{ prcsSttsCd }			 						/** Code de statut de traitement !==처리상태코드==! */
			</if>
		        AND T1.JRSD_ORGN_CD IN (           
            <choose>
                  <when test="jrsdOrgnCd != null and jrsdOrgnCd != ''">
                  SELECT unnest(string_to_array(alpassint.fn_cari_get_orgcd('O', #{jrsdOrgnCd}), ','))
                  </when>
                  <otherwise>
                  SELECT unnest(string_to_array(alpassint.fn_cari_get_orgcd('P', #{frstRegstId}), ','))
                  </otherwise>
              </choose>
            )
  		ORDER BY T1.trsn_dttm DESC
        <if test="pagination != null and  pagination == true ">
        <include refid="pagination.footer" ></include>
        </if>
    </select>


    <!--
    Enregistrement de la 'Rectifier le rapport de chargement (Export maritime)' !== 적재 보고 정정 등록 ==!
    (Leem Jaewoo)
    -->
    <insert id="insertCarLoadRprtMdfy" 
            parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo">
        /* CarLoadRprtMdfy.insertCarLoadRprtMdfy */
        INSERT INTO TB_CARI_LDUN_RPRT_MDFY
               ( ldun_rprt_no                  /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
               , ldun_rprt_mgmt_no             /** N° De Gestion De Rapport De Déchargement !== 하역보고관리번호 ==! */
               , rprt_dgcnt                    /** N° ordre de rapport !== 보고차수 ==! */
               , co_rqst_no                    /** N° de demande d'entreprise !== 업체신청번호 ==! */
               , mrn                           /** Mrn !== MRN ==! */
               , trsn_dttm                     /** Date et heure de transmission !== 전송일시 ==! */
               , cag_rqst_tp_cd                /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
               , jrsd_orgn_cd                  /** Code D'Unité Compétente !== 관할조직코드 ==! */
               , trsn_co_cd                    /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
               , real_ldun_strt_dttm             /** Date/Heure de début de déchargement effective !== 실제적재시작일시 ==! */
               , real_ldun_end_dttm              /** Date/Heure de fin de déchargement effective !== 실제적재종료일시 ==! */
               , infm_cn                       /** Contenu De Notification !== 통보내용 ==! */
               , del_yn                        /** Suppression On !== 삭제여부 ==! */
               , frst_regst_id                 /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
               , frst_rgsr_dttm                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
               , last_chpr_id                  /** Id Du Modificateur Final !== 최종변경자ID ==! */
               , last_chg_dttm                 /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
               , mdfy_dgcnt                    /** Fréquence de rectification !== 정정차수 ==! */
        )  VALUES (
                 #{ldunRprtNo}                 /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
               , #{ldunRprtMgmtNo}             /** N° De Gestion De Rapport De Déchargement !== 하역보고관리번호 ==! */
               , #{rprtDgcnt}                  /** N° ordre de rapport !== 보고차수 ==! */
               , #{coRqstNo}                   /** N° de demande d'entreprise !== 업체신청번호 ==! */
               , #{mrn}                        /** Mrn !== MRN ==! */
               , TO_TIMESTAMP( #{trsnDttm} , 'DD/MM/YYYY HH24:MI:SS')  /** Date et heure de transmission !== 전송일시 ==! */
               , #{cagRqstTpCd}                /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
               , #{jrsdOrgnCd}                 /** Code D'Unité Compétente !== 관할조직코드 ==! */
               , #{trsnCoCd}                   /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
               , TO_TIMESTAMP(#{realLdunStrtDttm},'DD/MM/YYYY HH24:MI:SS')
               , TO_TIMESTAMP(#{realLdunEndDttm},'DD/MM/YYYY HH24:MI:SS')
               , #{infmCn}                     /** Contenu De Notification !== 통보내용 ==! */
               , 'N'                           /** Suppression On !== 삭제여부 ==! */
               , #{frstRegstId}                /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
               , SYSTIMESTAMP                  /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
               , #{lastChprId}                 /** Id Du Modificateur Final !== 최종변경자ID ==! */
               , SYSTIMESTAMP                  /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
               , #{mdfyDgcnt}                  /** Fréquence de rectification !== 정정차수 ==! */
        )
    </insert>


    <!--
    Modifier la  'Rectifier le rapport de chargement (Export maritime)' !== 적재 보고 정정 수정 ==!
    (Leem Jaewoo)
    -->
    <update id="updateCarLoadRprtMdfy" 
            parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo">
        /* CarLoadRprtMdfy.updateCarLoadRprtMdfy */
        UPDATE TB_CARI_LDUN_RPRT SET 
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             , real_ldun_strt_dttm = TO_TIMESTAMP(#{realLdunStrtDttm},'DD/MM/YYYY HH24:MI:SS')
             , real_ldun_end_dttm = TO_TIMESTAMP(#{realLdunEndDttm},'DD/MM/YYYY HH24:MI:SS')
             WHERE LDUN_RPRT_NO = #{ldunRprtNo}	              /** != 보고번호 =! */
    </update>
    
    
    <!--
    Modifier la  'Rectifier le rapport de chargement (Export maritime)' !== 적재 보고 정정 수정 외부시스템 ==!
    (Leem Jaewoo)
    -->
    <update id="updateCarLoadRprtToExt"  parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo">
        /* CarLoadRprtMdfy.updateCarLoadRprtToExt */
        UPDATE ALPASSEXT.TB_CARE_LDUN_RPRT SET 
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , PRCS_DTTM =  SYSTIMESTAMP                     /** Code De Statut De Traitement !== 처리상태코드 ==! */
             , PRCS_STTS_CD =  #{prcsSttsCd}                 /** Date Et Heure De Traitement !== 처리일시 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             , real_ldun_strt_dttm = TO_TIMESTAMP(#{realLdunStrtDttm},'DD/MM/YYYY HH24:MI:SS')
             , real_ldun_end_dttm = TO_TIMESTAMP(#{realLdunEndDttm},'DD/MM/YYYY HH24:MI:SS')
           WHERE del_yn = 'N'                                /** Suppression ON !== 삭제여부 ==! */
           AND  LDUN_RPRT_MGMT_NO = #{ldunRprtMgmtNo}
    </update>
    
    <!--
    Modifier la  'Rectifier le rapport de chargement (Export maritime)' !== 적재 보고 정정 수정 외부시스템 ==!
    (Leem Jaewoo)
    -->
    <update id="updateCarLoadRprtMdfyToExt"  parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo">
        /* CarLoadRprtMdfy.updateCarLoadRprtMdfyToExt */
        UPDATE ALPASSEXT.TB_CARE_LDUN_RPRT_MDFY SET 
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , PRCS_DTTM =  SYSTIMESTAMP                     /** Code De Statut De Traitement !== 처리상태코드 ==! */
             , PRCS_STTS_CD =  #{prcsSttsCd}                 /** Date Et Heure De Traitement !== 처리일시 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
           WHERE del_yn = 'N'                                /** Suppression ON !== 삭제여부 ==! */
           AND  ldun_rprt_mdfy_mgrn = #{ldunRprtMdfyMgrn}
    </update>
    


    <!--
    Supprimer la 'Rectifier le rapport de chargement (Export maritime)' !== 적재 보고 정정 삭제 ==!
    (Leem Jaewoo)
    -->
    <update id="deleteCarLoadRprtMdfy" 
            parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo">
        /* CarLoadRprtMdfy.deleteCarLoadRprtMdfy */
        UPDATE TB_CARI_LDUN_RPRT_MDFY SET 
               del_yn = 'Y'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
         WHERE 1=1 
             <if test="ldunRprtNo != null and ldunRprtNo != ''">
             AND  A.ldun_rprt_no = #{ldunRprtNo}  /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
             </if>
    </update>
    
    
    <!--
				Consulter le "N° gestion de la rectification de rapport de chargement" précédent autorisé !==승인된 이전 정정보고번호 조회==! *
				--> 
    <select id="selectBfLdunRprtMdfyNo" parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo" resultType="string">
        /* CarLoadRprtMdfy.selectBfLdunRprtMdfyNo */
              SELECT A.LDUN_RPRT_MDFY_NO
              FROM TB_CARI_LDUN_RPRT_MDFY A
              WHERE A.DEL_YN = 'N'
              AND A.LDUN_RPRT_NO = #{ldunRprtNo}
              AND A.MDFY_DGCNT = ( SELECT MAX(MDFY_DGCNT)
							       FROM ALPASSEXT.TB_CARE_LDUN_RPRT_MDFY
							       WHERE DEL_YN = 'N'
							       AND LDUN_RPRT_NO = #{ldunRprtNo}
								   AND PRCS_STTS_CD = 'D08'
								   AND MDFY_DGCNT &lt; #{mdfyDgcnt})
    </select> 
    
    
    <!--
					Total de la liste des B/L !==B/L 목록 카운트==!
					--> 
					<select id="selectCariLoadRprtMdfyBlTotCnt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtBlVo" resultType="int">
						/* CarLoadRprtMdfy.selectCariLoadRprtMdfyBlTotCnt*/
							SELECT
							  COUNT(*) AS TOT_CNT
						FROM TB_CARI_LDUN_RPRT_BL_MDFY T1 , TB_CARI_LDUN_RPRT_MDFY T2
						WHERE 1=1
						AND T1.LDUN_RPRT_MDFY_NO  = T2.LDUN_RPRT_MDFY_NO
						AND T2.MDFY_DGCNT = #{mdfyDgcnt}
						AND T1.LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo} 	/** N° rectification de rapport de chargement  != 정정보고번호 =! */
						 <if test="blNo != null and blNo != ''">
											AND	T1.BL_NO = #{blNo}
								</if>
							 <if test='nrmlYn != null and nrmlYn == "Y"'>
							    AND T1.DSCR_TP_CD = 'OK'         		/** Déficit/Excédent != 불일치구분코드 =! */
							 </if>
							 <if test='nrmlYn != null and nrmlYn == "N"'>
							    AND T1.DSCR_TP_CD != 'OK'         		/** Déficit/Excédent != 불일치구분코드 =! */
							 </if>
					</select>
	
	
    <!--
				Voir les informations sur 'B/L rapports de chargement'. !==적재 보고 B/L 정보를 조회한다.==!
				(Leem Jaewoo) 
				--> 
	<select id="selectCariLoadRprtMdfyBlList" parameterType="alpass.ipt.car.load.vo.CarLoadRprtBlVo" resultType="alpass.ipt.car.load.vo.CarLoadRprtBlVo">
		/* CarLoadRprtMdfy.selectCariLoadRprtMdfyBlList*/
		<if test="pagination != null and  pagination == true ">
        SELECT #{totCnt} AS TOT_CNT
             , SQLRSLT.*
             , ROWNUM as RNUM
          FROM (
        </if>
			SELECT
			     T1.BL_NO                              	/** N° de BL !==BL번호==! */
			   , T1.HBL_NO                              /** N° de House B/L !== HBL번호 ==! */
			   , T1.LDUN_RPRT_MDFY_NO  
			   , T1.ibobz_cd                                               AS ibobz_cd            /** Code de zone sous douane !== 보세구역코드 ==! */
			   , (SELECT IB.IBOBZ_NM 
			        FROM TB_CARI_IBOBZ IB 
			       WHERE IB.IBOBZ_CD = T1.IBOBZ_CD)                              AS IBOBZ_NM           /** Nom d'entrepôt !== 보세창고명==! */  
							, T1.DSCR_TP_CD                         	/** DéficitExcédent !==불일치구분코드==! */
							, T1.PCKG_GCNT                          	/** Nombre de colis !==포장개수==! */
							, T1.TTWG                               	/** Poids brut !==총중량==! */
							, T1.CBM_VOL                            	/** Volume (MTQ) !==입방미터용적==! */
							, T1.LIR_VOL                            	/** Volume (Litre) !==리터용적==! */
							, CASE 
								WHEN T1.DIVD_LDUN_LAST_YN ='Y' THEN 'true'
								ELSE 'false' 
							END AS DIVD_LDUN_LAST
							, T1.DIVD_LDUN_LAST_YN						/** Dernier déchargement partiel ON !==분할하역최종여부==! */			
							, T1.DIVD_LDUN_LAST_YN						/** Dernier déchargement partiel ON !==분할하역최종여부==! */			
							, T1.INSC_CFRM_DT                       	/** Date de vérification de l'inspection !==검사확인일자==! */
							, T1.APRE_YN_CD                         	/** Autorisation O/N !==승인여부코드==! */
							, T1.RTRN_RSN_CN                            /** Motif de rejet !==반려사유내용==! */
							, (SELECT CAG_CHRC_CD FROM TB_CARI_LOAD_BL TT1 WHERE TT1.LOAD_RQST_NO = T2.MRN
							         AND TT1.BL_PT_CD = 'M'
						             AND TT1.BL_NO = T1.BL_NO) AS CAG_CHRC_CD   /** Nature de cargaison !==화물특성코드==! */ -->
				            , T1.PCKG_GCNT
				            , T1.TTWG
				            , T1.LIR_VOL            
							, T1.DEL_YN                             	/** Suppression ON !==삭제여부==! */
							, T1.FRST_REGST_ID                      	/** ID du premier enregistrant  !==최초등록자ID==! */
							, T1.LAST_CHPR_ID                       	/** ID du modificateur final !==최종변경자ID==! */
							, CASE WHEN T3.BL_PT_CD IS NOT NULL THEN T3.BL_PT_CD
              WHEN T3.BL_PT_CD IS NULL AND T1.HBL_NO = '' THEN 'M'
              ELSE 'H'
              END  AS BL_PT_CD /** Code De Type De Bl !== BL유형코드 ==! */  
						FROM TB_CARI_LDUN_RPRT_BL_MDFY T1
						INNER JOIN TB_CARI_LDUN_RPRT_MDFY T2
						ON T1.LDUN_RPRT_MDFY_NO  = T2.LDUN_RPRT_MDFY_NO
						LEFT JOIN (SELECT    TCL.LOAD_RQST_NO
									                , TCLR.LDUN_RPRT_NO
									                , TCLB.BL_NO 
									                , TCLB.HBL_NO 
					                    , TCLB.BL_PT_CD
					                 FROM TB_CARI_LOAD TCL
					                    , TB_CARI_LOAD_BL TCLB
					                    , TB_CARI_LDUN_RPRT TCLR
					                WHERE 1=1
					                  AND TCL.DEL_YN = 'N'
					                  AND TCLB.DEL_YN = 'N'
					                  AND TCLR.DEL_YN = 'N'
					                  AND TCL.LOAD_RQST_NO = TCLB.LOAD_RQST_NO
					                  AND TCL.LOAD_RQST_NO = TCLR.MRN
					                  AND ((TCLB.BL_PT_CD = 'M' AND TCLB.BL_TP_CD = 'S') OR TCLB.BL_PT_CD = 'H')
						           ) T3
					       ON T3.LOAD_RQST_NO = T2.MRN
					      AND T3.LDUN_RPRT_NO = T2.LDUN_RPRT_NO
					      AND T1.BL_NO = T3.BL_NO AND T1.HBL_NO = T3.HBL_NO
						WHERE 1=1
					 AND T2.MDFY_DGCNT = #{mdfyDgcnt}   
						AND T1.LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo} 	/** N° rectification de rapport de chargement  != 정정보고번호 =! */
						<if test='nrmlYn != null and nrmlYn == "Y"'>AND T1.DSCR_TP_CD = 'OK'         		/** Déficit/Excédent != 불일치구분코드 =! */</if>
						<if test='nrmlYn != null and nrmlYn == "N"'>AND T1.DSCR_TP_CD != 'OK'         		/** Déficit/Excédent != 불일치구분코드 =! */</if>
				   ORDER BY T1.BL_NO
				      <include refid="pagination.footer" ></include>
	</select>
	
	<!--
Total de la liste des conteneurs !==컨테이너 목록 카운트==!
	--> 
	<select id="selectCariLoadRprtMdfyCntrTotCnt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtCntrVo" resultType="int">
		/* CarLoadRprtMdfy.selectCariLoadRprtMdfyCntrTotCnt*/
			SELECT
				  COUNT(*) AS TOT_CNT
			FROM TB_CARI_LDUN_RPRT_CNTR_MDFY T1 , TB_CARI_LDUN_RPRT_MDFY T2
			WHERE 1=1
		 AND T1.LDUN_RPRT_MDFY_NO  = T2.LDUN_RPRT_MDFY_NO
		 AND T2.MDFY_DGCNT = #{mdfyDgcnt}
			AND T1.LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo} 	/** N° rectification de rapport de chargement  != 정정보고번호 =! */
			<if test="blNo != null and blNo != ''">
							AND	T1.BL_NO = #{blNo}
				</if>
			 <if test='nrmlYn != null and nrmlYn == "Y"'>
			    AND T1.DSCR_TP_CD = 'OK'         		/** Déficit/Excédent != 불일치구분코드 =! */
			 </if>
			 <if test='nrmlYn != null and nrmlYn == "N"'>
			    AND T1.DSCR_TP_CD != 'OK'         		/** Déficit/Excédent != 불일치구분코드 =! */
			 </if>
	</select>
	
	
	<!--
Voir les informations sur 'Conteneur rapports de chargement'. !==적재 보고 컨테이너 정보를 조회한다.==!
	--> 
	<select id="selectCariLoadRprtMdfyCntrList" parameterType="alpass.ipt.car.load.vo.CarLoadRprtCntrVo" resultType="alpass.ipt.car.load.vo.CarLoadRprtCntrVo">
		/* CarLoadRprtMdfy.selectCariLoadRprtMdfyCntrList*/
		<if test="pagination != null and  pagination == true ">
        SELECT #{totCnt} AS TOT_CNT
             , SQLRSLT.*
             , ROWNUM as RNUM
          FROM (
  </if>
			SELECT
				  T1.CNTR_SRNO                          	/** N° de séquence du conteneur !==컨테이너일련번호==! */
				, T1.LDUN_RPRT_MDFY_NO                   
				, T1.BL_NO                              	/** N° de BL !==BL번호==! */
				, T1.DSCR_TP_CD                         	/** DéficitExcédent !==불일치구분코드==! */
				, T1.CNTR_NO                            	/** N° de conteneur !==컨테이너번호==! */
				, T1.CNTR_TP_CD                         	/** Code de type de conteneur !==컨테이너구분코드==! */
				, T1.PCKG_GCNT                          	/** Nombre de colis !==포장개수==! */
				, T1.PCKG_UT_CD                         	/** Code de l'unité de colis !==포장단위코드==! */
				, T1.TTWG                               	/** Poids brut !==총중량==! */
				, T1.SEAL_NO1                           	/** N°1 de scellé !==봉인번호1==! */
				, T1.SEAL_NO2                           	/** N°2 de scellé !==봉인번호2==! */
				, T1.SEAL_NO3                           	/** N°3 de scellé !==봉인번호3==! */
				, T1.IBOBZ_CD                               /** Code de zone sous douane !== 보세구역코드 ==! */
			    , (SELECT IB.IBOBZ_NM 
			        FROM TB_CARI_IBOBZ IB 
			       WHERE IB.IBOBZ_CD = T1.IBOBZ_CD)  AS IBOBZ_NM           /** Nom d'entrepôt !== 보세창고명==! */  
	     		, T1.INSC_CFRM_DT                       	/** Date de vérification de l'inspection !==검사확인일자==! */
				, T1.APRE_YN_CD                         	/** Autorisation O/N !==승인여부코드==! */
				, T1.RTRN_RSN_CN                            /** Motif de rejet !==반려사유내용==! */
				, T1.DEL_YN                             	/** Suppression ON !==삭제여부==! */
				, T1.FRST_REGST_ID                      	/** ID du premier enregistrant  !==최초등록자ID==! */
				, T1.LAST_CHPR_ID                       	/** ID du modificateur final !==최종변경자ID==! */
				, T3.BL_PT_CD                           	/** Code De Type De Bl !== BL유형코드 ==! */
			 FROM TB_CARI_LDUN_RPRT_CNTR_MDFY T1 , TB_CARI_LDUN_RPRT_MDFY T2
			 LEFT JOIN (SELECT TCLR.LDUN_RPRT_NO
							 , TCLB.BL_NO
							 , TCLB.BL_PT_CD
							 , TCLBC.CNTR_SRNO
							 , TCLBC.CNTR_NO
						  FROM TB_CARI_LOAD TCL
							 , TB_CARI_LOAD_BL TCLB
							 , TB_CARI_LOAD_BL_CNTR TCLBC 
							 , TB_CARI_LDUN_RPRT TCLR
						 WHERE 1=1
						   AND TCL.DEL_YN = 'N'
						   AND TCLB.DEL_YN = 'N'
						   AND TCLR.DEL_YN = 'N'
						   AND TCLB.BL_PT_CD = 'M'
						   --AND ((TCLB.BL_PT_CD = 'M' AND TCLB.BL_TP_CD = 'S') OR TCLB.BL_PT_CD = 'H')
						   AND TCL.LOAD_RQST_NO = TCLB.LOAD_RQST_NO
						   AND TCL.LOAD_RQST_NO = TCLBC.LOAD_RQST_NO
						   AND TCLB.BL_SRNO = TCLBC.BL_SRNO
						   AND TCL.LOAD_RQST_NO = TCLR.MRN
						) T3
			   ON T3.LDUN_RPRT_NO = T2.LDUN_RPRT_NO
			WHERE 1=1
			  AND T1.LDUN_RPRT_MDFY_NO  = T2.LDUN_RPRT_MDFY_NO
			  AND T3.BL_NO = T1.BL_NO
			  AND T3.CNTR_SRNO = T1.CNTR_SRNO
			  AND T3.CNTR_NO = T1.CNTR_NO
			  AND T2.MDFY_DGCNT = #{mdfyDgcnt}
			  AND T1.LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo} 	/** N° rectification de rapport de chargement  != 정정보고번호 =! */
			<if test="blNo != null and blNo != ''">
							AND	T1.BL_NO = #{blNo}
				</if>
			 <if test='nrmlYn != null and nrmlYn == "Y"'>
			    AND T1.DSCR_TP_CD = 'OK'         		/** Déficit/Excédent != 불일치구분코드 =! */
			 </if>
			 <if test='nrmlYn != null and nrmlYn == "N"'>
			    AND T1.DSCR_TP_CD != 'OK'         		/** Déficit/Excédent != 불일치구분코드 =! */
			 </if>
		ORDER BY T1.CNTR_NO
		      <include refid="pagination.footer" ></include>
	</select>


    
    
    <!--
    Supprimer la  déclaration de B/L(IPT)  !==B/L 정보를 삭제한다.(IPT)==!
    -->
    <update id="deleteCarLoadRprtBlInt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo" >
        /* deleteCarLoadRprtBlInt */
        <selectKey keyProperty="ldunRprtMgmtNo" keyColumn="LDUN_RPRT_MGMT_NO" resultType="String" order="BEFORE">
            SELECT LDUN_RPRT_MGMT_NO FROM TB_CARI_LDUN_RPRT WHERE LDUN_RPRT_NO = #{ldunRprtNo}
        </selectKey>
        DELETE FROM TB_CARI_LDUN_RPRT_BL
        WHERE DEL_YN = 'N'
        AND LDUN_RPRT_NO = #{ldunRprtNo}
    </update>

    <!--
    Supprimer la  déclaration de B/L(EPT)  !==B/L 정보를 삭제한다.(EPT)==!
    -->
    <update id="deleteCarLoadRprtBlExt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo" >
        /* deleteCarLoadRprtBlExt */
        DELETE FROM ALPASSEXT.TB_CARE_LDUN_RPRT_BL
        WHERE DEL_YN = 'N'
        AND LDUN_RPRT_MGMT_NO = #{ldunRprtMgmtNo}
    </update>
    
    <!--
   Supprimer la  déclaration de Conteneur(IPT)  !==컨테이너 정보를 삭제한다.(IPT)==!
    -->
    <update id="deleteCarLoadRprtCntrInt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo" >
        /* deleteCarLoadRprtCntrInt */
        DELETE FROM TB_CARI_LDUN_RPRT_CNTR
        WHERE DEL_YN = 'N'
        AND LDUN_RPRT_NO = #{ldunRprtNo}
    </update>

    <!--
    Supprimer la  déclaration de Conteneur(EPT)  !==컨테이너 정보를 삭제한다.(EPT)==!
    -->
    <update id="deleteCarLoadRprtCntrExt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo" >
        /* deleteCarLoadRprtCntrExt */
        DELETE FROM ALPASSEXT.TB_CARE_LDUN_RPRT_CNTR
        WHERE DEL_YN = 'N'
        AND LDUN_RPRT_MGMT_NO = #{ldunRprtMgmtNo}
    </update>
    
    
    <!--
    Modifier les informations sur 'B/L rapports de chargement'. !==적재 보고 B/L 정보를 수정한다.==!
    (Leem Jaewoo)
    -->
    <update id="updateCarLoadRprtBlInt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo">
        /* CarLoadRprtMdfy.updateCarLoadRprtBlInt */
        INSERT INTO TB_CARI_LDUN_RPRT_BL
         (
                 ldun_rprt_no                  /**  !== 적재보고번호 ==! */ 
               , bl_no                         /** N° De Bl !== BL번호 ==! */
               , hbl_no                        /** N° de House B/L !== HBL번호 ==! */
               , ibobz_cd                      /** Code de zone sous douane !== 보세구역코드 ==! */
               , rprt_dgcnt                    /** N° ordre de rapport !== 보고차수 ==! */
               , dscr_tp_cd                    /** Code de non-conformité !== 불일치구분코드 ==! */
               , pckg_gcnt                     /** Nombre De Colis !== 포장개수 ==! */
               , ttwg                          /** Poids Brut !== 총중량 ==! */
               , cbm_vol                       /** Volume (Mtq) !== 입방미터용적 ==! */
               , lir_vol                       /** Volume (Litre) !== 리터용적 ==! */
               , divd_ldun_last_yn             /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
               , insc_cfrm_dt                  /** Date de vérification de la visite !== 검사확인일자 ==! */
               , apre_yn_cd                    /** Autorisation O/N !== 승인여부코드 ==! */
               , rtrn_rsn_cn                   /** Motif De Rejet !== 반려사유내용 ==! */
               , del_yn                        /** Suppression On !== 삭제여부 ==! */
               , frst_regst_id                 /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
               , frst_rgsr_dttm                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
               , last_chpr_id                  /** Id Du Modificateur Final !== 최종변경자ID ==! */
               , last_chg_dttm                 /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        )
        SELECT
	             #{ldunRprtNo}                
               , bl_no                       
               , hbl_no                       
               , ibobz_cd                   
               , rprt_dgcnt                 
               , dscr_tp_cd                 
               , pckg_gcnt                  
               , ttwg                     
               , cbm_vol                    
               , lir_vol                    
               , divd_ldun_last_yn        
               , insc_cfrm_dt              
               , apre_yn_cd                       
               , rtrn_rsn_cn                       
			   , 'N' AS DEL_YN
			   , frst_regst_id
			   , SYSTIMESTAMP AS FRST_RGSR_DTTM
			   , last_chpr_id 
			   , SYSTIMESTAMP AS LAST_CHG_DTTM
		FROM TB_CARI_LDUN_RPRT_BL_MDFY
		WHERE DEL_YN = 'N'
		AND ldun_rprt_mdfy_no = #{ldunRprtMdfyNo}
    </update>
    
         <!--
    Modifier les informations sur 'B/L rapports de chargement'. !==적재 보고 B/L 정보를 수정한다.==!
    (Leem Jaewoo)
    -->
    <update id="updateCarLoadRprtBlExt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo">
        /* CarLoadRprt.updateCarLoadRprtBlExt */
        INSERT INTO ALPASSEXT.TB_CARE_LDUN_RPRT_BL
         (
                 LDUN_RPRT_MGMT_NO             /**  !== 적재보고관리번호 ==! */
               , rprt_dgcnt                    /** N° ordre de rapport !== 보고차수 ==! */
               , bl_no                         /** N° De Bl !== BL번호 ==! */
               , hbl_no                        /** N° de House B/L !== HBL번호 ==! */
               , ibobz_cd                      /** Code de zone sous douane !== 보세구역코드 ==! */
               , dscr_tp_cd                    /** Code de non-conformité !== 불일치구분코드 ==! */
               , pckg_gcnt                     /** Nombre De Colis !== 포장개수 ==! */
               , ttwg                          /** Poids Brut !== 총중량 ==! */
               , cbm_vol                       /** Volume (Mtq) !== 입방미터용적 ==! */
               , lir_vol                       /** Volume (Litre) !== 리터용적 ==! */
               , divd_ldun_last_yn             /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
               , insc_cfrm_dt                  /** Date de vérification de la visite !== 검사확인일자 ==! */
               , apre_yn_cd                    /** Autorisation O/N !== 승인여부코드 ==! */
               , audt_opin_cn                  /** Contenu De L'Opinion À La Suite De La Vérification !== 심사의견내용 ==! */
               , del_yn                        /** Suppression On !== 삭제여부 ==! */
               , frst_regst_id                 /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
               , frst_rgsr_dttm                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
               , last_chpr_id                  /** Id Du Modificateur Final !== 최종변경자ID ==! */
               , last_chg_dttm                 /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        )
        SELECT
	             #{ldunRprtMgmtNo}        
	           , rprt_dgcnt                
               , bl_no                       
               , hbl_no                       
               , ibobz_cd                   
               , dscr_tp_cd                 
               , pckg_gcnt                  
               , ttwg                     
               , cbm_vol                    
               , lir_vol                    
               , divd_ldun_last_yn        
               , insc_cfrm_dt              
               , apre_yn_cd                       
               , rtrn_rsn_cn                     
			   , 'N' AS DEL_YN
			   , frst_regst_id
			   , SYSTIMESTAMP AS FRST_RGSR_DTTM
			   , last_chpr_id 
			   , SYSTIMESTAMP AS LAST_CHG_DTTM
		FROM TB_CARI_LDUN_RPRT_BL_MDFY
		WHERE DEL_YN = 'N'
		AND ldun_rprt_mdfy_no = #{ldunRprtMdfyNo}
    </update>
    
    
        <!--
    Modifier les informations sur 'Conteneur rapports de chargement'. !==적재 보고 컨테이너 정보를 수정한다.==!
    (Leem Jaewoo)
    -->
    <update id="updateCarLoadRprtCntrInt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo">
        /* CarLoadRprtMdfy.updateCarLoadRprtCntrInt */
         INSERT INTO TB_CARI_LDUN_RPRT_CNTR
         (
                 ldun_rprt_no                  /**  !== 적재보고번호 ==! */ 
               , bl_no                         /** N° De Bl !== BL번호 ==! */
               , cntr_srno                     /** N° De Séquence Du Conteneur !== 컨테이너일련번호 ==! */
               , rprt_dgcnt                    /** N° ordre de rapport !== 보고차수 ==! */
               , dscr_tp_cd                    /** Code de non-conformité !== 불일치구분코드 ==! */
               , cntr_no                       /** N° De Conteneur !== 컨테이너번호 ==! */
               , cntr_tp_cd                    /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
               , pckg_gcnt                     /** Nombre De Colis !== 포장개수 ==! */
               , pckg_ut_cd                    /** Code De L'Unité De Colis !== 포장단위코드 ==! */
               , ttwg                          /** Poids Brut !== 총중량 ==! */
               , seal_no1                      /** N° De Scellé1 !== 봉인번호1 ==! */
               , seal_no2                      /** N° De Scellé2 !== 봉인번호2 ==! */
               , seal_no3                      /** N° De Scellé3 !== 봉인번호3 ==! */
               , ibobz_cd                      /** Code de zone sous douane !== 보세구역코드 ==! */
               , divd_ldun_last_yn             /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
               , insc_cfrm_dt                  /** Date de vérification de la visite !== 검사확인일자 ==! */
               , apre_yn_cd                    /** Autorisation O/N !== 승인여부코드 ==! */
               , rtrn_rsn_cn                   /** Motif De Rejet !== 반려사유내용 ==! */
               , del_yn                        /** Suppression On !== 삭제여부 ==! */
               , frst_regst_id                 /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
               , frst_rgsr_dttm                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
               , last_chpr_id                  /** Id Du Modificateur Final !== 최종변경자ID ==! */
               , last_chg_dttm                 /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        )
        SELECT
	             #{ldunRprtNo}
               , bl_no                         /** N° De Bl !== BL번호 ==! */
               , cntr_srno                     /** N° De Séquence Du Conteneur !== 컨테이너일련번호 ==! */
               , rprt_dgcnt                    /** N° ordre de rapport !== 보고차수 ==! */
               , dscr_tp_cd                    /** Code de non-conformité !== 불일치구분코드 ==! */
               , cntr_no                       /** N° De Conteneur !== 컨테이너번호 ==! */
               , cntr_tp_cd                    /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
               , pckg_gcnt                     /** Nombre De Colis !== 포장개수 ==! */
               , pckg_ut_cd                    /** Code De L'Unité De Colis !== 포장단위코드 ==! */
               , ttwg                          /** Poids Brut !== 총중량 ==! */
               , seal_no1                      /** N° De Scellé1 !== 봉인번호1 ==! */
               , seal_no2                      /** N° De Scellé2 !== 봉인번호2 ==! */
               , seal_no3                      /** N° De Scellé3 !== 봉인번호3 ==! */
               , ibobz_cd                      /** Code de zone sous douane !== 보세구역코드 ==! */
               , divd_ldun_last_yn             /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
               , insc_cfrm_dt                  /** Date de vérification de la visite !== 검사확인일자 ==! */             
               , apre_yn_cd                       
               , rtrn_rsn_cn                     
			   , 'N' AS DEL_YN
			   , frst_regst_id
			   , SYSTIMESTAMP AS FRST_RGSR_DTTM
			   , last_chpr_id 
			   , SYSTIMESTAMP AS LAST_CHG_DTTM
		FROM TB_CARI_LDUN_RPRT_CNTR_MDFY
		WHERE DEL_YN = 'N'
		AND ldun_rprt_mdfy_no = #{ldunRprtMdfyNo}
    </update>
    
    
        <!--
    Modifier les informations sur 'Conteneur rapports de chargement'. !==적재 보고 컨테이너 정보를 수정한다.==!
    (Leem Jaewoo)
    -->
    <update id="updateCarLoadRprtCntrExt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo">
        /* CarLoadRprt.updateCarLoadRprtCntrExt */
        INSERT INTO ALPASSEXT.TB_CARE_LDUN_RPRT_CNTR
         (
                 LDUN_RPRT_MGMT_NO             /**  !== 적재보고관리번호 ==! */ 
               , bl_no                         /** N° De Bl !== BL번호 ==! */
               , cntr_srno                     /** N° De Séquence Du Conteneur !== 컨테이너일련번호 ==! */
               , rprt_dgcnt                    /** N° ordre de rapport !== 보고차수 ==! */
               , dscr_tp_cd                    /** Code de non-conformité !== 불일치구분코드 ==! */
               , cntr_no                       /** N° De Conteneur !== 컨테이너번호 ==! */
               , cntr_tp_cd                    /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
               , pckg_gcnt                     /** Nombre De Colis !== 포장개수 ==! */
               , pckg_ut_cd                    /** Code De L'Unité De Colis !== 포장단위코드 ==! */
               , ttwg                          /** Poids Brut !== 총중량 ==! */
               , seal_no1                      /** N° De Scellé1 !== 봉인번호1 ==! */
               , seal_no2                      /** N° De Scellé2 !== 봉인번호2 ==! */
               , seal_no3                      /** N° De Scellé3 !== 봉인번호3 ==! */
               , ibobz_cd                      /** Code de zone sous douane !== 보세구역코드 ==! */
               , divd_ldun_last_yn             /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
               , insc_cfrm_dt                  /** Date de vérification de la visite !== 검사확인일자 ==! */
               , apre_yn_cd                    /** Autorisation O/N !== 승인여부코드 ==! */
               , audt_opin_cn                  /** Contenu De L'Opinion À La Suite De La Vérification !== 심사의견내용 ==! */
               , del_yn                        /** Suppression On !== 삭제여부 ==! */
               , frst_regst_id                 /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
               , frst_rgsr_dttm                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
               , last_chpr_id                  /** Id Du Modificateur Final !== 최종변경자ID ==! */
               , last_chg_dttm                 /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        )
        SELECT
	             #{ldunRprtMgmtNo}
               , bl_no                         /** N° De Bl !== BL번호 ==! */
               , cntr_srno                     /** N° De Séquence Du Conteneur !== 컨테이너일련번호 ==! */
               , rprt_dgcnt                    /** N° ordre de rapport !== 보고차수 ==! */
               , dscr_tp_cd                    /** Code de non-conformité !== 불일치구분코드 ==! */
               , cntr_no                       /** N° De Conteneur !== 컨테이너번호 ==! */
               , cntr_tp_cd                    /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
               , pckg_gcnt                     /** Nombre De Colis !== 포장개수 ==! */
               , pckg_ut_cd                    /** Code De L'Unité De Colis !== 포장단위코드 ==! */
               , ttwg                          /** Poids Brut !== 총중량 ==! */
               , seal_no1                      /** N° De Scellé1 !== 봉인번호1 ==! */
               , seal_no2                      /** N° De Scellé2 !== 봉인번호2 ==! */
               , seal_no3                      /** N° De Scellé3 !== 봉인번호3 ==! */
               , ibobz_cd                      /** Code de zone sous douane !== 보세구역코드 ==! */
               , divd_ldun_last_yn             /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
               , insc_cfrm_dt                  /** Date de vérification de la visite !== 검사확인일자 ==! */             
               , apre_yn_cd                       
               , rtrn_rsn_cn                     
			   , 'N' AS DEL_YN
			   , frst_regst_id
			   , SYSTIMESTAMP AS FRST_RGSR_DTTM
			   , last_chpr_id 
			   , SYSTIMESTAMP AS LAST_CHG_DTTM
		FROM TB_CARI_LDUN_RPRT_CNTR_MDFY
		WHERE DEL_YN = 'N'
		AND ldun_rprt_mdfy_no = #{ldunRprtMdfyNo}
    </update>
    
    
    <!--
    Modifier les informations sur 'B/L rapports de chargement'. !==적재 보고 B/L 정보를 수정한다.==!
    (Leem Jaewoo)
    -->
    <update id="updateLoadRprtMdfyBlInt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtBlVo">
        /* CarLoadRprtMdfy.updateLoadRprtMdfyBlInt */
        UPDATE TB_CARI_LDUN_RPRT_BL_MDFY SET
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             , pckg_gcnt = #{pckgGcnt}                        /** Nombre De Colis !== 포장개수 ==! */
             , ttwg = #{ttwg}                                 /** Poids Brut !== 총중량 ==! */
             , cbm_vol = #{cbmVol}                            /** Volume (Mtq) !== 입방미터용적 ==! */
             , lir_vol = #{lirVol}                            /** Volume (Litre) !== 리터용적 ==! */
             <if test="inscCfrmDt != null and inscCfrmDt != ''">
             , insc_cfrm_dt = TO_CHAR(TO_DATE( #{inscCfrmDt}, 'YYYY/MM/DD'),'YYYYMMDD')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             </if>
             <if test="apreYnCd != null and apreYnCd != ''">
             , apre_yn_cd = #{apreYnCd}                       /** Autorisation O/N !== 승인여부코드 ==! */
             </if>
             <if test="rtrnRsnCn != null and rtrnRsnCn != ''">
             , rtrn_rsn_cn = #{rtrnRsnCn}                     /** Motif De Rejet !== 반려사유내용 ==! */
             </if>
           WHERE 1=1
             AND LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo} 	/** N° rectification de rapport de chargement  != 정정보고번호 =! */
             AND bl_no = #{blNo}                                /** N° De Bl !== BL번호 ==! */
    </update>
    
    <!--
    Modifier les informations sur 'B/L rapports de chargement'. !==적재 보고 B/L 정보를 수정한다.==!
    (Leem Jaewoo)
    -->
    <update id="updateLoadRprtMdfyBlExt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtBlVo">
        /* CarLoadRprt.updateLoadRprtMdfyBlExt */
        UPDATE ALPASSEXT.TB_CARE_LDUN_RPRT_MDFY_BL SET
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             , pckg_gcnt = #{pckgGcnt}                        /** Nombre De Colis !== 포장개수 ==! */
             , ttwg = #{ttwg}                                 /** Poids Brut !== 총중량 ==! */
             , cbm_vol = #{cbmVol}                            /** Volume (Mtq) !== 입방미터용적 ==! */
             , lir_vol = #{lirVol}                            /** Volume (Litre) !== 리터용적 ==! */
             <if test="inscCfrmDt != null and inscCfrmDt != ''">
             , insc_cfrm_dt = TO_CHAR(TO_DATE( #{inscCfrmDt}, 'YYYY/MM/DD'),'YYYYMMDD')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             </if>
             <if test="apreYnCd != null and apreYnCd != ''">
             , apre_yn_cd = #{apreYnCd}                       /** Autorisation O/N !== 승인여부코드 ==! */
             </if>
             <if test="rtrnRsnCn != null and rtrnRsnCn != ''">
             , rtrn_rsn_cn = #{rtrnRsnCn}                     /** Motif De Rejet !== 반려사유내용 ==! */
             </if>
             WHERE 1=1
             AND ldun_rprt_mdfy_mgrn = #{ldunRprtMdfyMgrn}        /** N° gestion de la rectification de rapport de chargement  != 정정보고관리번호 =! */
             AND bl_no = #{blNo}                                /** N° De Bl !== BL번호 ==! */
    </update>
    
        <!--
    Modifier les informations sur 'Conteneur rapports de chargement'. !==적재 보고 컨테이너 정보를 수정한다.==!
    (Leem Jaewoo)
    -->
    <update id="updateLoadRprtMdfyCntrInt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtCntrVo">
        /* CarLoadRprtMdfy.updateLoadRprtMdfyCntrInt */
        UPDATE TB_CARI_LDUN_RPRT_CNTR_MDFY SET
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             , pckg_gcnt = #{pckgGcnt}                        /** Nombre De Colis !== 포장개수 ==! */
             , pckg_ut_cd = #{pckgUtCd}                       /** Code De L'Unité De Colis !== 포장단위코드 ==! */
             , ttwg = #{ttwg}                                 /** Poids Brut !== 총중량 ==! */
             <if test="inscCfrmDt != null and inscCfrmDt != ''">
             , insc_cfrm_dt = TO_CHAR(TO_DATE( #{inscCfrmDt}, 'YYYY/MM/DD'),'YYYYMMDD')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             </if>
             <if test="apreYnCd != null and apreYnCd != ''">
             , apre_yn_cd = #{apreYnCd}                       /** Autorisation O/N !== 승인여부코드 ==! */
             </if>
             <if test="rtrnRsnCn != null and rtrnRsnCn != ''">
             , rtrn_rsn_cn = #{rtrnRsnCn}                     /** Motif De Rejet !== 반려사유내용 ==! */
             </if>
           WHERE 1=1
             AND LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo} 	/** N° rectification de rapport de chargement  != 정정보고번호 =! */
             AND bl_no = #{blNo}  /** N° De Bl !== BL번호 ==! */
             AND cntr_no = #{cntrNo}                            /** N° De Conteneur !== 컨테이너번호 ==! */
    </update>
    
   <!--
    Modifier les informations sur 'Conteneur rapports de chargement'. !==적재 보고 컨테이너 정보를 수정한다.==!
    (Leem Jaewoo)
    -->
    <update id="updateLoadRprtMdfyCntrExt" parameterType="alpass.ipt.car.load.vo.CarLoadRprtCntrVo">
        /* CarLoadRprt.updateLoadRprtMdfyCntrExt */
        UPDATE ALPASSEXT.TB_CARE_LDUN_RPRT_MDFY_CNTR SET
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             , pckg_gcnt = #{pckgGcnt}                        /** Nombre De Colis !== 포장개수 ==! */
             , pckg_ut_cd = #{pckgUtCd}                       /** Code De L'Unité De Colis !== 포장단위코드 ==! */
             , ttwg = #{ttwg}                                 /** Poids Brut !== 총중량 ==! */
             <if test="inscCfrmDt != null and inscCfrmDt != ''">
             , insc_cfrm_dt = TO_CHAR(TO_DATE( #{inscCfrmDt}, 'YYYY/MM/DD'),'YYYYMMDD')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             </if>
             <if test="apreYnCd != null and apreYnCd != ''">
             , apre_yn_cd = #{apreYnCd}                       /** Autorisation O/N !== 승인여부코드 ==! */
             </if>
             <if test="rtrnRsnCn != null and rtrnRsnCn != ''">
             , rtrn_rsn_cn = #{rtrnRsnCn}                     /** Motif De Rejet !== 반려사유내용 ==! */
             </if>
           WHERE 1=1
             AND ldun_rprt_mdfy_mgrn = #{ldunRprtMdfyMgrn}       /** N° gestion de la rectification de rapport de chargement  != 정정보고관리번호 =! */
             AND bl_no = #{blNo}                               /** N° De Bl !== BL번호 ==! */
             AND cntr_no = #{cntrNo}                           /** N° De Conteneur !== 컨테이너번호 ==! */
    </update>
    
    
    
    
    
    <!--
    Appliquer les observations du contrôle(Marchandises non TC) !==심사의견을 적용한다(컨테이너에 안실린 화물)==!
    -->
    <update id="apreYnCdCarLoadRprtMdfyBl" parameterType="alpass.ipt.car.load.vo.CarLoadRprtBlVo">
        /* apreYnCdCarLoadRprtMdfyBl */
        UPDATE TB_CARI_LDUN_RPRT_BL_MDFY SET
               insc_cfrm_dt = TO_CHAR(TO_DATE( #{inscCfrmDt}, 'YYYY/MM/DD'),'YYYYMMDD')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             , apre_yn_cd = #{apreYnCd}                       /** Autorisation O/N !== 승인여부코드 ==! */
             , rtrn_rsn_cn = #{rtrnRsnCn}                     /** Motif De Rejet !== 반려사유내용 ==! */
             WHERE 1=1
             AND LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo}        /** N° gestion de la rectification de rapport de chargement  != 정정보고관리번호 =! */
									<if test="aplyTp != null and aplyTp != ''">
										<!-- 적용 -->
										<if test="aplyTp == 'aply'">
							             AND bl_no = #{blNo}                              /** N° De Bl !== BL번호 ==! */
										</if>
										<!-- 일괄적용 -->
										<if test="aplyTp == 'bndlAply'">
											<if test='nrmlYn != null and nrmlYn == "Y"'>
							             AND dscr_tp_cd = 'OK'                /** Déficit/Excédent != 불일치구분코드 =! */
											</if>
											<if test='nrmlYn != null and nrmlYn == "N"'>
							             AND dscr_tp_cd != 'OK'               /** Déficit/Excédent != 불일치구분코드 =! */
											</if>
										</if>
									</if>
			    </update>
    
    <!--
     Appliquer en bloc les observations du contrôle(Marchandises non TC) !==심사의견을 일괄 적용한다(컨테이너에 안실린 화물)==!
    -->
    <update id="apreYnCdCarLoadRprtMdfyCntr" parameterType="alpass.ipt.car.load.vo.CarLoadRprtCntrVo">
        /* apreYnCdCarLoadRprtMdfyCntr */
        UPDATE TB_CARI_LDUN_RPRT_CNTR_MDFY SET
               insc_cfrm_dt = TO_CHAR(TO_DATE( #{inscCfrmDt}, 'YYYY/MM/DD'),'YYYYMMDD')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             , apre_yn_cd = #{apreYnCd}                       /** Autorisation O/N !== 승인여부코드 ==! */
             , rtrn_rsn_cn = #{rtrnRsnCn}                     /** Motif De Rejet !== 반려사유내용 ==! */
         WHERE 1=1
           AND LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo} 	/** N° rectification de rapport de chargement  != 정정보고번호 =! */
								<if test="aplyTp != null and aplyTp != ''">
									<!-- 적용 -->
									<if test="aplyTp == 'aply'">
						           AND bl_no = #{blNo}                              /** N° De Bl !== BL번호 ==! */
						           AND cntr_no = #{cntrNo}                    /** N° De Conteneur !== 컨테이너번호 ==! */
									</if>
									<!-- 일괄적용 -->
									<if test="aplyTp == 'bndlAply'">
										<if test='nrmlYn != null and nrmlYn == "Y"'>
						           AND dscr_tp_cd = 'OK'                /** Déficit/Excédent != 불일치구분코드 =! */
										</if>
										<if test='nrmlYn != null and nrmlYn == "N"'>
						           AND dscr_tp_cd != 'OK'               /** Déficit/Excédent != 불일치구분코드 =! */
										</if>
									</if>
								</if>
    </update>
    
    
    
    <!--
     Appliquer les observations du contrôle(Marchandises TC) !==심사의견을 적용한다(컨테이너에 실린 화물)==!
    -->
    <select id="checkApreYnCdLoadRprtMdfy" parameterType="alpass.ipt.car.load.vo.CarLoadRprtVo" resultType="int">
        /* ccheckApreYnCdLoadRprtMdfy */
         SELECT ( T1.CNT + T2.CNT ) CNT
											FROM   (SELECT COUNT(*) CNT
											        FROM   TB_CARI_LDUN_RPRT_BL_MDFY
											        WHERE  LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo}
											        <if test='apreYnCd != null and apreYnCd == "Y"'>
											               AND APRE_YN_CD IS NULL
											        </if>
											        <if test='apreYnCd != null and apreYnCd == "N"'>
											               AND APRE_YN_CD = 'N'
											        </if>
											               ) T1,
											       (SELECT COUNT(*) CNT
											        FROM   TB_CARI_LDUN_RPRT_CNTR_MDFY
											        WHERE  LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo}
											        <if test='apreYnCd != null and apreYnCd == "Y"'>
											               AND APRE_YN_CD IS NULL
											        </if>
											        <if test='apreYnCd != null and apreYnCd == "N"'>
											               AND APRE_YN_CD = 'N'
											        </if>
											               ) T2 
    </select>
    
    <!--
    Appliquer en bloc les observations du contrôle(Marchandises TC) !==심사의견을 일괄 적용한다(컨테이너에 실린 화물)==!
    -->
    <select id="selectCheckApreYnCdLoadRprtMdfyBl" parameterType="alpass.ipt.car.load.vo.CarLoadRprtBlVo" resultType="alpass.ipt.car.load.vo.CarLoadRprtBlVo">
        /* selectCheckApreYnCdLoadRprtMdfyBl */
        SELECT BL_NO
          FROM TB_CARI_LDUN_RPRT_BL_MDFY
         WHERE LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo}
		<if test='apreYnCd != null and apreYnCd == "Y"'>
           AND APRE_YN_CD IS NULL
		</if>
		<if test='apreYnCd != null and apreYnCd == "N"'>
           AND APRE_YN_CD = 'N'
		</if>
    </select>
    
    <!--
    Vérifier s'il existe des cas qui ont fait un contrôle ou pas et des cas qui ont été rejetés !==심사여부 및 기각 건이 있는지 확인==!
    -->
    <select id="selectCheckApreYnCdLoadRprtMdfyCntr" parameterType="alpass.ipt.car.load.vo.CarLoadRprtCntrVo" resultType="alpass.ipt.car.load.vo.CarLoadRprtCntrVo">
        /* selectCheckApreYnCdLoadRprtMdfyCntr */
        SELECT BL_NO, CNTR_NO
          FROM TB_CARI_LDUN_RPRT_CNTR_MDFY
         WHERE LDUN_RPRT_MDFY_NO = #{ldunRprtMdfyNo}
		<if test='apreYnCd != null and apreYnCd == "Y"'>
           AND APRE_YN_CD IS NULL
		</if>
		<if test='apreYnCd != null and apreYnCd == "N"'>
           AND APRE_YN_CD = 'N'
		</if>
    </select>
    
    
    
    
    
    
    
    
    
    

</mapper>
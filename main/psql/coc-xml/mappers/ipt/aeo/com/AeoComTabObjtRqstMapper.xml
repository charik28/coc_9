<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
Mapper : [OEA commun] L'onglet Demande de recours de la demande d'agrément !== [AEO 공통] 공인신청서 이의신청 탭 Mapper ==!
(wonjun.cha)
-->
<mapper namespace="alpass.ipt.aeo.com.mapper.AeoComTabObjtRqstMapper">

    <!--
    [OEA commun] Consulter la liste des demandes de recours !==[AEO 공통] 이의신청 목록 조회==!
    -->
	<select id="selectAeoComObjtRqstList"
	    parameterType="alpass.ipt.aeo.com.vo.AeoComObjtRqstVo"
	    resultType="alpass.ipt.aeo.com.vo.AeoComObjtRqstVo">
		/* selectAeoComObjtRqstList */
	    <include refid="pagination.header"/>
		SELECT
				  A.AEO_ATHR_RQST_NO           /** Numéro de demande du statut OEA !== AEO공인신청번호 ==! */
                , A.OBJT_RQST_ACAP_NO          /** N° de reception de demande de contestation !== 이의신청접수번호 ==! */
                , A.OBJT_RQST_TP_CD            /** Code de classification de demande de recours !== 이의신청구분코드 ==! */
                , FN_GET_CD_VDVAL_NM('AEO_0010', A.OBJT_RQST_TP_CD, #{langCd}) AS OBJT_RQST_TP_NM            /** Code de classification de demande de recours !== 이의신청구분코드 ==! */
                , A.OBJT_RQST_CN               /** Contenus de demande de recours !== 이의신청내용 ==! */
                , TO_CHAR(A.RQST_DTTM, 'DD/MM/YYYY') AS RQST_DTTM                  /** Date Et Heure De La Demande !== 신청일시 ==! */
                , A.RESP_CSTM_CD               /** Code de bureau de douane compétent !== 담당세관코드 ==! */
                , (SELECT ORGN_NM FROM  TB_POTI_ORGN WHERE ORGN_MGMT_CD = UPPER(A.RESP_CSTM_CD)) AS RESP_CSTM_NM               /** Code de bureau de douane compétent !== 담당세관코드 ==! */
                , A.CHPN_DEPT_CD               /** Code De Service En Charge !== 담당부서코드 ==! */
                , (SELECT ORGN_NM FROM  TB_POTI_ORGN WHERE ORGN_MGMT_CD = UPPER(A.CHPN_DEPT_CD)) AS CHPN_DEPT_NM               /** Code De Service En Charge !== 담당부서코드 ==! */
                , A.CHPN_ID                    /** Id Du Responsable !== 담당자ID ==! */
                , (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.CHPN_ID) AS CHPN_NM                    /** Id Du Responsable !== 담당자ID ==! */
				, CASE WHEN A.ANSW_DTTM IS NULL AND A.CHPN_ID != #{lastChprId} THEN ''
				       ELSE A.OBJT_RQST_ANSW_CN
				  END OBJT_RQST_ANSW_CN        /** Contenus de réponse de demande de recours !== 이의신청답변내용 ==! */
                , TO_CHAR(A.ANSW_DTTM, 'DD/MM/YYYY') AS ANSW_DTTM                  /** Date/Heure De Réponse !== 답변일시 ==! */
                , A.RMRK                       /** Remarque !== 비고 ==! */
                , A.DEL_YN                     /** Suppression On !== 삭제여부 ==! */
                , A.FRST_REGST_ID              /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
				, (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.FRST_REGST_ID) AS FRST_REGST_NM
				, TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS frstRgsrDttm			/** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
				, A.LAST_CHPR_ID				/** Id Du Modificateur Final !== 최종변경자ID ==! */
				, (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.LAST_CHPR_ID) AS LAST_CHPR_NM
				, TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS lastChgDttm				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
				, A.OBJT_RQST_ATCH_FILE_ID      /** Pièce jointe à la demande de recours !== 이의신청첨부파일ID ==! */
				, CASE WHEN A.ANSW_DTTM IS NULL AND A.CHPN_ID != #{lastChprId} THEN ''
				       ELSE A.OBJT_ANSW_ATCH_FILE_ID
				  END OBJT_ANSW_ATCH_FILE_ID    /** Pièce jointe à la réponse après demande de recours !== 이의답변첨부파일ID ==! */
		  FROM
		  		  TB_AEOI_OBJT_RQST A           /** AEOI_DEMANDE DE RECOURS !== AEOI_이의신청 ==! */
		 WHERE
		 		  A.DEL_YN = 'N'									/** Suppression ON !== 삭제여부 ==! */
           AND	  A.AEO_ATHR_RQST_NO = #{aeoAthrRqstNo}       		/** Numéro de demande du statut OEA !== AEO공인신청번호 ==! */
		   AND	  A.RQST_DTTM IS NOT NULL                           /** Date Et Heure De La Demande !== 신청일시 ==! */
         ORDER BY A.LAST_CHG_DTTM DESC
		<include refid="pagination.footer"/>
	</select>

    <!--
    [OEA commun] Consulter des demandes de recours !==[AEO 공통] 이의신청 조회==!
    -->
	<select id="selectAeoComObjtRqst"
	    parameterType="alpass.ipt.aeo.com.vo.AeoComObjtRqstVo"
	    resultType="alpass.ipt.aeo.com.vo.AeoComObjtRqstVo">
		/* selectAeoComObjtRqst */
		SELECT
				  A.AEO_ATHR_RQST_NO           /** Numéro de demande du statut OEA !== AEO공인신청번호 ==! */
                , A.OBJT_RQST_ACAP_NO          /** N° de reception de demande de contestation !== 이의신청접수번호 ==! */
                , A.OBJT_RQST_TP_CD            /** Code de classification de demande de recours !== 이의신청구분코드 ==! */
                , FN_GET_CD_VDVAL_NM('AEO_0010', A.OBJT_RQST_TP_CD, #{langCd}) AS OBJT_RQST_TP_NM            /** Code de classification de demande de recours !== 이의신청구분코드 ==! */
                , A.OBJT_RQST_CN               /** Contenus de demande de recours !== 이의신청내용 ==! */
                , TO_CHAR(A.RQST_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS RQST_DTTM                  /** Date Et Heure De La Demande !== 신청일시 ==! */
                , A.RESP_CSTM_CD               /** Code de bureau de douane compétent !== 담당세관코드 ==! */
                , (SELECT ORGN_NM FROM  TB_POTI_ORGN WHERE ORGN_MGMT_CD = UPPER(A.RESP_CSTM_CD)) AS RESP_CSTM_NM               /** Code de bureau de douane compétent !== 담당세관코드 ==! */
                , A.CHPN_DEPT_CD               /** Code De Service En Charge !== 담당부서코드 ==! */
                , (SELECT ORGN_NM FROM  TB_POTI_ORGN WHERE ORGN_MGMT_CD = UPPER(A.CHPN_DEPT_CD)) AS CHPN_DEPT_NM               /** Code De Service En Charge !== 담당부서코드 ==! */
                , A.CHPN_ID                    /** Id Du Responsable !== 담당자ID ==! */
                , (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.CHPN_ID) AS CHPN_NM                    /** Id Du Responsable !== 담당자ID ==! */
                , A.OBJT_RQST_ANSW_CN          /** Contenus de réponse de demande de recours !== 이의신청답변내용 ==! */
                , TO_CHAR(A.ANSW_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS ANSW_DTTM                  /** Date/Heure De Réponse !== 답변일시 ==! */
                , A.RMRK                       /** Remarque !== 비고 ==! */
                , A.DEL_YN                     /** Suppression On !== 삭제여부 ==! */
                , A.FRST_REGST_ID              /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
				, (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.FRST_REGST_ID) AS FRST_REGST_NM
				, TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS frstRgsrDttm			/** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
				, A.LAST_CHPR_ID				/** Id Du Modificateur Final !== 최종변경자ID ==! */
				, (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.LAST_CHPR_ID) AS LAST_CHPR_NM
				, TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS lastChgDttm				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		  FROM
		  		  TB_AEOI_OBJT_RQST A                               /** AEOI_DEMANDE DE RECOURS !== AEOI_이의신청 ==! */
		 WHERE
		 		  A.DEL_YN = 'N'									/** Suppression ON !== 삭제여부 ==! */
		 <if test='aeoAthrRqstNo != null and !"".equals(aeoAthrRqstNo)'>
           AND	  A.AEO_ATHR_RQST_NO = #{aeoAthrRqstNo}       		/** Numéro de demande du statut OEA !== AEO공인신청번호 ==! */
         </if>
		 <if test='objtRqstAcapNo != null and !"".equals(objtRqstAcapNo)'>
           AND	  A.OBJT_RQST_ACAP_NO = #{objtRqstAcapNo}       	/** N° de reception de demande de contestation !== 이의신청접수번호 ==! */
         </if>
		 <if test='objtRqstTpCd != null and !"".equals(objtRqstTpCd)'>
           AND	  A.OBJT_RQST_TP_CD = #{objtRqstTpCd}       		/** Code de classification de demande de recours !== 이의신청구분코드 ==! */
         </if>
	</select>
	
    <!--
    [OEA commun] Enregistrer la demande de recours !==[AEO 공통] 이의신청 등록==!
    -->
	<insert id="insertAeoComObjtRqst"
		parameterType="alpass.ipt.aeo.com.vo.AeoComObjtRqstVo">
		/* insertAeoComObjtRqst */
        WITH UPSERT AS  (
			UPDATE TB_AEOI_OBJT_RQST                        /** AEOI_DEMANDE DE RECOURS !== AEOI_이의신청 ==! */
			   SET
					  LAST_CHPR_ID = #{lastChprId}          /** Id Du Modificateur Final !== 최종변경자ID ==! */            
					, LAST_CHG_DTTM = CURRENT_TIMESTAMP		/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */ 
		    	<if test='objtRqstTpCd != null and !"".equals(objtRqstTpCd)'>
					, OBJT_RQST_TP_CD = #{objtRqstTpCd}           /** Code de classification de demande de recours !== 이의신청구분코드 ==! */
	            </if>
		    	<if test='objtRqstCn != null and !"".equals(objtRqstCn)'>
	                , OBJT_RQST_CN = #{objtRqstCn}                /** Contenus de demande de recours !== 이의신청내용 ==! */
	            </if>
		    	<if test='respCstmCd != null and !"".equals(respCstmCd)'>
	                , RESP_CSTM_CD = #{respCstmCd}                /** Code de bureau de douane compétent !== 담당세관코드 ==! */
	            </if>
		    	<if test='chpnDeptCd != null and !"".equals(chpnDeptCd)'>
	                , CHPN_DEPT_CD = #{chpnDeptCd}                /** Code De Service En Charge !== 담당부서코드 ==! */
	            </if>
		    	<if test='chpnId != null and !"".equals(chpnId)'>
	                , CHPN_ID = #{chpnId}                         /** Id Du Responsable !== 담당자ID ==! */
	            </if>
		    	<if test='objtRqstAnswCn != null and !"".equals(objtRqstAnswCn)'>
	                , OBJT_RQST_ANSW_CN = #{objtRqstAnswCn}       /** Contenus de réponse de demande de recours !== 이의신청답변내용 ==! */
	            </if>
		    	<if test='rmrk != null and !"".equals(rmrk)'>
	                , RMRK = #{rmrk}                              /** Remarque !== 비고 ==! */
	            </if>
			 WHERE
            		  AEO_ATHR_RQST_NO = #{aeoAthrRqstNo}         /** Numéro de demande du statut OEA !== AEO공인신청번호 ==! */
              	AND	  OBJT_RQST_ACAP_NO = #{objtRqstAcapNo}       /** N° de reception de demande de contestation !== 이의신청접수번호 ==! */
              	AND	  OBJT_RQST_TP_CD = #{objtRqstTpCd}           /** Code de classification de demande de recours !== 이의신청구분코드 ==! */
		     RETURNING *
        )
		INSERT INTO TB_AEOI_OBJT_RQST (             /** AEOI_DEMANDE DE RECOURS !== AEOI_이의신청 ==! */
					  AEO_ATHR_RQST_NO              /** Numéro de demande du statut OEA !== AEO공인신청번호 ==! */
	                , OBJT_RQST_ACAP_NO             /** N° de reception de demande de contestation !== 이의신청접수번호 ==! */
	                , OBJT_RQST_TP_CD               /** Code de classification de demande de recours !== 이의신청구분코드 ==! */
	                , OBJT_RQST_CN                  /** Contenus de demande de recours !== 이의신청내용 ==! */
	                , RMRK                          /** Remarque !== 비고 ==! */
	                , DEL_YN                        /** Suppression On !== 삭제여부 ==! */
					, FRST_REGST_ID					/** Id Du Premier Enregistrant !== 최초등록자ID ==! */
					, FRST_RGSR_DTTM				/** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
					, LAST_CHPR_ID					/** Id Du Modificateur Final !== 최종변경자ID ==! */
					, LAST_CHG_DTTM					/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		)
		SELECT
					  #{aeoAthrRqstNo}              /** Numéro de demande du statut OEA !== AEO공인신청번호 ==! */
	                , #{objtRqstAcapNo}             /** N° de reception de demande de contestation !== 이의신청접수번호 ==! */
	                , #{objtRqstTpCd}               /** Code de classification de demande de recours !== 이의신청구분코드 ==! */
	                , #{objtRqstCn}                 /** Contenus de demande de recours !== 이의신청내용 ==! */
	                , #{rmrk}                       /** Remarque !== 비고 ==! */
	                , 'N'                          	/** Suppression On !== 삭제여부 ==! */
					, #{frstRegstId}          		/** Id Du Premier Enregistrant !== 최초등록자ID ==! */
					, CURRENT_TIMESTAMP          	/** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */   
					, #{lastChprId}          		/** Id Du Modificateur Final !== 최종변경자ID ==! */                 
					, CURRENT_TIMESTAMP          	/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		 WHERE	NOT EXISTS (SELECT * FROM UPSERT)
	</insert>

    <!--
    [OEA commun] Modifier la demande de recours !==[AEO 공통] 이의신청 수정==!
    -->
	<update id="updateAeoComObjtRqst"
		parameterType="alpass.ipt.aeo.com.vo.AeoComObjtRqstVo">
		/* updateAeoComObjtRqst */
		UPDATE	  TB_AEOI_OBJT_RQST                                 /** AEOI_DEMANDE DE RECOURS !== AEOI_이의신청 ==! */
		   SET
				  LAST_CHPR_ID = #{lastChprId}          			/** Id Du Modificateur Final !== 최종변경자ID ==! */
				, LAST_CHG_DTTM = CURRENT_TIMESTAMP					/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
                , OBJT_RQST_ANSW_CN = #{objtRqstAnswCn}         	/** Contenus de réponse de demande de recours !== 이의신청답변내용 ==! */
			<if test='objtAnswAtchFileId != null and !"".equals(objtAnswAtchFileId)'>
				, OBJT_ANSW_ATCH_FILE_ID = #{objtAnswAtchFileId}	/** Pièce jointe à la réponse après demande de recours !== 이의답변첨부파일ID ==! */
			</if>
	    	<if test='respCstmCd != null and !"".equals(respCstmCd)'>
                , RESP_CSTM_CD = #{respCstmCd}                /** Code de bureau de douane compétent !== 담당세관코드 ==! */
            </if>
	    	<if test='chpnDeptCd != null and !"".equals(chpnDeptCd)'>
                , CHPN_DEPT_CD = #{chpnDeptCd}                /** Code De Service En Charge !== 담당부서코드 ==! */
            </if>
	    	<if test='chpnId != null and !"".equals(chpnId)'>
                , CHPN_ID = #{chpnId}                         /** Id Du Responsable !== 담당자ID ==! */
            </if>
	    	<if test='rmrk != null and !"".equals(rmrk)'>
                , RMRK = #{rmrk}                              /** Remarque !== 비고 ==! */
            </if>
		 WHERE
           		  DEL_YN = 'N'                                	/** Suppression ON !== 삭제여부 ==! */
           AND	  AEO_ATHR_RQST_NO = #{aeoAthrRqstNo}           /** Numéro de demande du statut OEA !== AEO공인신청번호 ==! */
           AND	  OBJT_RQST_ACAP_NO = #{objtRqstAcapNo}         /** N° de reception de demande de contestation !== 이의신청접수번호 ==! */
           AND	  OBJT_RQST_TP_CD = #{objtRqstTpCd}             /** Code de classification de demande de recours !== 이의신청구분코드 ==! */
	</update>

    <!--
    [OEA commun] Supprimer la demande de recours !==[AEO 공통] 이의신청 삭제==!
    -->
	<update id="deleteAeoComObjtRqst"
		parameterType="alpass.ipt.aeo.com.vo.AeoComObjtRqstVo">
		  /* deleteAeoComObjtRqst */
		  UPDATE  TB_AEOI_OBJT_RQST                             /** AEOI_DEMANDE DE RECOURS !== AEOI_이의신청 ==! */
		     SET
				  LAST_CHPR_ID = #{lastChprId}          		/** Id Du Modificateur Final !== 최종변경자ID ==! */            
				, LAST_CHG_DTTM = CURRENT_TIMESTAMP				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */ 
		  		, DEL_YN = 'Y'									/** Suppression On !== 삭제여부 ==! */ 
		   WHERE
		  		  DEL_YN = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             AND  AEO_ATHR_RQST_NO = #{aeoAthrRqstNo}           /** Numéro de demande du statut OEA !== AEO공인신청번호 ==! */
             AND  OBJT_RQST_ACAP_NO = #{objtRqstAcapNo}         /** N° de reception de demande de contestation !== 이의신청접수번호 ==! */
             AND  OBJT_RQST_TP_CD = #{objtRqstTpCd}             /** Code de classification de demande de recours !== 이의신청구분코드 ==! */
	</update>

    <!--
    [OEA commun] Notifier la demande de recours !==[AEO 공통] 이의신청 통보==!
    -->
	<update id="updateAeoComObjtRqstNotify"
		parameterType="alpass.ipt.aeo.com.vo.AeoComObjtRqstVo">
		/* notifyAeoComObjtRqst */
		UPDATE	  TB_AEOI_OBJT_RQST                                 /** AEOI_DEMANDE DE RECOURS !== AEOI_이의신청 ==! */
		   SET
				  LAST_CHPR_ID = #{lastChprId}          			/** Id Du Modificateur Final !== 최종변경자ID ==! */
				, LAST_CHG_DTTM = CURRENT_TIMESTAMP					/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
                , OBJT_RQST_ANSW_CN = #{objtRqstAnswCn}       		/** Contenus de réponse de demande de recours !== 이의신청답변내용 ==! */
		        , ANSW_DTTM = CURRENT_TIMESTAMP                 	/** Date/Heure De Réponse !== 답변일시 ==! */
			<if test='objtAnswAtchFileId != null and !"".equals(objtAnswAtchFileId)'>
				, OBJT_ANSW_ATCH_FILE_ID = #{objtAnswAtchFileId}	/** Pièce jointe à la réponse après demande de recours !== 이의답변첨부파일ID ==! */
			</if>
			<if test='respCstmCd != null and !"".equals(respCstmCd)'>
                , RESP_CSTM_CD = #{respCstmCd}                /** Code de bureau de douane compétent !== 담당세관코드 ==! */
            </if>
	    	<if test='chpnDeptCd != null and !"".equals(chpnDeptCd)'>
                , CHPN_DEPT_CD = #{chpnDeptCd}                /** Code De Service En Charge !== 담당부서코드 ==! */
            </if>
	    	<if test='chpnId != null and !"".equals(chpnId)'>
                , CHPN_ID = #{chpnId}                         /** Id Du Responsable !== 담당자ID ==! */
            </if>
	    	<if test='rmrk != null and !"".equals(rmrk)'>
                , RMRK = #{rmrk}                              /** Remarque !== 비고 ==! */
            </if>
		 WHERE
           		  DEL_YN = 'N'                                	/** Suppression ON !== 삭제여부 ==! */
           AND	  AEO_ATHR_RQST_NO = #{aeoAthrRqstNo}           /** Numéro de demande du statut OEA !== AEO공인신청번호 ==! */
           AND	  OBJT_RQST_ACAP_NO = #{objtRqstAcapNo}         /** N° de reception de demande de contestation !== 이의신청접수번호 ==! */
           AND	  OBJT_RQST_TP_CD = #{objtRqstTpCd}             /** Code de classification de demande de recours !== 이의신청구분코드 ==! */
	</update>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="alpass.ipt.col.fine.mapper.ColVltnCdMgmtMapper">

    <!--
    Voir la liste des Gérer les codes d'infraction !== 위반코드관리 목록 조회 ==!
    -->
    <select id="selectColVltnCdList" parameterType="alpass.ipt.col.fine.vo.ColVltnCdMgmtVo" resultType="alpass.ipt.col.fine.vo.ColVltnCdMgmtVo">
        /* ColVltnCdMgmt_selectColVltnCdList */
        SELECT
              A.VLTN_CD                    /** Code d'infraction !== 위반코드 ==! */
            , A.VLTN_CD_NM                 /** Libellé infraction !== 위반코드명 ==! */
            , A.VLTN_CD_DESC               /** Qualification de l'infraction !== 위반코드설명 ==! */
            , A.VLTN_CD_CN                 /** Contenu du code d'infraction !== 위반코드내용 ==! */
            , A.LWLM_AMT                   /** Montant plancher !== 하한금액 ==! */
            , A.UPLM_AMT                   /** Montant plafonne !== 상한금액 ==! */
            , A.FINE_TAX_CD                /** Code de taxe concernant les amendes !== 벌금세금코드 ==! */
            , A.BSOP_TP_CD                 /** Code de catégorie de service !== 업무구분코드 ==! */
            , A.USE_YN                     /** Utilise ON !== 사용여부 ==! */
            , A.DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
            , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
            , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
            , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
            , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
        FROM   TB_COLI_VLTN_CD A
       WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
       <if test="vltnCd != null and vltnCd != ''">
         AND  A.VLTN_CD = TRIM(#{vltnCd})                       /** Code d'infraction !== 위반코드 ==! */
       </if>
       <if test="bsopTpCd != null and bsopTpCd != ''">
         AND  A.BSOP_TP_CD IN                             /** Code de catégorie de service !== 업무구분코드 ==! */
         (
		    SELECT trim(regexp_substr(str, '[^,]+', 1, LEVEL)) str
		    FROM (SELECT #{bsopTpCd} str FROM dual)
		    CONNECT BY instr(str, ',', 1, LEVEL - 1) > 0         
         ) 
       </if>
       <if test="useYn != null and useYn != ''">
         AND  A.USE_YN = #{useYn}                       /** Code d'infraction !== 위반코드 ==! */
       </if>
    </select>
    
    <!--
    Vérification des clés redondantes !==중복키 검사==!
    -->
    <select id="selectColVltnCdMgmtCnt" parameterType="alpass.ipt.col.fine.vo.ColVltnCdMgmtVo" resultType="int">
        /* ColVltnCdMgmt_selectColVltnCdMgmtCnt */
        SELECT
            COUNT(*) CNT
        FROM   TB_COLI_VLTN_CD A
       WHERE  A.VLTN_CD = TRIM(#{vltnCd})                       /** Code d'infraction !== 위반코드 ==! */
    </select>    
    
    <!--
    Voir la liste des Gérer les codes d'infraction !== 위반코드관리 목록 조회 ==!
    -->
    <select id="selectColVltnCdMgmtList" parameterType="alpass.ipt.col.fine.vo.ColVltnCdMgmtVo" resultType="alpass.ipt.col.fine.vo.ColVltnCdMgmtVo">
        /* ColVltnCdMgmt_selectColVltnCdMgmtList */
        <include refid="pagination.header" />
            SELECT
                  A.VLTN_CD                    /** Code d'infraction !== 위반코드 ==! */
                , A.VLTN_CD_NM                 /** Libellé infraction !== 위반코드명 ==! */
                , A.VLTN_CD_DESC               /** Qualification de l'infraction !== 위반코드설명 ==! */
                , A.VLTN_CD_CN                 /** Contenu du code d'infraction !== 위반코드내용 ==! */
                , A.LWLM_AMT                   /** Montant plancher !== 하한금액 ==! */
                , A.UPLM_AMT                   /** Montant plafonne !== 상한금액 ==! */
                , A.FINE_TAX_CD                /** Code de taxe concernant les amendes !== 벌금세금코드 ==! */
                , A.BSOP_TP_CD                 /** Code de catégorie de service !== 업무구분코드 ==! */
                , A.USE_YN                     /** Utilise ON !== 사용여부 ==! */
                , A.DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
                , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
                , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
                , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
                , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
            FROM   TB_COLI_VLTN_CD A
           WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
           <if test="vltnCd != null and vltnCd != ''">
             AND  A.VLTN_CD LIKE TRIM(#{vltnCd}) || '%'                       /** Code d'infraction !== 위반코드 ==! */
           </if>
           <if test="bsopTpCd != null and bsopTpCd != ''">
             AND  A.BSOP_TP_CD = #{bsopTpCd}                       /** Code de catégorie de service !== 업무구분코드 ==! */
           </if>
           <if test="useYn != null and useYn != ''">
             AND  A.USE_YN = #{useYn}                       /** Code d'infraction !== 위반코드 ==! */
           </if>
           ORDER BY VLTN_CD
        <include refid="pagination.footer" />
    </select>

    <!--
    Consulter un seul cas dans la gestion des codes d'infraction !== 위반코드관리 단건 조회 ==!
    -->
    <select id="selectColVltnCdMgmt" parameterType="alpass.ipt.col.fine.vo.ColVltnCdMgmtVo" resultType="alpass.ipt.col.fine.vo.ColVltnCdMgmtVo">
        /* ColVltnCdMgmt_selectColVltnCdMgmt */
            SELECT
                  A.VLTN_CD                    /** Code d'infraction !== 위반코드 ==! */
                , A.VLTN_CD_NM                 /** Libellé infraction !== 위반코드명 ==! */
                , A.VLTN_CD_DESC               /** Qualification de l'infraction !== 위반코드설명 ==! */
                , A.VLTN_CD_CN                 /** Contenu du code d'infraction !== 위반코드내용 ==! */
                , A.LWLM_AMT                   /** Montant plancher !== 하한금액 ==! */
                , A.UPLM_AMT                   /** Montant plafonne !== 상한금액 ==! */
                , A.FINE_TAX_CD                /** Code de taxe concernant les amendes !== 벌금세금코드 ==! */
                , A.BSOP_TP_CD                 /** Code de catégorie de service !== 업무구분코드 ==! */
                , A.USE_YN                     /** Utilise ON !== 사용여부 ==! */
                , A.DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
                , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
                , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
                , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
                , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
            FROM   TB_COLI_VLTN_CD A
           WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
             AND  A.VLTN_CD = TRIM(#{vltnCd})                       /** Code d'infraction !== 위반코드 ==! */
    </select>


    <!--
    Enregistrement de la Gérer les codes d'infraction !== 위반코드관리 등록 ==!
    -->
    <insert id="insertColVltnCdMgmt" parameterType="alpass.ipt.col.fine.vo.ColVltnCdMgmtVo">
        /* ColVltnCdMgmt_insertColVltnCdMgmt */
        with upsert as
        (
            UPDATE TB_COLI_VLTN_CD
            SET VLTN_CD_NM     = #{vltnCdNm} /** Libellé infraction !== 위반코드명 ==! */
              , VLTN_CD_DESC   = #{vltnCdDesc} /** Qualification de l'infraction !== 위반코드설명 ==! */
              , VLTN_CD_CN     = #{vltnCdCn} /** Contenu du code d'infraction !== 위반코드내용 ==! */
              , LWLM_AMT       = #{lwlmAmt} /** Montant plancher !== 하한금액 ==! */
              , UPLM_AMT       = #{uplmAmt} /** Montant plafonne !== 상한금액 ==! */
              , FINE_TAX_CD    = #{fineTaxCd} /** Code de taxe concernant les amendes !== 벌금세금코드 ==! */
              , BSOP_TP_CD     = #{bsopTpCd} /** Code de catégorie de service !== 업무구분코드 ==! */
              , USE_YN         = #{useYn} /** Utilise ON !== 사용여부 ==! */
              , DEL_YN         = 'N' /** Suppression ON !== 삭제여부 ==! */
              , FRST_REGST_ID  = #{frstRegstId} /** ID du premier enregistrant  !== 최초등록자ID ==! */
              , FRST_RGSR_DTTM = SYSTIMESTAMP /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
              , LAST_CHPR_ID   = #{lastChprId} /** ID du modificateur final !== 최종변경자ID ==! */
              , LAST_CHG_DTTM  = SYSTIMESTAMP /** Date et heure de modification finale !== 최종변경일시 ==! */
            WHERE VLTN_CD = TRIM(#{vltnCd})
            returning *
        )
        INSERT INTO TB_COLI_VLTN_CD
        (
             VLTN_CD /** Code d'infraction !== 위반코드 ==! */
            , VLTN_CD_NM /** Libellé infraction !== 위반코드명 ==! */
            , VLTN_CD_DESC /** Qualification de l'infraction !== 위반코드설명 ==! */
            , VLTN_CD_CN /** Contenu du code d'infraction !== 위반코드내용 ==! */
            , LWLM_AMT /** Montant plancher !== 하한금액 ==! */
            , UPLM_AMT /** Montant plafonne !== 상한금액 ==! */
            , FINE_TAX_CD /** Code de taxe concernant les amendes !== 벌금세금코드 ==! */
            , BSOP_TP_CD /** Code de catégorie de service !== 업무구분코드 ==! */
            , USE_YN /** Utilise ON !== 사용여부 ==! */
            , DEL_YN /** Suppression ON !== 삭제여부 ==! */
            , FRST_REGST_ID /** ID du premier enregistrant  !== 최초등록자ID ==! */
            , FRST_RGSR_DTTM /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
            , LAST_CHPR_ID /** ID du modificateur final !== 최종변경자ID ==! */
            , LAST_CHG_DTTM /** Date et heure de modification finale !== 최종변경일시 ==! */
        )
        SELECT
            TRIM(#{vltnCd}) /** Code d'infraction !== 위반코드 ==! */
             , #{vltnCdNm} /** Libellé infraction !== 위반코드명 ==! */
             , #{vltnCdDesc} /** Qualification de l'infraction !== 위반코드설명 ==! */
             , #{vltnCdCn} /** Contenu du code d'infraction !== 위반코드내용 ==! */
             , #{lwlmAmt} /** Montant plancher !== 하한금액 ==! */
             , #{uplmAmt} /** Montant plafonne !== 상한금액 ==! */
             , #{fineTaxCd} /** Code de taxe concernant les amendes !== 벌금세금코드 ==! */
             , #{bsopTpCd} /** Code de catégorie de service !== 업무구분코드 ==! */
             , #{useYn} /** Utilise ON !== 사용여부 ==! */
             , 'N' /** Suppression ON !== 삭제여부 ==! */
             , #{frstRegstId} /** ID du premier enregistrant  !== 최초등록자ID ==! */
             , SYSTIMESTAMP /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
             , #{lastChprId} /** ID du modificateur final !== 최종변경자ID ==! */
             , SYSTIMESTAMP /** Date et heure de modification finale !== 최종변경일시 ==! */
        WHERE NOT exists (select * from upsert)
    </insert>


    <!--
    Modifier la Gérer les codes d'infraction !== 위반코드관리 수정 ==!
    -->
    <update id="updateColVltnCdMgmt" parameterType="alpass.ipt.col.fine.vo.ColVltnCdMgmtVo">
        /* ColVltnCdMgmt_updateColVltnCdMgmt */
        UPDATE  TB_COLI_VLTN_CD SET 
        <trim prefixOverrides="," >
                  VLTN_CD_NM = #{vltnCdNm}                    /** Libellé infraction !== 위반코드명 ==! */
                , VLTN_CD_DESC = #{vltnCdDesc}                /** Qualification de l'infraction !== 위반코드설명 ==! */
                , VLTN_CD_CN = #{vltnCdCn}                    /** Contenu du code d'infraction !== 위반코드내용 ==! */
                , LWLM_AMT = #{lwlmAmt}                       /** Montant plancher !== 하한금액 ==! */
                , UPLM_AMT = #{uplmAmt}                       /** Montant plafonne !== 상한금액 ==! */
                , FINE_TAX_CD = #{fineTaxCd}                  /** Code de taxe concernant les amendes !== 벌금세금코드 ==! */
                , BSOP_TP_CD = #{bsopTpCd}                    /** Code de catégorie de service !== 업무구분코드 ==! */
                , USE_YN = #{useYn}                           /** Utilise ON !== 사용여부 ==! */
                , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
                , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
        </trim>
           WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
             AND  VLTN_CD = TRIM(#{vltnCd})                         /** Code d'infraction !== 위반코드 ==! */
    </update>


    <!--
    Supprimer la Gérer les codes d'infraction !== 위반코드관리 삭제 ==!
    -->
    <update id="deleteColVltnCdMgmt" parameterType="alpass.ipt.col.fine.vo.ColVltnCdMgmtVo">
        /* ColVltnCdMgmt_deleteColVltnCdMgmt */
        UPDATE  TB_COLI_VLTN_CD SET 
                DEL_YN = 'Y'                                  /** Suppression ON !== 삭제여부 ==! */
             ,  LAST_CHPR_ID = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             ,  LAST_CHG_DTTM = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
         WHERE  DEL_YN = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
           AND  VLTN_CD = TRIM(#{vltnCd})                           /** Code d'infraction !== 위반코드 ==! */
    </update>

</mapper>
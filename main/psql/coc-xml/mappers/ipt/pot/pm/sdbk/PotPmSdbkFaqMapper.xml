<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="alpass.ipt.pot.pm.sdbk.mapper.PotPmSdbkFaqMapper">

  <!-- 
      Consulter la liste de la gestion de la FAQ !==FAQ 관리 목록을 조회한다.==!
    -->
  <select id="selectFaqList" parameterType="alpass.ipt.pot.pm.sdbk.vo.PotPmSdbkFaqVo" resultType="alpass.ipt.pot.pm.sdbk.vo.PotPmSdbkFaqVo">
    /* selectFaqList */
    <include refid="pagination.header"/>
    SELECT
    A.FAQ_SRNO
    , A.TRGT_APP_CLSF_CD
    , A.FAQ_TP_CD
    , A.FAQ_TTLE
    , A.FAQ_CN
    , A.MDPN_ID
    , ( SELECT CONCAT(U.EMP_FMNM, ' ', U.EMP_NM) FROM TB_POTI_EMP U WHERE PBSR_NO = A.MDPN_ID) AS MDPN_NM
    , TO_CHAR(A.MAKE_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS MAKE_DTTM
    , A.INQT_CNT
    , A.PRTL_BLTN_YN
    , A.ATCH_FILE_ID
    , A.DEL_YN
    , A.FRST_REGST_ID
    , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:MI:SS') AS FRST_RGSR_DTTM
    , A.LAST_CHPR_ID
    , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:MI:SS') AS  LAST_CHG_DTTM
    FROM   TB_POTI_FAQ A
    WHERE  DEL_YN = 'N'
    <if test="searchKeywordFrom != null and searchKeywordFrom != '' ">
      AND A.MAKE_DTTM BETWEEN TO_DATE(#{searchKeywordFrom}, 'DD/MM/YYYY') AND TO_DATE(#{searchKeywordTo}, 'DD/MM/YYYY') + 0.99999
    </if>
    <if test="faqTtle != null and faqTtle != '' ">
      AND UPPER(A.FAQ_TTLE) like '%' || UPPER(#{faqTtle}) || '%'
    </if>
    <if test="faqTpCd != null and faqTpCd != '' ">
      AND A.FAQ_TP_CD = #{faqTpCd}
    </if>
    <if test="trgtAppClsfCd != null and trgtAppClsfCd != '' ">
      AND A.TRGT_APP_CLSF_CD = #{trgtAppClsfCd}
    </if>
    ORDER BY A.FAQ_SRNO DESC
    <include refid="pagination.footer"/>
  </select>

  <!-- 
      Consulter un article de la gestion de la FAQ !==FAQ 관리 게시글을 조회한다.==!
  -->
  <select id="selectFaq" parameterType="alpass.ipt.pot.pm.sdbk.vo.PotPmSdbkFaqVo" resultType="alpass.ipt.pot.pm.sdbk.vo.PotPmSdbkFaqVo">
    /** selectFaq */
    SELECT    A.FAQ_SRNO
         , A.TRGT_APP_CLSF_CD
         , A.FAQ_TP_CD
         , A.FAQ_TTLE
         , A.FAQ_CN
         , A.MDPN_ID
         , ( SELECT CONCAT(U.EMP_FMNM,' ',U.EMP_NM) FROM TB_POTI_EMP U WHERE PBSR_NO = A.MDPN_ID) AS MDPN_NM
         , TO_CHAR(A.MAKE_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS MAKE_DTTM
         , A.INQT_CNT
         , A.PRTL_BLTN_YN
         , A.ATCH_FILE_ID
         , A.DEL_YN
         , A.FRST_REGST_ID
         , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:MI:SS') AS FRST_RGSR_DTTM
         , A.LAST_CHPR_ID
         , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:MI:SS') AS  LAST_CHG_DTTM
    FROM   TB_POTI_FAQ A
    WHERE A.FAQ_SRNO = #{faqSrno}
  </select>

  <!-- 
      Modifier le nombre de vues de la gestion de la FAQ !==FAQ 관리 조회수를 수정한다.==!
  -->
  <update id="updateFaqView" parameterType="alpass.ipt.pot.pm.sdbk.vo.PotPmSdbkFaqVo">
    /* updateFaqView */
    UPDATE  TB_POTI_FAQ SET
      INQT_CNT = INQT_CNT+1
    WHERE	FAQ_SRNO = #{faqSrno}
  </update>

  <!-- 
      Enregistrer un article de la gestion de la FAQ !==FAQ 관리 게시글을 등록한다.==!
  -->
  <insert id="insertFaq" parameterType="alpass.ipt.pot.pm.sdbk.vo.PotPmSdbkFaqVo">
    /* insertFaq */
    <selectKey keyProperty="faqSrno" keyColumn="FAQ_SRNO" resultType="java.math.BigDecimal" order="BEFORE">
      SELECT NVL(MAX(FAQ_SRNO),0)+1 FROM TB_POTI_FAQ
    </selectKey>
    INSERT INTO TB_POTI_FAQ
    (
    FAQ_SRNO
    , TRGT_APP_CLSF_CD
    , FAQ_TP_CD
    , FAQ_TTLE
    , FAQ_CN
    , MDPN_ID
    , MAKE_DTTM
    , INQT_CNT
    , PRTL_BLTN_YN
    , ATCH_FILE_ID
    , DEL_YN
    , FRST_REGST_ID
    , FRST_RGSR_DTTM
    , LAST_CHPR_ID
    , LAST_CHG_DTTM
    )
    VALUES
    (
    #{faqSrno}
    , #{trgtAppClsfCd}
    , #{faqTpCd}
    , #{faqTtle}
    , #{faqCn}
    , #{mdpnId}
    , SYSTIMESTAMP
    , #{inqtCnt}
    , #{prtlBltnYn}
    , #{atchFileId}
    , 'N'
    , #{frstRegstId}
    , SYSTIMESTAMP
    , #{lastChprId}
    , SYSTIMESTAMP
    )
  </insert>

  <!-- 
      Modifier un article de la gestion de la FAQ !==FAQ 관리 게시글을 수정한다.==!
  -->
  <update id="updateFaq" parameterType="alpass.ipt.pot.pm.sdbk.vo.PotPmSdbkFaqVo">
    /* updateFaq */
    UPDATE  TB_POTI_FAQ
    <trim prefix="SET" prefixOverrides="," >
      <if test="faqTpCd != null and faqTpCd != '' ">, FAQ_TP_CD = #{faqTpCd}</if>
      <if test="trgtAppClsfCd != null and trgtAppClsfCd != '' ">, TRGT_APP_CLSF_CD = #{trgtAppClsfCd}</if>
      <if test="faqTtle != null and faqTtle != '' ">, FAQ_TTLE = #{faqTtle}</if>
      <if test="faqCn != null and faqCn != '' ">, FAQ_CN = #{faqCn}</if>
      <if test="inqtCnt != null and inqtCnt != '' ">, INQT_CNT = #{inqtCnt}</if>
      <if test="prtlBltnYn != null and prtlBltnYn != '' ">, PRTL_BLTN_YN = #{prtlBltnYn}</if>
      <if test="atchFileId != null and atchFileId != '' ">, ATCH_FILE_ID = #{atchFileId}</if>
      <if test="lastChprId != null and lastChprId != '' ">, LAST_CHPR_ID = #{lastChprId}</if>
      <if test="lastChprId != null and lastChprId != '' ">, LAST_CHG_DTTM = SYSTIMESTAMP</if>
    </trim>
    WHERE	FAQ_SRNO = #{faqSrno}
  </update>

  <!-- 
      Supprimer un article de la gestion de la FAQ !==FAQ 관리 게시글을 삭제한다.==!
  -->
  <update id="deleteFaq" parameterType="alpass.ipt.pot.pm.sdbk.vo.PotPmSdbkFaqVo">
    /* deleteFaq */
    UPDATE  TB_POTI_FAQ SET
            DEL_YN = 'Y'
         ,  LAST_CHPR_ID = #{lastChprId}
         ,  LAST_CHG_DTTM = SYSTIMESTAMP
    WHERE  DEL_YN = 'N'
      AND	FAQ_SRNO = #{faqSrno}
  </update>

</mapper>

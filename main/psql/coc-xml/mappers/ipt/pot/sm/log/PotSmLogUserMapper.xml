<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="alpass.ipt.pot.sm.log.mapper.PotSmLogUserMapper">

	<!-- 
		 Consulter la liste des fichiers journaux de l'utilisateur IPT !== IPT사용자로그  리스트를 조회 ==!
	 -->
	<select id="selectIptUserLogList" parameterType="alpass.ipt.pot.sm.log.vo.PotSmLogUserlogVo" resultType="alpass.ipt.pot.sm.log.vo.PotSmLogUserlogVo">
		/** selectIptUserLogList */
		<include refid="pagination.header"/>
		SELECT 
		       A.*
		     , TO_CHAR(A.OCRN_DT_TMP,'DD/MM/YYYY HH24:MI:SS') AS OCRN_DT
		FROM
		(       
			SELECT 
				   A.OCRN_DTTM AS OCRN_DT_TMP
				 , A.SRVC_NM
				 , A.METD_NM
				 , A.LOG_MSG_ID
				 , A.USER_ID
				 , (SELECT FN_GET_CD_VDVAL_NM('COM_0052', A.PRCS_TP_CD, #{langCd}) FROM DUAL) AS PRCS_TP_CD
				 , A.PRCS_RQRD_HR		
				 , A.DEL_YN	 
				 , A.FRST_REGST_ID
				 , A.FRST_RGSR_DTTM
				 , A.LAST_CHPR_ID
				 , A.LAST_CHG_DTTM		
			FROM  TB_COM_SYS_USER_LOG A
			WHERE A.DEL_YN = 'N'
		  AND LOG_MSG_ID like 'IPT_%'
			<if test="searUserId != null and searUserId != ''">
			AND   A.USER_ID =  #{searUserId}
			</if>	
			<if test="searchKeywordFrom != null and searchKeywordFrom != ''">
			AND  TO_CHAR(A.OCRN_DTTM, 'YYYYMMDD') BETWEEN TO_CHAR(TO_DATE(#{searchKeywordFrom}, 'DD/MM/YYYY'), 'YYYYMMDD') AND TO_CHAR(TO_DATE(#{searchKeywordTo}, 'DD/MM/YYYY'), 'YYYYMMDD')
			</if>
			<if test="searPrcsTpCd != null and searPrcsTpCd != ''">
			AND   A.PRCS_TP_CD =  #{searPrcsTpCd}
			</if>	
			<if test="searSrvcNm != null and searSrvcNm != ''">
			AND   UPPER(A.SRVC_NM) LIKE '%' || UPPER(#{searSrvcNm}) || '%'
			</if>	
			<if test="searMetdNm != null and searMetdNm != ''">
			AND   UPPER(A.METD_NM) LIKE '%' || UPPER(#{searMetdNm}) || '%'
			</if>	
			<if test="searLogMsgId != null and searLogMsgId != ''">
			AND   UPPER(A.LOG_MSG_ID) LIKE '%' || UPPER(#{searLogMsgId}) || '%'
			</if>	
			ORDER BY OCRN_DTTM DESC
		) A				    	    	    
		<include refid="pagination.footer"/>
	</select>
					
	<!-- 
		 Consulter la liste des fichiers journaux de l'utilisateur EPT !== EPT사용자로그  리스트를 조회 ==!
	 -->
	<select id="selectEptUserLogList" parameterType="alpass.ipt.pot.sm.log.vo.PotSmLogUserlogVo" resultType="alpass.ipt.pot.sm.log.vo.PotSmLogUserlogVo">
		/** selectEptUserLogList */
		<include refid="pagination.header"/>
		SELECT 
		       A.*
		     , TO_CHAR(A.OCRN_DT_TMP,'DD/MM/YYYY HH24:MI:SS') AS OCRN_DT
		FROM
		(
			SELECT 
				   A.OCRN_DTTM AS OCRN_DT_TMP
				 , A.SRVC_NM
				 , A.METD_NM
				 , A.LOG_MSG_ID
				 , A.USER_ID
				 , (SELECT FN_GET_CD_VDVAL_NM('COM_0052', A.PRCS_TP_CD, #{langCd}) FROM DUAL) AS PRCS_TP_CD
				 , A.PRCS_RQRD_HR		
				 , A.DEL_YN	 
				 , A.FRST_REGST_ID
				 , A.FRST_RGSR_DTTM
				 , A.LAST_CHPR_ID
				 , A.LAST_CHG_DTTM		
			FROM  TB_COM_SYS_USER_LOG A
			WHERE A.DEL_YN = 'N'
		  AND LOG_MSG_ID like 'EPT_%'
			<if test="searUserId != null and searUserId != ''">
			AND   A.USER_ID =  #{searUserId}
			</if>	
			<if test="searchKeywordFrom != null and searchKeywordFrom != ''">
			AND  TO_CHAR(A.OCRN_DTTM, 'YYYYMMDD') BETWEEN TO_CHAR(TO_DATE(#{searchKeywordFrom}, 'DD/MM/YYYY'), 'YYYYMMDD') AND TO_CHAR(TO_DATE(#{searchKeywordTo}, 'DD/MM/YYYY'), 'YYYYMMDD')
			</if>
			<if test="searPrcsTpCd != null and searPrcsTpCd != ''">
			AND   A.PRCS_TP_CD =  #{searPrcsTpCd}
			</if>	
			<if test="searSrvcNm != null and searSrvcNm != ''">
			AND   UPPER(A.SRVC_NM) LIKE '%' || UPPER(#{searSrvcNm}) || '%'
			</if>	
			<if test="searMetdNm != null and searMetdNm != ''">
			AND   UPPER(A.METD_NM) LIKE '%' || UPPER(#{searMetdNm}) || '%'
			</if>	
			<if test="searLogMsgId != null and searLogMsgId != ''">
			AND   UPPER(A.LOG_MSG_ID) LIKE '%' || UPPER(#{searLogMsgId}) || '%'
			</if>	
			ORDER BY OCRN_DTTM DESC
		) A      	
		<include refid="pagination.footer"/>
	</select>

	<!--
		 Consulter des journaux d'accès au système de délégation des attributions !== 권한위임 시스템 접근 로그 목록을 조회 ==!
	 -->
	<select id="selectAuthMndaSysAcsLog" parameterType="alpass.ipt.pot.sm.log.vo.PotSmLogAuthMndalogVo" resultType="alpass.ipt.pot.sm.log.vo.PotSmLogAuthMndalogVo">
		<!--selectAuthMndaSysAcsLog-->
        <include refid="pagination.header"/>
        SELECT
        MNDA_SRNO
        ,MNDA_PBSR_NO
             ,(SELECT EMP_FMNM FROM TB_POTI_EMP WHERE PBSR_NO = MNDA_PBSR_NO) AS MNDA_PBSR_FMNM
             ,(SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = MNDA_PBSR_NO) AS MNDA_PBSR_NM
        ,MNDA_TRGT_PBSR_NO
			,(SELECT EMP_FMNM FROM TB_POTI_EMP WHERE PBSR_NO = MNDA_TRGT_PBSR_NO) AS MNDA_TRGT_PBSR_FMNM
			,(SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = MNDA_TRGT_PBSR_NO) AS MNDA_TRGT_PBSR_NM
			,(SELECT FN_GET_CD_VDVAL_NM('POT_0107', MNDA_ACES_TP, #{langCd}) FROM DUAL) AS MNDA_ACES_TP
		, TO_CHAR(MNDA_ACES_DTTM,'DD/MM/YYYY HH24:MI:SS') AS MNDA_ACES_DTTM
        FROM TB_COM_AUTH_MNDA_ACES_LOG
        WHERE DEL_YN = 'N'
        <if test="mndaPbsrNo != null and mndaPbsrNo != ''">
            AND MNDA_PBSR_NO = #{mndaPbsrNo}
        </if>
        <if test="mndaTrgtPbsrNo != null and mndaTrgtPbsrNo != ''">
            AND MNDA_TRGT_PBSR_NO = #{mndaTrgtPbsrNo}
        </if>
        <if test="searchKeywordFrom != null and searchKeywordFrom != ''">
            AND TO_CHAR(MNDA_ACES_DTTM, 'YYYYMMDD') BETWEEN TO_CHAR(TO_DATE(#{searchKeywordFrom}, 'DD/MM/YYYY'), 'YYYYMMDD') AND TO_CHAR(TO_DATE(#{searchKeywordTo}, 'DD/MM/YYYY'), 'YYYYMMDD')
        </if>
        <if test="mndaAcesTp != null and mndaAcesTp !=''">
			AND MNDA_ACES_TP = #{mndaAcesTp}
		</if>
        ORDER BY MNDA_ACES_DTTM DESC
        <include refid="pagination.footer"/>
    </select>

	<!--
   Enregistrer des journaux de connexion/déconnexion pour la délégation des attributions !== 권한위임 로그인/로그아웃 로그 등록 ==!
 -->
	<insert id="insertAuthMndaAcesLog" parameterType="alpass.ipt.pot.sm.log.vo.PotSmLogAuthMndalogVo">
		<!--insertAuthMndaAcesLog-->
		<selectKey keyProperty="mndaSrno" order="BEFORE" resultType="java.math.BigDecimal">
			SELECT NVL(MAX(MNDA_SRNO),0)+1 FROM TB_COM_AUTH_MNDA_ACES_LOG
		</selectKey>
		INSERT INTO TB_COM_AUTH_MNDA_ACES_LOG(
				MNDA_SRNO
			, MNDA_PBSR_NO
			, MNDA_TRGT_PBSR_NO
			, MNDA_ACES_TP
			, MNDA_ACES_DTTM
			, DEL_YN
			, FRST_REGST_ID
			, FRST_RGSR_DTTM
			, LAST_CHPR_ID
			, LAST_CHG_DTTM
		) VALUES (
				#{mndaSrno}
			, #{mndaPbsrNo}
			, #{mndaTrgtPbsrNo}
			, #{mndaAcesTp}
			, SYSTIMESTAMP
			, 'N'
			, #{mndaTrgtPbsrNo}
			, SYSTIMESTAMP
			, #{mndaTrgtPbsrNo}
			, SYSTIMESTAMP
		)
	</insert>


																						
</mapper>

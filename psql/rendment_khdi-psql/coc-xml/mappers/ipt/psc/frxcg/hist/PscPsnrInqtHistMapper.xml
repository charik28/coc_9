<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="alpass.ipt.psc.frxcg.hist.mapper.PscPsnrInqtHistMapper">

  <!--
  @TODO:번역필요 !== 여행자 조회 이력 목록 조회 ==!
  -->
  <select id="selectPscPsnrInqtHistList"  parameterType="alpass.ipt.psc.frxcg.hist.vo.PscPsnrInqtHistSearchVo" 
    resultType="alpass.ipt.psc.frxcg.hist.vo.PscPsnrInqtHistSearchVo"> 
      /* selectPscPsnrInqtHistList */
      <include refid="pagination.header" ></include>
    
	    SELECT
                  A.PSPR_NO                    /** N° De Passeport !== 여권번호 ==! */
                , A.NAT_CD                     /** Code De Nationalité !== 국적코드 ==! */
                , A.HIST_SRNO                  /** N° de sequence de l'historique !== 이력일련번호 ==! */
                , A.RGSR_DTTM                  /** Date Et Heure De L'Enregistrement !== 등록일시 ==! */
                , A.DEL_YN                     /** Suppression On !== 삭제여부 ==! */
                , A.FRST_REGST_ID              /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
                , A.FRST_RGSR_DTTM             /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
                , A.LAST_CHPR_ID               /** Id Du Modificateur Final !== 최종변경자ID ==! */
                , A.LAST_CHG_DTTM              /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
                , A.CSTM_CD                    /** Code Du Bureau !== 세관코드 ==! */
                , A.RGSR_DT                    /** Date D'Enregistrement !== 등록일자 ==! */
                , A.TRVL_YY                    /** Annee !== 여행년도 ==! */
            FROM   TB_PSCI_PSNR_INQT_HIST A
           WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
             AND  A.PSPR_NO = #{psprNo}                       /** N° De Passeport !== 여권번호 ==! */
             AND  A.NAT_CD = #{natCd}                         /** Code De Nationalité !== 국적코드 ==! */     
        <if test='(rgsrDtFrom != null and !"".equals(rgsrDtFrom)) and (rgsrDtTo != null and !"".equals(rgsrDtTo))'>
			 AND  RGSR_DT BETWEEN TO_CHAR(TO_DATE(REPLACE(#{rgsrDtFrom}, '/', ''), 'DDMMYYYY'), 'YYYYMMDD') AND TO_CHAR(TO_DATE(REPLACE(#{rgsrDtTo}, '/', ''), 'DDMMYYYY'), 'YYYYMMDD')
		</if>
      	<if test='trvlYy != null and trvlYy != ""'>
			 AND  A.TRVL_YY = #{trvlYy}                       /** Annee !== 여행년도 ==! */
		</if>
		ORDER BY  A.RGSR_DTTM 
      <include refid="pagination.footer" ></include>
  </select>

  
  <!--
    @TODO:번역필요 !== GeneratorComments 등록 ==!
    (Generated)
    -->
    <insert id="insertPscPsnrInqtHist" parameterType="alpass.ipt.psc.frxcg.hist.vo.PscPsnrInqtHistSearchVo">
       /* insertPscPsnrInqtHist */
       <selectKey keyProperty="histSrno" order="BEFORE" resultType="java.math.BigDecimal">
	 		SELECT NVL(MAX(HIST_SRNO),0)+1 FROM ALPASSINT.TB_PSCI_PSNR_INQT_HIST WHERE TRVL_YY = TO_CHAR(SYSDATE,'YYYY')  AND PSPR_NO = #{psprNo} AND NAT_CD = #{natCd} 
	   </selectKey>  
       INSERT INTO ALPASSINT.TB_PSCI_PSNR_INQT_HIST 
             (
               PSPR_NO                      /** N° De Passeport !== 여권번호 ==! */
             , NAT_CD                       /** Code De Nationalité !== 국적코드 ==! */
             , HIST_SRNO                    /** N° de sequence de l'historique !== 이력일련번호 ==! */
             , RGSR_DTTM                    /** Date Et Heure De L'Enregistrement !== 등록일시 ==! */
             , DEL_YN                       /** Suppression On !== 삭제여부 ==! */
             , FRST_REGST_ID                /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
             , FRST_RGSR_DTTM               /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , LAST_CHPR_ID                 /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , LAST_CHG_DTTM                /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
             , CSTM_CD                      /** Code Du Bureau !== 세관코드 ==! */
             , RGSR_DT                      /** Date D'Enregistrement !== 등록일자 ==! */
             , TRVL_YY                      /** Annee !== 여행년도 ==! */
             )
             VALUES
             (
               #{psprNo}                    /** N° De Passeport !== 여권번호 ==! */
             , #{natCd}                     /** Code De Nationalité !== 국적코드 ==! */
             , #{histSrno}                  /** N° de sequence de l'historique !== 이력일련번호 ==! */
             , SYSTIMESTAMP                 /** Date Et Heure De L'Enregistrement !== 등록일시 ==! */
             , 'N'                          /** Suppression On !== 삭제여부 ==! */
             , #{frstRegstId}               /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
             , SYSTIMESTAMP                 /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , #{lastChprId}                /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , SYSTIMESTAMP                 /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
             , #{cstmCd}                    /** Code Du Bureau !== 세관코드 ==! */
             , TO_CHAR(SYSDATE,'YYYYMMDD')                    /** Date D'Enregistrement !== 등록일자 ==! */
             , TO_CHAR(SYSDATE,'YYYY')                     /** Annee !== 여행년도 ==! */
             )
    </insert>
    
</mapper>
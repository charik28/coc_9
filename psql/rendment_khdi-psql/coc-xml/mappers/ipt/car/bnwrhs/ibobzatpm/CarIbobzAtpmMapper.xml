<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper">

  <!--
    [Rechercher] Consulter la liste des cotations des demandes d'accord préalable aux autorités compétentes.      !== 사전승인 신청 관할 당국 배부 목록을 조회한다. ==!
    (YoungChae.Kim)
    -->
  <select id="selectIbobzAtpmPrapAudtList" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAtpmVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzAtpmPrapAudtList */
    <include refid="pagination.header" ></include>
    SELECT A.IBOBZ_PRAP_RQST_NO				/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
         , A.IBOBZ_NM				/**  Nom de la zone sous douane  !== 보세구역명 ==!  */
         , A.JRSD_ORGN_CD				/**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
         , (SELECT ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.JRSD_ORGN_CD) AS ORGN_NM /**  Code D'Unité Compétente  !== 관할조직명 ==!  */
         , A.NIF                     /**  NIF  !== NIF ==!  */
         , A.IBOBZ_TP_CD				/**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
         , A.IBOBZ_PRAP_TMLM_DT				/**  Date D'Échéance De L'Accord Préalable Pour La Zone Sous Douane  !== 보세구역사전승인기한일자 ==!  */
         , A.IBOBZ_AREA				/**  Superficie De La Zone Sous Douane  !== 보세구역면적 ==!  */
         , TO_CHAR(A.TRSN_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS TRSN_DTTM	/**  Date et heure de transmission  !== 전송일시 ==!  */
         , A.TRSN_CO_CD				/**  Code d'entreprise transmettrice  !== 전송업체코드 ==!  */
         , A.DEL_YN				/**  Suppression On  !== 삭제여부 ==!  */
         , A.FRST_REGST_ID				/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
         , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS FRST_RGSR_DTTM	/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
         , A.LAST_CHPR_ID				/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
         , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS LAST_CHG_DTTM	/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
         , CPB1.AUDT_EMP_ID  	AS AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
         , CPB1.AUDT_EMP_NM		AS AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
         , CPB1.PRCS_DTTM 			AS PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
         , CPB1.PRCS_STTS_CD		AS PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
         , CPB1.RQST_DGCNT       AS RQST_DGCNT       /** N° ordre de la demande !== 신청차수 ==! */
      FROM TB_CARI_IBOBZ_ATPM_PRAP A
      LEFT JOIN (
                  SELECT TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
                       , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
                       , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
                       , TCCPB.JRSD_ORGN_CD                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
                       , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
                       , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
                       , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
                       , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
                    FROM TB_CARI_CAG_PRCS_BRKD TCCPB
                   WHERE TCCPB.DEL_YN = 'N'
      ) CPB1
      ON A.IBOBZ_PRAP_RQST_NO = CPB1.CAG_RQST_NO
      AND CPB1.CAG_RQST_TP_CD = #{cagRqstTpCd}		/** Code de type de demande de cargaison !==화물신청구분코드==! */

      LEFT JOIN ( SELECT C1.ORGN_CD
                       , C2.ORGN_CD JRSD_CSTM_CD
                    FROM TB_POTI_ORGN C1
                    LEFT JOIN  TB_POTI_ORGN C2
                      ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                   WHERE C1.DEL_YN = 'N'
      ) C
      ON A.JRSD_ORGN_CD = C.ORGN_CD

    WHERE
    A.DEL_YN = 'N'           /** Suppression ON !== 삭제여부 ==! */
    AND  CPB1.JRSD_ORGN_CD LIKE SUBSTR(#{cstmOrgnCd}, 1, 5) || '%'                                         /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordFrom) and @alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordTo)">
      AND (
      (
      A.TRSN_DTTM <![CDATA[ >= ]]> TO_DATE(#{searchKeywordFrom}, 'DD/MM/YYYY')       /**  Date et heure de transmission  !== 전송일시 ==!  */
      AND A.TRSN_DTTM <![CDATA[ <= ]]> TO_DATE(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999   /**  Date et heure de transmission  !== 전송일시 ==!  */
      ) OR (
      A.LAST_CHG_DTTM <![CDATA[ >= ]]> TO_TIMESTAMP(#{searchKeywordFrom}, 'DD/MM/YYYY')
      AND A.LAST_CHG_DTTM <![CDATA[ <= ]]> TO_TIMESTAMP(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999
      )
      )
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdCstmCd)">
      AND C.JRSD_CSTM_CD = #{jrsdCstmCd}                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdOrgnCd)">
      AND A.JRSD_ORGN_CD = #{jrsdOrgnCd}                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(prcsSttsCd)">
      AND
      CPB1.PRCS_STTS_CD = #{prcsSttsCd}                                           /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzPrapRqstNo)">
      AND  A.IBOBZ_PRAP_RQST_NO = #{ibobzPrapRqstNo}                                /**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzTpCd)">
      AND  A.IBOBZ_TP_CD = #{ibobzTpCd}                                             /**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzNm)">
      AND  A.IBOBZ_NM LIKE '%'||#{ibobzNm}||'%'                                     /**  Nom de la zone sous douane  !== 보세구역명 ==!  */
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(nif)">
      AND  A.NIF LIKE '%'||#{nif}||'%'                                            /**  NIF  !== NIF ==!  */
    </if>
    ORDER BY A.FRST_RGSR_DTTM DESC
    <include refid="pagination.footer" ></include>
  </select>

  <!--
    [Rechercher] Consulter la liste des "Demande d'accord préalable de l'exploitation de la zone sous douane" !== 보세구역인허가 사전승인 신청 목록을 조회한다. ==!
    (ByungYeol.Jeong)
    -->
  <select id="selectIbobzAtpmPrapList" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAtpmVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzAtpmPrapList */
    <include refid="pagination.header" ></include>
      SELECT
          A.IBOBZ_PRAP_RQST_NO				/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
        , A.IBOBZ_NM				/**  Nom de la zone sous douane  !== 보세구역명 ==!  */
        , A.JRSD_ORGN_CD				/**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
        , (SELECT ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.JRSD_ORGN_CD) AS ORGN_NM /**  Code D'Unité Compétente  !== 관할조직명 ==!  */
        , A.NIF                     /**  NIF  !== NIF ==!  */
        , A.IBOBZ_TP_CD				/**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
        , A.IBOBZ_PRAP_TMLM_DT				/**  Date D'Échéance De L'Accord Préalable Pour La Zone Sous Douane  !== 보세구역사전승인기한일자 ==!  */
        , A.IBOBZ_AREA				/**  Superficie De La Zone Sous Douane  !== 보세구역면적 ==!  */
        , TO_CHAR(A.TRSN_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS TRSN_DTTM	/**  Date et heure de transmission  !== 전송일시 ==!  */
        , A.TRSN_CO_CD				/**  Code d'entreprise transmettrice  !== 전송업체코드 ==!  */
        , A.DEL_YN				/**  Suppression On  !== 삭제여부 ==!  */
        , A.FRST_REGST_ID				/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
        , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS FRST_RGSR_DTTM	/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
        , A.LAST_CHPR_ID				/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
        , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS LAST_CHG_DTTM	/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
        , CPB1.AUDT_EMP_ID  	AS AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB1.AUDT_EMP_NM		AS AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB1.PRCS_DTTM 			AS PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB1.PRCS_STTS_CD		AS PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
        , CPB1.RQST_DGCNT       AS RQST_DGCNT       /** N° ordre de la demande !== 신청차수 ==! */
      FROM
        TB_CARI_IBOBZ_ATPM_PRAP           A
      LEFT JOIN (
        SELECT
            TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
          , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
          , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
          , TCCPB.JRSD_ORGN_CD                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
          , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
          , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
          , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
          , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        FROM
            TB_CARI_CAG_PRCS_BRKD TCCPB
        WHERE
          TCCPB.DEL_YN = 'N'
      ) CPB1
        ON A.IBOBZ_PRAP_RQST_NO = CPB1.CAG_RQST_NO
        AND CPB1.CAG_RQST_TP_CD = #{cagRqstTpCd}		/** Code de type de demande de cargaison !==화물신청구분코드==! */

      LEFT JOIN ( SELECT C1.ORGN_CD
                       , C2.ORGN_CD JRSD_CSTM_CD
                    FROM TB_POTI_ORGN C1
                    LEFT JOIN  TB_POTI_ORGN C2
                      ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                    WHERE C1.DEL_YN = 'N'
      ) C
      ON A.JRSD_ORGN_CD = C.ORGN_CD

      WHERE
        A.DEL_YN = 'N'           /** Suppression ON !== 삭제여부 ==! */

    <choose>
      <when test="roleId.equals('CAR094'.toString())">
        AND CPB1.AUDT_EMP_ID  = #{pbsrNo}
      </when>
      <otherwise>
        AND CPB1.JRSD_ORGN_CD LIKE SUBSTR(#{cstmOrgnCd}, 1, 5) || '%'
      </otherwise>
    </choose>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordFrom) and @alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordTo)">
        AND (
          (
            A.TRSN_DTTM <![CDATA[ >= ]]> TO_DATE(#{searchKeywordFrom}, 'DD/MM/YYYY')       /**  Date et heure de transmission  !== 전송일시 ==!  */
            AND A.TRSN_DTTM <![CDATA[ <= ]]> TO_DATE(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999   /**  Date et heure de transmission  !== 전송일시 ==!  */
          ) OR (
              A.LAST_CHG_DTTM <![CDATA[ >= ]]> TO_TIMESTAMP(#{searchKeywordFrom}, 'DD/MM/YYYY')
              AND A.LAST_CHG_DTTM <![CDATA[ <= ]]> TO_TIMESTAMP(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999
          )
        )
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(prcsSttsCd)">
        AND
          CPB1.PRCS_STTS_CD = #{prcsSttsCd}                                           /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzPrapRqstNo)">
        AND  A.IBOBZ_PRAP_RQST_NO = #{ibobzPrapRqstNo}                                /**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzTpCd)">
        AND  A.IBOBZ_TP_CD = #{ibobzTpCd}                                             /**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzNm)">
        AND  A.IBOBZ_NM LIKE '%'||#{ibobzNm}||'%'                                     /**  Nom de la zone sous douane  !== 보세구역명 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdCstmCd)">
        AND C.JRSD_CSTM_CD = #{jrsdCstmCd}                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdOrgnCd)">
        AND  A.JRSD_ORGN_CD = #{jrsdOrgnCd}                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(nif)">
        AND  A.NIF LIKE '%'||#{nif}||'%'                                            /**  NIF  !== NIF ==!  */
      </if>

      ORDER BY A.FRST_RGSR_DTTM DESC

    <include refid="pagination.footer" ></include>
  </select>

  <!--
    [Rechercher] Consulter les détails de la "Demande d'accord préalable de l'exploitation de la zone sous douane" !== 보세구역인허가 사전승인 신청의 상세내역을 조회한다. ==!
    (ByungYeol.Jeong)
    -->
  <select id="selectIbobzAtpmPrap" parameterType="String" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAtpmVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzAtpmPrap */
      SELECT
          A.IBOBZ_PRAP_RQST_NO				/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
        , A.RQST_CO_ADDR_NM				/**  Adresse d'opérateur demandeur  !== 신청업체주소명 ==!  */
        , A.RQST_CO_TLPH_NO				/**  N° De Téléphone D'Opérateur Demandeur  !== 신청업체전화번호 ==!  */
        , A.NIF				/**  N° de registre de commerce  !== 사업자등록번호 ==!  */
        , A.CMRC_REGS_NO  /**  Numero de registre du commerce  !== 상업등기번호 ==!  */
        , A.RQST_CO_FAX_NO				/**  N° fax de l’opérateur demandeur  !== 신청업체팩스번호 ==!  */
        , A.RQST_CO_EML				/**  E-mail de l’opérateur demandeur  !== 신청업체이메일 ==!  */
        , A.IBOBZ_NM				/**  Nom de la zone sous douane  !== 보세구역명 ==!  */
        , A.IBOBZ_ADDR  /**  Adresse de la zone sous douane  !== 보세구역주소 ==!  */
        , A.JRSD_ORGN_CD				/**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
        , C.JRSD_CSTM_CD
        , A.IBOBZ_TP_CD				/**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
        , A.IBOBZ_PRAP_TMLM_DT				/**  Date D'Échéance De L'Accord Préalable Pour La Zone Sous Douane  !== 보세구역사전승인기한일자 ==!  */
        , A.IBOBZ_AREA				/**  Superficie De La Zone Sous Douane  !== 보세구역면적 ==!  */
        , A.CAG_KND_SSTVS_YN				/**  Sensible O/N  !== 화물종류민감여부 ==!  */
        , A.CAG_KND_RSK_YN				/**  Dangereux O/N  !== 화물종류위험여부 ==!  */
        , A.CAG_KND_CRPT_WRY_YN				/**  Périssable O/N  !== 화물종류부패우려여부 ==!  */
        , A.CAG_KND_ANML_YN				/**  Animaux O/N  !== 화물종류동물여부 ==!  */
        , A.CAG_KND_CMCS_YN				/**  Chimique O/N  !== 화물종류화학물여부 ==!  */
        , A.CAG_KND_HMGNS_CAG_YN				/**  Homogène O/N  !== 화물종류균질화물여부 ==!  */
        , A.CAG_KND_OVSZ_OVSZ_CAG_YN				/**  Hors Gabarit O/N  !== 화물종류특대화물여부 ==!  */
        , A.CNSO_CAG_YN                 /**  Marchandises en groupage O/N  !== 콘솔화물여부 ==!  */
        , A.CNTR_TRMN_YN				/**  Terminal à conteneurs O/N  !== 컨테이너터미널여부 ==!  */
        , A.ACPE_CNTR_GCNT  /**  Nombre de conteneurs admissibles !==  수용컨테이너개수 ==!  */
        , A.PTCL_MTR_CN				/**  Remarques   !== 특이사항내용 ==!  */
        , A.ATCH_FILE_ID				/**  Id Du Fichier Joint  !== 첨부파일ID ==!  */
        , TO_CHAR(A.TRSN_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS TRSN_DTTM	/**  Date et heure de transmission  !== 전송일시 ==!  */
        , A.TRSN_CO_CD				/**  Code d'entreprise transmettrice  !== 전송업체코드 ==!  */
        , CASE WHEN CPB3.PRCS_STTS_CD IS NULL
               THEN CASE WHEN CPB2.PRCS_STTS_CD IS NULL
                         THEN CPB1.PRCS_STTS_CD
                         ELSE CPB2.PRCS_STTS_CD
                    END
               ELSE CPB3.PRCS_STTS_CD
          END AS PRCS_STTS_CD
        , CASE WHEN CPB3.PRCS_DTTM IS NULL
               THEN CASE WHEN CPB2.PRCS_DTTM IS NULL
                         THEN CPB1.PRCS_DTTM
                         ELSE CPB2.PRCS_DTTM
                    END
               ELSE CPB3.PRCS_DTTM
          END AS PRCS_DTTM
        , CPB1.AUDT_EMP_ID  	AS IDD_AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB1.AUDT_EMP_NM		AS IDD_AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB1.PRCS_DTTM 			AS IDD_PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB1.PRCS_STTS_CD		AS IDD_PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

        , CPB2.AUDT_EMP_ID  	AS DRD_AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB2.AUDT_EMP_NM		AS DRD_AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB2.PRCS_DTTM 			AS DRD_PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB2.PRCS_STTS_CD		AS DRD_PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

        , CPB3.AUDT_EMP_ID  	AS DGD_AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB3.AUDT_EMP_NM		AS DGD_AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB3.PRCS_DTTM 			AS DGD_PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB3.PRCS_STTS_CD		AS DGD_PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

        , A.DEL_YN				/**  Suppression On  !== 삭제여부 ==!  */
        , A.FRST_REGST_ID				/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
        , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS FRST_RGSR_DTTM	/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
        , A.LAST_CHPR_ID				/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
        , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS LAST_CHG_DTTM	/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
      FROM
        TB_CARI_IBOBZ_ATPM_PRAP           A

      LEFT JOIN (
        SELECT
            TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
          , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
          , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
          , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
          , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
          , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
          , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        FROM
            TB_CARI_CAG_PRCS_BRKD TCCPB
        WHERE
          TCCPB.DEL_YN = 'N'
      ) CPB1
        ON A.IBOBZ_PRAP_RQST_NO = CPB1.CAG_RQST_NO
        AND CPB1.CAG_RQST_TP_CD = 'ZCP'		/** Code de type de demande de cargaison !==화물신청구분코드==! */
        AND CPB1.RQST_DGCNT     = 10

      LEFT JOIN (
        SELECT
            TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
          , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
          , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
          , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
          , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
          , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
          , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        FROM
            TB_CARI_CAG_PRCS_BRKD TCCPB
        WHERE
          TCCPB.DEL_YN = 'N'
      ) CPB2
        ON A.IBOBZ_PRAP_RQST_NO = CPB2.CAG_RQST_NO
        AND CPB2.CAG_RQST_TP_CD = 'ZCP'		/** Code de type de demande de cargaison !==화물신청구분코드==! */
        AND CPB2.RQST_DGCNT     = 20

      LEFT JOIN (
        SELECT
            TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
          , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
          , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
          , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
          , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
          , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
          , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        FROM
            TB_CARI_CAG_PRCS_BRKD TCCPB
        WHERE
          TCCPB.DEL_YN = 'N'
      ) CPB3
        ON A.IBOBZ_PRAP_RQST_NO = CPB3.CAG_RQST_NO
        AND CPB3.CAG_RQST_TP_CD = 'ZCP'		/** Code de type de demande de cargaison !==화물신청구분코드==! */
        AND CPB3.RQST_DGCNT     = 30

       LEFT JOIN ( SELECT C1.ORGN_CD
                        , C2.ORGN_CD JRSD_CSTM_CD
                   FROM TB_POTI_ORGN C1
                   LEFT JOIN  TB_POTI_ORGN C2
                     ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                   WHERE C1.DEL_YN = 'N'
        ) C
          ON A.JRSD_ORGN_CD = C.ORGN_CD

      WHERE
        A.DEL_YN = 'N'           /** Suppression ON !== 삭제여부 ==! */
      AND
        A.IBOBZ_PRAP_RQST_NO = #{ibobzPrapRqstNo}                                /**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
  </select>

  <!--
  [Modifier] Modifier le code d'état de traitement de la demande d'accord préalable d'agrément pour la zone sous douane !== 외부 보세구역인허가 사전승인 신청 처리상태코드를 수정한다.==!
  (ByungYeol.Jeong)
  -->
  <update id="updateIbobzAtpmPrapPrcsSttsCd" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAtpmVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.updateIbobzAtpmPrapPrcsSttsCd */
    UPDATE  TB_CARE_IBOBZ_ATPM_PRAP SET
        PRCS_DTTM				            = SYSTIMESTAMP 	            /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
      , PRCS_STTS_CD                = #{prcsSttsCd}			    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(prcsSttsCd) and @alpass.ipt.car.com.util.CarMyBatisUtil@isEqualsStr(prcsSttsCd,'D08')">
        , IBOBZ_PRAP_TMLM_DT        = TO_CHAR(NOW+365, 'YYYYMMDD') /**  Date D'Échéance De L'Accord Préalable Pour La Zone Sous Douane  !== 보세구역사전승인기한일자 ==!  */
      </if>
      , LAST_CHPR_ID                = #{lastChprId} 			  /**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
      , LAST_CHG_DTTM               = SYSTIMESTAMP 	        /**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
    WHERE
        DEL_YN = 'N'                                        /** Suppression ON !== 삭제여부 ==! */
    AND
        IBOBZ_PRAP_RQST_NO = #{ibobzPrapRqstNo}   /**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
  </update>


  <!--
  [Modifier] Modifier la date d'échéance de l'accord préalable de la demande d'accord préalable d'agrément pour la zone sous douane.
  !== 내부 보세구역인허가 사전승인 신청의 사전승인기한일자를 수정한다..==!
  (ByungYeol.Jeong)
  -->
  <update id="updateIbobzAtpmPrapTmlmDt" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAtpmVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.updateIbobzAtpmPrapTmlmDt */
    UPDATE  TB_CARI_IBOBZ_ATPM_PRAP SET
        IBOBZ_PRAP_TMLM_DT        = TO_CHAR(NOW+365, 'YYYYMMDD') /**  Date D'Échéance De L'Accord Préalable Pour La Zone Sous Douane  !== 보세구역사전승인기한일자 ==!  */
      , LAST_CHPR_ID              = #{lastChprId} 			  /**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
      , LAST_CHG_DTTM             = SYSTIMESTAMP 	        /**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
    WHERE
        DEL_YN = 'N'                                        /** Suppression ON !== 삭제여부 ==! */
    AND
        IBOBZ_PRAP_RQST_NO = #{ibobzPrapRqstNo}   /**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
  </update>

  <!--
    [Rechercher] Consulter la liste des "Demande d'autorisation de l’exploitation de la zone sous douane" !== 보세구역인허가 관할당국 배부 목록을 조회한다. ==!
    (YoungChae.Kim)
    -->
  <select id="selectIbobzAtpmAudtList" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAtpmVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzAtpmAudtList */
    <include refid="pagination.header" ></include>
    SELECT
    S.IBOBZ_ATPM_RQST_NO				/**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
    , A.IBOBZ_PRAP_RQST_NO				/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
    , A.NIF                     /**  NIF  !== NIF ==!  */
    , A.IBOBZ_NM				/**  Nom de la zone sous douane  !== 보세구역명 ==!  */
    , A.JRSD_ORGN_CD				/**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
    , (SELECT ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.JRSD_ORGN_CD) AS ORGN_NM /**  Code D'Unité Compétente  !== 관할조직명 ==!  */
    , A.IBOBZ_TP_CD				/**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
    , TO_CHAR(A.TRSN_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS TRSN_DTTM	/**  Date et heure de transmission  !== 전송일시 ==!  */
    , A.TRSN_CO_CD				/**  Code d'entreprise transmettrice  !== 전송업체코드 ==!  */
    , A.DEL_YN				/**  Suppression On  !== 삭제여부 ==!  */
    , A.FRST_REGST_ID				/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
    , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS FRST_RGSR_DTTM	/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
    , A.LAST_CHPR_ID				/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
    , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS LAST_CHG_DTTM	/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */

    , CPB1.AUDT_EMP_ID  	AS AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
    , CPB1.AUDT_EMP_NM		AS AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
    , CPB1.PRCS_DTTM 		AS PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
    , CPB1.PRCS_STTS_CD		AS PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
    , CPB1.RQST_DGCNT       AS RQST_DGCNT       /** N° ordre de la demande !== 신청차수 ==! */

    FROM
    TB_CARI_IBOBZ_ATPM           S
    LEFT JOIN
    TB_CARI_IBOBZ_ATPM_PRAP      A ON A.IBOBZ_PRAP_RQST_NO = S.IBOBZ_PRAP_RQST_NO AND A.DEL_YN = 'N'

    LEFT JOIN (
    SELECT
    TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
    , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
    , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
    , TCCPB.JRSD_ORGN_CD                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
    , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
    , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
    , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
    , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
    FROM
    TB_CARI_CAG_PRCS_BRKD TCCPB
    WHERE
    TCCPB.DEL_YN = 'N'
    ) CPB1
    ON S.IBOBZ_ATPM_RQST_NO = CPB1.CAG_RQST_NO
    AND CPB1.CAG_RQST_TP_CD = #{cagRqstTpCd}		/** Code de type de demande de cargaison !==화물신청구분코드==! */

    LEFT JOIN ( SELECT C1.ORGN_CD
                     , C2.ORGN_CD JRSD_CSTM_CD
                  FROM TB_POTI_ORGN C1
                  LEFT JOIN  TB_POTI_ORGN C2
                    ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                  WHERE C1.DEL_YN = 'N'
    ) C
    ON A.JRSD_ORGN_CD = C.ORGN_CD

    WHERE
    S.DEL_YN = 'N'           /** Suppression ON !== 삭제여부 ==! */
    AND  CPB1.JRSD_ORGN_CD LIKE SUBSTR(#{cstmOrgnCd}, 1, 5) || '%'

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordFrom) and @alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordTo)">
      AND (
      (
      A.TRSN_DTTM <![CDATA[ >= ]]> TO_DATE(#{searchKeywordFrom}, 'DD/MM/YYYY')       /**  Date et heure de transmission  !== 전송일시 ==!  */
      AND A.TRSN_DTTM <![CDATA[ <= ]]> TO_DATE(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999   /**  Date et heure de transmission  !== 전송일시 ==!  */
      ) OR (
      A.LAST_CHG_DTTM <![CDATA[ >= ]]> TO_TIMESTAMP(#{searchKeywordFrom}, 'DD/MM/YYYY')
      AND A.LAST_CHG_DTTM <![CDATA[ <= ]]> TO_TIMESTAMP(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999
      )
      )
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdCstmCd)">
      AND C.JRSD_CSTM_CD = #{jrsdCstmCd}                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdOrgnCd)">
      AND A.JRSD_ORGN_CD = #{jrsdOrgnCd}                                             /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(prcsSttsCd)">
      AND
      CPB1.PRCS_STTS_CD = #{prcsSttsCd}                                           /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzPrapRqstNo)">
      AND  A.IBOBZ_PRAP_RQST_NO = #{ibobzPrapRqstNo}                                /**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzAtpmRqstNo)">
      AND  S.IBOBZ_ATPM_RQST_NO	= #{ibobzAtpmRqstNo}			                          /**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzTpCd)">
      AND  A.IBOBZ_TP_CD = #{ibobzTpCd}                                             /**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzNm)">
      AND  A.IBOBZ_NM LIKE '%'||#{ibobzNm}||'%'                                     /**  Nom de la zone sous douane  !== 보세구역명 ==!  */
    </if>

    ORDER BY S.FRST_RGSR_DTTM DESC
    <include refid="pagination.footer" ></include>
  </select>

  <!--
    [Rechercher] Consulter la liste des "Demande d'autorisation de l’exploitation de la zone sous douane" !== 보세구역인허가 신청 목록을 조회한다. ==!
    (ByungYeol.Jeong)
    -->
  <select id="selectIbobzAtpmList" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAtpmVo">
      /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzAtpmList */
      <include refid="pagination.header" ></include>
      SELECT
          S.IBOBZ_ATPM_RQST_NO				/**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
        , A.IBOBZ_PRAP_RQST_NO				/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
        , A.NIF                     /**  NIF  !== NIF ==!  */
        , (SELECT IBOBZ_CD FROM TB_CARI_IBOBZ WHERE IBOBZ_ATPM_RQST_NO = S.IBOBZ_ATPM_RQST_NO) AS IBOBZ_CD  /** Zone sous douane  !== 보세구역코드 ==!  */
        , A.IBOBZ_NM				/**  Nom de la zone sous douane  !== 보세구역명 ==!  */
        , A.JRSD_ORGN_CD				/**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
        , (SELECT ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.JRSD_ORGN_CD) AS ORGN_NM /**  Code D'Unité Compétente  !== 관할조직명 ==!  */
        , A.IBOBZ_TP_CD				/**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
        , TO_CHAR(A.TRSN_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS TRSN_DTTM	/**  Date et heure de transmission  !== 전송일시 ==!  */
        , A.TRSN_CO_CD				/**  Code d'entreprise transmettrice  !== 전송업체코드 ==!  */
        , A.DEL_YN				/**  Suppression On  !== 삭제여부 ==!  */
        , A.FRST_REGST_ID				/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
        , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS FRST_RGSR_DTTM	/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
        , A.LAST_CHPR_ID				/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
        , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS LAST_CHG_DTTM	/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */

        , CPB1.AUDT_EMP_ID  	AS AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB1.AUDT_EMP_NM		AS AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB1.PRCS_DTTM 		AS PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB1.PRCS_STTS_CD		AS PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
        , CPB1.RQST_DGCNT       AS RQST_DGCNT       /** N° ordre de la demande !== 신청차수 ==! */

      FROM
        TB_CARI_IBOBZ_ATPM           S
      LEFT JOIN
        TB_CARI_IBOBZ_ATPM_PRAP      A ON A.IBOBZ_PRAP_RQST_NO = S.IBOBZ_PRAP_RQST_NO AND A.DEL_YN = 'N'

      LEFT JOIN (
        SELECT
            TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
          , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
          , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
          , TCCPB.JRSD_ORGN_CD                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
          , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
          , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
          , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
          , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        FROM
            TB_CARI_CAG_PRCS_BRKD TCCPB
        WHERE
          TCCPB.DEL_YN = 'N'
      ) CPB1
        ON S.IBOBZ_ATPM_RQST_NO = CPB1.CAG_RQST_NO
        AND CPB1.CAG_RQST_TP_CD = #{cagRqstTpCd}		/** Code de type de demande de cargaison !==화물신청구분코드==! */

      LEFT JOIN ( SELECT C1.ORGN_CD
                       , C2.ORGN_CD JRSD_CSTM_CD
                    FROM TB_POTI_ORGN C1
                    LEFT JOIN  TB_POTI_ORGN C2
                      ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                    WHERE C1.DEL_YN = 'N'
      ) C
      ON A.JRSD_ORGN_CD = C.ORGN_CD

      WHERE
        S.DEL_YN = 'N'           /** Suppression ON !== 삭제여부 ==! */
    <choose>
      <when test="roleId.equals('CAR094'.toString())">
        AND CPB1.AUDT_EMP_ID  = #{pbsrNo}
      </when>
      <otherwise>
        AND CPB1.JRSD_ORGN_CD LIKE SUBSTR(#{cstmOrgnCd}, 1, 5) || '%'
      </otherwise>
    </choose>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordFrom) and @alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordTo)">
        AND (
          (
            A.TRSN_DTTM <![CDATA[ >= ]]> TO_DATE(#{searchKeywordFrom}, 'DD/MM/YYYY')       /**  Date et heure de transmission  !== 전송일시 ==!  */
            AND A.TRSN_DTTM <![CDATA[ <= ]]> TO_DATE(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999   /**  Date et heure de transmission  !== 전송일시 ==!  */
          ) OR (
              A.LAST_CHG_DTTM <![CDATA[ >= ]]> TO_TIMESTAMP(#{searchKeywordFrom}, 'DD/MM/YYYY')
              AND A.LAST_CHG_DTTM <![CDATA[ <= ]]> TO_TIMESTAMP(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999
          )
        )
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(prcsSttsCd)">
        AND
          CPB1.PRCS_STTS_CD = #{prcsSttsCd}                                           /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzPrapRqstNo)">
        AND  A.IBOBZ_PRAP_RQST_NO = #{ibobzPrapRqstNo}                                /**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzAtpmRqstNo)">
        AND  S.IBOBZ_ATPM_RQST_NO	= #{ibobzAtpmRqstNo}			                          /**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzTpCd)">
        AND  A.IBOBZ_TP_CD = #{ibobzTpCd}                                             /**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdCstmCd)">
        AND C.JRSD_CSTM_CD = #{jrsdCstmCd}                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdOrgnCd)">
        AND  A.JRSD_ORGN_CD = #{jrsdOrgnCd}                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzNm)">
        AND  A.IBOBZ_NM LIKE '%'||#{ibobzNm}||'%'                                     /**  Nom de la zone sous douane  !== 보세구역명 ==!  */
      </if>

        ORDER BY S.FRST_RGSR_DTTM DESC
    <include refid="pagination.footer" ></include>
  </select>

  <!--
    [Rechercher] Consulter les détails de la "Demande d'autorisation de l’exploitation de la zone sous douane" !== 보세구역인허가 신청의 상세내역을 조회한다. ==!
    (ByungYeol.Jeong)
    -->
  <select id="selectIbobzAtpm" parameterType="String" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAtpmVo">
      /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzAtpm */
      SELECT
          A.IBOBZ_ATPM_RQST_NO				/**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
        , A.IBOBZ_PRAP_RQST_NO				/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
        , B.JRSD_ORGN_CD    /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
        , C.JRSD_CSTM_CD
        , B.IBOBZ_TP_CD    /**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
        , A.PTCL_MTR_CN				/**  Remarques   !== 특이사항내용 ==!  */
        , A.ATCH_FILE_ID				/**  Id Du Fichier Joint  !== 첨부파일ID ==!  */
        , TO_CHAR(A.TRSN_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS TRSN_DTTM	/**  Date et heure de transmission  !== 전송일시 ==!  */
        , A.TRSN_CO_CD				/**  Code d'entreprise transmettrice  !== 전송업체코드 ==!  */

        , CPB1.AUDT_EMP_ID  	AS IDD_AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB1.AUDT_EMP_NM		AS IDD_AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB1.PRCS_DTTM 			AS IDD_PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB1.PRCS_STTS_CD		AS IDD_PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

        , CPB2.AUDT_EMP_ID  	AS DRD_AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB2.AUDT_EMP_NM		AS DRD_AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB2.PRCS_DTTM 			AS DRD_PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB2.PRCS_STTS_CD		AS DRD_PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

        , CPB3.AUDT_EMP_ID  	AS DGD_AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB3.AUDT_EMP_NM		AS DGD_AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB3.PRCS_DTTM 			AS DGD_PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB3.PRCS_STTS_CD		AS DGD_PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

        , A.DEL_YN				/**  Suppression On  !== 삭제여부 ==!  */
        , A.FRST_REGST_ID				/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
        , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS FRST_RGSR_DTTM	/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
        , A.LAST_CHPR_ID				/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
        , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS LAST_CHG_DTTM	/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
      FROM
        TB_CARI_IBOBZ_ATPM A
          LEFT JOIN ( SELECT B1.JRSD_ORGN_CD
                           , B1.IBOBZ_PRAP_RQST_NO
                           , B1.IBOBZ_TP_CD
                      FROM TB_CARE_IBOBZ_ATPM_PRAP B1
        ) B
        ON B.IBOBZ_PRAP_RQST_NO = A.IBOBZ_PRAP_RQST_NO
      LEFT JOIN (
        SELECT
            TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
          , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
          , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
          , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
          , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
          , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
          , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        FROM
            TB_CARI_CAG_PRCS_BRKD TCCPB
        WHERE
          TCCPB.DEL_YN = 'N'
      ) CPB1
        ON A.IBOBZ_ATPM_RQST_NO = CPB1.CAG_RQST_NO
        AND CPB1.CAG_RQST_TP_CD = 'ZCG'		/** Code de type de demande de cargaison !==화물신청구분코드==! */
        AND CPB1.RQST_DGCNT     = 10

      LEFT JOIN (
        SELECT
            TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
          , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
          , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
          , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
          , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
          , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
          , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        FROM
            TB_CARI_CAG_PRCS_BRKD TCCPB
        WHERE
          TCCPB.DEL_YN = 'N'
      ) CPB2
        ON A.IBOBZ_ATPM_RQST_NO = CPB2.CAG_RQST_NO
        AND CPB2.CAG_RQST_TP_CD = 'ZCG'		/** Code de type de demande de cargaison !==화물신청구분코드==! */
        AND CPB2.RQST_DGCNT     = 20

      LEFT JOIN (
        SELECT
            TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
          , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
          , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
          , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
          , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
          , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
          , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        FROM
            TB_CARI_CAG_PRCS_BRKD TCCPB
        WHERE
          TCCPB.DEL_YN = 'N'
      ) CPB3
        ON A.IBOBZ_ATPM_RQST_NO = CPB3.CAG_RQST_NO
        AND CPB3.CAG_RQST_TP_CD = 'ZCG'		/** Code de type de demande de cargaison !==화물신청구분코드==! */
        AND CPB3.RQST_DGCNT     = 30

      LEFT JOIN ( SELECT C1.ORGN_CD
                       , C2.ORGN_CD JRSD_CSTM_CD
                    FROM TB_POTI_ORGN C1
                    LEFT JOIN  TB_POTI_ORGN C2
                      ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                    WHERE C1.DEL_YN = 'N'
      ) C
        ON B.JRSD_ORGN_CD = C.ORGN_CD

      WHERE
        A.DEL_YN = 'N'           /** Suppression ON !== 삭제여부 ==! */
      AND
        A.IBOBZ_ATPM_RQST_NO = #{ibobzAtpmRqstNo}             /**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
  </select>

  <!--
  [Modifier] Modifier le code d'état de traitement de la demande d'agrément pour la zone sous douane !== 보세구역인허가 신청 처리상태코드를 수정한다.==!
  (ByungYeol.Jeong)
  -->
  <update id="updateIbobzAtpmPrcsSttsCd" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAtpmVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.updateIbobzAtpmPrcsSttsCd */
    UPDATE  TB_CARE_IBOBZ_ATPM SET
        PRCS_DTTM				            = SYSTIMESTAMP 	            /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
      , PRCS_STTS_CD                = #{prcsSttsCd}			    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
      , LAST_CHPR_ID                = #{lastChprId} 			  /**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
      , LAST_CHG_DTTM               = SYSTIMESTAMP 	        /**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
    WHERE
        DEL_YN = 'N'                                        /** Suppression ON !== 삭제여부 ==! */
    AND
        IBOBZ_ATPM_RQST_NO = #{ibobzAtpmRqstNo}             /**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
  </update>

  <!--
    [Rechercher] Consulter la liste des demandes de prorogation, de recours, de retrait de l'agrément pour la zone sous douane !== 보세구역인허가 연장, 항소, 철회 신청 심사자배부 목록을 조회한다. ==!
    (YoungChae.Kim)
    -->
  <select id="selectIbobzXtnsApelWdrlAudtList" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzXtnsApelWdrlVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzXtnsApelWdrlAudtList */
    <include refid="pagination.header" ></include>
    SELECT
    A.IBOBZ_XTNS_APEL_WDRL_RQST_NO				/**  N° demande du retrait de recours sur la prorogation de la zone sous douane  !== 보세구역연장항소철회신청번호 ==!  */
    , A.IBOBZ_PRAP_RQST_NO				/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
    , A.IBOBZ_ATPM_RQST_NO				/**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
    , A.CAG_RQST_TP_CD				/**  Code de type de demande fret  !== 화물신청구분코드 ==!  */

    , B.NIF                         /**  NIF  !== NIF ==!  */
    , (SELECT IBOBZ_CD FROM TB_CARI_IBOBZ WHERE IBOBZ_ATPM_RQST_NO = A.IBOBZ_ATPM_RQST_NO) AS IBOBZ_CD /**  Zone sous douane  !== 보세구역코드 ==!  */

    , B.IBOBZ_NM				/**  Nom de la zone sous douane  !== 보세구역명 ==!  */
    , B.JRSD_ORGN_CD				/**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
    , (SELECT ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = B.JRSD_ORGN_CD) AS ORGN_NM /**  Code D'Unité Compétente  !== 관할조직명 ==!  */
    , B.IBOBZ_TP_CD				/**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
    , IBOBZ_PRAP_TMLM_DT				/**  Date D'Échéance De L'Accord Préalable Pour La Zone Sous Douane  !== 보세구역사전승인기한일자 ==!  */

    , TO_CHAR(A.TRSN_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS TRSN_DTTM	/**  Date et heure de transmission  !== 전송일시 ==!  */
    , A.TRSN_CO_CD				/**  Code d'entreprise transmettrice  !== 전송업체코드 ==!  */
    , A.DEL_YN				/**  Suppression On  !== 삭제여부 ==!  */
    , A.FRST_REGST_ID				/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
    , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS FRST_RGSR_DTTM	/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
    , A.LAST_CHPR_ID				/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
    , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS LAST_CHG_DTTM	/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */

    /** Demande de retrait de l'agrément de la zone sous douane !== 보세구역인허가 철회 신청 ==! **/
    /** Demande de recours de l'accord préalable d'agrément pour la zone sous douane !== 보세구역인허가 사전승인 항소 신청 ==! **/
    /** Demande de prorogation de l'accord préalable d'agrément pour la zone sous douane !== 보세구역인허가 사전승인 연장 신청 ==! **/
    /** Demande de recours de l'agrément pour la zone sous douane !== 보세구역인허가 항소 신청 ==! **/
    , CPB1.AUDT_EMP_ID  	AS AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
    , CPB1.AUDT_EMP_NM		AS AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
    , CPB1.PRCS_DTTM 			AS PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
    , CPB1.PRCS_STTS_CD		AS PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

    FROM
    TB_CARI_IBOBZ_XTNS_APEL_WDRL      A

    /** Demande de retrait de l'agrément de la zone sous douane !== 보세구역인허가 철회 신청 ==! **/
    LEFT JOIN
    TB_CARI_IBOBZ_ATPM_PRAP      B ON B.IBOBZ_PRAP_RQST_NO = A.IBOBZ_PRAP_RQST_NO AND B.DEL_YN = 'N'

    LEFT JOIN (
    SELECT
    TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
    , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
    , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
    , TCCPB.JRSD_ORGN_CD
    , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
    , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
    , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
    , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
    FROM
    TB_CARI_CAG_PRCS_BRKD TCCPB
    WHERE
    TCCPB.DEL_YN = 'N'
    ) CPB1
    ON A.IBOBZ_XTNS_APEL_WDRL_RQST_NO = CPB1.CAG_RQST_NO
    AND CPB1.CAG_RQST_TP_CD     = A.CAG_RQST_TP_CD		/** Code de type de demande de cargaison !==화물신청구분코드==! */

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEqualsStr(cagRqstTpCd,'ZCR')">
      /** Demande de recours de l'accord préalable d'agrément pour la zone sous douane !== 보세구역인허가 사전승인 항소 신청 ==! **/
      /** Demande de prorogation de l'accord préalable d'agrément pour la zone sous douane !== 보세구역인허가 사전승인 연장 신청 ==! **/
      /** Demande de recours de l'agrément pour la zone sous douane !== 보세구역인허가 항소 신청 ==! **/
      AND CPB1.RQST_DGCNT         = 30
    </if>

    LEFT JOIN ( SELECT C1.ORGN_CD
                     , C2.ORGN_CD JRSD_CSTM_CD
                  FROM TB_POTI_ORGN C1
                  LEFT JOIN  TB_POTI_ORGN C2
                    ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                  WHERE C1.DEL_YN = 'N'
    ) C
    ON B.JRSD_ORGN_CD = C.ORGN_CD

    WHERE
    A.DEL_YN = 'N'           /** Suppression ON !== 삭제여부 ==! */
    AND
    A.CAG_RQST_TP_CD = #{cagRqstTpCd}   /**  Code de type de demande fret  !== 화물신청구분코드 ==!  */
    AND
    CPB1.JRSD_ORGN_CD LIKE SUBSTR(#{cstmOrgnCd}, 1, 5) || '%'

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordFrom) and @alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordTo)">
      AND (
      (
      A.TRSN_DTTM <![CDATA[ >= ]]> TO_DATE(#{searchKeywordFrom}, 'DD/MM/YYYY')       /**  Date et heure de transmission  !== 전송일시 ==!  */
      AND A.TRSN_DTTM <![CDATA[ <= ]]> TO_DATE(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999   /**  Date et heure de transmission  !== 전송일시 ==!  */
      ) OR (
      A.LAST_CHG_DTTM <![CDATA[ >= ]]> TO_TIMESTAMP(#{searchKeywordFrom}, 'DD/MM/YYYY')
      AND A.LAST_CHG_DTTM <![CDATA[ <= ]]> TO_TIMESTAMP(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999
      )
      )
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdCstmCd)">
      AND C.JRSD_CSTM_CD = #{jrsdCstmCd}                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdOrgnCd)">
      AND  B.JRSD_ORGN_CD = #{jrsdOrgnCd}                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(prcsSttsCd)">
      AND  CPB1.PRCS_STTS_CD = #{prcsSttsCd}                                           /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzXtnsApelWdrlRqstNo)">
      AND  A.IBOBZ_XTNS_APEL_WDRL_RQST_NO	= #{ibobzXtnsApelWdrlRqstNo}			/**  N° demande du retrait de recours sur la prorogation de la zone sous douane  !== 보세구역연장항소철회신청번호 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzPrapRqstNo)">
      AND  A.IBOBZ_PRAP_RQST_NO = #{ibobzPrapRqstNo}                                /**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzAtpmRqstNo)">
      AND  A.IBOBZ_ATPM_RQST_NO	= #{ibobzAtpmRqstNo}			                          /**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzTpCd)">
      AND  B.IBOBZ_TP_CD = #{ibobzTpCd}                                             /**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzNm)">
      AND  B.IBOBZ_NM LIKE '%'||#{ibobzNm}||'%'                                     /**  Nom de la zone sous douane  !== 보세구역명 ==!  */
    </if>

    ORDER BY A.FRST_RGSR_DTTM DESC

    <include refid="pagination.footer" ></include>
  </select>

  <!--
    [Rechercher] Consulter la liste des demandes de prorogation, de recours, de retrait de l'agrément pour la zone sous douane !== 보세구역인허가 연장, 항소, 철회 신청 목록을 조회한다. ==!
    (ByungYeol.Jeong)
    -->
  <select id="selectIbobzXtnsApelWdrlList" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzXtnsApelWdrlVo">
      /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzXtnsApelWdrlList */
      <include refid="pagination.header" ></include>
      SELECT
          A.IBOBZ_XTNS_APEL_WDRL_RQST_NO				/**  N° demande du retrait de recours sur la prorogation de la zone sous douane  !== 보세구역연장항소철회신청번호 ==!  */
        , A.IBOBZ_PRAP_RQST_NO				/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
        , A.IBOBZ_ATPM_RQST_NO				/**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
        , A.CAG_RQST_TP_CD				/**  Code de type de demande fret  !== 화물신청구분코드 ==!  */

        , B.NIF                         /**  NIF  !== NIF ==!  */
        , (SELECT IBOBZ_CD FROM TB_CARI_IBOBZ WHERE IBOBZ_ATPM_RQST_NO = A.IBOBZ_ATPM_RQST_NO) AS IBOBZ_CD /**  Zone sous douane  !== 보세구역코드 ==!  */

        , B.IBOBZ_NM				/**  Nom de la zone sous douane  !== 보세구역명 ==!  */
        , B.JRSD_ORGN_CD				/**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
        s, (SELECT ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = B.JRSD_ORGN_CD) AS ORGN_NM /**  Code D'Unité Compétente  !== 관할조직명 ==!  */
        , B.IBOBZ_TP_CD				/**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
        , IBOBZ_PRAP_TMLM_DT				/**  Date D'Échéance De L'Accord Préalable Pour La Zone Sous Douane  !== 보세구역사전승인기한일자 ==!  */

        , TO_CHAR(A.TRSN_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS TRSN_DTTM	/**  Date et heure de transmission  !== 전송일시 ==!  */
        , A.TRSN_CO_CD				/**  Code d'entreprise transmettrice  !== 전송업체코드 ==!  */
        , A.DEL_YN				/**  Suppression On  !== 삭제여부 ==!  */
        , A.FRST_REGST_ID				/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
        , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS FRST_RGSR_DTTM	/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
        , A.LAST_CHPR_ID				/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
        , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS LAST_CHG_DTTM	/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */

        /** Demande de retrait de l'agrément de la zone sous douane !== 보세구역인허가 철회 신청 ==! **/
        /** Demande de recours de l'accord préalable d'agrément pour la zone sous douane !== 보세구역인허가 사전승인 항소 신청 ==! **/
        /** Demande de prorogation de l'accord préalable d'agrément pour la zone sous douane !== 보세구역인허가 사전승인 연장 신청 ==! **/
        /** Demande de recours de l'agrément pour la zone sous douane !== 보세구역인허가 항소 신청 ==! **/
        , CPB1.AUDT_EMP_ID  	AS AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB1.AUDT_EMP_NM		AS AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB1.PRCS_DTTM 			AS PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB1.PRCS_STTS_CD		AS PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

      FROM
        TB_CARI_IBOBZ_XTNS_APEL_WDRL      A

        /** Demande de retrait de l'agrément de la zone sous douane !== 보세구역인허가 철회 신청 ==! **/
          LEFT JOIN
            TB_CARI_IBOBZ_ATPM_PRAP      B ON B.IBOBZ_PRAP_RQST_NO = A.IBOBZ_PRAP_RQST_NO AND B.DEL_YN = 'N'

          LEFT JOIN (
            SELECT
                TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
              , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
              , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
              , TCCPB.JRSD_ORGN_CD                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
              , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
              , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
              , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
              , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
            FROM
                TB_CARI_CAG_PRCS_BRKD TCCPB
            WHERE
              TCCPB.DEL_YN = 'N'
          ) CPB1
            ON A.IBOBZ_XTNS_APEL_WDRL_RQST_NO = CPB1.CAG_RQST_NO
            AND CPB1.CAG_RQST_TP_CD     = A.CAG_RQST_TP_CD		/** Code de type de demande de cargaison !==화물신청구분코드==! */

        <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEqualsStr(cagRqstTpCd,'ZCR')">
          /** Demande de recours de l'accord préalable d'agrément pour la zone sous douane !== 보세구역인허가 사전승인 항소 신청 ==! **/
          /** Demande de prorogation de l'accord préalable d'agrément pour la zone sous douane !== 보세구역인허가 사전승인 연장 신청 ==! **/
          /** Demande de recours de l'agrément pour la zone sous douane !== 보세구역인허가 항소 신청 ==! **/
          AND CPB1.RQST_DGCNT         = 30
        </if>

        LEFT JOIN ( SELECT C1.ORGN_CD
                         , C2.ORGN_CD JRSD_CSTM_CD
                      FROM TB_POTI_ORGN C1
                      LEFT JOIN  TB_POTI_ORGN C2
                        ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                      WHERE C1.DEL_YN = 'N'
        ) C
        ON B.JRSD_ORGN_CD = C.ORGN_CD

      WHERE
        A.DEL_YN = 'N'           /** Suppression ON !== 삭제여부 ==! */
      AND
        A.CAG_RQST_TP_CD = #{cagRqstTpCd}   /**  Code de type de demande fret  !== 화물신청구분코드 ==!  */
    <choose>
      <when test="roleId.equals('CAR094'.toString())">
        AND CPB1.AUDT_EMP_ID  = #{pbsrNo}
      </when>
      <otherwise>
        AND CPB1.JRSD_ORGN_CD LIKE SUBSTR(#{cstmOrgnCd}, 1, 5) || '%'
      </otherwise>
    </choose>
      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordFrom) and @alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordTo)">
        AND (
          (
            A.TRSN_DTTM <![CDATA[ >= ]]> TO_DATE(#{searchKeywordFrom}, 'DD/MM/YYYY')       /**  Date et heure de transmission  !== 전송일시 ==!  */
            AND A.TRSN_DTTM <![CDATA[ <= ]]> TO_DATE(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999   /**  Date et heure de transmission  !== 전송일시 ==!  */
          ) OR (
              A.LAST_CHG_DTTM <![CDATA[ >= ]]> TO_TIMESTAMP(#{searchKeywordFrom}, 'DD/MM/YYYY')
              AND A.LAST_CHG_DTTM <![CDATA[ <= ]]> TO_TIMESTAMP(#{searchKeywordTo}, 'DD/MM/YYYY')+0.9999
          )
        )
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(prcsSttsCd)">
        AND  CPB1.PRCS_STTS_CD = #{prcsSttsCd}                                           /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzXtnsApelWdrlRqstNo)">
        AND  A.IBOBZ_XTNS_APEL_WDRL_RQST_NO	= #{ibobzXtnsApelWdrlRqstNo}			/**  N° demande du retrait de recours sur la prorogation de la zone sous douane  !== 보세구역연장항소철회신청번호 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzPrapRqstNo)">
        AND  A.IBOBZ_PRAP_RQST_NO = #{ibobzPrapRqstNo}                                /**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzAtpmRqstNo)">
        AND  A.IBOBZ_ATPM_RQST_NO	= #{ibobzAtpmRqstNo}			                          /**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzTpCd)">
        AND  B.IBOBZ_TP_CD = #{ibobzTpCd}                                             /**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdCstmCd)">
        AND C.JRSD_CSTM_CD = #{jrsdCstmCd}                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdOrgnCd)">
        AND  B.JRSD_ORGN_CD = #{jrsdOrgnCd}                                           /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
      </if>

      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzNm)">
        AND  B.IBOBZ_NM LIKE '%'||#{ibobzNm}||'%'                                     /**  Nom de la zone sous douane  !== 보세구역명 ==!  */
      </if>

        ORDER BY A.FRST_RGSR_DTTM DESC

    <include refid="pagination.footer" ></include>
  </select>

  <!--
    [Rechercher] Consulter les détails de la demande de prorogation, de recours, de retrait de l'agrément pour la zone sous douane !== 보세구역인허가 연장, 항소, 철회 신청의 상세내역을 조회한다. ==!
    (ByungYeol.Jeong)
    -->
  <select id="selectIbobzXtnsApelWdrl" parameterType="String" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzXtnsApelWdrlVo">
      /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzXtnsApelWdrl */
      SELECT
          A.IBOBZ_XTNS_APEL_WDRL_RQST_NO				/**  N° demande du retrait de recours sur la prorogation de la zone sous douane  !== 보세구역연장항소철회신청번호 ==!  */
        , A.IBOBZ_PRAP_RQST_NO				/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
        , A.IBOBZ_ATPM_RQST_NO				/**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
        , B.JRSD_ORGN_CD    /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
        , C.JRSD_CSTM_CD
        , A.CAG_RQST_TP_CD				/**  Code de type de demande fret  !== 화물신청구분코드 ==!  */
        , A.RQST_RSN_CN				/**  Contenu De La Motif De Demande  !== 신청사유내용 ==!  */
        , A.ATCH_FILE_ID				/**  Id Du Fichier Joint  !== 첨부파일ID ==!  */
        , TO_CHAR(A.TRSN_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS TRSN_DTTM	/**  Date et heure de transmission  !== 전송일시 ==!  */
        , A.TRSN_CO_CD				/**  Code d'entreprise transmettrice  !== 전송업체코드 ==!  */

        /** Demande de retrait de l'agrément de la zone sous douane !== 보세구역인허가 철회 신청 ==! **/
        , CPB1.AUDT_EMP_ID  	AS IDD_AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB1.AUDT_EMP_NM		AS IDD_AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB1.PRCS_DTTM 			AS IDD_PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB1.PRCS_STTS_CD		AS IDD_PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

        , CPB2.AUDT_EMP_ID  	AS DRD_AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB2.AUDT_EMP_NM		AS DRD_AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB2.PRCS_DTTM 			AS DRD_PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB2.PRCS_STTS_CD		AS DRD_PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

        , CPB3.AUDT_EMP_ID  	AS DGD_AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , CPB3.AUDT_EMP_NM		AS DGD_AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
        , CPB3.PRCS_DTTM 			AS DGD_PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , CPB3.PRCS_STTS_CD		AS DGD_PRCS_STTS_CD		    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

        , A.DEL_YN				/**  Suppression On  !== 삭제여부 ==!  */
        , A.FRST_REGST_ID				/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
        , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS FRST_RGSR_DTTM	/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
        , A.LAST_CHPR_ID				/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
        , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS LAST_CHG_DTTM	/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
      FROM
        TB_CARI_IBOBZ_XTNS_APEL_WDRL    A
      LEFT JOIN
        TB_CARI_IBOBZ_ATPM_PRAP      B ON B.IBOBZ_PRAP_RQST_NO = A.IBOBZ_PRAP_RQST_NO AND B.DEL_YN = 'N'

      LEFT JOIN (
        SELECT
            TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
          , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
          , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
          , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
          , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
          , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
          , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        FROM
            TB_CARI_CAG_PRCS_BRKD TCCPB
        WHERE
          TCCPB.DEL_YN = 'N'
      ) CPB1
        ON A.IBOBZ_XTNS_APEL_WDRL_RQST_NO = CPB1.CAG_RQST_NO
        AND CPB1.CAG_RQST_TP_CD     = A.CAG_RQST_TP_CD		/** Code de type de demande de cargaison !==화물신청구분코드==! */
        AND CPB1.RQST_DGCNT         = 10

      LEFT JOIN (
        SELECT
            TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
          , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
          , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
          , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
          , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
          , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
          , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        FROM
            TB_CARI_CAG_PRCS_BRKD TCCPB
        WHERE
          TCCPB.DEL_YN = 'N'
      ) CPB2
        ON A.IBOBZ_XTNS_APEL_WDRL_RQST_NO = CPB2.CAG_RQST_NO
        AND CPB2.CAG_RQST_TP_CD     = A.CAG_RQST_TP_CD		/** Code de type de demande de cargaison !==화물신청구분코드==! */
        AND CPB2.RQST_DGCNT         = 20

      LEFT JOIN (
        SELECT
            TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
          , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
          , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
          , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
          , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
          , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
          , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        FROM
            TB_CARI_CAG_PRCS_BRKD TCCPB
        WHERE
          TCCPB.DEL_YN = 'N'
      ) CPB3
        ON A.IBOBZ_XTNS_APEL_WDRL_RQST_NO = CPB3.CAG_RQST_NO
        AND CPB3.CAG_RQST_TP_CD     = A.CAG_RQST_TP_CD		/** Code de type de demande de cargaison !==화물신청구분코드==! */
        AND CPB3.RQST_DGCNT         = 30

      LEFT JOIN ( SELECT C1.ORGN_CD
                       , C2.ORGN_CD JRSD_CSTM_CD
                  FROM TB_POTI_ORGN C1
                  LEFT JOIN  TB_POTI_ORGN C2
                    ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                  WHERE C1.DEL_YN = 'N'
        ) C
        ON B.JRSD_ORGN_CD = C.ORGN_CD

      WHERE
        A.DEL_YN = 'N'           /** Suppression ON !== 삭제여부 ==! */
      AND
        A.IBOBZ_XTNS_APEL_WDRL_RQST_NO = #{ibobzXtnsApelWdrlRqstNo}                                /**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
  </select>

  <!--
  [Modifier] Modifier le code d'état de traitement de la prorogation, le recours, le retrait de l'agrément pour la zone sous douane !== 보세구역인허가 연장, 항소, 철회 처리상태코드를 수정한다.==!
  (ByungYeol.Jeong)
  -->
  <update id="updateIbobzXtnsApelWdrlPrcsSttsCd" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzXtnsApelWdrlVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.updateIbobzXtnsApelWdrlPrcsSttsCd */
    UPDATE  TB_CARE_IBOBZ_XTNS_APEL_WDRL SET
        PRCS_DTTM				            = SYSTIMESTAMP 	            /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
      , PRCS_STTS_CD                = #{prcsSttsCd}			    /**  Code De Statut De Traitement  !== 처리상태코드 ==!  */
      , LAST_CHPR_ID                = #{lastChprId} 			  /**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
      , LAST_CHG_DTTM               = SYSTIMESTAMP 	        /**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
    WHERE
        DEL_YN = 'N'                                        /** Suppression ON !== 삭제여부 ==! */
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzXtnsApelWdrlRqstNo)">
      AND  IBOBZ_XTNS_APEL_WDRL_RQST_NO	= #{ibobzXtnsApelWdrlRqstNo}			/**  N° demande du retrait de recours sur la prorogation de la zone sous douane  !== 보세구역연장항소철회신청번호 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzPrapRqstNo)">
      AND  IBOBZ_PRAP_RQST_NO = #{ibobzPrapRqstNo}                                /**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
    </if>

    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzAtpmRqstNo)">
      AND  IBOBZ_ATPM_RQST_NO	= #{ibobzAtpmRqstNo}			                          /**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
    </if>
  </update>

  <!--
    [Rechercher] Consulter les détails de la pièce jointe du contrôle de l'agrément de la zone sous douane !== 보세구역인허가 심사 첨부파일 상세내역을 조회한다. ==!
    (ByungYeol.Jeong)
  -->
  <select id="selectIbobzAudtAtchFile" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAudtAtchFileVo" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAudtAtchFileVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzAudtAtchFile */
    SELECT
        A.AUDT_YY				/**  Année du contrôle  !== 심사연도 ==!  */
      , A.AUDT_SRNO				/**  N° de série du contrôle  !== 심사일련번호 ==!  */
      , A.IBOBZ_PRAP_RQST_NO				/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
      , A.IBOBZ_ATPM_RQST_NO				/**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
      , A.IBOBZ_XTNS_APEL_WDRL_RQST_NO				/**  N° demande du retrait de recours sur la prorogation de la zone sous douane  !== 보세구역연장항소철회신청번호 ==!  */
      , A.CSTM_TP_CD				/**  Code De Catégorie Du Bureau   !== 세관구분코드 ==!  */
      , TO_CHAR(A.AUDT_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS AUDT_DTTM	/**  Date De L'Étude  !== 심사일시 ==!  */
      , A.AUDT_PT_CD				/**  Code De Type De Contrôle  !== 심사유형코드 ==!  */
      , A.AUDT_RSLT_CN				/**  Contenu Du Résultat De La Vérification  !== 심사결과내용 ==!  */
      , A.AUDT_ATCH_FILE_ID				/**  ID du document joint pour le contrôle  !== 심사첨부파일ID ==!  */

      , CPB.AUDT_EMP_ID		/**  ID de l'insepcteur  !== 심사직원ID ==!  */
      , CPB.AUDT_EMP_NM		/**  Nom du l'insepcteur  !== 심사직원명 ==!  */
      , CPB.FRST_RGSR_DTTM  AS HNOT_DTTM
      , CASE WHEN CPB.PRCS_STTS_CD = 'B02' THEN NULL
             ELSE CPB.PRCS_DTTM	    /**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        END AS PRCS_DTTM
      , CPB.PRCS_STTS_CD	/**  Code De Statut De Traitement  !== 처리상태코드 ==!  */

      , A.DEL_YN				/**  Suppression On  !== 삭제여부 ==!  */
      , A.FRST_REGST_ID				/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
      , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS FRST_RGSR_DTTM	/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
      , A.LAST_CHPR_ID				/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
      , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS LAST_CHG_DTTM	/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
    FROM (
      SELECT
          TCCPB.CAG_RQST_NO				/** N° De Demande De Cargaison !== 화물신청번호 ==! */
        , TCCPB.RQST_DGCNT        /** N° ordre de la demande !== 신청차수 ==! */
        , TCCPB.CAG_RQST_TP_CD				/**  Code de type de demTCCPB.de fret  !== 화물신청구분코드 ==!  */
        , TCCPB.PRCS_STTS_CD				/**  Code De StTCCPB.ut De TrTCCPB.tement  !== 처리상태코드 ==!  */
        , TO_CHAR(TCCPB.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS FRST_RGSR_DTTM
        , TO_CHAR(TCCPB.PRCS_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS PRCS_DTTM	/**  Date Et Heure De Traitement  !== 처리일시 ==!  */
        , TCCPB.AUDT_EMP_ID				/**  ID de l'insepcteur  !== 심사직원ID ==!  */
        , ((SELECT EMP_FMNM || ' ' || EMP_NM FROM TB_POTI_EMP TPE WHERE TPE.PBSR_NO = TCCPB.AUDT_EMP_ID AND TPE.DEL_YN = 'N')) AS AUDT_EMP_NM			/**  ID de l'insepcteur  !== 심사직원ID ==!  */
      FROM
          TB_CARI_CAG_PRCS_BRKD TCCPB
      WHERE
        TCCPB.DEL_YN = 'N'
    ) CPB

    LEFT JOIN
        TB_CARI_IBOBZ_AUDT_ATCH_FILE  A
        ON  A.DEL_YN = 'N'
        AND A.CSTM_TP_CD = #{cstmTpCd}               /**  Code De Catégorie Du Bureau   !== 세관구분코드 ==!  */
    <choose>
        <when test="@alpass.ipt.car.com.util.CarMyBatisUtil@isEqualsStr(cagRqstTpCd,'ZCP')">
            AND A.IBOBZ_PRAP_RQST_NO = CPB.CAG_RQST_NO
        </when>
        <when test="@alpass.ipt.car.com.util.CarMyBatisUtil@isEqualsStr(cagRqstTpCd,'ZCG')">
            AND A.IBOBZ_ATPM_RQST_NO = CPB.CAG_RQST_NO
        </when>
        <otherwise>
            AND A.IBOBZ_XTNS_APEL_WDRL_RQST_NO = CPB.CAG_RQST_NO
        </otherwise>
    </choose>

    WHERE 1=1

    AND CPB.CAG_RQST_TP_CD  = #{cagRqstTpCd}		    /** Code de type de demande de cargaison !==화물신청구분코드==! */

    AND CPB.RQST_DGCNT      = #{cstmTpCd}           /**  Code De Catégorie Du Bureau   !== 세관구분코드 ==!  */

    AND CPB.CAG_RQST_NO     = #{cagRqstNo}          /**  N° De Demande De Cargaison  !== 화물신청번호 ==!  */

  </select>

  <!--
    [Enregistrer] @Enregistrer la pièce jointe agrément pour la zone sous douane. !== 보세구역인허가 심사 첨부파일을 등록한다. ==!
    (ByungYeol.Jeong)
  -->
  <insert id="insertIbobzAudtAtchFile" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAudtAtchFileVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.insertIbobzAudtAtchFile */
    INSERT INTO
        TB_CARI_IBOBZ_AUDT_ATCH_FILE
    (
        AUDT_YY				/**  Année du contrôle  !== 심사연도 ==!  */
      , AUDT_SRNO				/**  N° de série du contrôle  !== 심사일련번호 ==!  */
      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzPrapRqstNo)">
        , IBOBZ_PRAP_RQST_NO				/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
      </if>
      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzAtpmRqstNo)">
        , IBOBZ_ATPM_RQST_NO				/**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
      </if>
      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzXtnsApelWdrlRqstNo)">
        , IBOBZ_XTNS_APEL_WDRL_RQST_NO				/**  N° demande du retrait de recours sur la prorogation de la zone sous douane  !== 보세구역연장항소철회신청번호 ==!  */
      </if>
      , AUDT_PT_CD				/**  Code De Type De Contrôle  !== 심사유형코드 ==!  */
      , AUDT_RSLT_CN				/**  Contenu Du Résultat De La Vérification  !== 심사결과내용 ==!  */
      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(audtAtchFileId)">
      , AUDT_ATCH_FILE_ID /**  Id Du Fichier Joint  !== 첨부파일ID ==!  */
      </if>
      , CSTM_TP_CD				/**  Code De Catégorie Du Bureau   !== 세관구분코드 ==!  */
      , AUDT_DTTM
      , DEL_YN				/**  Suppression On  !== 삭제여부 ==!  */
      , FRST_REGST_ID				/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
      , FRST_RGSR_DTTM				/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
      , LAST_CHPR_ID				/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
      , LAST_CHG_DTTM				/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
    )VALUES(
        TO_CHAR(SYSTIMESTAMP, 'YYYY') /**  Année du contrôle  !== 심사연도 ==!  */
      , (SELECT NVL(MAX(A.AUDT_SRNO),0) + 1 FROM TB_CARI_IBOBZ_AUDT_ATCH_FILE A WHERE A.AUDT_YY = TO_CHAR(SYSTIMESTAMP, 'YYYY')) /**  N° de série du contrôle  !== 심사일련번호 ==!  */
      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzPrapRqstNo)">
        , #{ibobzPrapRqstNo}			/**  N° demande de l'accord préalable pour zone sous douane  !== 보세구역사전승인신청번호 ==!  */
      </if>
      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzAtpmRqstNo)">
        , #{ibobzAtpmRqstNo}			/**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
      </if>
      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzXtnsApelWdrlRqstNo)">
        , #{ibobzXtnsApelWdrlRqstNo}			/**  N° demande du retrait de recours sur la prorogation de la zone sous douane  !== 보세구역연장항소철회신청번호 ==!  */
      </if>
      , #{audtPtCd}				/**  Code De Type De Contrôle  !== 심사유형코드 ==!  */
      , #{audtRsltCn}				/**  Contenu Du Résultat De La Vérification  !== 심사결과내용 ==!  */
      <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(audtAtchFileId)">
      , #{audtAtchFileId} /**  Id Du Fichier Joint  !== 첨부파일ID ==!  */
      </if>
      , #{cstmTpCd}			/**  Code De Catégorie Du Bureau   !== 세관구분코드 ==!  */
      , SYSTIMESTAMP
      , 'N'			/**  Suppression On  !== 삭제여부 ==!  */
      , #{frstRegstId}			/**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
      , SYSTIMESTAMP 	/**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
      , #{lastChprId}			/**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
      , SYSTIMESTAMP 	/**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
    )
  </insert>


  
  <!--
    [Enregistrer] Enregistrer la zone sous douane. !== 보세구역을 등록한다. ==!
    (ByungYeol.Jeong)
  -->
  <insert id="insertIbobz" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzVo">
    INSERT INTO
      TB_CARI_IBOBZ
    (
          IBOBZ_CD /**  Code de zone sous douane  !== 보세구역코드 ==!  */
        , ATPM_DT /**  Date d'agrément  !== 인허가일자 ==!  */
        , JRSD_ORGN_CD /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
        , IBOBZ_NM /**  Nom de la zone sous douane  !== 보세구역명 ==!  */
        , IBOBZ_CO_CD /**  Code de l'opérateur de la zone sous douane  !== 보세구역업체코드 ==!  */
        , IBOBZ_NIF /**  Nif De L'Exploitant De La Zone Sous Douane  !== 보세구역사업자등록번호 ==!  */
        , CMRC_REGS_NO /**  Numero de registre du commerce  !== 상업등기번호 ==!  */
        , IBOBZ_TLPH_NO /**  N˚ de téléphone de la zone sous douane  !== 보세구역전화번호 ==!  */
        , IBOBZ_FAX_NO /**  N˚ de fax de la zone sous douane  !== 보세구역팩스번호 ==!  */
        , IBOBZ_EML /**  Email de la zone sous douane  !== 보세구역이메일 ==!  */
        , IBOBZ_ADDR /**  Adresse de la zone sous douane  !== 보세구역주소 ==!  */
        , IBOBZ_TP_CD /**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
        , IBOBZ_AREA /**  Superficie De La Zone Sous Douane  !== 보세구역면적 ==!  */
        , CAG_KND_SSTVS_YN /**  Sensible O/N  !== 화물종류민감여부 ==!  */
        , CAG_KND_RSK_YN /**  Dangereux O/N  !== 화물종류위험여부 ==!  */
        , CAG_KND_CRPT_WRY_YN /**  Périssable O/N  !== 화물종류부패우려여부 ==!  */
        , CAG_KND_ANML_YN /**  Animaux O/N  !== 화물종류동물여부 ==!  */
        , CAG_KND_CMCS_YN /**  Chimique O/N  !== 화물종류화학물여부 ==!  */
        , CAG_KND_HMGNS_CAG_YN /**  Homogène O/N  !== 화물종류균질화물여부 ==!  */
        , CAG_KND_OVSZ_OVSZ_CAG_YN /**  Hors Gabarit O/N  !== 화물종류특대화물여부 ==!  */
        , CNSO_CAG_YN /**  Marchandises en groupage O/N  !== 콘솔화물여부 ==!  */
        , CNTR_TRMN_YN /**  Terminal à conteneurs O/N  !== 컨테이너터미널여부 ==!  */
        , ACPE_CNTR_GCNT /**  Nombre de conteneurs admissibles !==  수용컨테이너개수 ==!  */
        , PTCL_MTR_CN /**  Remarques   !== 특이사항내용 ==!  */
        , IBOBZ_ATPM_RQST_NO /**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
        , AGRE_WRHS_YN  /**  Entrepôt de convention O/N  !== 협약창고여부 ==!  */
        , OPRN_CESE_YN  /**  Suspension d'exploitation O/N  !== 운영중지여부 ==!  */
        , ATPM_WDRL_YN   /**  Retrait d'agrément O/N  !== 인허가철회여부 ==!  */
        , DEL_YN /**  Suppression On  !== 삭제여부 ==!  */
        , FRST_REGST_ID /**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
        , FRST_RGSR_DTTM /**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
        , LAST_CHPR_ID /**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
        , LAST_CHG_DTTM /**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
    )
    SELECT
        #{ibobzCd }	/**  Code de zone sous douane  !== 보세구역코드 ==!  */
      , TO_CHAR(SYSDATE, 'YYYYMMDD') /**  Date d'agrément  !== 인허가일자 ==!  */
      , #{jrsdCstmCd} /**  Code D'Unité Compétente  !== 관할조직코드 ==!  */
      , B.IBOBZ_NM /**  Nom de la zone sous douane  !== 보세구역명 ==!  */
      , B.TRSN_CO_CD  /**  Code de l'opérateur de la zone sous douane  !== 보세구역업체코드 ==!  */
      , B.NIF /**  Nif De L'Exploitant De La Zone Sous Douane  !== 보세구역사업자등록번호 ==!  */
      , B.CMRC_REGS_NO /**  Numero de registre du commerce  !== 상업등기번호 ==!  */
      , B.RQST_CO_TLPH_NO /**  N˚ de téléphone de la zone sous douane  !== 보세구역전화번호 ==!  */
      , B.RQST_CO_FAX_NO /**  N˚ de fax de la zone sous douane  !== 보세구역팩스번호 ==!  */
      , B.RQST_CO_EML /**  Email de la zone sous douane  !== 보세구역이메일 ==!  */
      , B.IBOBZ_ADDR /**  Adresse de la zone sous douane  !== 보세구역주소 ==!  */
      , B.IBOBZ_TP_CD /**  Code de type de zone sous douane  !== 보세구역구분코드 ==!  */
      , B.IBOBZ_AREA /**  Superficie De La Zone Sous Douane  !== 보세구역면적 ==!  */
      , B.CAG_KND_SSTVS_YN /**  Sensible O/N  !== 화물종류민감여부 ==!  */
      , B.CAG_KND_RSK_YN /**  Dangereux O/N  !== 화물종류위험여부 ==!  */
      , B.CAG_KND_CRPT_WRY_YN /**  Périssable O/N  !== 화물종류부패우려여부 ==!  */
      , B.CAG_KND_ANML_YN /**  Animaux O/N  !== 화물종류동물여부 ==!  */
      , B.CAG_KND_CMCS_YN /**  Chimique O/N  !== 화물종류화학물여부 ==!  */
      , B.CAG_KND_HMGNS_CAG_YN /**  Homogène O/N  !== 화물종류균질화물여부 ==!  */
      , B.CAG_KND_OVSZ_OVSZ_CAG_YN /**  Hors Gabarit O/N  !== 화물종류특대화물여부 ==!  */
      , B.CNSO_CAG_YN /**  Marchandises en groupage O/N  !== 콘솔화물여부 ==!  */
      , B.CNTR_TRMN_YN /**  Terminal à conteneurs O/N  !== 컨테이너터미널여부 ==!  */
      , B.ACPE_CNTR_GCNT /**  Nombre de conteneurs admissibles !==  수용컨테이너개수 ==!  */
      , A.PTCL_MTR_CN /**  Remarques   !== 특이사항내용 ==!  */
      , A.IBOBZ_ATPM_RQST_NO /**  N° demande d'agrément pour la zone sous douane  !== 보세구역인허가신청번호 ==!  */
      , 'N' /**  Entrepôt de convention O/N  !== 협약창고여부 ==!  */
      , 'N'  /**  Suspension d'exploitation O/N  !== 운영중지여부 ==!  */
      , 'N'   /**  Retrait d'agrément O/N  !== 인허가철회여부 ==!  */
      , 'N' /**  Suppression On  !== 삭제여부 ==!  */
      , #{frstRegstId} /**  Id Du Premier Enregistrant   !== 최초등록자ID ==!  */
      , SYSTIMESTAMP /**  Date Et Heure De Premier Enregistrement  !== 최초등록일시 ==!  */
      , #{lastChprId} /**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
      , SYSTIMESTAMP /**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
    FROM
      TB_CARI_IBOBZ_ATPM A
    LEFT JOIN
      TB_CARI_IBOBZ_ATPM_PRAP B ON B.IBOBZ_PRAP_RQST_NO = A.IBOBZ_PRAP_RQST_NO
    WHERE
      IBOBZ_ATPM_RQST_NO  = #{ibobzAtpmRqstNo}
    AND
      A.DEL_YN = 'N'
  </insert>

  <!--
    [Modifier] Modifier le retrait O/N de la zone sous douane. !== 보세구역의 철회여부를 수정한다. ==!
    (ByungYeol.Jeong)
  -->
  <update id="updateIbobzWdrl" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzVo">
    UPDATE
      TB_CARI_IBOBZ
    SET
        ATPM_WDRL_YN = #{atpmWdrlYn} /**  Retrait d'agrément O/N  !== 인허가철회여부 ==!  */
      , ATPM_WDRL_DTTM = SYSTIMESTAMP /**  Date/Heure du retrait d'agrément  !== 인허가철회일시 ==!  */
      , LAST_CHPR_ID                = #{lastChprId} 			  /**  Id Du Modificateur Final  !== 최종변경자ID ==!  */
      , LAST_CHG_DTTM               = SYSTIMESTAMP 	        /**  Date Et Heure De Modification Finale  !== 최종변경일시 ==!  */
    WHERE
       IBOBZ_ATPM_RQST_NO =  #{ibobzAtpmRqstNo}

  </update>

  <!--
    Consulter la liste de gestion de zone sous douane !== 보세구역관리 목록을 조회한다. ==!
    (Jugho.Ryu)
  -->
  <select id="selectIbobzList" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzList */
    <include refid="pagination.header" ></include>
    SELECT A.IBOBZ_CD
         , TO_CHAR(TO_DATE(A.ATPM_DT, 'YYYY/MM/DD'), 'DD/MM/YYYY') AS ATPM_DT
         , A.JRSD_ORGN_CD
         , A.JRSD_ORGN_CD || ' | ' || FN_GET_ORGN_NM(A.JRSD_ORGN_CD) AS JRSD_ORGN_NM
         , A.IBOBZ_NM
         , A.IBOBZ_CO_CD
         , A.IBOBZ_NIF
         , A.IBOBZ_TLPH_NO
         , A.IBOBZ_FAX_NO
         , A.IBOBZ_EML
         , A.IBOBZ_ADDR
         , A.IBOBZ_TP_CD
         , A.DFSH_TP_CD
         , A.IBOBZ_AREA
         , A.AGRE_WRHS_YN
         , A.CNTR_TRMN_YN
         , A.PTCL_MTR_CN
         , A.TRSF_TMLM_MCNT
         , A.TRSF_TMLM_DCNT
         , A.OPRN_CESE_YN
         , TO_CHAR(A.OPRN_CESE_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS OPRN_CESE_DTTM
         , A.ATPM_WDRL_YN
         , TO_CHAR(A.ATPM_WDRL_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS ATPM_WDRL_DTTM
      FROM TB_CARI_IBOBZ A
      LEFT JOIN ( SELECT C1.ORGN_CD
                       , C2.ORGN_CD JRSD_CSTM_CD
                    FROM TB_POTI_ORGN C1
                    LEFT JOIN  TB_POTI_ORGN C2
                      ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                    WHERE C1.DEL_YN = 'N'
      ) C
      ON A.JRSD_ORGN_CD = C.ORGN_CD

     WHERE A.DEL_YN = 'N'
      AND A.IBOBZ_CO_CD != '00000'
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(searchKeywordFrom)">
      AND A.ATPM_DT BETWEEN TO_CHAR(TO_DATE(REPLACE(#{searchKeywordFrom}, '/', ''), 'DDMMYYYY'), 'YYYYMMDD') AND TO_CHAR(TO_DATE(REPLACE(#{searchKeywordTo}, '/', ''), 'DDMMYYYY'), 'YYYYMMDD')
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdCstmCd)">
      AND C.JRSD_CSTM_CD = #{jrsdCstmCd}
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(jrsdOrgnCd)">
       AND A.JRSD_ORGN_CD = #{jrsdOrgnCd}
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzCd)">
       AND A.IBOBZ_CD = #{ibobzCd}
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzTpCd)">
       AND A.IBOBZ_TP_CD = #{ibobzTpCd}
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(oprnCeseYn)">
       AND A.OPRN_CESE_YN = #{oprnCeseYn}
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(atpmWdrlYn)">
      AND A.ATPM_WDRL_YN = #{atpmWdrlYn}
    </if>
    <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzNm)">
       AND A.IBOBZ_NM LIKE '%'||#{ibobzNm}||'%'                                     /**  Nom de la zone sous douane  !== 보세구역명 ==!  */
    </if>
    ORDER BY A.IBOBZ_CD, A.FRST_RGSR_DTTM DESC
    <include refid="pagination.footer" ></include>
  </select>

  <!--
    Consulter les détails de gestion de zone sous douane !== 보세구역관리의 상세내역을 조회한다. ==!
    (Jugho.Ryu)
  -->
  <select id="selectIbobz" parameterType="String" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobz */
    SELECT A.IBOBZ_CD
         , TO_CHAR(TO_DATE(A.ATPM_DT, 'YYYY/MM/DD'), 'DD/MM/YYYY') AS ATPM_DT
         , C.JRSD_CSTM_CD
         , FN_GET_ORGN_NM(C.JRSD_CSTM_CD) AS JRSD_CSTM_NM
         , A.JRSD_ORGN_CD
         , FN_GET_ORGN_NM(A.JRSD_ORGN_CD) AS JRSD_ORGN_NM
         , A.IBOBZ_NM
         , A.IBOBZ_CO_CD
         , A.IBOBZ_NIF
         /*, (SELECT CO_NM FROM ALPASSEXT.TB_POTE_NIF B WHERE B.NIF = A.IBOBZ_NIF) AS IBOBZ_CO_NM*/
         , ALPASSINT.FN_CARE_GET_CO_NM(A.IBOBZ_CO_CD) AS IBOBZ_CO_NM
         , A.CMRC_REGS_NO
         , A.IBOBZ_TLPH_NO
         , A.IBOBZ_FAX_NO
         , A.IBOBZ_EML
         , A.IBOBZ_ADDR
         , A.IBOBZ_TP_CD
         , A.DFSH_TP_CD
         , A.IBOBZ_AREA
         , A.CAG_KND_SSTVS_YN
         , A.CAG_KND_RSK_YN
         , A.CAG_KND_CRPT_WRY_YN
         , A.CAG_KND_ANML_YN
         , A.CAG_KND_CMCS_YN
         , A.CAG_KND_HMGNS_CAG_YN
         , A.CAG_KND_OVSZ_OVSZ_CAG_YN
         , A.CNSO_CAG_YN
         , A.AGRE_WRHS_YN
         , A.AGRE_CSTM_CD
         , A.CNTR_TRMN_YN
         , NVL(A.ACPE_CNTR_GCNT,0) AS ACPE_CNTR_GCNT
         , A.PTCL_MTR_CN
         , A.TRSF_TMLM_MCNT
         , A.TRSF_TMLM_DCNT
         , A.OPRN_CESE_YN
         , TO_CHAR(A.OPRN_CESE_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS OPRN_CESE_DTTM
         , A.ATPM_WDRL_YN
         , TO_CHAR(A.ATPM_WDRL_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS ATPM_WDRL_DTTM
      FROM TB_CARI_IBOBZ A
      LEFT JOIN ( SELECT C1.ORGN_CD
                       , C2.ORGN_CD JRSD_CSTM_CD
                    FROM TB_POTI_ORGN C1
                    LEFT JOIN  TB_POTI_ORGN C2
                      ON C1.UPR_ORGN_MGMT_CD = C2.ORGN_MGMT_CD
                    WHERE C1.DEL_YN = 'N'
      ) C
      ON A.JRSD_ORGN_CD = C.ORGN_CD
     WHERE A.DEL_YN = 'N'
       AND A.IBOBZ_CD = #{ibobzCd}
  </select>

  <!--
    Demander la suspension d'exploitation de la zone sous douane !== 보세구역관리 운영중지 요청. ==!
    (Jugho.Ryu)
  -->
  <update id="updateIbobzOprnCese" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.updateIbobzOprnCese */
    UPDATE TB_CARI_IBOBZ
    SET LAST_CHPR_ID = #{lastChprId}
      , LAST_CHG_DTTM = SYSDATE
      , OPRN_CESE_YN = 'Y'
      , OPRN_CESE_DTTM = SYSDATE
    WHERE IBOBZ_CD = #{ibobzCd}
  </update>

  <!--
    Demander le retrait d'agrément de la gestion de zone sous douane  !== 보세구역관리 인처가철회 요청. ==!
    (Jugho.Ryu)
  -->
  <update id="updateIbobzAtpmWdrl" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.updateIbobzAtpmWdrl */
    UPDATE TB_CARI_IBOBZ
    SET LAST_CHPR_ID = #{lastChprId}
      , LAST_CHG_DTTM = SYSDATE
      , ATPM_WDRL_YN = 'Y'
      , ATPM_WDRL_DTTM = SYSDATE
    WHERE IBOBZ_CD = #{ibobzCd}
  </update>

  <!--
    Modifier la gestion de zone sous douane  !== 보세구역관리 수정 ==!
    (Jugho.Ryu)
  -->
  <update id="updateIbobz" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.updateIbobz */
    UPDATE TB_CARI_IBOBZ
       SET LAST_CHPR_ID = #{lastChprId}
         , LAST_CHG_DTTM = SYSDATE
         , IBOBZ_NM = #{ibobzNm}
         , CMRC_REGS_NO = #{cmrcRegsNo}
         , IBOBZ_TLPH_NO = #{ibobzTlphNo}
         , IBOBZ_FAX_NO = #{ibobzFaxNo}
         , IBOBZ_EML = #{ibobzEml}
         , IBOBZ_ADDR = #{ibobzAddr}
         , IBOBZ_AREA = #{ibobzArea}
         , TRSF_TMLM_MCNT = #{trsfTmlmMcnt}
         , TRSF_TMLM_DCNT = #{trsfTmlmDcnt}
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzNif)">
         , IBOBZ_NIF = #{ibobzNif}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ibobzCoCd)">
         , IBOBZ_CO_CD = #{ibobzCoCd}
         </if>
         <if test='oprnCeseYn == "Y"'>
         , OPRN_CESE_YN = #{oprnCeseYn}
         , OPRN_CESE_DTTM = SYSDATE
         </if>
         <if test='oprnCeseYn == "N"'>
         , OPRN_CESE_YN = #{oprnCeseYn}
         , OPRN_CESE_DTTM = NULL
         </if>
         <if test='atpmWdrlYn == "Y"'>
         , ATPM_WDRL_YN = #{atpmWdrlYn}
         , ATPM_WDRL_DTTM = SYSDATE
         </if>
         <if test='atpmWdrlYn == "N"'>
         , ATPM_WDRL_YN = #{atpmWdrlYn}
         , ATPM_WDRL_DTTM = NULL
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(agreWrhsYn)">
         , AGRE_WRHS_YN = #{agreWrhsYn}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(cntrTrmnYn)">
         , CNTR_TRMN_YN = #{cntrTrmnYn}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(dfshTpCd)">
         , DFSH_TP_CD = #{dfshTpCd}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(cagKndSstvsYn)">
         , CAG_KND_SSTVS_YN = #{cagKndSstvsYn}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(cagKndRskYn)">
         , CAG_KND_RSK_YN = #{cagKndRskYn}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(cagKndCrptWryYn)">
         , CAG_KND_CRPT_WRY_YN = #{cagKndCrptWryYn}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(cagKndAnmlYn)">
         , CAG_KND_ANML_YN = #{cagKndAnmlYn}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(cagKndCmcsYn)">
         , CAG_KND_CMCS_YN = #{cagKndCmcsYn}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(cagKndHmgnsCagYn)">
         , CAG_KND_HMGNS_CAG_YN = #{cagKndHmgnsCagYn}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(cagKndOvszOvszCagYn)">
         , CAG_KND_OVSZ_OVSZ_CAG_YN = #{cagKndOvszOvszCagYn}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(cnsoCagYn)">
         , CNSO_CAG_YN = #{cnsoCagYn}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(ptclMtrCn)">
         , PTCL_MTR_CN = #{ptclMtrCn}
         </if>
         <if test="@alpass.ipt.car.com.util.CarMyBatisUtil@isNotEmpty(acpeCntrGcnt)">
         , ACPE_CNTR_GCNT = #{acpeCntrGcnt}
         </if>
         , AGRE_CSTM_CD = #{agreCstmCd}
     WHERE IBOBZ_CD = #{ibobzCd}
  </update>

  <!--
    Consulter le code de service du bureau supérieur.      !== 상위세관 조직코드를 조회한다. ==!
    (YoungChae.Kim)
  -->
  <select id="selectUprOrgnCd" parameterType="String" resultType="String">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectUprOrgnCd */
    SELECT (
             SELECT B.ORGN_CD
             FROM TB_POTI_ORGN B
             WHERE B.ORGN_MGMT_CD = A.UPR_ORGN_MGMT_CD
               AND B.ORGN_STTS_CD = '01'
               AND B.DEL_YN = 'N'
           ) AS ORGN_CD
    FROM TB_POTI_ORGN A
    WHERE A.ORGN_CD = #{cstmOrgnCd}
      AND A.ORGN_STTS_CD = '01'
      AND A.DEL_YN = 'N'
  </select>

  <!--
  [Rechercher] Consulter le nombre de demandes d'agrément pour la zone sous douane.      !== 보세구역인허가 신청차수를 조회한다. ==!
  -->
  <select id="selectRqstDgcnt" parameterType="String" resultType="String">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectRqstDgCnt */
    SELECT MAX(RQST_DGCNT) AS RQST_DGCNT
      FROM TB_CARI_CAG_PRCS_BRKD
     WHERE CAG_RQST_NO = #{cagRqstNo}
  </select>

  <!--
  Supprimer le contrôle existant lors de l'autorisation de la demande de recours de l'accord préalable pour la zone sous douane.      !== 보세구역인허가 항소 신청 승인 시 기존 심사를 삭제한다. ==!
  -->
  <update id="deleteIbobzAudtAtchFile" parameterType="alpass.ipt.car.com.vo.CarCagPrcsBrkdVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.deleteIbobzAudtAtchFile */
    UPDATE TB_CARI_IBOBZ_AUDT_ATCH_FILE
       SET DEL_YN = 'Y'
     WHERE CSTM_TP_CD = #{cagRqstNo}
       <if test='cagRqstTpCd == "ZCP"'>
         AND IBOBZ_PRAP_RQST_NO = #{cagRqstNo}
       </if>
       <if test='cagRqstTpCd == "ZCG"'>
       AND IBOBZ_ATPM_RQST_NO = #{cagRqstNo}
       </if>
  </update>

  <!--
  [Rechercher] Consulter la liste des "Infos sur la zone douane" !== 보세구역정보 목록을 조회한다. ==!
  (YoungChae.Kim)
  -->
  <select id="selectIbobzInfoList" parameterType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAtpmVo" resultType="alpass.ipt.car.bnwrhs.ibobzatpm.vo.CarIbobzAtpmVo">
    /* alpass.ipt.car.bnwrhs.ibobzatpm.mapper.CarIbobzAtpmMapper.selectIbobzInfoList */
    <include refid="pagination.header" ></include>
    SELECT I.IBOBZ_CD AS IBOBZ_CD
         , I.IBOBZ_ATPM_RQST_NO AS IBOBZ_ATPM_RQST_NO
         , P.IBOBZ_PRAP_RQST_NO AS IBOBZ_PRAP_RQST_NO
         , TO_CHAR(TO_DATE(I.ATPM_DT, 'YYYY/MM/DD'), 'DD/MM/YYYY') AS ATPM_DT
         , I.JRSD_ORGN_CD AS JRSD_ORGN_CD
         , (SELECT ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = I.JRSD_ORGN_CD) AS ORGN_NM /**  Code D'Unité Compétente  !== 관할조직명 ==!  */
         , I.IBOBZ_NM AS IBOBZ_NM
         , I.IBOBZ_CO_CD AS IBOBZ_CO_CD
         , I.IBOBZ_NIF AS NIF
         , I.IBOBZ_TLPH_NO
         , I.IBOBZ_FAX_NO
         , I.IBOBZ_EML
         , I.IBOBZ_ADDR
         , I.IBOBZ_TP_CD AS IBOBZ_TP_CD
         , I.DFSH_TP_CD
         , I.IBOBZ_AREA
         , I.AGRE_WRHS_YN
         , I.CNTR_TRMN_YN
         , I.PTCL_MTR_CN
         , I.TRSF_TMLM_MCNT
         , I.TRSF_TMLM_DCNT
         , I.OPRN_CESE_YN
         , TO_CHAR(I.OPRN_CESE_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS OPRN_CESE_DTTM
         , I.ATPM_WDRL_YN
         , TO_CHAR(I.ATPM_WDRL_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS ATPM_WDRL_DTTM
      FROM TB_CARI_IBOBZ I
      LEFT JOIN TB_CARI_IBOBZ_ATPM S
        ON I.IBOBZ_ATPM_RQST_NO = S.IBOBZ_ATPM_RQST_NO
       AND S.DEL_YN = 'N'
      LEFT JOIN TB_CARI_IBOBZ_ATPM_PRAP P
        ON S.IBOBZ_PRAP_RQST_NO = P.IBOBZ_PRAP_RQST_NO
       AND P.DEL_YN ='N'
     WHERE I.DEL_YN = 'N'
       AND I.OPRN_CESE_YN = 'N'
       AND I.ATPM_WDRL_YN = 'N'
    <include refid="pagination.footer" ></include>
  </select>

</mapper>

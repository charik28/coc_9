<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="alpass.ipt.car.ldun.mapper.CarCagLdunRprtMapper">

    <!--
    Rapport de déchargement !== 하역 보고  ==!
    (Lee KyoungSung)
    -->
    
    <sql id ="selectItemCarCagLdunRprt">
           SELECT T1.ldun_rprt_no                                           AS ldun_rprt_no        /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
                , T1.ldun_rprt_mgmt_no                                      AS ldun_rprt_mgmt_no   /** N° De Gestion De Rapport De Déchargement !== 하역보고관리번호 ==! */
                , t2.cag_dcsh_rgsr_mgmt_no                                  AS cag_dcsh_rgsr_mgmt_no/** Numéro de gestion de l'enregistrement de la déclaration de fret !== 화물신고서등록관리번호 ==! */
                , T1.rprt_dgcnt                                             AS rprt_dgcnt          /** N° ordre de rapport !== 보고차수 ==! */
                , T1.co_rqst_no                                             AS co_rqst_no          /** N° de demande d'entreprise !== 업체신청번호 ==! */
                , T1.mrn                                                    AS mrn                 /** Mrn !== MRN ==! */
                , TO_CHAR(T1.trsn_dttm,'DD/MM/YYYY HH24:MI:SS')             AS trsn_dttm           /** Date et heure de transmission !== 전송일시 ==! */
                , T1.trsn_dttm                                              AS sort_trsn_dttm      /** Date et heure de transmission !== 전송일시 ==! */
                , T1.cag_rqst_tp_cd                                         AS cag_rqst_tp_cd      /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
                , T1.jrsd_orgn_cd                                           AS jrsd_orgn_cd        /** Code D'Unité Compétente !== 관할조직코드 ==! */
                , FN_GET_ORGN_NM(T1.jrsd_orgn_cd)                           AS jrsd_orgn_nm        /** Nom D'Organisme !== 조직명 ==! */
                , cstm.jrsd_cstm_cd                                         AS jrsd_cstm_cd        /** Code de bureau compétent !== 관할세관코드 ==! */
                , cstm.jrsd_cstm_nm                                         AS jrsd_cstm_nm        /** Code de bureau compétent !== 관할세관코드 ==! */
                , T1.trsn_co_cd                                             AS trsn_co_cd          /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
                , FN_CARI_GET_CO_NM(T1.TRSN_CO_CD)                          AS trsn_co_nm
                , T1.TRSN_CO_CD || ' | ' || FN_CARI_GET_CO_NM(T1.TRSN_CO_CD) AS trsn_co_cd_nm
                , TO_CHAR(T1.real_ldun_strt_dttm,'DD/MM/YYYY HH24:MI')       AS real_ldun_strt_dttm  	    /** Date/Heure de début de déchargement effective !== 실제하역시작일시 ==! */
                , TO_CHAR(T1.real_ldun_end_dttm,'DD/MM/YYYY HH24:MI')        AS real_ldun_end_dttm  	    /** Date/Heure de fin de déchargement effective !== 실제하역종료일시 ==! */
                , T1.infm_cn                                                AS infm_cn             /** Contenu De Notification !== 통보내용 ==! */
                , T2.carr_cd                                                AS carr_cd             /** Code De Société De Transport !== 운송사코드 ==! */
                , CC.carr_nm                                                AS carr_nm
                , T2.trnp_meth_nm                                           AS trnp_meth_nm        /** Nom De Moyen De Transport !== 운송수단명 ==! */
                , T2.trnp_meth_idfy_no                                      AS trnp_meth_idfy_no   /** N° D'Identification Du Moyen De Transport !== 운송수단식별번호 ==! */
                , T2.trnp_rfer_no                                           AS trnp_rfer_no        /** N° de référence de transport !== 운송참고번호 ==! */
                , T2.trnp_meth_loct_nm                                      AS trnp_meth_loct_nm   /** Emplacement De Moyen De Transport !== 운송수단위치명 ==! */
                , T2.IMO_NO                                                 AS IMO_NO              /** N° IMO !== IMO번호 ==! */
                , TO_CHAR(T3.prcs_dttm,'DD/MM/YYYY HH24:MI:SS')             AS prcs_dttm           /** Date Et Heure De Traitement !== 처리일시 ==! */
                , T3.prcs_stts_cd                                           AS prcs_stts_cd        /** Code De Statut De Traitement !== 처리상태코드 ==! */
                , FN_GET_CD_VDVAL_NM('COM_0026', T3.prcs_stts_cd, 'FR')     AS PRCS_STTS_NM        /** Code de statut de traitement !==처리상태코드==! */
                , T3.audt_emp_id                                            AS audt_emp_id         /** ID de l'vérificateur !== 검사직원ID ==! */
                , DD.audt_emp_nm                                            AS audt_emp_nm
                , T4.bl_nrml_gcnt                                           AS bl_nrml_gcnt
                , T4.bl_abnr_gcnt                                           AS bl_abnr_gcnt
                , T5.cntr_nrml_gcnt                                         AS cntr_nrml_gcnt
                , T5.cntr_abnr_gcnt                                         AS cntr_abnr_gcnt
                , HNOT.bfch_emp_id                                          AS bfch_emp_id         /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
                , HNOT.bfch_emp_nm                                          AS bfch_emp_nm         /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
                , HNOT.afch_emp_id                                          AS afch_emp_id         /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
                , HNOT.afch_emp_nm                                          AS afch_emp_nm         /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
                , HNOT.chg_rsn_cn                                           AS chg_rsn_cn          /** Motif De La Modification !== 변경사유내용 ==! */
                , T1.atch_file_id                                           AS atch_file_id        /** Id Du Fichier Joint !== 파일ID ==! */
                , T1.frst_regst_id                                          AS frst_regst_id       /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
                , TO_CHAR(T1.frst_rgsr_dttm,'DD/MM/YYYY HH24:MI:SS')        AS frst_rgsr_dttm      /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
                , T1.last_chpr_id                                           AS last_chpr_id        /** Id Du Modificateur Final !== 최종변경자ID ==! */
                , TO_CHAR(T1.last_chg_dttm,'DD/MM/YYYY HH24:MI:SS')         AS last_chg_dttm       /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
                , (select max(stvd_cd) from TB_CARI_LDUN x, TB_CARI_LDUN_BL y 
                    where x.mrn = t1.mrn and x.del_Yn = 'N' and y.del_yn = 'N' and x.ldun_rqst_no = y.ldun_rqst_no) as stvd_cd /** Code De Stevedoremanutentionnaire !== 하역업자코드 ==! */
                , (SELECT CO.CO_NM
                     FROM TB_COM_CO CO, TB_COM_CO_DCLR_CD CD
                    WHERE CO.NIF = CD.NIF
                      AND CD.CO_DCLR_CD = (SELECT MAX(stvd_cd) 
                                             FROM tb_cari_ldun x, tb_cari_ldun_bl y 
                                            WHERE x.mrn = t1.mrn
                                              AND x.del_Yn = 'N'
                                              AND y.del_yn = 'N'
                                              AND x.ldun_rqst_no = y.ldun_rqst_no)
                      AND ROWNUM = 1) AS STVD_NM
                  ,T2.TRNP_MEAN_CD     
             FROM TB_CARI_LDUN_RPRT T1
            INNER JOIN TB_CARI_CAG_DCSH T2
               ON T1.MRN = T2.MRN
               -- AND T2.del_yn = 'N'                                        /** Suppression ON !== 삭제여부 ==! */
             LEFT JOIN ( SELECT C1.co_nm carr_nm
                              , C2.co_dclr_cd
                           FROM TB_COM_CO C1
                              , TB_COM_CO_DCLR_CD C2
                          WHERE C1.nif = C2.nif
                            AND C2.del_yn = 'N'
                  ) CC
               ON t2.trsn_co_cd = CC.CO_DCLR_CD
            INNER JOIN TB_CARI_CAG_PRCS_BRKD T3                             /** CARI_화물_처리_내역 */
               ON T1.CAG_RQST_TP_CD = T3.CAG_RQST_TP_CD
              AND T1.LDUN_RPRT_NO = T3.cag_rqst_no
              AND T1.RPRT_DGCNT = T3.RQST_DGCNT
              AND T3.del_yn = 'N'
             LEFT JOIN ( SELECT A.cag_rqst_no                                            AS cag_rqst_no         /** N° De Demande De Cargaison !== 화물신청번호 ==! */
                              , A.cag_rqst_tp_cd                                         AS cag_rqst_tp_cd      /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
                              , A.bfch_emp_id                                            AS bfch_emp_id         /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
                              , A.afch_emp_id                                            AS afch_emp_id         /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
                              , A.chg_rsn_cn                                             AS chg_rsn_cn          /** Motif De La Modification !== 변경사유내용 ==! */
                              , e1.EMP_FMNM || ' ' || e1.emp_nm                                                AS bfch_emp_nm              /** Nom De L'Employé !== 직원명 ==! */
                              , e2.EMP_FMNM || ' ' || e2.emp_nm                                                AS afch_emp_nm              /** Nom De L'Employé !== 직원명 ==! */
                           FROM TB_CARI_HNOT_CHG_H A
                          INNER JOIN ( SELECT cag_rqst_no
                                            , MAX(chg_hist_srno) chg_hist_srno
                                         FROM TB_CARI_HNOT_CHG_H
                                        GROUP BY cag_rqst_no
                                ) H
                             ON A.cag_rqst_no = h.cag_rqst_no
                            AND A.chg_hist_srno = h.chg_hist_srno
                           LEFT JOIN TB_POTI_EMP e1
                             ON e1.pbsr_no = A.bfch_emp_id
                           LEFT JOIN TB_POTI_EMP e2
                             ON e2.pbsr_no = A.afch_emp_id
                  ) HNOT
               ON HNOT.cag_rqst_no = t3.cag_rqst_no
              AND HNOT.cag_rqst_tp_cd = t3.cag_rqst_tp_cd
             LEFT JOIN ( SELECT D.pbsr_no                                                AS pbsr_no             /** Matricule Solde !== 공무원번호 ==! */
                              , D.EMP_FMNM || ' ' || D.emp_nm                                                 AS audt_emp_nm         /** Nom De L'Employé !== 직원명 ==! */
                              , E.orgn_cd                                                AS orgn_cd             /** Code De L'Organisme !== 조직코드 ==! */
                              , E.orgn_nm                                                AS orgn_nm             /** Nom D'Organisme !== 조직명 ==! */
                           FROM TB_POTI_EMP D
                           LEFT JOIN TB_POTI_ORGN E                                      /** POTI_조직 */
                             ON D.orgn_mgmt_cd = E.orgn_mgmt_cd
                          WHERE D.del_yn = 'N'
                            AND E.del_yn = 'N'
                  ) DD
               ON T3.audt_emp_id   = DD.pbsr_no
             LEFT JOIN ( SELECT ldun_rprt_no
                              , SUM(CASE WHEN dscr_tp_cd  ='OK' THEN 1 ELSE 0 END)  bl_nrml_gcnt
                              , SUM(CASE WHEN dscr_tp_cd !='OK' THEN 1 ELSE 0 END)  bl_abnr_gcnt
                           FROM TB_CARI_LDUN_RPRT_BL TT1
                          WHERE TT1.del_yn ='N'
                          GROUP BY ldun_rprt_no
                  ) T4
               ON T1.ldun_rprt_no   = T4.ldun_rprt_no
             LEFT JOIN ( SELECT ldun_rprt_no
                              , SUM(CASE WHEN dscr_tp_cd  ='OK' THEN 1 ELSE 0 END)  cntr_nrml_gcnt
                              , SUM(CASE WHEN dscr_tp_cd !='OK' THEN 1 ELSE 0 END)  cntr_abnr_gcnt
                           FROM TB_CARI_LDUN_RPRT_CNTR TT1
                          WHERE TT1.del_yn ='N'
                          GROUP BY ldun_rprt_no
                  ) T5
               ON T1.ldun_rprt_no   = T5.ldun_rprt_no
             LEFT JOIN ( SELECT c1.orgn_cd
                              , c2.orgn_cd AS jrsd_cstm_cd
                              , c2.orgn_nm AS jrsd_cstm_nm
                           FROM tb_poti_orgn c1
                           LEFT JOIN tb_poti_orgn c2
                             ON c1.upr_orgn_mgmt_cd = c2.orgn_mgmt_cd
                          WHERE c1.del_yn = 'N'
                  ) cstm
               ON T1.jrsd_orgn_cd = cstm.orgn_cd
            WHERE T1.del_yn = 'N'                                         /** Suppression ON !== 삭제여부 ==! */
    </sql>

    <!--
    Voir les détails de la Rapport de déchargement !== 하역 보고 단건 조회 ==!
    (Lee KyoungSung)
    -->
    <select id="selectCarCagLdunRprtItem"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo"
            resultType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
           /* CarCagLdunRprt.selectCarCagLdunRprtItem */
           <include refid="selectItemCarCagLdunRprt" ></include>
           <if test="ldunRprtNo != null and ldunRprtNo != ''">
           AND T1.ldun_rprt_no = #{ldunRprtNo}  /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
           </if>
    </select>


	<!-- Voir la liste des Rapport de déchargement !== 하역 보고 목록 조회 ==!
		(Lee KyoungSung)
	-->
	<select id="selectCarCagLdunRprtList"
			parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo"
			resultType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
		/* CarCagLdunRprt.selectCarCagLdunRprtList */
		<if test="pagination != null and  pagination == true ">
			<include refid="pagination.header" ></include>
		</if>
		<include refid="selectItemCarCagLdunRprt" ></include>
		<if test="cagRqstTpCd != null and cagRqstTpCd != ''">
              AND T1.cag_rqst_tp_cd = #{cagRqstTpCd}
		</if>
		<if test="pbsrNo != null and pbsrNo != ''">
              AND T3.audt_emp_id  = #{pbsrNo}	/** ID de l'inspecteur !==검사직원ID==! */
		</if>
		<if test="trsnDttmFrom != null and trsnDttmFrom != ''">
              AND T1.trsn_dttm <![CDATA[ >= ]]> TO_DATE(#{trsnDttmFrom},'DD/MM/YYYY')
		</if>
		<if test="trsnDttmTo != null and trsnDttmTo != ''">
              AND T1.trsn_dttm <![CDATA[ < ]]> TO_DATE(#{trsnDttmTo},'DD/MM/YYYY')+1
		</if>
		<if test="prcsDttmFrom != null and prcsDttmFrom != ''">
              AND T3.prcs_dttm <![CDATA[ >= ]]> TO_DATE(#{prcsDttmFrom},'DD/MM/YYYY')
		</if>
		<if test="prcsDttmTo != null and prcsDttmTo != ''">
              AND T3.prcs_dttm <![CDATA[ < ]]> TO_DATE(#{prcsDttmTo},'DD/MM/YYYY')+1
		</if>
		
		<if test="realLdunDtFrom != null and realLdunDtFrom != ''">  /** Date de fin de déchargement effective !== 실제하역종료일자 ==! */
        	  AND T1.real_ldun_end_dt <![CDATA[ >= ]]> TO_DATE(#{realLdunDtFrom},'DD/MM/YYYY')
		</if>
		<if test="realLdunDtTo != null and realLdunDtTo != ''">  /** Date de fin de déchargement effective !== 실제하역종료일자 ==! */
              AND T1.real_ldun_end_dt <![CDATA[ < ]]> TO_DATE(#{realLdunDtTo},'DD/MM/YYYY')+1
		</if>
		<if test="mrn != null and mrn != ''">
              AND UPPER(t1.mrn) LIKE UPPER(#{mrn}) || '%'								/** MRN !==MRN==! */
		</if>
		<if test="carrNm != null and carrNm != ''">
              AND UPPER(cc.carr_nm) LIKE UPPER(#{carrNm}) || '%'
		</if>
		<if test="trnpMethNm != null and trnpMethNm != ''">
              AND UPPER(t2.trnp_meth_nm) LIKE UPPER(#{trnpMethNm}) || '%'				/** Nom de moyen de transport !==운송수단명==! */
		</if>
		<if test="trnpMethIdfyNo != null and trnpMethIdfyNo != ''">
              AND UPPER(t2.trnp_meth_idfy_no) LIKE UPPER(#{trnpMethIdfyNo}) || '%'		/** N° d'identification du moyen de transport !==운송수단식별번호==! */
		</if>
		<if test="trnpRferNo != null and trnpRferNo != ''">
              AND UPPER(t2.trnp_rfer_no) LIKE UPPER(#{trnpRferNo}) || '%'				/** N° de voyage/N° de vol/N° d'itinéraire !==운송참고번호==! */
		</if>
		<if test="trnpMeanCd != null and trnpMeanCd != ''">
              AND T2.trnp_mean_cd = #{trnpMeanCd} /** Code de mode de transport !== 운송방법코드 ==! */
		</if>
		<if test="prcsSttsCd != null and prcsSttsCd != ''">
              AND T3.prcs_stts_cd= #{ prcsSttsCd }			 						/** Code de statut de traitement !==처리상태코드==! */
		</if>
              AND T1.JRSD_ORGN_CD IN (           
            <choose>
                  <when test="jrsdOrgnCd != null and jrsdOrgnCd != ''">
                  SELECT unnest(string_to_array(alpassint.fn_cari_get_orgcd('O', #{jrsdOrgnCd}), ','))
                  </when>
                  <otherwise>
                  SELECT unnest(string_to_array(alpassint.fn_cari_get_orgcd('P', #{frstRegstId}), ','))
                  </otherwise>
              </choose>
            )
            ORDER BY sort_trsn_dttm DESC
		<if test="pagination != null and  pagination == true ">
			<include refid="pagination.footer" ></include>
		</if>
	</select>

    <!--   !==하역 보고의 자동 반입 대상을 조회한다.==! -->
    <select id="selectCarCagDcshBlForRprt"
            parameterType="alpass.ipt.car.com.vo.CarCagDcshBlVo"
            resultType="alpass.ipt.car.com.vo.CarCagDcshBlVo">
        /* CarCagLdunRprt.selectCarCagDcshBlForRprt */
        SELECT A.MRN
             , A.CAG_MGMT_NO
             , B.BL_NO
             , B.IBOBZ_CD
             , B.CAG_CHRC_CD
             , B.PCKG_GCNT
             , A.PCKG_UT_CD
             , B.TTWG
             , B.CBM_VOL
             , B.LIR_VOL
             , A.PDLS_NM
          FROM TB_CARI_CAG_DCSH_BL A
          JOIN ( SELECT R.MRN
                      , RB.BL_NO
                      , RB.IBOBZ_CD
                      , RB.CAG_CHRC_CD
                      , RB.PCKG_GCNT
                      , RB.TTWG
                      , RB.CBM_VOL
                      , RB.LIR_VOL
                   FROM TB_CARI_LDUN_RPRT R
                   LEFT JOIN TB_CARI_LDUN_RPRT_BL RB
                     ON R.LDUN_RPRT_NO = RB.LDUN_RPRT_NO
                    AND R.DEL_YN = 'N'
                    AND RB.DEL_YN = 'N'
                  WHERE R.MRN = #{mrn}
               ) B
            ON A.MRN = B.MRN
           AND A.BL_NO = B.BL_NO
         WHERE 1=1
         UNION ALL
        SELECT A.MRN
             , A.CAG_MGMT_NO
             , P.BL_NO
             , A.IBOBZ_CD
             , A.CAG_CHRC_CD
             , P.PCKG_GCNT
             , A.PCKG_UT_CD
             , P.TTWG
             , '0' AS CBM_VOL
             , '0' AS LIR_VOL
             , A.PDLS_NM
          FROM TB_CARI_CAG_DCSH_BL A
          JOIN ( SELECT R.MRN
                      , C.BL_NO
                      , SUM(C.PCKG_GCNT) PCKG_GCNT
                      , SUM(C.TTWG) TTWG
                   FROM TB_CARI_LDUN_RPRT R
                   JOIN TB_CARI_LDUN_RPRT_CNTR C
                     ON R.LDUN_RPRT_NO = C.LDUN_RPRT_NO
                    AND R.DEL_YN = 'N'
                    AND C.DEL_YN = 'N'
                  WHERE 1=1
                    AND R.MRN = #{mrn}
                  GROUP BY R.MRN
                      , C.BL_NO
               ) P
            ON A.MRN = P.MRN
           AND A.BL_NO = P.BL_NO
         WHERE 1=1
    </select>
    <!--
    Enregistrement de la Rapport de déchargement !== 하역 보고 등록 ==!
    (Lee KyoungSung)
    -->
    <insert id="insertCarCagLdunRprt"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprt.insertCarCagLdunRprt */
        INSERT INTO TB_CARI_LDUN_RPRT
               ( ldun_rprt_no                  /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
               , ldun_rprt_mgmt_no             /** N° De Gestion De Rapport De Déchargement !== 하역보고관리번호 ==! */
               , rprt_dgcnt                    /** N° ordre de rapport !== 보고차수 ==! */
               , co_rqst_no                    /** N° de demande d'entreprise !== 업체신청번호 ==! */
               , mrn                           /** Mrn !== MRN ==! */
               , trsn_dttm                     /** Date et heure de transmission !== 전송일시 ==! */
               , cag_rqst_tp_cd                /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
               , jrsd_orgn_cd                  /** Code D'Unité Compétente !== 관할조직코드 ==! */
               , trsn_co_cd                    /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
               , real_ldun_strt_dttm  	        /** Date/Heure de début de déchargement effective !== 실제하역시작일시 ==! */
               , real_ldun_end_dttm  	         /** Date/Heure de fin de déchargement effective !== 실제하역종료일시 ==! */
               , infm_cn                       /** Contenu De Notification !== 통보내용 ==! */
               , del_yn                        /** Suppression On !== 삭제여부 ==! */
               , frst_regst_id                 /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
               , frst_rgsr_dttm                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
               , last_chpr_id                  /** Id Du Modificateur Final !== 최종변경자ID ==! */
               , last_chg_dttm                 /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        )  VALUES (
                 #{ldunRprtNo}                 /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
               , #{ldunRprtMgmtNo}             /** N° De Gestion De Rapport De Déchargement !== 하역보고관리번호 ==! */
               , #{rprtDgcnt}                  /** N° ordre de rapport !== 보고차수 ==! */
               , #{coRqstNo}                   /** N° de demande d'entreprise !== 업체신청번호 ==! */
               , #{mrn}                        /** Mrn !== MRN ==! */
               , TO_TIMESTAMP( #{trsnDttm} , 'DD/MM/YYYY HH24:MI:SS')  /** Date et heure de transmission !== 전송일시 ==! */
               , #{cagRqstTpCd}                /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
               , #{jrsdOrgnCd}                 /** Code D'Unité Compétente !== 관할조직코드 ==! */
               , #{trsnCoCd}                   /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
               , TO_TIMESTAMP(#{realLdunStrtDttm},'DD/MM/YYYY HH24:MI:SS')
               , TO_TIMESTAMP(#{realLdunEndDttm},'DD/MM/YYYY HH24:MI:SS')
               , #{infmCn}                     /** Contenu De Notification !== 통보내용 ==! */
               , 'N'                           /** Suppression On !== 삭제여부 ==! */
               , #{frstRegstId}                /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
               , SYSTIMESTAMP                  /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
               , #{lastChprId}                 /** Id Du Modificateur Final !== 최종변경자ID ==! */
               , SYSTIMESTAMP                  /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        )
    </insert>


    <!--
    Modifier la  Rapport de déchargement !== 하역 보고 수정 ==!
    (Lee KyoungSung)
    -->
    <update id="updateCarCagLdunRprt"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprt.updateCarCagLdunRprt */
        UPDATE TB_CARI_LDUN_RPRT SET
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             <if test="ldunRprtMgmtNo != null and ldunRprtMgmtNo != ''">
             , ldun_rprt_mgmt_no = #{ldunRprtMgmtNo}          /** N° De Gestion De Rapport De Déchargement !== 하역보고관리번호 ==! */
             </if>
             <if test="rprtDgcnt != null and rprtDgcnt != ''">
             , rprt_dgcnt = #{rprtDgcnt}                      /** N° ordre de rapport !== 보고차수 ==! */
             </if>
             <if test="coRqstNo != null and coRqstNo != ''">
             , co_rqst_no = #{coRqstNo}                       /** N° de demande d'entreprise !== 업체신청번호 ==! */
             </if>
             <if test="mrn != null and mrn != ''">
             , mrn = #{mrn}                                   /** Mrn !== MRN ==! */
             </if>
             <if test="trsnDttm != null and trsnDttm != ''">
             , trsn_dttm = TO_TIMESTAMP( #{trsnDttm}, 'DD/MM/YYYY HH24:MI:SS')  /** Date et heure de transmission !== 전송일시 ==! */
             </if>
             <if test="cagRqstTpCd != null and cagRqstTpCd != ''">
             , cag_rqst_tp_cd = #{cagRqstTpCd}                /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
             </if>
             <if test="jrsdOrgnCd != null and jrsdOrgnCd != ''">
             , jrsd_orgn_cd = #{jrsdOrgnCd}                   /** Code D'Unité Compétente !== 관할조직코드 ==! */
             </if>
             <if test="trsnCoCd != null and trsnCoCd != ''">
             , trsn_co_cd = #{trsnCoCd}                       /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
             </if>
             <if test="realLdunStrtDt != null and realLdunStrtDt != ''">
             , real_ldun_strt_dttm = TO_TIMESTAMP(#{realLdunStrtDttm},'DD/MM/YYYY HH24:MI:SS')  /** Date/Heure de début de déchargement effective !== 실제적재시작일시 ==! */
             </if>
             <if test="realLdunEndDt != null and realLdunEndDt != ''">
             , real_ldun_end_dttm = TO_TIMESTAMP(#{realLdunEndDttm},'DD/MM/YYYY HH24:MI:SS')  /** Date/Heure de fin de déchargement effective !== 실제적재종료일시 ==! */
             </if>
             <if test="infmCn != null and infmCn != ''">
             , infm_cn = #{infmCn}                            /** Contenu De Notification !== 통보내용 ==! */
             </if>
           WHERE 1=1
             <if test="ldunRprtNo != null and ldunRprtNo != ''">
             AND ldun_rprt_no = #{ldunRprtNo}  /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
             </if>
    </update>

    <!--
    Supprimer la Rapport de déchargement !== 하역 보고 삭제 ==!
    (Lee KyoungSung)
    -->
    <update id="deleteCarCagLdunRprt"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprt.deleteCarCagLdunRprt */
        UPDATE TB_CARI_LDUN_RPRT SET
               del_yn = 'Y'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
         WHERE 1=1
             <if test="ldunRprtNo != null and ldunRprtNo != ''">
             AND  A.ldun_rprt_no = #{ldunRprtNo}  /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
             </if>
    </update>

    <!--
    Modifier la  Rapport de déchargement (BL) !== 하역 보고 수정 (BL) ==!
    (Lee KyoungSung)
    -->
    <update id="updateCarCagLdunRprtBl"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtBlVo">
        /* CarCagLdunRprt.updateCarCagLdunRprtBl */
        UPDATE TB_CARI_LDUN_RPRT_BL SET
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             , pckg_gcnt = #{pckgGcnt}                       /** Nombre De Colis !== 포장개수 ==! */
             , ttwg = #{ttwg}                                /** Poids Brut !== 총중량 ==! */
             , cbm_vol = #{cbmVol}                           /** Volume (Mtq) !== 입방미터용적 ==! */
             , lir_vol = #{lirVol}                           /** Volume (Litre) !== 리터용적 ==! */
             <if test="divdLdunLastYn != null and divdLdunLastYn != ''">
             , divd_ldun_last_yn = #{divdLdunLastYn}         /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             </if>
             <if test="inscCfrmDt != null and inscCfrmDt != ''">
             , insc_cfrm_dt = TO_CHAR(TO_DATE( #{inscCfrmDt}, 'DD/MM/YYYY'),'DDMMYYYY')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             </if>
             <if test="apreYnCd != null and apreYnCd != ''">
             , apre_yn_cd = #{apreYnCd}                      /** Autorisation O/N !== 승인여부코드 ==! */
             </if>
             <if test="rtrnRsnCn != null and rtrnRsnCn != ''">
             , rtrn_rsn_cn = #{rtrnRsnCn}                    /** Motif De Rejet !== 반려사유내용 ==! */
             </if>
           WHERE 1=1
             AND ldun_rprt_no = #{ldunRprtNo}                /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
             AND bl_no = #{blNo}                             /** N° De Bl !== BL번호 ==! */
             AND ibobz_cd = #{ibobzCd}                       /** Code de zone sous douane !== 보세구역코드 ==! */
    </update>

    <!-- Modifier la  Rapport de déchargement (Conteneur) !== 하역 보고 수정 (Conteneur) ==! -->
    <update id="updateCarCagLdunRprtCntr"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtCntrVo">
        /* CarCagLdunRprt.updateCarCagLdunRprtCntr */
        UPDATE TB_CARI_LDUN_RPRT_CNTR SET
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             , pckg_gcnt = #{pckgGcnt}                        /** Nombre De Colis !== 포장개수 ==! */
             , pckg_ut_cd = #{pckgUtCd}                       /** Code De L'Unité De Colis !== 포장단위코드 ==! */
             , ttwg = #{ttwg}                                 /** Poids Brut !== 총중량 ==! */
             <if test="divdLdunLastYn != null and divdLdunLastYn != ''">
             , divd_ldun_last_yn = #{divdLdunLastYn}         /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             </if>
             <if test="inscCfrmDt != null and inscCfrmDt != ''">
             , insc_cfrm_dt = TO_CHAR(TO_DATE( #{inscCfrmDt}, 'DD/MM/YYYY'),'DDMMYYYY')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             </if>
             <if test="apreYnCd != null and apreYnCd != ''">
             , apre_yn_cd = #{apreYnCd}                       /** Autorisation O/N !== 승인여부코드 ==! */
             </if>
             <if test="rtrnRsnCn != null and rtrnRsnCn != ''">
             , rtrn_rsn_cn = #{rtrnRsnCn}                     /** Motif De Rejet !== 반려사유내용 ==! */
             </if>
           WHERE 1=1
             AND ldun_rprt_no = #{ldunRprtNo}  /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
             AND bl_no = #{blNo}  /** N° De Bl !== BL번호 ==! */
             AND cntr_no = #{cntrNo}                            /** N° De Conteneur !== 컨테이너번호 ==! */
    </update>

    <!--
    Modifier la  Rapport de déchargement EPT !== 하역 보고 수정 EPT ==!
    (Lee KyoungSung)
    -->
    <update id="updateEptCarCagLdunRprt"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprt.updateEptCarCagLdunRprt */
        UPDATE TB_CARE_LDUN_RPRT SET
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             <if test="prcsDttm != null and prcsDttm != ''">
             , prcs_dttm = TO_TIMESTAMP( #{prcsDttm}, 'DD/MM/YYYY HH24:MI:SS')  /** Date Et Heure De Traitement !== 처리일시 ==! */
             </if>
             <if test="prcsSttsCd != null and prcsSttsCd != ''">
             , prcs_stts_cd = #{prcsSttsCd}                   /** Code De Statut De Traitement !== 처리상태코드 ==! */
             </if>
           WHERE 1=1
             AND ldun_rprt_no = #{ldunRprtNo}                   /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
    </update>

    <!-- Modifier la  Rapport de déchargement EPT (BL) !== 하역 보고 수정 EPT (BL) ==! -->
    <update id="updateEptCarCagLdunRprtBl"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprt.updateEptCarCagLdunRprtBl */
        UPDATE TB_CARE_LDUN_RPRT_BL AS T SET
               T.del_yn             = 'N'                       /** Suppression ON !== 삭제여부 ==! */
             , T.last_chpr_id       = S.last_chpr_id            /** ID du modificateur final !== 최종변경자ID ==! */
             , T.last_chg_dttm      = SYSTIMESTAMP              /** Date et heure de modification finale !== 최종변경일시 ==! */
             , T.pckg_gcnt          = S.pckg_gcnt               /** Nombre De Colis !== 포장개수 ==! */
             , T.ttwg               = S.ttwg                    /** Poids Brut !== 총중량 ==! */
             , T.cbm_vol            = S.cbm_vol                 /** Volume (Mtq) !== 입방미터용적 ==! */
             , T.lir_vol            = S.lir_vol                 /** Volume (Litre) !== 리터용적 ==! */
             , T.divd_ldun_last_yn  = S.divd_ldun_last_yn       /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             , T.insc_cfrm_dt       = S.insc_cfrm_dt            /** Date de vérification de la visite !== 검사확인일자 ==! */
             , T.apre_yn_cd         = S.apre_yn_cd              /** Autorisation O/N !== 승인여부코드 ==! */
             , T.audt_opin_cn       = S.rtrn_rsn_cn             /** Contenu De L'Opinion À La Suite De La Vérification !== 심사의견내용 ==! */
          FROM  ( SELECT M.ldun_rprt_mgmt_no                                         AS ldun_rprt_mgmt_no  /** N° De Gestion De Rapport De Déchargement !== 하역보고관리번호 ==! */
                       , A.ldun_rprt_no                                              AS ldun_rprt_no       /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
                       , A.bl_no                                                     AS bl_no              /** N° De Bl !== BL번호 ==! */
                       , A.ibobz_cd                                                  AS ibobz_cd           /** Code de zone sous douane !== 보세구역코드 ==! */
                       , A.rprt_dgcnt                                                AS rprt_dgcnt         /** N° ordre de rapport !== 보고차수 ==! */
                       , A.dscr_tp_cd                                                AS dscr_tp_cd         /** Code de non-conformité !== 불일치구분코드 ==! */
                       , A.pckg_gcnt                                                 AS pckg_gcnt          /** Nombre De Colis !== 포장개수 ==! */
                       , A.ttwg                                                      AS ttwg               /** Poids Brut !== 총중량 ==! */
                       , A.cbm_vol                                                   AS cbm_vol            /** Volume (Mtq) !== 입방미터용적 ==! */
                       , A.lir_vol                                                   AS lir_vol            /** Volume (Litre) !== 리터용적 ==! */
                       , A.divd_ldun_last_yn                                         AS divd_ldun_last_yn  /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
                       , TO_CHAR(TO_DATE(A.insc_cfrm_dt , 'DD/MM/YYYY'),'DDMMYYYY')  AS insc_cfrm_dt       /** Date de vérification de la visite !== 검사확인일자 ==! */
                       , A.apre_yn_cd                                                AS apre_yn_cd         /** Autorisation O/N !== 승인여부코드 ==! */
                       , A.rtrn_rsn_cn                                               AS rtrn_rsn_cn        /** Motif De Rejet !== 반려사유내용 ==! */
                       , A.del_yn                                                    AS del_yn             /** Suppression On !== 삭제여부 ==! */
                       , A.last_chpr_id                                              AS last_chpr_id       /** Id Du Modificateur Final !== 최종변경자ID ==! */
                    FROM TB_CARI_LDUN_RPRT_BL A
                   INNER JOIN TB_CARI_LDUN_RPRT M
                      ON A.LDUN_RPRT_NO = M.LDUN_RPRT_NO
                     AND A.LDUN_RPRT_NO = #{ldunRprtNo}
                  WHERE A.del_yn = 'N'
                 ) AS S
         WHERE 1=1
           AND T.ldun_rprt_mgmt_no = S.ldun_rprt_mgmt_no
           AND T.bl_no = S.bl_no
           AND T.ibobz_cd = S.ibobz_cd
    </update>

    <!-- Modifier la  Rapport de déchargement EPT (Conteneur) !== 하역 보고 수정 EPT (Conteneur) ==! -->
    <update id="updateEptCarCagLdunRprtCntr"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprt.updateEptCarCagLdunRprtCntr */
        UPDATE TB_CARE_LDUN_RPRT_CNTR AS T SET
               T.del_yn             = 'N'                       /** Suppression ON !== 삭제여부 ==! */
             , T.last_chpr_id       = S.last_chpr_id            /** ID du modificateur final !== 최종변경자ID ==! */
             , T.last_chg_dttm      = SYSTIMESTAMP              /** Date et heure de modification finale !== 최종변경일시 ==! */
             , T.pckg_gcnt          = S.pckg_gcnt               /** Nombre De Colis !== 포장개수 ==! */
             , T.pckg_ut_cd         = S.pckg_ut_cd              /** Code De L'Unité De Colis !== 포장단위코드 ==! */
             , T.ttwg               = S.ttwg                    /** Poids Brut !== 총중량 ==! */
             , T.divd_ldun_last_yn  = S.divd_ldun_last_yn       /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             , T.insc_cfrm_dt       = S.insc_cfrm_dt            /** Date de vérification de la visite !== 검사확인일자 ==! */
             , T.apre_yn_cd         = S.apre_yn_cd              /** Autorisation O/N !== 승인여부코드 ==! */
             , T.audt_opin_cn       = S.rtrn_rsn_cn             /** Contenu De L'Opinion À La Suite De La Vérification !== 심사의견내용 ==! */
          FROM  ( SELECT M.ldun_rprt_mgmt_no                                         AS ldun_rprt_mgmt_no  /** N° De Gestion De Rapport De Déchargement !== 하역보고관리번호 ==! */
                       , A.ldun_rprt_no                                              AS ldun_rprt_no       /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
                       , A.bl_no                                                     AS bl_no              /** N° De Bl !== BL번호 ==! */
                       , A.cntr_srno                                                 AS cntr_srno          /** N° De Séquence Du Conteneur !== 컨테이너일련번호 ==! */
                       , A.rprt_dgcnt                                                AS rprt_dgcnt         /** N° ordre de rapport !== 보고차수 ==! */
                       , A.dscr_tp_cd                                                AS dscr_tp_cd         /** Code de non-conformité !== 불일치구분코드 ==! */
                       , A.cntr_no                                                   AS cntr_no            /** N° De Conteneur !== 컨테이너번호 ==! */
                       , A.cntr_tp_cd                                                AS cntr_tp_cd         /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
                       , A.pckg_gcnt                                                 AS pckg_gcnt          /** Nombre De Colis !== 포장개수 ==! */
                       , A.pckg_ut_cd                                                AS pckg_ut_cd         /** Code De L'Unité De Colis !== 포장단위코드 ==! */
                       , A.ttwg                                                      AS ttwg               /** Poids Brut !== 총중량 ==! */
                       , A.seal_no1                                                  AS seal_no1           /** N° De Scellé1 !== 봉인번호1 ==! */
                       , A.seal_no2                                                  AS seal_no2           /** N° De Scellé2 !== 봉인번호2 ==! */
                       , A.seal_no3                                                  AS seal_no3           /** N° De Scellé3 !== 봉인번호3 ==! */
                       , A.ibobz_cd                                                  AS ibobz_cd           /** Code de zone sous douane !== 보세구역코드 ==! */
                       , A.divd_ldun_last_yn                                         AS divd_ldun_last_yn  /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
                       , TO_CHAR(TO_DATE(A.insc_cfrm_dt , 'DD/MM/YYYY'),'DDMMYYYY')  AS insc_cfrm_dt       /** Date de vérification de la visite !== 검사확인일자 ==! */
                       , A.apre_yn_cd                                                AS apre_yn_cd         /** Autorisation O/N !== 승인여부코드 ==! */
                       , A.rtrn_rsn_cn                                               AS rtrn_rsn_cn        /** Motif De Rejet !== 반려사유내용 ==! */
                       , A.del_yn                                                    AS del_yn             /** Suppression On !== 삭제여부 ==! */
                       , A.last_chpr_id                                              AS last_chpr_id       /** Id Du Modificateur Final !== 최종변경자ID ==! */
                    FROM TB_CARI_LDUN_RPRT_CNTR A
                   INNER JOIN TB_CARI_LDUN_RPRT M
                      ON A.LDUN_RPRT_NO = M.LDUN_RPRT_NO
                     AND A.LDUN_RPRT_NO = #{ldunRprtNo}
                   WHERE A.del_yn = 'N'
               ) AS S
         WHERE 1=1
           AND T.ldun_rprt_mgmt_no = S.ldun_rprt_mgmt_no
           AND T.bl_no             = S.bl_no
           AND T.cntr_no           = S.cntr_no
    </update>

    <select id="selectCariLdunRprtBlautoRlbrPrcsList"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo"
            resultType="alpass.ipt.car.ldun.vo.CarCagLdunRprtCntrVo">
               /* CarCagLdunRprt.selectCariLdunRprtBlautoRlbrPrcsList */
               SELECT LM.ldun_rprt_no             AS ldun_rprt_no        /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
                , LM.mrn                      AS mrn                 /** Mrn !== MRN ==! */
                , B.cag_mgmt_no               AS cag_mgmt_no         /** N° Demande De La Création De Crn !== 화물관리번호 ==! */
                , B.bf_cag_mgmt_no            AS bf_cag_mgmt_no      /** Crn Précédent !== 이전화물관리번호 ==! */
                , B.cag_chrc_cd               AS cag_chrc_cd         /** Nature De Cargaison !== 화물특성코드 ==! */
                , LB.bl_no                    AS bl_no               /** N° De Bl !== BL번호 ==! */
                , B.cag_chrc_cd               AS cag_chrc_cd         /** Nature De Cargaison !== 화물특성코드 ==! */
                , B.pdls_nm                   AS pdls_nm             /** Nom De L'Article !== 품목명 ==! */
                , LB.dscr_tp_cd               AS dscr_tp_cd          /** Code de non-conformité !== 불일치구분코드 ==! */
                , LC.cntr_srno                AS cntr_srno           /** N° De Séquence Du Conteneur !== 컨테이너일련번호 ==! */
                , LC.cntr_tp_cd               AS cntr_tp_cd          /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
                , LB.divd_ldun_last_yn        AS divd_ldun_last_yn   /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
                , LB.ibobz_cd                 AS bl_ibobz_cd         /** Code de zone sous douane !== 보세구역코드 ==! */
                , NVL(LB.pckg_gcnt, 0)        AS bl_pckg_gcnt        /** Nombre De Colis !== 포장개수 ==! */
                , NVL(LB.ttwg, 0)             AS bl_ttwg             /** Poids Brut !== 총중량 ==! */
                , NVL(LB.lir_vol, 0)          AS bl_lir_vol          /** Volume (Litre) !== 리터용적 ==! */
                , LC.ibobz_cd                 AS ibobz_cd            /** Code de zone sous douane !== 보세구역코드 ==! */
                , NVL(LC.pckg_gcnt, 0)        AS pckg_gcnt           /** Nombre De Colis !== 포장개수 ==! */
                , NVL(LC.ttwg, 0)             AS ttwg                /** Poids Brut !== 총중량 ==! */
             FROM TB_CARI_LDUN_RPRT_BL LB
             LEFT JOIN TB_CARI_LDUN_RPRT_CNTR LC
               ON LB.ldun_rprt_no = LC.ldun_rprt_no
              AND LB.bl_no = LC.bl_no
            INNER JOIN TB_CARI_LDUN_RPRT LM
               ON LM.ldun_rprt_no = LB.ldun_rprt_no
            INNER JOIN TB_CARI_CAG_DCSH_BL B
               ON B.mrn = LM.mrn
              AND B.bl_no = LB.bl_no
            WHERE 1=1
              AND B.bl_pt_cd = 'M'
              AND LM.ldun_rprt_no = #{ldunRprtNo}
              AND NOT EXISTS( SELECT 1
                                FROM TB_CARI_LDUN_RPRT_BL T1
                               WHERE LB.ldun_rprt_no = T1.ldun_rprt_no
                                 AND LB.bl_no = T1.bl_no
                                 AND NVL(T1.apre_yn_cd, 'N') != 'O'
                  )
              AND NOT EXISTS( SELECT 1
                                FROM TB_CARI_LDUN_RPRT_CNTR T1
                               WHERE LB.ldun_rprt_no = T1.ldun_rprt_no
                                 AND LB.bl_no = T1.bl_no
                                 AND NVL(T1.apre_yn_cd, 'N') != 'O'
                  )
              AND NOT EXISTS( SELECT 1
                                FROM TB_CARI_RLBR T1
                               WHERE LM.ldun_rprt_no = T1.rela_no
                                 AND B.cag_mgmt_no = T1.cag_mgmt_no
                                 AND T1.del_yn != 'Y'
                  )

    </select>

    <!-- N° De Gestion De Rapport De Déchargement !== 하역보고관리번호 ==! -->
    <select id="selectLdunRprtMgmtNo"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo"
            resultType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprtMapper.selectLdunRprtMgmtNo */
        SELECT LDUN_RPRT_MGMT_NO, RPRT_DGCNT
        FROM ALPASSEXT.TB_CARE_LDUN_RPRT
        WHERE ldun_RPRT_no = #{ldunRprtNo} LIMIT 1
    </select>

    <!-- N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! -->
    <select id="selectLdunRprtNo"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo"
            resultType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprtMapper.selectLdunRprtNo */
        SELECT LDUN_RPRT_NO
          FROM ALPASSEXT.TB_CARE_LDUN_RPRT
         WHERE LDUN_RPRT_MGMT_NO = #{ldunRprtMgmtNo}
           AND RPRT_DGCNT = #{rprtDgcnt} LIMIT 1
    </select>

    <!-- Enregistrement de la rectification de rapport de déchargement (CARE) !== 하역보고정정 등록 (CARE) ==! -->
    <insert id="insertLdunRprtMdfyAsNew"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprtMapper.insertLdunRprtMdfyAsNew */
        INSERT INTO ALPASSEXT.tb_care_ldun_rprt_mdfy
        ( ldun_rprt_mdfy_mgrn                         /** N° De Gestion De Demande De Déchargement !== 하역보고정정관리번호 ==! */
        , rprt_dgcnt                                  /** N° ordre de rapport !== 보고차수 ==! */
        , ldun_rprt_no                                /** N° De Demande De Déchargement !== 하역보고번호 ==! */
        , ldun_rprt_mdfy_no                           /** N° rectification de rapport de déchargement !== 하역보고정정번호 ==! */
        , mdfy_dgcnt                                  /** Fréquence de rectification !== 정정차수 ==! */
        , co_rqst_no                                  /** N° de demande d'entreprise !== 업체신청번호 ==! */
        , mrn                                         /** Mrn !== MRN ==! */
        , trsn_dttm                                   /** Date et heure de transmission !== 전송일시 ==! */
        , cag_rqst_tp_cd                              /** Code de type de demande fret !== 화물신청구분코드 ==! */
        , jrsd_orgn_cd                                /** Code D'Unité Compétente !== 관할조직코드 ==! */
        , trsn_co_cd                                  /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
        , real_ldun_strt_dttm                         /** Date/Heure de début de déchargement effective !== 실제하역시작일시 ==! */
        , real_ldun_end_dttm                          /** Date/Heure de fin de déchargement effective !== 실제하역종료일시 ==! */
        , prcs_dttm                                   /** Date Et Heure De Traitement !== 처리일시 ==! */
        , prcs_stts_cd                                /** Code De Statut De Traitement !== 처리상태코드 ==! */
        , infm_cn                                     /** Contenu De Notification !== 통보내용 ==! */
        , atch_file_id                                /** Id Du Fichier Joint !== 파일ID ==! */
        , del_yn                                      /** Suppression On !== 삭제여부 ==! */
        , frst_regst_id                               /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
        , frst_rgsr_dttm                              /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
        , last_chpr_id                                /** Id Du Modificateur Final !== 최종변경자ID ==! */
        , last_chg_dttm                               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        )
        SELECT #{ldunRprtMgmtNo}                      /** N° De Gestion De Demande De Déchargement !== 하역보고정정관리번호 ==! */
             , #{rprtDgcnt}                           /** N° ordre de rapport !== 보고차수 ==! */
             , #{ldunRprtNo}                          /** N° De Demande De Déchargement !== 하역보고번호 ==! */
             , #{ldunRprtMdfyNo}                      /** N° rectification de rapport de déchargement !== 하역보고정정번호 ==! */
             , (SELECT NVL(MAX(MDFY_DGCNT), -1) + 1
                FROM ALPASSEXT.TB_CARE_LDUN_RPRT_MDFY
                WHERE ldun_rprt_no = #{ldunRprtNo}
                  AND rprt_dgcnt = #{rprtDgcnt})      /** Fréquence de rectification !== 정정차수 ==! */
             , A.co_rqst_no                           /** N° de demande d'entreprise !== 업체신청번호 ==! */
             , A.mrn                                  /** Mrn !== MRN ==! */
             , A.trsn_dttm                            /** Date et heure de transmission !== 전송일시 ==! */
             , #{cagRqstTpCd}                         /** Code de type de demande fret !== 화물신청구분코드 ==! */
             , A.jrsd_orgn_cd                         /** Code D'Unité Compétente !== 관할조직코드 ==! */
             , A.trsn_co_cd                           /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
             , A.real_ldun_strt_dttm                    /** Date/Heure de début de déchargement effective !== 실제하역시작일시 ==! */
             , A.real_ldun_end_dttm                     /** Date/Heure de fin de déchargement effective !== 실제하역종료일시 ==! */
             , A.prcs_dttm                            /** Date Et Heure De Traitement !== 처리일시 ==! */
             , #{prcsSttsCd}                          /** Code De Statut De Traitement !== 처리상태코드 ==! */
             , ''                                     /** Contenu De Notification !== 통보내용 ==! */
             , A.atch_file_id                         /** Id Du Fichier Joint !== 파일ID ==! */
             , 'N'                                    /** Suppression On !== 삭제여부 ==! */
             , A.frst_regst_id                        /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , SYSTIMESTAMP                           /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , A.last_chpr_id                         /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , SYSTIMESTAMP                           /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        FROM ALPASSEXT.tb_care_ldun_rprt A
        WHERE A.del_yn = 'N'                          /** Suppression ON !== 삭제여부 ==! */
          AND A.ldun_rprt_mgmt_no = #{ldunRprtMgmtNo}
          AND A.rprt_dgcnt = #{rprtDgcnt}
    </insert>
    
    <!-- Supprimer la rectification de rapport de déchargement (CARE) !==하역 보고 정정 삭제 한다. (CARE)==! -->
    <delete id="deleteCareLdunRprtMdfyBl"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtBlVo">
        /* CarCagLdunRprtMapper.deleteCareLdunRprtMdfyBl */
        DELETE ALPASSEXT.TB_CARE_LDUN_RPRT_MDFY_BL A
         WHERE 1=1
           AND A.ldun_rprt_mdfy_mgrn = #{ldunRprtMdfyMgrn}
           AND A.rprt_dgcnt= #{rprtDgcnt}
           AND A.BL_NO= #{blNo}
    </delete>

    <!-- Enregistrement de la rectification de rapport de déchargement (CARE BL) !== 하역보고정정 등록 (CARE BL) ==! -->
    <insert id="insertCareLdunRprtMdfyBl"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtBlVo">
        /* CarCagLdunRprtMapper.insertCareLdunRprtMdfyBl */
        INSERT INTO ALPASSEXT.tb_care_ldun_RPRT_mdfy_bl
             ( ldun_rprt_mdfy_mgrn                   /** N° De Gestion De Rapport De Déchargement !== 하역보고정정관리번호 ==! */
             , rprt_dgcnt                            /** N° ordre de rapport !== 보고차수 ==! */
             , bl_no                                 /** N° De Bl !== BL번호 ==! */
             , hbl_no                                /** N° de House B/L !== HBL번호 ==! */
             , ibobz_cd                              /** Code de zone sous douane !== 보세구역코드 ==! */
             , dscr_tp_cd                            /** Code de non-conformité !== 불일치구분코드 ==! */
             , pckg_gcnt                             /** Nombre De Colis !== 포장개수 ==! */
             , ttwg                                  /** Poids Brut !== 총중량 ==! */
             , cbm_vol                               /** Volume (Mtq) !== 입방미터용적 ==! */
             , lir_vol                               /** Volume (Litre) !== 리터용적 ==! */
             , divd_ldun_last_yn                     /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             , insc_cfrm_dt                          /** Date de vérification de la visite !== 검사확인일자 ==! */
             , apre_yn_cd                            /** Autorisation O/N !== 승인여부코드 ==! */
             , rtrn_rsn_cn                           /** Motif De Rejet !== 반려사유내용 ==! */
             , cag_chrc_cd                           /** Nature De Cargaison !== 화물특성코드 ==! */
             , del_yn                                /** Suppression On !== 삭제여부 ==! */
             , frst_regst_id                         /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , frst_rgsr_dttm                        /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , last_chpr_id                          /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , last_chg_dttm                         /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
             )
      SELECT #{ldunRprtMdfyMgrn}                     /** N° De Gestion De Rapport De Déchargement !== 하역보고정정관리번호 ==! */
             , A.rprt_dgcnt                          /** N° ordre de rapport !== BL번호 ==! */
             , A.bl_no                               /** N° De Bl !== BL번호 ==! */
             , A.hbl_no                              /** N° de House B/L !== HBL번호 ==! */
             , A.ibobz_cd                            /** Code de zone sous douane !== 보세구역코드 ==! */
             , A.dscr_tp_cd                          /** Code de non-conformité !== 불일치구분코드 ==! */
             , A.pckg_gcnt                           /** Nombre De Colis !== 포장개수 ==! */
             , A.ttwg                                /** Poids Brut !== 총중량 ==! */
             , A.cbm_vol                             /** Volume (Mtq) !== 입방미터용적 ==! */
             , A.lir_vol                             /** Volume (Litre) !== 리터용적 ==! */
             , 'N'                                   /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             , TO_CHAR(TO_DATE(A.insc_cfrm_dt, 'DD/MM/YYYY'), 'DDMMYYYY')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             , A.apre_yn_cd                          /** Autorisation O/N !== 승인여부코드 ==! */
             , A.audt_opin_cn                        /** Motif De Rejet !== 반려사유내용 ==! */
             , A.cag_chrc_cd                         /** Nature De Cargaison !== 화물특성코드 ==! */
             , A.del_yn                              /** Suppression On !== 삭제여부 ==! */
             , A.frst_regst_id                       /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , A.frst_rgsr_dttm                      /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , A.last_chpr_id                        /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , A.last_chg_dttm                       /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        FROM ALPASSEXT.tb_care_ldun_RPRT_bl A
       INNER JOIN ALPASSEXT.tb_care_ldun_RPRT M
          ON M.ldun_RPRT_mgmt_no = A.ldun_RPRT_mgmt_no
       WHERE 1 = 1
         AND A.del_yn = 'N'
         AND M.del_yn = 'N'
         AND M.ldun_rprt_mgmt_no = #{ldunRprtMgmtNo}
         AND M.rprt_dgcnt = #{rprtDgcnt}
        <if test="blNo != null and blNo != ''">
           AND A.bl_no  = #{blNo}
								</if>
    </insert>

    <!-- Supprimer la rectification de rapport de déchargement (CARE Conteneur) !==하역 보고 정정 Conteneur 삭제 한다. (CARE Conteneur)==! -->
    <delete id="deleteCareLdunRprtMdfyCntr"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtCntrVo">
        /* CarCagLdunRprtMapper.deleteCareLdunRprtMdfyCntr */
        DELETE ALPASSEXT.tb_care_ldun_rprt_mdfy_cntr A
         WHERE 1=1
           AND A.ldun_rprt_mdfy_mgrn = #{ldunRprtMdfyMgrn}
           AND A.rprt_dgcnt= #{rprtDgcnt}
           AND A.BL_NO= #{blNo}
           AND A.Cntr_Srno= #{cntrSrno}
    </delete>

    <!-- Enregistrement de la rectification de rapport de déchargement (CARE Conteneur) !== 하역보고정정 컨테이너 등록 (CARE Conteneur) ==! -->
    <insert id="insertCareLdunRprtMdfyCntr"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtCntrVo">
        /* CarCagLdunRprtMapper.insertCareLdunRprtMdfyCntr */
        INSERT INTO ALPASSEXT.tb_care_ldun_rprt_mdfy_cntr
             ( ldun_rprt_mdfy_mgrn                   /** N° De Gestion De Rapport De Déchargement !== 하역보고정정관리번호 ==! */
             , rprt_dgcnt                            /** N° ordre de rapport !== 보고차수 ==! */
             , BL_NO                                 /** N° De Bl !== BL번호 ==! */
             , CNTR_SRNO                             /** N° De Séquence Du Conteneur !== 컨테이너일련번호 ==! */
             , dscr_tp_cd                            /** Code de non-conformité !== 불일치구분코드 ==! */
             , cntr_no                               /** N° De Conteneur !== 컨테이너번호 ==! */
             , cntr_tp_cd                            /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
             , pckg_gcnt                             /** Nombre De Colis !== 포장개수 ==! */
             , pckg_ut_cd                            /** Code De L'Unité De Colis !== 포장단위코드 ==! */
             , ttwg                                  /** Poids Brut !== 총중량 ==! */
             , seal_no1                              /** N° De Scellé1 !== 봉인번호1 ==! */
             , seal_no2                              /** N° De Scellé2 !== 봉인번호2 ==! */
             , seal_no3                              /** N° De Scellé3 !== 봉인번호3 ==! */
             , IBOBZ_CD                              /** Code de zone sous douane !== 보세구역코드 ==! */
             , divd_ldun_last_yn                     /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             , insc_cfrm_dt                          /** Date de vérification de la visite !== 검사확인일자 ==! */
             , apre_yn_cd                            /** Autorisation O/N !== 승인여부코드 ==! */
             , rtrn_rsn_cn                           /** Motif De Rejet !== 반려사유내용 ==! */
             , DEL_YN                                /** Suppression On !== 삭제여부 ==! */
             , FRST_REGST_ID                         /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , FRST_RGSR_DTTM                        /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , last_chpr_id                          /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , LAST_CHG_DTTM                         /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
             )
      SELECT #{ldunRprtMdfyMgrn}                     /** N° De Gestion De Rapport De Déchargement !== 하역보고정정관리번호 ==! */
             , A.rprt_dgcnt                          /** N° ordre de rapport !== 보고차수 ==! */
             , A.BL_NO                               /** N° De Bl !== BL번호 ==! */
             , A.CNTR_SRNO                           /** N° De Séquence Du Conteneur !== 컨테이너일련번호 ==! */
             , A.dscr_tp_cd                          /** Code de non-conformité !== 불일치구분코드 ==! */
             , A.cntr_no                             /** N° De Conteneur !== 컨테이너번호 ==! */
             , A.cntr_tp_cd                          /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
             , A.pckg_gcnt                           /** Nombre De Colis !== 포장개수 ==! */
             , A.pckg_ut_cd                          /** Code De L'Unité De Colis !== 포장단위코드 ==! */
             , A.ttwg                                /** Poids Brut !== 총중량 ==! */
             , A.seal_no1                            /** N° De Scellé1 !== 봉인번호1 ==! */
             , A.seal_no2                            /** N° De Scellé2 !== 봉인번호2 ==! */
             , A.seal_no3                            /** N° De Scellé3 !== 봉인번호3 ==! */
             , A.IBOBZ_CD                            /** Code de zone sous douane !== 보세구역코드 ==! */
             , 'N'                                   /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             , TO_CHAR(TO_DATE(A.insc_cfrm_dt , 'DD/MM/YYYY'),'DDMMYYYY')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             , A.apre_yn_cd                          /** Autorisation O/N !== 승인여부코드 ==! */
             , A.audt_opin_cn                        /** Contenu De L'Opinion À La Suite De La Vérification !== 심사의견내용 ==! */
             , A.DEL_YN                              /** Suppression On !== 삭제여부 ==! */
             , A.FRST_REGST_ID                       /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , A.FRST_RGSR_DTTM                      /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , A.last_chpr_id                        /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , A.LAST_CHG_DTTM                       /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        FROM ALPASSEXT.tb_care_ldun_rprt_cntr A
       INNER JOIN ALPASSEXT.tb_care_ldun_RPRT M
          ON M.ldun_RPRT_mgmt_no = A.ldun_RPRT_mgmt_no
       WHERE 1 = 1
         AND M.ldun_rprt_mgmt_no = #{ldunRprtMgmtNo}
         AND M.rprt_dgcnt = #{rprtDgcnt}
         AND M.del_yn = 'N'
         AND A.del_yn = 'N'
         AND A.bl_no = #{blNo}
         AND A.cntr_srno = #{cntrSrno}
    </insert>

    <!-- Voir les détails de la rectification de rapport de déchargement !==하역 보고 정정 조회한다.==! -->
    <select id="selectCareLdunRprtMdfy"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo"
            resultType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprtMapper.selectCareLdunRprtMdfy */
        SELECT LDUN.ldun_rprt_mgmt_no                                AS ldun_rprt_mgmt_no/** N° De Gestion De Demande De Déchargement !== 하역신청관리번호 ==! */
             , LDUN.rprt_dgcnt                                       AS rprt_dgcnt/** N° ordre de rapport !== 보고차수 ==! */
             , LDUN.ldun_rprt_no                                     AS ldun_rprt_no/** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
             , MDFY.ldun_rprt_mdfy_mgrn                              AS ldun_rprt_mdfy_mgrn/** N° De Gestion De Rapport De Déchargement !== 하역보고정정관리번호 ==! */
             , MDFY.ldun_rprt_mdfy_no                                AS ldun_rprt_mdfy_no/** N° rectification de rapport de déchargement !== 하역보고정정번호 ==! */
             , MDFY.mrn                                              AS mrn /** Mrn !== MRN ==! */
             , MDFY.mdfy_dgcnt                                       AS mdfy_dgcnt /** Fréquence de rectification !== 정정차수 ==! */
             , MDFY.co_rqst_no                                       AS co_rqst_no /** N° de demande d'entreprise !== 업체신청번호 ==! */
             , MDFY.trsn_dttm                                        AS trsn_dttm /** Date et heure de transmission !== 전송일시 ==! */
             , MDFY.cag_rqst_tp_cd                                   AS cag_rqst_tp_cd /** Code de type de demande fret !== 화물신청구분코드 ==! */
             , MDFY.jrsd_orgn_cd                                     AS jrsd_orgn_cd /** Code D'Unité Compétente !== 관할조직코드 ==! */
             , MDFY.trsn_co_cd                                       AS trsn_co_cd /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
             , MDFY.real_ldun_strt_dttm                                AS real_ldun_strt_dttm /** Date/Heure de début de déchargement effective !== 실제하역시작일시 ==! */
             , MDFY.real_ldun_end_dttm                                 AS real_ldun_end_dttm  /** Date/Heure de fin de déchargement effective !== 실제하역종료일시 ==! */
             , MDFY.prcs_dttm                                        AS prcs_dttm /** Date Et Heure De Traitement !== 처리일시 ==! */
             , MDFY.prcs_stts_cd                                     AS prcs_stts_cd /** Code De Statut De Traitement !== 처리상태코드 ==! */
             , MDFY.infm_cn                                          AS infm_cn /** Contenu De Notification !== 통보내용 ==! */
             , MDFY.mdfy_rsn_cn                                      AS mdfy_rsn_cn /** Motif de rectification !== 정정사유내용 ==! */
             , MDFY.del_yn                                           AS del_yn /** Suppression On !== 삭제여부 ==! */
             , MDFY.frst_regst_id                                    AS frst_regst_id /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , TO_CHAR(MDFY.frst_rgsr_dttm, 'DD/MM/YYYY HH24:MI:SS') AS frst_rgsr_dttm /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , MDFY.last_chpr_id                                     AS last_chpr_id /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , TO_CHAR(MDFY.last_chg_dttm, 'DD/MM/YYYY HH24:MI:SS')  AS last_chg_dttm /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        FROM ALPASSEXT.tb_care_ldun_rprt_mdfy MDFY
             INNER JOIN ALPASSEXT.tb_care_ldun_rprt LDUN
                ON MDFY.ldun_rprt_no = LDUN.ldun_rprt_no
        WHERE MDFY.del_yn = 'N'                                      /** Suppression ON !== 삭제여부 ==! */
          AND LDUN.del_yn = 'N'                                      /** Suppression ON !== 삭제여부 ==! */
          AND MDFY.ldun_rprt_mdfy_mgrn = #{ldunRprtMdfyMgrn}
          AND MDFY.rprt_dgcnt = #{rprtDgcnt}
    </select>

    <!-- Supprimer la rectification de rapport de déchargement (CARI) !==하역 보고 정정 삭제 한다. (CARI)==! -->
    <delete id="deleteCariLdunRprtMdfy"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprtMapper.deleteCariLdunRprtMdfy */
        DELETE
          FROM TB_CARI_LDUN_RPRT_MDFY A
         WHERE A.ldun_rprt_mdfy_no = #{ldunRprtMdfyNo}
           AND A.rprt_dgcnt = #{rprtDgcnt}
    </delete>

    <!-- Enregistrement de la rectification de rapport de déchargement (CARI) !== 하역보고정정 등록 (CARI) ==! -->
    <insert id="insertCariLdunRprtMdfy"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprtMapper.insertCariLdunRprtMdfy */
        INSERT INTO tb_cari_ldun_rprt_mdfy
             ( ldun_rprt_mdfy_no             /** N° rectification de rapport de déchargement !== 하역보고정정번호 ==! */
             , ldun_rprt_no                  /** N° De Demande De Déchargement !== 하역보고번호 ==! */
             , ldun_rprt_mdfy_mgrn           /** N° De Gestion De Demande De Déchargement !== 하역신청정정관리번호 ==! */
             , rprt_dgcnt                    /** N° ordre de rapport !== 보고차수 ==! */
             , mdfy_dgcnt                    /** Fréquence de rectification !== 정정차수 ==! */
             , co_rqst_no                    /** N° de demande d'entreprise !== 업체신청번호 ==! */
             , mrn                           /** Mrn !== MRN ==! */
             , trsn_dttm                     /** Date et heure de transmission !== 전송일시 ==! */
             , cag_rqst_tp_cd                /** Code de type de demande fret !== 화물신청구분코드 ==! */
             , jrsd_orgn_cd                  /** Code D'Unité Compétente !== 관할조직코드 ==! */
             , trsn_co_cd                    /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
             , real_ldun_strt_dttm             /** Date/Heure de début de déchargement effective !== 실제하역시작일시 ==! */
             , real_ldun_end_dttm              /** Date/Heure de fin de déchargement effective !== 실제하역종료일시 ==! */
             , infm_cn                       /** Contenu De Notification !== 통보내용 ==! */
             , mdfy_rsn_cn                   /** Motif de rectification !== 정정사유내용 ==! */
             , prcs_dttm                     /** Date Et Heure De Traitement !== 처리일시 ==! */
             , prcs_stts_cd                  /** Code De Statut De Traitement !== 처리상태코드 ==! */
             , del_yn                        /** Suppression On !== 삭제여부 ==! */
             , frst_regst_id                 /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , frst_rgsr_dttm                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , last_chpr_id                  /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , last_chg_dttm                 /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
             )
        SELECT #{ldunRprtMdfyNo}             /** N° rectification de rapport de déchargement !== 하역보고정정번호 ==! */
             , A.ldun_rprt_no                /** N° De Demande De Déchargement !== 하역보고번호 ==! */
             , A.ldun_rprt_mdfy_mgrn         /** N° De Gestion De Demande De Déchargement !== 하역신청정정관리번호 ==! */
             , A.rprt_dgcnt                  /** N° ordre de rapport !== 보고차수 ==! */
             , A.mdfy_dgcnt                  /** Fréquence de rectification !== 정정차수 ==! */
             , A.co_rqst_no                  /** N° de demande d'entreprise !== 업체신청번호 ==! */
             , A.mrn                         /** Mrn !== MRN ==! */
             , A.trsn_dttm                   /** Date et heure de transmission !== 전송일시 ==! */
             , A.cag_rqst_tp_cd              /** Code de type de demande fret !== 화물신청구분코드 ==! */
             , A.jrsd_orgn_cd                /** Code D'Unité Compétente !== 관할조직코드 ==! */
             , A.trsn_co_cd                  /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
             , A.real_ldun_strt_dttm           /** Date/Heure de début de déchargement effective !== 실제하역시작일시 ==! */
             , A.real_ldun_end_dttm            /** Date/Heure de fin de déchargement effective !== 실제하역종료일시 ==! */
             , A.infm_cn                     /** Contenu De Notification !== 통보내용 ==! */
             , A.mdfy_rsn_cn                 /** Motif de rectification !== 정정사유내용 ==! */
             , A.prcs_dttm                   /** Date Et Heure De Traitement !== 처리일시 ==! */
             , A.prcs_stts_cd                /** Code De Statut De Traitement !== 처리상태코드 ==! */
             , A.del_yn                      /** Suppression On !== 삭제여부 ==! */
             , A.frst_regst_id               /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , A.frst_rgsr_dttm              /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , A.last_chpr_id                /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , A.last_chg_dttm               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
          FROM ALPASSEXT.tb_care_ldun_rprt_mdfy A
         WHERE A.del_yn = 'N' /** Suppression ON !== 삭제여부 ==! */
           AND A.ldun_rprt_mdfy_mgrn = #{ldunRprtMdfyMgrn}
           AND A.rprt_dgcnt = #{rprtDgcnt}
    </insert>

    <!-- Supprimer la rectification de rapport de déchargement (CARI BL) !==하역 보고 정정 BL 삭제 한다. (CARI BL)==! -->
    <delete id="deleteCariLdunRprtMdfyBl"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprtMapper.deleteCariLdunRprtMdfyBl */
        DELETE
               TB_CARI_LDUN_RPRT_BL_MDFY A
         WHERE 1=1
           AND A.ldun_rprt_mdfy_no = #{ldunRprtMdfyNo} /**  !== 하역보고정정번호 ==! */
           AND A.rprt_dgcnt = #{rprtDgcnt} /**  !== 보고차수 ==! */
    </delete>

    <!-- Enregistrement de la rectification de rapport de déchargement (CARI BL) !== 하역보고정정 BL 등록 (CARI BL) ==! -->
    <insert id="insertCariLdunRprtMdfyBl"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprtMapper.insertCariLdunRprtMdfyBl */
        INSERT INTO tb_carI_ldun_rprt_BL_mdfy
             ( ldun_rprt_mdfy_no                 /** N° rectification de rapport de déchargement !== 하역보고정정번호 ==! */
             , bl_no                             /** N° De Bl !== BL번호 ==! */
             , hbl_no                            /** N° de House B/L !== HBL번호 ==! */
             , ibobz_cd                          /** Code de zone sous douane !== 보세구역코드 ==! */
             , rprt_dgcnt                        /** N° ordre de rapport !== 보고차수 ==! */
             , dscr_tp_cd                        /** Code de non-conformité !== 불일치구분코드 ==! */
             , pckg_gcnt                         /** Nombre De Colis !== 포장개수 ==! */
             , ttwg                              /** Poids Brut !== 총중량 ==! */
             , cbm_vol                           /** Volume (Mtq) !== 입방미터용적 ==! */
             , lir_vol                           /** Volume (Litre) !== 리터용적 ==! */
             , divd_ldun_last_yn                 /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             , insc_cfrm_dt                      /** Date de vérification de la visite !== 검사확인일자 ==! */
             , apre_yn_cd                        /** Autorisation O/N !== 승인여부코드 ==! */
             , rtrn_rsn_cn                       /** Motif De Rejet !== 반려사유내용 ==! */
             , cag_chrc_cd                       /** Nature De Cargaison !== 화물특성코드 ==! */
             , del_yn                            /** Suppression On !== 삭제여부 ==! */
             , frst_regst_id                     /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , frst_rgsr_dttm                    /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , last_chpr_id                      /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , last_chg_dttm                     /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
             )
        SELECT #{ldunRprtMdfyNo}                 /** N° rectification de rapport de déchargement !== 하역보고정정번호 ==! */
             , A.bl_no                           /** N° De Bl !== BL번호 ==! */
             , A.hbl_no                          /** N° de House B/L !== HBL번호 ==! */
             , A.ibobz_cd                        /** Code de zone sous douane !== 보세구역코드 ==! */
             , A.rprt_dgcnt                      /** N° ordre de rapport !== 보고차수 ==! */
             , A.dscr_tp_cd                      /** Code de non-conformité !== 불일치구분코드 ==! */
             , A.pckg_gcnt                       /** Nombre De Colis !== 포장개수 ==! */
             , A.ttwg                            /** Poids Brut !== 총중량 ==! */
             , A.cbm_vol                         /** Volume (Mtq) !== 입방미터용적 ==! */
             , A.lir_vol                         /** Volume (Litre) !== 리터용적 ==! */
             , A.divd_ldun_last_yn               /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             , TO_CHAR(TO_DATE(A.insc_cfrm_dt , 'DD/MM/YYYY'),'DDMMYYYY')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             , A.apre_yn_cd                      /** Autorisation O/N !== 승인여부코드 ==! */
             , A.rtrn_rsn_cn                     /** Motif De Rejet !== 반려사유내용 ==! */
             , A.cag_chrc_cd                     /** Nature De Cargaison !== 화물특성코드 ==! */
             , A.del_yn                          /** Suppression On !== 삭제여부 ==! */
             , A.frst_regst_id                   /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , A.frst_rgsr_dttm                  /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , A.last_chpr_id                    /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , A.last_chg_dttm                   /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
          FROM ALPASSEXT.tb_care_ldun_rprt_mdfy_bl A
         WHERE A.del_yn = 'N'                    /** Suppression ON !== 삭제여부 ==! */
           AND A.ldun_rprt_mdfy_mgrn = #{ldunRprtMdfyMgrn}
           AND A.rprt_dgcnt = #{rprtDgcnt}
    </insert>

    <!-- Supprimer la rectification de rapport de déchargement (CARI Conteneur) !==하역 보고 정정 Conteneur 삭제 한다. (CARI Conteneur)==! -->
    <delete id="deleteCariLdunRprtMdfyCntr"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprtMapper.deleteCariLdunRprtMdfyCntr */
        DELETE
               tb_carI_ldun_rprt_cntr_mdfy A
         WHERE 1=1
           AND A.ldun_rprt_mdfy_no = #{ldunRprtMdfyNo} /**  !== 하역보고정정번호 ==! */
           AND A.rprt_dgcnt = #{rprtDgcnt} /**  !== 보고차수 ==! */
    </delete>

    <!-- Enregistrement de la rectification de rapport de déchargement (CARI Conteneur) !== 하역보고정정 컨테이너 등록 (CARI Conteneur) ==! -->
    <insert id="insertCariLdunRprtMdfyCntr"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprtMapper.insertCariLdunRprtMdfyCntr */
        INSERT INTO tb_carI_ldun_rprt_cntr_mdfy
             ( ldun_rprt_mdfy_no                 /** N° rectification de rapport de déchargement !== 하역보고정정번호 ==! */
             , bl_no                             /** N° De Bl !== BL번호 ==! */
             , cntr_srno                         /**  !== 컨테이너일련번호 ==! */
             , rprt_dgcnt                        /** N° ordre de rapport !== 보고차수 ==! */
             , dscr_tp_cd                        /** Code de non-conformité !== 불일치구분코드 ==! */
             , cntr_no                           /** N° De Conteneur !== 컨테이너번호 ==! */
             , cntr_tp_cd                        /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
             , pckg_gcnt                         /** Nombre De Colis !== 포장개수 ==! */
             , pckg_ut_cd                        /** Code De L'Unité De Colis !== 포장단위코드 ==! */
             , ttwg                              /** Poids Brut !== 총중량 ==! */
             , seal_no1                          /** N° De Scellé1 !== 봉인번호1 ==! */
             , seal_no2                          /** N° De Scellé2 !== 봉인번호2 ==! */
             , seal_no3                          /** N° De Scellé3 !== 봉인번호3 ==! */
             , ibobz_cd                          /** Code de zone sous douane !== 보세구역코드 ==! */
             , divd_ldun_last_yn                 /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             , insc_cfrm_dt                      /** Date de vérification de la visite !== 검사확인일자 ==! */
             , apre_yn_cd                        /** Autorisation O/N !== 승인여부코드 ==! */
             , rtrn_rsn_cn                       /** Motif De Rejet !== 반려사유내용 ==! */
             , del_yn                            /** Suppression On !== 삭제여부 ==! */
             , frst_regst_id                     /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , frst_rgsr_dttm                    /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , last_chpr_id                      /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , last_chg_dttm                     /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
             )
        SELECT #{ldunRprtMdfyNo}                 /** N° rectification de rapport de déchargement !== 하역보고정정번호 ==! */
             , A.bl_no                           /** N° De Bl !== BL번호 ==! */
             , cntr_srno                         /**  !== 컨테이너일련번호 ==! */
             , A.rprt_dgcnt                      /** N° ordre de rapport !== 보고차수 ==! */
             , dscr_tp_cd                        /** Code de non-conformité !== 불일치구분코드 ==! */
             , cntr_no                           /** N° De Conteneur !== 컨테이너번호 ==! */
             , cntr_tp_cd                        /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
             , pckg_gcnt                         /** Nombre De Colis !== 포장개수 ==! */
             , pckg_ut_cd                        /** Code De L'Unité De Colis !== 포장단위코드 ==! */
             , ttwg                              /** Poids Brut !== 총중량 ==! */
             , seal_no1                          /** N° De Scellé1 !== 봉인번호1 ==! */
             , seal_no2                          /** N° De Scellé2 !== 봉인번호2 ==! */
             , seal_no3                          /** N° De Scellé3 !== 봉인번호3 ==! */
             , ibobz_cd                          /** Code de zone sous douane !== 보세구역코드 ==! */
             , divd_ldun_last_yn                 /** Dernier Déchargement Partiel On !== 분할하역최종여부 ==! */
             , TO_CHAR(TO_DATE(insc_cfrm_dt , 'DD/MM/YYYY'),'DDMMYYYY')  /** Date de vérification de la visite !== 검사확인일자 ==! */
             , apre_yn_cd                        /** Autorisation O/N !== 승인여부코드 ==! */
             , rtrn_rsn_cn                       /** Motif De Rejet !== 반려사유내용 ==! */
             , A.del_yn                          /** Suppression On !== 삭제여부 ==! */
             , A.frst_regst_id                   /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , A.frst_rgsr_dttm                  /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , A.last_chpr_id                    /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , A.last_chg_dttm                   /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
          FROM ALPASSEXT.tb_care_ldun_rprt_mdfy_cntr A
         WHERE A.del_yn = 'N'                    /** Suppression ON !== 삭제여부 ==! */
           AND A.ldun_rprt_mdfy_mgrn = #{ldunRprtMdfyMgrn}
           AND A.rprt_dgcnt = #{rprtDgcnt}
    </insert>
    
</mapper>
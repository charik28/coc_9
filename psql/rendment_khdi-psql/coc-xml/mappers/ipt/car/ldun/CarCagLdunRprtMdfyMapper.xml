<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="alpass.ipt.car.ldun.mapper.CarCagLdunRprtMdfyMapper">
	
	<sql id ="selectCarCagLdunRprtMdfyListItem">
		SELECT a.ldun_rprt_mdfy_no    /** N° rectification de rapport de déchargement !== 하역보고정정번호 */
		     , a.ldun_rprt_mdfy_mgrn  /** N° gestion de la rectification de rapport de déchargement !== 하역보고정정관리번호 ==! */
		     , a.ldun_rprt_no         /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
		     , a.mdfy_dgcnt           /** Fréquence de rectification !== 정정차수 ==! */
		     , a.rprt_dgcnt           /** N° ordre de rapport !== 보고차수 ==! */
		     , a.co_rqst_no           /** N° de demande d'entreprise !== 업체신청번호 ==! */
		     , a.mrn                  /*  Mrn !== MRN ==!  */
		     , TO_CHAR(a.trsn_dttm ,'DD/MM/YYYY HH24:MI:SS') AS trsn_dttm /** Date et heure de transmission !== 전송일시 ==! */
		     , a.trsn_dttm                                   AS sort_trsn_dttm      /** Date et heure de transmission !== 전송일시 ==! */
		     , a.cag_rqst_tp_cd       /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
		     , a.jrsd_orgn_cd         /** Code D'Unité Compétente !== 관할조직코드 ==! */
		     , FN_GET_ORGN_NM(a.jrsd_orgn_cd)     AS jrsd_orgn_nm /** Code D'Unité Compétente !== 관할조직코드 ==! */
		     , cstm.jrsd_cstm_cd                  AS jrsd_cstm_cd        /** Code de bureau compétent !== 관할세관코드 ==! */
		     , cstm.jrsd_cstm_nm                  AS jrsd_cstm_nm        /** Code de bureau compétent !== 관할세관코드 ==! */
		     , a.trsn_co_cd           /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
		     , FN_CARI_GET_CO_NM(a.trsn_co_cd) AS trsn_co_nm
		     , TO_CHAR(a.real_ldun_strt_dttm,'DD/MM/YYYY HH24:MI')       AS real_ldun_strt_dttm  /** Date/Heure de début de déchargement effective !== 실제하역시작일시 ==! */
		     , TO_CHAR(a.real_ldun_end_dttm,'DD/MM/YYYY HH24:MI')        AS real_ldun_end_dttm   /** Date/Heure de fin de déchargement effective !== 실제하역종료일시 ==! */
		     , a.infm_cn              /** Contenu De Notification !== 통보내용 ==! */
		     , a.del_yn               /** Suppression ON !== 삭제여부 ==! */
		     , a.frst_regst_id        /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
		     , TO_CHAR(a.frst_rgsr_dttm ,'DD/MM/YYYY HH24:MI:SS') AS frst_rgsr_dttm /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
		     , a.last_chpr_id         /** Id Du Modificateur Final !== 최종변경자ID ==! */
		     , TO_CHAR(a.last_chg_dttm ,'DD/MM/YYYY HH24:MI:SS') AS last_chg_dttm /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		     , a.mdfy_rsn_cn          /**  Motif de rectification !== 정정사유내용 ==!  */
		     , a.atch_file_id         /** Id Du Fichier Joint !== 파일ID ==! */
		     , c.trnp_meth_nm         /** Nom De Moyen De Transport !== 운송수단명 ==! */
		     , c.trnp_rfer_no         /** N° de référence de transport !== 운송참고번호 ==! */
		     , e.bl_nrml_gcnt         AS bl_nrml_gcnt
		     , e.bl_abnr_gcnt         AS bl_abnr_gcnt
		     , f.cntr_nrml_gcnt       AS cntr_nrml_gcnt
		     , f.cntr_abnr_gcnt       AS cntr_abnr_gcnt
		     , pb.prcs_stts_cd        /** Code de statut de traitement !== 처리상태코드 ==! */
		     , TO_CHAR(pb.prcs_dttm, 'DD/MM/YYYY HH24:MI:SS')  AS prcs_dttm    /** Date de traitement !== 처리일자 ==! */
		     , pb.rqst_dgcnt          /** N° ordre de la demande !== 신청차수 ==! */
		     , pb.hnot_emp_id         /** ID du chargé de cotation !== 배부직원ID ==! */
		     , pb.audt_emp_id         /** ID de l'insepcteur !== 심사직원ID ==! */
		     , (SELECT EMP.EMP_FMNM || ' ' || EMP.EMP_NM
		        FROM TB_POTI_EMP EMP
		        WHERE EMP.pbsr_no = pb.audt_emp_id)    AS audt_emp_nm /** Nom de l'inspecteur !==심사직원명==! */
		     , pb.insc_emp_id                          AS insc_emp_id /** ID de l'vérificateur !== 검사직원ID ==! */
		     , hnot.bfch_emp_id                        AS bfch_emp_id /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
		     , hnot.bfch_emp_nm                        AS bfch_emp_nm /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
		     , hnot.afch_emp_id                        AS afch_emp_id /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
		     , hnot.afch_emp_nm                        AS afch_emp_nm /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
		     , hnot.chg_rsn_cn                         AS chg_rsn_cn /** Motif De La Modification !== 변경사유내용 ==! */
		  FROM tb_cari_ldun_rprt_mdfy a
		  LEFT JOIN tb_cari_ldun_rprt b
		    ON a.mrn = b.mrn
		   AND a.ldun_rprt_no = b.ldun_rprt_no
		  LEFT join tb_cari_cag_dcsh c
		    ON a.mrn = c.mrn
		  LEFT JOIN ( SELECT t.ldun_rprt_mdfy_no
		                   , SUM(CASE WHEN t.dscr_tp_cd  ='OK' THEN 1 ELSE 0 END) AS bl_nrml_gcnt
		                   , SUM(CASE WHEN t.dscr_tp_cd !='OK' THEN 1 ELSE 0 END) AS bl_abnr_gcnt
		                FROM tb_cari_ldun_rprt_bl_mdfy t
		               WHERE t.del_yn ='N'
		               GROUP BY t.ldun_rprt_mdfy_no) e
		    ON a.ldun_rprt_mdfy_no  = e.ldun_rprt_mdfy_no
		  LEFT JOIN ( SELECT t.ldun_rprt_mdfy_no
		                   , SUM(CASE WHEN t.dscr_tp_cd  ='OK' THEN 1 ELSE 0 END) AS cntr_nrml_gcnt
		                   , SUM(CASE WHEN t.dscr_tp_cd !='OK' THEN 1 ELSE 0 END) AS cntr_abnr_gcnt
		                FROM tb_cari_ldun_rprt_cntr_mdfy t
		               WHERE t.del_yn ='N'
		               GROUP BY ldun_rprt_mdfy_no) f
		    ON a.ldun_rprt_mdfy_no = f.ldun_rprt_mdfy_no
		  LEFT JOIN tb_cari_cag_prcs_brkd pb
		    ON a.cag_rqst_tp_cd = pb.cag_rqst_tp_cd
		   AND a.ldun_rprt_mdfy_no = pb.cag_rqst_no
		   AND pb.del_yn = 'N'
		  LEFT JOIN (  SELECT a.cag_rqst_no    AS cag_rqst_no /** N° De Demande De Cargaison !== 화물신청번호 ==! */
		                    , a.cag_rqst_tp_cd AS cag_rqst_tp_cd /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
		                    , a.bfch_emp_id    AS bfch_emp_id /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
		                    , a.afch_emp_id    AS afch_emp_id /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
		                    , a.chg_rsn_cn     AS chg_rsn_cn /** Motif De La Modification !== 변경사유내용 ==! */
		                    , e1.EMP_FMNM || ' ' || e1.emp_nm        AS bfch_emp_nm /** Nom De L'Employé !== 직원명 ==! */
		                    , e2.EMP_FMNM || ' ' || e2.emp_nm        AS afch_emp_nm /** Nom De L'Employé !== 직원명 ==! */
		               FROM tb_cari_hnot_chg_h A
		              INNER JOIN (SELECT cag_rqst_no
		                               , MAX(chg_hist_srno) chg_hist_srno
		                            FROM tb_cari_hnot_chg_h
		                           GROUP BY cag_rqst_no) h
		                 ON a.cag_rqst_no = h.cag_rqst_no
		                AND a.chg_hist_srno = h.chg_hist_srno
		               LEFT JOIN tb_poti_emp e1
		                 ON e1.pbsr_no = a.bfch_emp_id
		               LEFT JOIN tb_poti_emp e2
		                 ON e2.pbsr_no = a.afch_emp_id) hnot
		    ON hnot.cag_rqst_no = pb.cag_rqst_no
		   AND hnot.cag_rqst_tp_cd = pb.cag_rqst_tp_cd
		  LEFT JOIN ( SELECT c1.orgn_cd
		                   , c2.orgn_cd AS jrsd_cstm_cd
		                   , c2.orgn_nm AS jrsd_cstm_nm
		                FROM tb_poti_orgn c1
		                LEFT JOIN tb_poti_orgn c2
		                  ON c1.upr_orgn_mgmt_cd = c2.orgn_mgmt_cd
		               WHERE c1.del_yn = 'N'
		       ) cstm
		    ON a.jrsd_orgn_cd = cstm.orgn_cd
		  LEFT JOIN ( SELECT C1.co_nm carr_nm
		                   , C2.co_dclr_cd
		                FROM TB_COM_CO C1
		                   , TB_COM_CO_DCLR_CD C2
		               WHERE C1.nif = C2.nif
		                 AND C2.del_yn = 'N'
		       ) CC
		    ON a.trsn_co_cd = CC.CO_DCLR_CD
		 WHERE 1=1
		   AND a.del_yn = 'N'
		   AND b.del_yn = 'N'
		   AND c.del_yn = 'N'
		   AND a.cag_rqst_tp_cd = #{cagRqstTpCd} /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
		   AND a.mdfy_dgcnt <![CDATA[>]]> 0
	</sql>
	
	<sql id ="selectCarCagLdunRprtMdfyItem">
		SELECT a.ldun_rprt_mdfy_no    /** N° rectification de rapport de déchargement !== 하역보고정정번호 */
		     , a.ldun_rprt_mdfy_mgrn  /** N° gestion de la rectification de rapport de déchargement !== 하역보고정정관리번호 ==! */
		     , c.cag_dcsh_rgsr_mgmt_no /** Numéro de gestion de l'enregistrement de la déclaration de fret !== 화물신고서등록관리번호 ==! */
		     , a.rprt_dgcnt           /** N° ordre de rapport !== 보고차수 ==! */
		     , a.co_rqst_no           /** N° de demande d'entreprise !== 업체신청번호 ==! */
		     , a.mrn                  /*  Mrn !== MRN ==!  */
		     , TO_CHAR(a.trsn_dttm ,'DD/MM/YYYY HH24:MI:SS')  AS trsn_dttm /** Date et heure de transmission !== 전송일시 ==! */
		     , a.trsn_dttm                                   AS sort_trsn_dttm      /** Date et heure de transmission !== 전송일시 ==! */
		     , a.cag_rqst_tp_cd       /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
		     , a.jrsd_orgn_cd         /** Code D'Unité Compétente !== 관할조직코드 ==! */
		     , FN_GET_ORGN_NM(a.jrsd_orgn_cd)  AS jrsd_orgn_nm        /** Code D'Unité Compétente !== 관할조직코드 ==! */
		     , cstm.jrsd_cstm_cd      AS jrsd_cstm_cd        /** Code de bureau compétent !== 관할세관코드 ==! */
		     , cstm.jrsd_cstm_nm      AS jrsd_cstm_nm        /** Code de bureau compétent !== 관할세관코드 ==! */
		     , a.trsn_co_cd           /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
		     , FN_CARI_GET_CO_NM(a.trsn_co_cd)                          AS trsn_co_nm
		     , a.trsn_co_cd || ' | ' || FN_CARI_GET_CO_NM(a.trsn_co_cd) AS trsn_co_cd_nm
		     , TO_CHAR(a.real_ldun_strt_dttm, 'DD/MM/YYYY HH24:MI:SS') AS real_ldun_strt_dttm   /** Date et heure de début de déchargement effective !== 실제하역시작일자 ==! */
		     , TO_CHAR(a.real_ldun_end_dttm, 'DD/MM/YYYY HH24:MI:SS')  AS real_ldun_end_dttm    /** Date et heure de fin de déchargement effective !== 실제하역종료일자 ==! */
		     , a.infm_cn              /** Contenu De Notification !== 통보내용 ==! */
		     , a.del_yn               /** Suppression ON !== 삭제여부 ==! */
		     , a.frst_regst_id        /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
		     , TO_CHAR(a.frst_rgsr_dttm ,'DD/MM/YYYY HH24:MI:SS') AS frst_rgsr_dttm /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
		     , a.last_chpr_id         /** Id Du Modificateur Final !== 최종변경자ID ==! */
		     , TO_CHAR(a.last_chg_dttm ,'DD/MM/YYYY HH24:MI:SS')  AS last_chg_dttm  /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		     , a.mdfy_dgcnt           /** Fréquence de rectification !== 정정차수 ==! */
		     , a.ldun_rprt_no         /** N° De Rapport Sur Le Déchargement !== 하역보고번호 ==! */
		     , a.mdfy_rsn_cn          /**  Motif de rectification  !== 정정사유내용 ==!  */
		     , a.atch_file_id         /** Id Du Fichier Joint !== 파일ID ==! */
		     , a.mdfy_atch_file_id    /** ID de pièce jointe de rectification !== 정정첨부파일ID ==! */
		     , TO_CHAR(a.prcs_dttm,'DD/MM/YYYY HH24:MI:SS')             AS prcs_dttm           /** Date Et Heure De Traitement !== 처리일시 ==! */
		     , c.trnp_meth_nm         /** Nom De Moyen De Transport !== 운송수단명 ==! */
		     , c.trnp_meth_idfy_no    /** N° D'Identification Du Moyen De Transport !== 운송수단식별번호 ==! */
		     , c.trnp_rfer_no         /** N° de référence de transport !== 운송참고번호 ==! */
		     , c.trnp_mean_cd         /** Code de type de transport !==운송방법코드==! */
		     , c.trnp_meth_loct_nm    /** Emplacement De Moyen De Transport !== 운송수단위치명 ==! */
		     , brkd.prcs_stts_cd      /** Code de statut de traitement !== 처리상태코드 ==! */
		     , brkd.hnot_emp_id       /** ID de distributeur !==배부직원ID==! */
		     , brkd.audt_emp_id       /** ID de la personne verifiant !==심사직원ID==! */
		     , c.carr_cd              /** Code De Société De Transport !== 운송사코드 ==! */
		     , (SELECT co.co_nm
		          FROM tb_com_co co, tb_com_co_dclr_cd cd
		         WHERE co.nif = cd.nif
		           AND cd.co_dclr_cd = c.carr_cd
		           AND ROWNUM = 1) AS carr_nm /** Code De Société De Transport !== 운송사코드 ==! */
		     , NVL(bl.bl_cnt_ok,0)       AS bl_nrml_gcnt
		     , NVL(bl.bl_cnt_no,0)       AS bl_abnr_gcnt
		     , NVL(cntr.cntr_cnt_ok,0)   AS cntr_nrml_gcnt
		     , NVL(cntr.cntr_cnt_no,0)   AS cntr_abnr_gcnt
		     , (SELECT MAX(stvd_cd) 
		          FROM tb_cari_ldun x, tb_cari_ldun_bl y 
		         WHERE x.mrn = a.mrn
		           AND x.del_Yn = 'N'
		           AND y.del_yn = 'N'
		           AND x.ldun_rqst_no = y.ldun_rqst_no) AS stvd_cd /** Code De Stevedoremanutentionnaire !== 하역업자코드 ==! */
		     , (SELECT CO.CO_NM
		          FROM TB_COM_CO CO, TB_COM_CO_DCLR_CD CD
		         WHERE CO.NIF = CD.NIF
		           AND CD.CO_DCLR_CD = (SELECT MAX(stvd_cd) 
		                                  FROM tb_cari_ldun x, tb_cari_ldun_bl y 
		                                 WHERE x.mrn = a.mrn 
		                                   AND x.del_Yn = 'N' 
		                                   AND y.del_yn = 'N' 
		                                   AND x.ldun_rqst_no = y.ldun_rqst_no)
		           AND ROWNUM = 1) AS STVD_NM
		  FROM tb_cari_ldun_rprt_mdfy a
		  LEFT JOIN tb_cari_ldun_rprt b
		         ON a.mrn = b.mrn
		  LEFT JOIN tb_cari_cag_dcsh c                                      /**CARI_적하목록*/
		         ON a.mrn = c.mrn
		  LEFT OUTER JOIN tb_cari_cag_prcs_brkd brkd
		               ON a.ldun_rprt_mdfy_no = brkd.cag_rqst_no
		              AND brkd.cag_rqst_tp_cd = a.cag_rqst_tp_cd
		  LEFT JOIN ( SELECT tt1.ldun_rprt_mdfy_no
		                   , SUM(CASE WHEN dscr_tp_cd = 'OK' THEN 1 ELSE 0 END) bl_cnt_ok
		                   , SUM(CASE WHEN DSCR_TP_CD != 'OK' THEN 1 ELSE 0 END) bl_cnt_no
		                FROM tb_cari_ldun_rprt_bl_mdfy TT1
		               WHERE del_yn = 'N'
		               GROUP BY  ldun_rprt_mdfy_no ) bl
		         ON a.ldun_rprt_mdfy_no = bl.ldun_rprt_mdfy_no
		  LEFT JOIN ( SELECT tt1.ldun_rprt_mdfy_no
		                   , SUM(CASE WHEN dscr_tp_cd = 'OK' THEN 1 else 0 END) cntr_cnt_ok
		                   , SUM(CASE WHEN dscr_tp_cd != 'OK' THEN 1 else 0 END) cntr_cnt_no
		                FROM tb_cari_ldun_rprt_cntr_mdfy tt1
		               WHERE del_yn = 'N'
		               GROUP BY  ldun_rprt_mdfy_no ) cntr
		         ON a.ldun_rprt_mdfy_no = cntr.ldun_rprt_mdfy_no
		  LEFT JOIN ( SELECT c1.orgn_cd
		                   , c2.orgn_cd AS jrsd_cstm_cd
		                   , c2.orgn_nm AS jrsd_cstm_nm
		                FROM tb_poti_orgn c1
		                LEFT JOIN tb_poti_orgn c2
		                  ON c1.upr_orgn_mgmt_cd = c2.orgn_mgmt_cd
		               WHERE c1.del_yn = 'N'
		       ) cstm
		    ON a.jrsd_orgn_cd = cstm.orgn_cd
		 WHERE 1=1
		   AND a.del_yn = 'N'
		   AND b.del_yn = 'N'
		   AND c.del_yn = 'N'
	</sql>

	<!-- Voir la liste des rectification de rapport de déchargement
	 !== 하역 보고 정정 목록 조회 ==! -->
	<select id="selectCarCagLdunRprtMdfyList" parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtMdfyVo"
												 resultType="alpass.ipt.car.ldun.vo.CarCagLdunRprtMdfyVo">
		/* CarCagLdunRprtMdfyMapper.selectCarCagLdunRprtMdfyList */
		<if test="pagination != null and  pagination == true ">
			<include refid="pagination.header" ></include>
		</if>
		<include refid="selectCarCagLdunRprtMdfyListItem"></include>
		<if test="pbsrNo != null and pbsrNo != ''">
		   AND pb.audt_emp_id = #{pbsrNo} /** ID de la personne vérifiant != 심사직원ID =! */
		</if>
		<if test="trsnDttmFrom != null and trsnDttmFrom != ''">
		   AND a.trsn_dttm <![CDATA[ >= ]]> TO_DATE(#{trsnDttmFrom},'DD/MM/YYYY')
		</if>
		<if test="trsnDttmTo != null and trsnDttmTo != ''">
		   AND a.trsn_dttm <![CDATA[ < ]]> TO_DATE(#{trsnDttmTo},'DD/MM/YYYY')+1
		</if>
		<if test="prcsDttmFrom != null and prcsDttmFrom != ''">
		   AND a.prcs_dttm <![CDATA[ >= ]]> TO_DATE(#{prcsDttmFrom},'DD/MM/YYYY')
		</if>
		<if test="prcsDttmTo != null and prcsDttmTo != ''">
		   AND a.prcs_dttm <![CDATA[ < ]]> TO_DATE(#{prcsDttmTo},'DD/MM/YYYY')+1
		</if>
           AND a.JRSD_ORGN_CD IN (           
            <choose>
                  <when test="jrsdOrgnCd != null and jrsdOrgnCd != ''">
                  SELECT unnest(string_to_array(alpassint.fn_cari_get_orgcd('O', #{jrsdOrgnCd}), ','))
                  </when>
                  <otherwise>
                  SELECT unnest(string_to_array(alpassint.fn_cari_get_orgcd('P', #{frstRegstId}), ','))
                  </otherwise>
              </choose>
            )
		<if test="prcsSttsCd != null and prcsSttsCd != ''">
		   AND pb.prcs_stts_cd= #{ prcsSttsCd }  /** Code de statut de traitement !==처리상태코드==! */
		</if>
		
		<if test="realLdunDtFrom != null and realLdunDtFrom != ''"><!-- 이거확인 STRT -->
		   AND a.real_ldun_end_dt <![CDATA[ >= ]]> TO_DATE(#{realLdunDtFrom},'DD/MM/YYYY')
		</if>
		<if test="realLdunDtTo != null and realLdunDtTo != ''">
		   AND a.real_ldun_end_dt <![CDATA[ < ]]> TO_DATE(#{realLdunDtTo},'DD/MM/YYYY')+1
		</if>
		<if test="mrn != null and mrn != ''">
		   AND UPPER(a.mrn) LIKE UPPER(#{mrn})||'%' /** MRN !== MRN ==! */
		</if>
		<if test="trnpMethNm != null and trnpMethNm != ''">
		   AND UPPER(c.trnp_meth_nm) LIKE '%'||UPPER(#{trnpMethNm})||'%' /** Nom de moyen de transport !== 운송수단명 ==! */
		</if>
		<if test="trnpMethIdfyNo != null and trnpMethIdfyNo != ''">
		   AND UPPER(c.trnp_meth_idfy_no) LIKE '%'||UPPER(#{trnpMethIdfyNo})||'%' /** N° D'Identification Du Moyen De Transport !== 운송수단식별번호 ==! */
		</if>
		<if test="trnpRferNo != null and trnpRferNo != ''">
		   AND UPPER(c.trnp_rfer_no) LIKE UPPER(#{trnpRferNo})||'%' /** N° de voyage/N° de vol/N° d'itinéraire !== 운송참고번호 ==! */
		</if>
		<if test="trnpMeanCd != null and trnpMeanCd != ''">
		   AND c.trnp_mean_cd = #{trnpMeanCd} /** Code de mode de transport !== 운송방법코드 ==! */
		</if>
		<if test="carrNm != null and carrNm != ''">
		   AND UPPER(cc.carr_nm) LIKE UPPER(#{carrNm} || '%')
		</if>
		ORDER BY sort_trsn_dttm desc
		<if test="pagination != null and  pagination == true ">
			<include refid="pagination.footer" ></include>
		</if>
	</select>
	
	<!-- Voir les détails de la rectification de rapport de déchargement
	 !== 하역 보고 정정 조회한다.==! --> 
	<select id="selectCarCagLdunRprtMdfyKeysByMdfyNo" parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtMdfyVo"
														 resultType="alpass.ipt.car.ldun.vo.CarCagLdunRprtMdfyVo">
		/* CarCagLdunRprtMdfyMapper.selectCarCagLdunRprtMdfyKeysByMdfyNo */
		<include refid="selectCarCagLdunRprtMdfyItem"></include>
		   AND a.ldun_rprt_mdfy_no = #{ldunRprtMdfyNo}
		   AND ROWNUM = 1
	</select>

	<!-- (before) Voir les détails de la rectification de rapport de déchargement
	 !== (정정전) 하역 보고 정정 조회한다.==! --> 
	<select id="selectCarCagLdunRprtMdfyBeforeItem" parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtMdfyVo"
													   resultType="alpass.ipt.car.ldun.vo.CarCagLdunRprtMdfyVo">
		/* CarCagLdunRprtMdfyMapper.selectCarCagLdunRprtMdfyBeforeItem */
		SELECT tbl.*
		  FROM (
		      <include refid="selectCarCagLdunRprtMdfyItem"></include>
		   AND a.mrn = #{mrn}
		   AND a.rprt_dgcnt = #{rprtDgcnt}
		   AND a.mdfy_dgcnt <![CDATA[<]]> #{mdfyDgcnt}
		 ORDER BY a.mdfy_dgcnt DESC
		        ) tbl
		WHERE ROWNUM = 1
	</select>
	
    <!--
    Modifier la rectification de Rapport de déchargement (EPT) !== 하역 보고 정정 수정 (EPT) ==!
    (Lee KyoungSung)
    -->
    <update id="updateEptCarCagLdunRprtMdfy"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtMdfyVo">
        /* CarCagLdunRprtMdfyMapper.updateEptCarCagLdunRprtMdfy */
        UPDATE TB_CARE_LDUN_RPRT_MDFY SET
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             <if test="prcsDttm != null and prcsDttm != ''">
             , prcs_dttm = TO_TIMESTAMP( #{prcsDttm}, 'DD/MM/YYYY HH24:MI:SS')  /** Date Et Heure De Traitement !== 처리일시 ==! */
             </if>
             <if test="prcsSttsCd != null and prcsSttsCd != ''">
             , prcs_stts_cd = #{prcsSttsCd}                   /** Code De Statut De Traitement !== 처리상태코드 ==! */
             </if>
           WHERE 1=1
             AND ldun_rprt_mdfy_mgrn = #{ldunRprtMdfyMgrn}
             AND rprt_dgcnt = #{rprtDgcnt}
    </update>
    
    <!-- Modifier la  Rapport de déchargement (CARE) !==하역 보고 수정 한다. (CARE) ==! -->
    <update id="updateCarCagLdunRprtEpt"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRprtVo">
        /* CarCagLdunRprtMdfyMapper.updateCarCagLdunRprtEpt */
        UPDATE ALPASSEXT.TB_CARE_LDUN_RPRT SET
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             <if test="jrsdOrgnCd != null and jrsdOrgnCd != ''">
             , jrsd_orgn_cd = #{jrsdOrgnCd}                   /** Code D'Unité Compétente !== 관할조직코드 ==! */
             </if>
             <if test="realLdunStrtDttm != null and realLdunStrtDttm != ''">
             , real_ldun_strt_dttm = TO_TIMESTAMP(#{realLdunStrtDttm},'DD/MM/YYYY HH24:MI:SS')  /** Date/Heure de début de déchargement effective !== 실제하역시작일시 ==! */
             </if>
             <if test="realLdunEndDttm != null and realLdunEndDttm != ''">
             , real_ldun_end_dttm = TO_TIMESTAMP(#{realLdunEndDttm},'DD/MM/YYYY HH24:MI:SS')  /** Date/Heure de fin de déchargement effective !== 실제하역종료일시 ==! */
             </if>
           WHERE 1=1
             AND LDUN_RPRT_MGMT_NO = #{ldunRprtMgmtNo}
             and RPRT_DGCNT = #{rprtDgcnt}
    </update>
	
</mapper>


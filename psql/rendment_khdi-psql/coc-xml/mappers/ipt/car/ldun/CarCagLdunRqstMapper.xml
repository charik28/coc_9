<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="alpass.ipt.car.ldun.mapper.CarCagLdunRqstMapper">

    <!--
    Demande de déchargement !== 하역신청  ==!
    (Lee KyoungSung)
    -->
    <sql id ="selectItemCarCagLdunRqst">
           SELECT 'false'                                                  AS chk_sel
                , A.ldun_rqst_no                                           AS ldun_rqst_no       /** N° De Demande De Déchargement !== 하역신청번호 ==! */
                , A.ldun_rqst_mgmt_no                                      AS ldun_rqst_mgmt_no  /** N° De Gestion De Demande De Déchargement !== 하역신청관리번호 ==! */
                , B.cag_dcsh_rgsr_mgmt_no                                  AS cag_dcsh_rgsr_mgmt_no/** Numéro de gestion de l'enregistrement de la déclaration de fret !== 화물신고서등록관리번호 ==! */
                , B.mrn                                                    AS mrn                /** Mrn !== MRN ==! */
                , A.trnp_meth_loct_nm                                      AS trnp_meth_loct_nm  /** Emplacement De Moyen De Transport !== 운송수단위치명 ==! */
                , B.trnp_meth_nm                                           AS trnp_meth_nm       /** Nom De Moyen De Transport !== 운송수단명 ==! */
                , B.trnp_meth_idfy_no                                      AS trnp_meth_idfy_no  /** N° D'Identification Du Moyen De Transport !== 운송수단식별번호 ==! */
                , B.trnp_rfer_no                                           AS trnp_rfer_no       /** N° de référence de transport !== 운송참고번호 ==! */
                , B.trnp_mean_cd                                           AS trnp_mean_cd       /** Code de type de transport !==운송방법코드==! */
                , TO_CHAR(B.arvl_dttm,'DD/MM/YYYY HH24:MI:SS')             AS arvl_dttm          /** Date Et Heure D'Arrivée !== 도착일시 ==! */
                , B.al_cntr_gcnt                                           AS al_cntr_gcnt       /** Nombre Total De Conteneurs !== 전체컨테이너개수 ==! */
                , B.al_vhcl_gcnt                                           AS al_vhcl_gcnt       /** Nombre Total De Véhicules !== 전체차량개수 ==! */
                --, BC.BL_CNT                                                AS bl_cnt
                , B.al_bl_gcnt                                             AS bl_cnt
                , NVL(B.ldun_bl_gcnt, 0)                                   AS ldun_bl_gcnt       /** Nombre de BL déchargé !== 양하BL개수 ==! */ 
                , TO_CHAR(A.trsn_dttm,'DD/MM/YYYY HH24:MI:SS')             AS trsn_dttm          /** Date et heure de transmission !== 전송일시 ==! */
                , A.trsn_dttm                                              AS sort_trsn_dttm      /** Date et heure de transmission !== 전송일시 ==! */
                , A.cag_rqst_tp_cd                                         AS cag_rqst_tp_cd     /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
                , A.jrsd_orgn_cd                                           AS jrsd_orgn_cd       /** Code D'Unité Compétente !== 관할조직코드 ==! */
                , FN_GET_ORGN_NM(A.jrsd_orgn_cd)                           AS jrsd_orgn_nm       /** Code D'Unité Compétente !== 관할조직코드 ==! */
                , cstm.jrsd_cstm_cd                                        AS jrsd_cstm_cd        /** Code de bureau compétent !== 관할세관코드 ==! */
                , cstm.jrsd_cstm_nm                                        AS jrsd_cstm_nm        /** Code de bureau compétent !== 관할세관코드 ==! */
                , A.trsn_co_cd                                             AS trsn_co_cd         /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
                , FN_CARI_GET_CO_NM(A.trsn_co_cd)                          AS trsn_co_nm
                , A.carr_cd                                                AS carr_cd            /** Code De Société De Transport !== 운송사코드 ==! */
                , CC.CARR_NM                                               AS carr_nm
                , TO_CHAR(A.real_arvl_dttm,'DD/MM/YYYY HH24:MI:SS')        AS real_arvl_dttm     /** Date Et Heure D'Arrivée Effective !== 실제도착일시 ==! */
                , TO_CHAR(A.ldun_expc_dttm,'DD/MM/YYYY HH24:MI:SS')            AS ldun_expc_dttm   /** Date/Heure de déchargement prévue !== 하역예상일시 ==! */
                , A.APRE_YN_CD                                             AS apre_yn_cd         /** Autorisation O/N !== 승인여부코드 ==! */
                , A.AUDT_OPIN_CN                                           AS audt_opin_cn       /** Contenu De L'Opinion À La Suite De La Vérification !== 심사의견내용 ==! */
                , A.co_rqst_no                                             AS co_rqst_no         /** N° de demande d'entreprise !== 업체신청번호 ==! */
                , TO_CHAR(A.anch_dttm,'DD/MM/YYYY HH24:MI:SS')             AS anch_dttm          /** Date/Heure d'accostage !== 정박일시 ==! */
                , C.audt_emp_id                                            AS audt_emp_id        /** ID de l'insepcteur !== 심사직원ID ==! */
                , C.cag_rqst_no                                            AS cag_rqst_no        /** N° De Demande De Cargaison !== 화물신청번호 ==! */
                , C.prcs_stts_cd                                           AS prcs_stts_cd       /** Code De Statut De Traitement !== 처리상태코드 ==! */
                , TO_CHAR(C.prcs_dttm,'DD/MM/YYYY HH24:MI:SS')             AS prcs_dttm          /** Date Et Heure De Traitement !== 처리일시 ==! */
                , DD.AUDT_EMP_NM                                           AS audt_emp_nm        /** Nom De L'Employé !== 직원명 ==! */
                , DD.orgn_cd                                               AS orgn_cd            /** Code De L'Organisme !== 조직코드 ==! */
                , EE.ORGN_NM                                               AS orgn_nm            /** Nom D'Organisme !== 조직명 ==! */
                , HNOT.bfch_emp_id                                         AS bfch_emp_id        /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
                , HNOT.bfch_emp_nm                                         AS bfch_emp_nm        /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
                , HNOT.afch_emp_id                                         AS afch_emp_id        /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
                , HNOT.afch_emp_nm                                         AS afch_emp_nm        /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
                , HNOT.chg_rsn_cn                                          AS chg_rsn_cn         /** Motif De La Modification !== 변경사유내용 ==! */
             FROM TB_CARI_LDUN A
             LEFT JOIN TB_CARI_CAG_DCSH B                                      /**CARI_적하목록*/
               ON A.mrn = B.mrn
              AND B.del_yn = 'N'                                         /** Suppression ON !== 삭제여부 ==! */
             LEFT JOIN TB_CARI_CAG_PRCS_BRKD C                             /** CARI_화물_처리_내역 */
               ON A.cag_rqst_tp_cd = C.cag_rqst_tp_cd                        /** Code de type de demande de cargaison !==화물신청구분코드==! */
              AND A.ldun_rqst_no = C.cag_rqst_no
              AND C.del_yn = 'N'
             LEFT JOIN ( SELECT A.cag_rqst_no                                            AS cag_rqst_no         /** N° De Demande De Cargaison !== 화물신청번호 ==! */
                              , A.cag_rqst_tp_cd                                         AS cag_rqst_tp_cd      /** Code de classement du suivi du fret !== 화물신청구분코드 ==! */
                              , A.bfch_emp_id                                            AS bfch_emp_id         /** Id De L'Inspecteur Avant La Modification !== 변경전직원ID ==! */
                              , A.afch_emp_id                                            AS afch_emp_id         /** Id De L'Inspecteur Après La Modification !== 변경후직원ID ==! */
                              , A.chg_rsn_cn                                             AS chg_rsn_cn          /** Motif De La Modification !== 변경사유내용 ==! */
                              , e1.EMP_FMNM || ' ' || e1.emp_nm                                                AS bfch_emp_nm              /** Nom De L'Employé !== 직원명 ==! */
                              , e2.EMP_FMNM || ' ' || e2.emp_nm                                                AS afch_emp_nm              /** Nom De L'Employé !== 직원명 ==! */
                           FROM TB_CARI_HNOT_CHG_H A
                          INNER JOIN ( SELECT cag_rqst_no
                                            , MAX(chg_hist_srno) chg_hist_srno
                                         FROM TB_CARI_HNOT_CHG_H
                                        GROUP BY cag_rqst_no
                                ) H
                             ON A.cag_rqst_no = h.cag_rqst_no
                            AND A.chg_hist_srno = h.chg_hist_srno
                           LEFT JOIN TB_POTI_EMP e1
                             ON e1.pbsr_no = A.bfch_emp_id
                           LEFT JOIN TB_POTI_EMP e2
                             ON e2.pbsr_no = A.afch_emp_id
                  ) HNOT
               ON HNOT.cag_rqst_no = c.cag_rqst_no
              AND HNOT.cag_rqst_tp_cd = c.cag_rqst_tp_cd
             /*LEFT JOIN ( SELECT mrn
                              , count(*) BL_CNT
                           FROM TB_CARI_CAG_DCSH_BL
                          where del_yn = 'N'
                          GROUP BY mrn
                  ) BC
               ON A.mrn = BC.mrn*/
             LEFT JOIN ( SELECT T1.co_nm carr_nm
                              , T2.co_dclr_cd
                           FROM TB_COM_CO T1
                              , TB_COM_CO_DCLR_CD T2
                          WHERE T1.nif = T2.nif
                            AND T2.del_yn = 'N'
                  ) CC
               ON A.trsn_co_cd = CC.CO_DCLR_CD
             LEFT JOIN ( SELECT D.pbsr_no                                                AS pbsr_no             /** Matricule Solde !== 공무원번호 ==! */
                              , D.EMP_FMNM || ' ' ||  D.emp_nm                           AS audt_emp_nm         /** Nom De L'Employé !== 직원명 ==! */
                              , E.orgn_cd                                                AS orgn_cd             /** Code De L'Organisme !== 조직코드 ==! */
                              , E.orgn_nm                                                AS orgn_nm             /** Nom D'Organisme !== 조직명 ==! */
                           FROM TB_POTI_EMP D
                           LEFT JOIN TB_POTI_ORGN E                                      /** POTI_조직 */
                             ON D.orgn_mgmt_cd = E.orgn_mgmt_cd
                          WHERE D.del_yn = 'N'
                            AND E.del_yn = 'N'
                  ) DD
               ON C.audt_emp_id  = DD.pbsr_no
             LEFT JOIN TB_POTI_ORGN EE                                      /** POTI_조직 */
               ON A.jrsd_orgn_cd  = EE.orgn_cd
              AND EE.del_yn = 'N'                                        /** Suppression ON !== 삭제여부 ==! */
             LEFT JOIN ( SELECT c1.orgn_cd
                              , c2.orgn_cd AS jrsd_cstm_cd
                              , c2.orgn_nm AS jrsd_cstm_nm
                           FROM tb_poti_orgn c1
                           LEFT JOIN tb_poti_orgn c2
                             ON c1.upr_orgn_mgmt_cd = c2.orgn_mgmt_cd
                          WHERE c1.del_yn = 'N'
                  ) cstm
               ON a.jrsd_orgn_cd = cstm.orgn_cd
            WHERE A.CAG_RQST_TP_CD = #{cagRqstTpCd}
              AND A.del_yn = 'N'                                         /** Suppression ON !== 삭제여부 ==! */
    </sql>

	<sql id ="selectCariLdunCagDcshUnCntrSelect">
           SELECT --B.bl_no                                                  AS bl_no               /** N° De Bl !== BL번호 ==! */
                  (CASE WHEN B.bl_pt_cd = 'M'
                        THEN B.bl_no
                        ELSE B.hbl_no
                    END)                                                   AS bl_no               /** N° De Bl !== BL번호 ==! */
                , B.cag_mgmt_no                                            AS cag_mgmt_no         /** N° Demande De La Création De Crn !== 화물관리번호 ==! */
                , B.cag_chrc_cd                                            AS cag_chrc_cd         /** Nature De Cargaison !== 화물특성코드 ==! */
                , B.bl_tp_cd                                               AS bl_tp_cd            /** Code De Catégorie De B/L !== BL구분코드 ==! */
                , B.bl_pt_cd                                               AS bl_pt_cd            /** Code De Type De Bl !== BL유형코드 ==! */
                , (SELECT T.frwr_cd
                     FROM TB_CARI_CAG_DCSH_BL T
                    WHERE T.mrn = B.mrn
                      AND T.msn = B.msn
                      AND T.bl_pt_cd = 'M')                                AS frwr_cd             /** Groupeur !==포워더==! */
                , (SELECT T1.co_nm
                     FROM tb_com_co T1
                        , tb_com_co_dclr_cd T2
                    WHERE T1.nif = T2.nif
                    AND T1.del_yn = 'N' AND T2.del_yn = 'N'
                      AND T2.co_dclr_cd = (SELECT T.frwr_cd
                                             FROM TB_CARI_CAG_DCSH_BL T
                                            WHERE T.mrn = B.mrn
                                              AND T.msn = B.msn
                                              AND T.bl_pt_cd = 'M'))       AS frwr_nm             /** Nom de groupeur !==포워더명==! */
                , B.pckg_gcnt                                              AS pckg_gcnt           /** Nombre De Colis !== 포장개수 ==! */
                , TRUNC(CASE WHEN B.cag_chrc_cd != '9'
                             THEN B.ttwg /** Poids brut !== 총중량 ==! */
                             ELSE B.lir_vol /** Volume (Litre) !==리터용적==! */
                         END, 2)                                           AS ttwg                /** Poids Brut !== 총중량 ==! */
                , B.vhcl_gcnt                                              AS vhcl_gcnt           /** Nombre De Véhicules !== 차량개수 ==! */
                , D.ibobz_cd                                               AS ibobz_cd            /** Code de zone sous douane !== 보세구역코드 ==! */
                , DD.ibobz_nm                                              AS ibobz_nm
                , B.stvd_cd                                                AS stvd_cd             /** Code De Stevedoremanutentionnaire !== 하역업자코드 ==! */
                , DE.stvd_nm                                               AS stvd_nm
                , DED.DTL_DCSH_NO  /** N° de la déclaration !==신고서번호==! */
                , DED.PRCS_STTS_CD  /** Etat de traitement !==처리상태==! */
<!--                 , D.GRDAST_NM                                              AS GRDAST_NM			  /** Assistant au sol !==조업사명==! */ -->
             FROM TB_CARI_CAG_DCSH A
             JOIN TB_CARI_CAG_DCSH_BL B
               ON A.mrn = B.mrn
              AND A.del_yn = 'N'
              AND B.del_yn = 'N'
             JOIN TB_CARI_LDUN C
               ON A.mrn = C.mrn
              AND C.del_yn = 'N'
             JOIN TB_CARI_LDUN_BL D
               ON C.ldun_rqst_no = D.ldun_rqst_no
              AND B.bl_no = D.bl_no
              AND D.del_yn = 'N'
             LEFT JOIN TB_CARI_IBOBZ DD
               ON DD.ibobz_cd = D.ibobz_cd
              AND DD.del_yn = 'N'
             LEFT JOIN ( SELECT CO.co_nm      stvd_nm
                              , CD.co_dclr_cd stvd_cd
                           FROM TB_COM_CO CO, TB_COM_CO_DCLR_CD CD
                          WHERE CO.nif = CD.nif
                  ) DE
               ON DE.stvd_cd = B.stvd_cd
             LEFT JOIN ( SELECT DISTINCT  A.DTL_DCSH_NO, A.PRCS_STTS_CD, A.CAG_MGMT_NO
					                    FROM ALPASSINT.TB_CLRI_DED_COMN A
					                   INNER JOIN ALPASSINT.TB_CLRI_DED_PRCS_BRKD B
					                      ON A.DTL_DCSH_NO = B.DTL_DCSH_NO
					                     AND B.DEL_YN ='N'
					                   WHERE A.CAG_MGMT_NO IS NOT NULL
					                     AND A.CAG_MGMT_NO != ''
					                     AND A.DEL_YN ='N'
					           ) DED
					       ON B.CAG_MGMT_NO = DED.CAG_MGMT_NO   
            WHERE 1=1
	</sql>
	
	<sql id ="selectCariLdunCagDcshUnCntrWhere">
              AND A.del_yn = 'N'                                         /** Suppression ON !== 삭제여부 ==! */
              AND C.ldun_rqst_no = #{ldunRqstNo}
              AND B.cag_chrc_cd IN ('2','4','5','6','8','9','10','11','12','13','99')    /** Nature de cargaison !==화물특성코드==! */
              AND B.cntr_gcnt = 0
              AND ((B.bl_pt_cd = 'M' AND B.bl_tp_cd = 'S') OR B.bl_pt_cd = 'H')
	</sql>
	
	<sql id ="selectCariLdunCagDcshCntrSelect">
           SELECT B.bl_no                                                  AS bl_no               /** N° De Bl !== BL번호 ==! */
                , B.cag_mgmt_no                                            AS cag_mgmt_no         /** N° Demande De La Création De Crn !== 화물관리번호 ==! */
                , B.bl_pt_cd                                               AS bl_pt_cd            /** Code De Type De Bl !== BL유형코드 ==! */
                , D.ibobz_cd                                               AS ibobz_cd            /** Code de zone sous douane !== 보세구역코드 ==! */
                , DD.ibobz_nm                                              AS ibobz_nm
                , B.stvd_cd                                                AS stvd_cd             /** Code De Stevedoremanutentionnaire !== 하역업자코드 ==! */
                , DE.stvd_nm                                               AS stvd_nm
<!--                 , D.GRDAST_NM                                              AS GRDAST_NM			  /** Assistant au sol !==조업사명==! */ -->
                , E.cntr_no                                                AS cntr_no             /** N° De Conteneur !== 컨테이너번호 ==! */
                , E.cntr_tp_cd                                             AS cntr_tp_cd          /** Code De Type De Conteneur !== 컨테이너구분코드 ==! */
                , E.pckg_gcnt                                              AS pckg_gcnt           /** Nombre De Colis !== 포장개수 ==! */
                , TRUNC(E.ttwg, 2)                                         AS ttwg                /** Poids Brut !== 총중량 ==! */
                , E.pckg_ut_cd                                             AS pckg_ut_cd          /** Code De L'Unité De Colis !== 포장단위코드 ==! */
                , CASE WHEN E.pckg_ut_cd IS NOT NULL
                       THEN E.pckg_gcnt||'['||E.pckg_ut_cd||']'
                       ELSE E.pckg_gcnt||''
                   END                                                     AS pckg_gcnt_ut_cd
                , E.seal_no1                                               AS seal_no1            /** N° De Scellé1 !== 봉인번호1 ==! */
                , E.seal_no2                                               AS seal_no2            /** N° De Scellé2 !== 봉인번호2 ==! */
                , E.seal_no3                                               AS seal_no3            /** N° De Scellé3 !== 봉인번호3 ==! */
                , E.seal_chpn1                                             AS seal_chpn1          /** Responsable de scellé 1 !== 봉인담당자1 ==! */
                , E.seal_chpn2                                             AS seal_chpn2          /** Responsable de scellé 2 !== 봉인담당자2 ==! */
                , E.seal_chpn3                                             AS seal_chpn3          /** Responsable de scellé 3 !== 봉인담당자3 ==! */
                , DED.DTL_DCSH_NO  /** N° de la déclaration !==신고서번호==! */
                , DED.PRCS_STTS_CD  /** Etat de traitement !==처리상태==! */
             FROM TB_CARI_CAG_DCSH A
             JOIN TB_CARI_CAG_DCSH_BL B
               ON A.mrn = B.mrn
              AND A.del_yn = 'N'
              AND B.del_yn = 'N'
              AND B.bl_pt_cd = 'M'
             JOIN TB_CARI_LDUN C
               ON A.mrn = C.mrn
              AND C.del_yn = 'N'
             JOIN TB_CARI_LDUN_BL D
               ON C.ldun_rqst_no = D.ldun_rqst_no
              AND B.bl_no = D.bl_no
              AND D.del_yn = 'N'
             LEFT JOIN TB_CARI_IBOBZ DD
               ON DD.ibobz_cd = D.ibobz_cd
              AND DD.del_yn = 'N'
             LEFT JOIN ( SELECT CO.CO_NM      stvd_nm
                              , CD.CO_DCLR_CD stvd_cd
                           FROM TB_COM_CO CO
                              , TB_COM_CO_DCLR_CD CD
                          WHERE CO.NIF = CD.NIF
                  ) DE
               ON DE.stvd_cd = B.stvd_cd
             JOIN TB_CARI_CAG_DCSH_BL_CNTR E
               ON B.mrn = E.mrn
              AND B.cag_mgmt_no = E.cag_mgmt_no
              LEFT JOIN ( SELECT DISTINCT  A.DTL_DCSH_NO, A.PRCS_STTS_CD, A.CAG_MGMT_NO
					                    FROM ALPASSINT.TB_CLRI_DED_COMN A
					                   INNER JOIN ALPASSINT.TB_CLRI_DED_PRCS_BRKD B
					                      ON A.DTL_DCSH_NO = B.DTL_DCSH_NO
					                     AND B.DEL_YN ='N'
					                   WHERE A.CAG_MGMT_NO IS NOT NULL
					                     AND A.CAG_MGMT_NO != ''
					                     AND A.DEL_YN ='N'
					           ) DED
					       ON B.CAG_MGMT_NO = DED.CAG_MGMT_NO  
              WHERE 1=1
	</sql>
	
	<sql id ="selectCariLdunCagDcshCntrWhere">
                AND A.del_yn = 'N'                                         /** Suppression ON !== 삭제여부 ==! */
                AND C.ldun_rqst_no = #{ldunRqstNo}
	</sql>

    <!--
    Voir les détails de la Demande de déchargement !== 하역신청 단건 조회 ==!
    (Lee KyoungSung)
    -->
    <select id="selectCarCagLdunRqstItem"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo"
            resultType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo">
        /* CarCagLdunRqst.selectCarCagLdunRqstItem */
        <include refid="selectItemCarCagLdunRqst" ></include>
             <if test="ldunRqstNo != null and ldunRqstNo != ''">
              AND  A.ldun_rqst_no = #{ldunRqstNo}  /** N° De Demande De Déchargement !== 하역신청번호 ==! */
             </if>
             <if test="mrn != null and mrn != ''">
              AND B.MRN = #{mrn} /** MRN !== MRN ==! */
             </if>
    </select>


    <!--
    Voir la liste des Demande de déchargement !== 하역신청 목록 조회 ==!
    (Lee KyoungSung)
    -->
    <select id="selectCarCagLdunRqstList"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo"
            resultType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo">
        /* CarCagLdunRqst.selectCarCagLdunRqstList */
        <if test="pagination != null and  pagination == true ">
        <include refid="pagination.header" ></include>
        </if>
        <include refid="selectItemCarCagLdunRqst" ></include>
            <if test="ldunRqstNo != null and ldunRqstNo != ''">
            AND A.ldun_rqst_no = #{ldunRqstNo}  /** N° De Demande De Déchargement !== 하역신청번호 ==! */
            </if>
            <if test="trsnDttmFrom != null and trsnDttmFrom != ''">
            AND A.trsn_dttm <![CDATA[ >= ]]> TO_DATE(#{trsnDttmFrom},'DD/MM/YYYY')
            </if>
            <if test="trsnDttmTo != null and trsnDttmTo != ''">
            AND A.trsn_dttm <![CDATA[ < ]]> TO_DATE(#{trsnDttmTo},'DD/MM/YYYY')+1
            </if>
            <if test="mrn != null and mrn != ''">
            AND UPPER(b.mrn) LIKE UPPER(#{mrn})||'%' /** MRN !== MRN ==! */
            </if>
            <if test="carrNm != null and carrNm != ''">
            AND UPPER(cc.carr_nm) LIKE UPPER(#{carrNm})||'%' /** Code de société de transport !== 운송사코드 ==! */
            </if>
            <if test="trnpMethNm != null and trnpMethNm != ''">
            AND UPPER(b.trnp_meth_nm) LIKE UPPER(#{trnpMethNm})||'%' /** Nom de moyen de transport !== 운송수단명 ==! */
            </if>
            <if test="trnpRferNo != null and trnpRferNo != ''">
            AND UPPER(b.trnp_rfer_no) LIKE UPPER(#{trnpRferNo})||'%' /** N° de voyage/N° de vol/N° d'itinéraire !== 운송참고번호 ==! */
            </if>
            <if test="trnpMethIdfyNo != null and trnpMethIdfyNo != ''">
            AND UPPER(b.trnp_meth_idfy_no) LIKE '%'||UPPER(#{trnpMethIdfyNo})||'%' /** N° D'Identification Du Moyen De Transport !== 운송수단식별번호 ==! */
            </if>
            <if test="trnpMeanCd != null and trnpMeanCd != ''">
            AND B.TRNP_MEAN_CD = #{trnpMeanCd} /** Code de mode de transport !== 운송방법코드 ==! */
            </if>
            <choose>
                <when test="arrPrcsSttsCd != null and arrPrcsSttsCd.size != 0">/** Code de statut de traitement !== 처리상태코드 ==! */
            AND C.PRCS_STTS_CD IN
                    <foreach collection="arrPrcsSttsCd" item="item" index="index" separator="," open="(" close=")">
                #{item}
                    </foreach>
                </when>
            </choose>
            <if test="audtEmpId != null and audtEmpId != ''">
                AND C.AUDT_EMP_ID = #{audtEmpId} /** ID de la personne vérifiant != 심사직원ID =! */
            </if>
            AND c.JRSD_ORGN_CD IN (           
            <choose>
                  <when test="jrsdOrgnCd != null and jrsdOrgnCd != ''">
                  SELECT unnest(string_to_array(alpassint.fn_cari_get_orgcd('O', #{jrsdOrgnCd}), ','))
                  </when>
                  <otherwise>
                  SELECT unnest(string_to_array(alpassint.fn_cari_get_orgcd('P', #{frstRegstId}), ','))
                  </otherwise>
              </choose>
            )
            <if test="prcsDttmFrom != null and prcsDttmFrom != ''">
            AND C.PRCS_DTTM <![CDATA[ >= ]]> TO_DATE(#{prcsDttmFrom},'DD/MM/YYYY')
            </if>
            <if test="prcsDttmTo != null and prcsDttmTo != ''">
            AND C.PRCS_DTTM <![CDATA[ < ]]> TO_DATE(#{prcsDttmTo},'DD/MM/YYYY')+1
            </if>
         ORDER BY sort_trsn_dttm DESC                                           /** Date et heure de traitement !== 처리일시 ==! */
        <if test="pagination != null and  pagination == true ">
        <include refid="pagination.footer" ></include>
        </if>
    </select>

    <!-- Voir les détails de la Demande de déchargement !==하역신청 조회한다.==! -->
    <select id="selectCariLdunCagDcsh"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo"
            resultType="alpass.ipt.car.com.vo.CarCagDcshVo">
           /* CarCagLdunRqst.selectCariLdunCagDcsh */
           SELECT B.mrn                                                    AS mrn                 /** Mrn !== MRN ==! */
                , B.trnp_meth_nm                                           AS trnp_meth_nm        /** Nom De Moyen De Transport !== 운송수단명 ==! */
                , B.trnp_meth_idfy_no                                      AS trnp_meth_idfy_no   /** N° D'Identification Du Moyen De Transport !== 운송수단식별번호 ==! */
                , B.trnp_rfer_no                                           AS trnp_rfer_no        /** N° de référence de transport !== 운송참고번호 ==! */
                , B.trnp_mean_cd                                           AS trnp_mean_cd        /** Code de type de transport !==운송방법코드==! */
                , TO_CHAR(TO_DATE(B.trnp_meth_rgsr_dt),'DD/MM/YYYY')       AS trnp_meth_rgsr_dt   /** Date D'Enregistrement De Moyen De Transport !== 운송수단등록일자 ==! */
                , TO_CHAR(B.dptr_dttm,'DD/MM/YYYY HH24:MI:SS')             AS dptr_dttm           /** Date Et Heure De Départ !== 출발일시 ==! */
                , TO_CHAR(B.arvl_dttm,'DD/MM/YYYY HH24:MI:SS')             AS arvl_dttm           /** Date Et Heure D'Arrivée !== 도착일시 ==! */
                , CASE WHEN B.last_ldun_dt != NULL
                       THEN TO_CHAR(TO_DATE(B.last_ldun_dt),'DD/MM/YYYY')
                       ELSE ''
                  END AS last_ldun_dt        /** Date De Déchargement Définitif !== 최종하역일자 ==! */
                , B.dptr_port_cd                                           AS dptr_port_cd        /** Code De Port De Départ !== 출발항구코드 ==! */
                , FN_CARI_GET_PORT_AIRPT_CITY_CD_NM(B.dptr_port_cd,#{langCd})   AS dptr_port_nm
                , B.ldun_port_cd                                           AS ldun_port_cd        /** Code De Port De Déchargement !== 하역항구코드 ==! */
                , FN_CARI_GET_PORT_AIRPT_CITY_CD_NM(B.ldun_port_cd,#{langCd})   AS ldun_port_nm
                , B.last_thrg_port_cd                                      AS last_thrg_port_cd   /** Code Du Dernier Port D'Escale !== 최종경유항구코드 ==! */
                , FN_CARI_GET_PORT_AIRPT_CITY_CD_NM(B.last_thrg_port_cd,#{langCd})   AS last_thrg_port_nm
                , A.trnp_meth_loct_nm                                      AS trnp_meth_loct_nm   /** Emplacement De Moyen De Transport !== 운송수단위치명 ==! */
                , B.trsn_co_cd                                             AS trsn_co_cd       /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
                , FN_CARI_GET_CO_NM(B.trsn_co_cd)                          AS trsn_co_nm
                , B.trsn_co_cd || ' | ' || FN_CARI_GET_CO_NM(B.trsn_co_cd) AS trsn_co_cd_nm
                , B.carr_cd                                                AS carr_cd             /** Code De Société De Transport !== 운송사코드 ==! */
                , CC.CARR_NM                                               AS carr_nm
                , B.trnp_meth_nat_cd                                       AS trnp_meth_nat_cd    /** Code de nationalité du moyen de transport !== 운송수단국적코드 ==! */
                , FN_GET_CNTY_NM(B.trnp_meth_nat_cd, #{langCd})            AS trnp_meth_nat_nm
                , B.carr_addr_nm                                           AS carr_addr_nm        /** Adresse De Société De Transport !== 운송사주소명 ==! */
                , B.ship_ttn                                               AS ship_ttn            /** Tonnage Brut Du Navire !== 선박총톤수 ==! */
                , B.ship_nttn                                              AS ship_nttn           /** Tonnage Net Du Navire !== 선박순톤수 ==! */
                , B.al_bl_gcnt                                             AS al_bl_gcnt          /** Nombre Total De Bl !== 전체BL개수 ==! */
                , B.al_cntr_gcnt                                           AS al_cntr_gcnt        /** Nombre Total De Conteneurs !== 전체컨테이너개수 ==! */
                , B.al_vhcl_gcnt                                           AS al_vhcl_gcnt        /** Nombre Total De Véhicules !== 전체차량개수 ==! */
                , NVL(B.ldun_bl_gcnt, 0) 								   AS ldun_bl_gcnt		  /** Nombre de BL déchargé !== 양하BL개수 ==! */
             FROM TB_CARI_LDUN A    /**CARI_하역*/
             LEFT JOIN  TB_CARI_CAG_DCSH B            /** CARI_적하목록 */
               ON A.MRN = B.MRN
              and B.del_yn ='N'
             LEFT JOIN ( SELECT T1.co_nm carr_nm
                              , T2.co_dclr_cd
                           FROM TB_COM_CO T1
                              , TB_COM_CO_DCLR_CD T2
                          WHERE T1.nif = T2.nif
                            AND T2.del_yn = 'N'
                  ) CC
               ON A.carr_cd = CC.CO_DCLR_CD
            WHERE A.del_yn = 'N'
              AND A.ldun_rqst_no = #{ldunRqstNo}
    </select>

    <!-- Marchandises TC !== 컨테이너에 실린 화물 ==! -->
    <select id="selectCariLdunCagDcshCntrTotCnt"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo"
            resultType="integer">
           /* CarCagLdunRqst.selectCariLdunCagDcshCntrTotCnt */
        SELECT COUNT(*) AS TOT_CNT
          FROM (
        <include refid="selectCariLdunCagDcshCntrSelect" ></include>
        <include refid="selectCariLdunCagDcshCntrWhere" ></include>
               ) SQLRSLT
    </select>

    <!-- Marchandises TC !== 컨테이너에 실린 화물 ==! -->
    <select id="selectCariLdunCagDcshCntr"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo"
            resultType="alpass.ipt.car.com.vo.CarCagDcshBlCntrVo">
           /* CarCagLdunRqst.selectCariLdunCagDcshCntr */
        <if test="pagination != null and  pagination == true ">
        SELECT #{totCnt} AS TOT_CNT
             , SQLRSLT.*
             , ROWNUM as RNUM
          FROM (
        </if>
        <include refid="selectCariLdunCagDcshCntrSelect" ></include>
        <include refid="selectCariLdunCagDcshCntrWhere" ></include>
              ORDER BY B.bl_no                     /** N° de B/L !== BL번호 ==! */
                  , E.cntr_no                   /** N° de conteneur !==컨테이너번호==! */
        <if test="pagination != null and  pagination == true ">
        <include refid="pagination.footer" ></include>
        </if>
    </select>

    <!-- Marchandises non TC !== 컨테이너에 안실린 화물 ==! -->
    <select id="selectCariLdunCagDcshUnCntrTotCnt"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo"
            resultType="integer">
           /* CarCagLdunRqst.selectCariLdunCagDcshUnCntrTotCnt */
        SELECT COUNT(*) AS TOT_CNT
          FROM (
        <include refid="selectCariLdunCagDcshUnCntrSelect" ></include>
        <include refid="selectCariLdunCagDcshUnCntrWhere" ></include>
               ) SQLRSLT
    </select>
    
    <select id="selectCariLdunCagDcshUnCntr"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo"
            resultType="alpass.ipt.car.com.vo.CarCagDcshBlVo">
           /* CarCagLdunRqst.selectCariLdunCagDcshUnCntr */
        <if test="pagination != null and  pagination == true ">
        SELECT #{totCnt} AS TOT_CNT
             , SQLRSLT.*
             , ROWNUM as RNUM
          FROM (
        </if>
        <include refid="selectCariLdunCagDcshUnCntrSelect" ></include>
        <include refid="selectCariLdunCagDcshUnCntrWhere" ></include>
            ORDER BY B.bl_no
        <if test="pagination != null and  pagination == true ">
        <include refid="pagination.footer" ></include>
        </if>
    </select>

    <!--
    Modifier la  Demande de déchargement (CARI) !== 하역신청 수정 (CARI) ==!
    (Lee KyoungSung)
    -->
    <update id="updateCarCagLdunRqst"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo">
        /* CarCagLdunRqstMapper.updateCarCagLdunRqst */
        UPDATE TB_CARI_LDUN SET
               del_yn = 'N'                                  /** Suppression ON !== 삭제여부 ==! */
             , last_chpr_id = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
             , last_chg_dttm = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
             <if test="apreYnCd != null and apreYnCd != ''">
             , APRE_YN_CD = #{apreYnCd}                       /** Autorisation O/N !== 승인여부코드 ==! */
             </if>
             <if test="audtOpinCn != null and audtOpinCn != ''">
             , AUDT_OPIN_CN = #{audtOpinCn}                   /** Contenu De L'Opinion À La Suite De La Vérification !== 심사의견내용 ==! */
             </if>
             <if test="jrsdOrgnCd != null and jrsdOrgnCd != ''">
             , JRSD_ORGN_CD = #{jrsdOrgnCd}                   /** Code D'Unité Compétente !== 관할조직코드 ==! */
             </if>
             <if test="realArvlDttm != null and realArvlDttm != ''">
             , real_arvl_dttm = TO_TIMESTAMP( #{realArvlDttm} , 'DD/MM/YYYY HH24:MI:SS')  /** Date Et Heure D'Arrivée Effective !== 실제도착일시 ==! */
             </if>
             <if test="ldunExpcDttm != null and ldunExpcDttm != ''">
             , ldun_expc_dttm = TO_TIMESTAMP(#{ldunExpcDttm},'DD/MM/YYYY HH24:MI:SS')  /** Date/Heure de déchargement prévue !== 하역예상일시 ==! */
             </if>
             <if test="anchDttm != null and anchDttm != ''">
             , anch_dttm = TO_TIMESTAMP( #{anchDttm} , 'DD/MM/YYYY HH24:MI:SS')  /** Date/Heure d'accostage !== 정박일시 ==! */
             </if>
           WHERE 1=1
             AND  ldun_rqst_no = #{ldunRqstNo}  /** N° De Demande De Déchargement !== 하역신청번호 ==! */
    </update>

    <!-- Modifier la  Demande de déchargement (CARE) !== 하역신청 수정 (CARE) ==! -->
    <update id="updateCareCagLdunRqst"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo" >
		/* CarCagLdunRqstMapper.updateCareCagLdunRqst */
        UPDATE TB_CARE_LDUN
           SET LAST_CHPR_ID = #{lastChprId}          /** Identifiant du modificateur final !== 최종변경자ID ==! */
             , LAST_CHG_DTTM = SYSTIMESTAMP          /** Date et heure de modification finale !== 최종변경일시 ==! */
             <if test="prcsDttm != null and prcsDttm != ''">
             , PRCS_DTTM = TO_DATE(#{prcsDttm},'DD/MM/YYYY HH24:MI:SS')                /** Date et heure de traitement !== 처리일시 ==! */
             </if>
             <if test="prcsSttsCd != null and prcsSttsCd != ''">
             , PRCS_STTS_CD = #{prcsSttsCd}          /** Code de statut de traitement !== 처리상태코드 ==! */
             </if>
             <if test="apreYnCd != null and apreYnCd != ''">
             , APRE_YN_CD = #{apreYnCd}                       /** Autorisation O/N !== 승인여부코드 ==! */
             </if>
             <if test="audtOpinCn != null and audtOpinCn != ''">
             , AUDT_OPIN_CN = #{audtOpinCn}              /** Contenu De L'Opinion À La Suite De La Vérification !== 심사의견내용 ==! */
             </if>
             <if test="jrsdOrgnCd != null and jrsdOrgnCd != ''">
             , JRSD_ORGN_CD = #{jrsdOrgnCd}                   /** Code D'Unité Compétente !== 관할조직코드 ==! */
             </if>
             <if test="realArvlDttm != null and realArvlDttm != ''">
             , real_arvl_dttm = TO_TIMESTAMP( #{realArvlDttm} , 'DD/MM/YYYY HH24:MI:SS')  /** Date Et Heure D'Arrivée Effective !== 실제도착일시 ==! */
             </if>
             <if test="ldunExpcDttm != null and ldunExpcDttm != ''">
             , ldun_expc_dttm = TO_TIMESTAMP(#{ldunExpcDttm},'DD/MM/YYYY HH24:MI:SS')  /** Date/Heure de déchargement prévue !== 하역예상일시 ==! */
             </if>
             <if test="anchDttm != null and anchDttm != ''">
             , anch_dttm = TO_TIMESTAMP( #{anchDttm} , 'DD/MM/YYYY HH24:MI:SS')  /** Date/Heure d'accostage !== 정박일시 ==! */
             </if>
         WHERE ldun_rqst_no = #{ldunRqstNo}
	</update>

    <!-- N° De Gestion De Demande De Déchargement !== 하역신청관리번호 ==! -->
    <select id="selectLdunRqstMgmtNo"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo"
            resultType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo">
        /* CarCagLdunRqstMapper.selectLdunRqstMgmtNo */
        SELECT LDUN_RQST_MGMT_NO
        FROM ALPASSEXT.TB_CARE_LDUN
        WHERE ldun_rqst_no = #{ldunRqstNo} LIMIT 1
    </select>

    <!-- N° De Demande De Déchargement !== 하역신청번호 ==! -->
    <select id="selectLdunRqstNo"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo"
            resultType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo">
        /* CarCagLdunRqstMapper.selectLdunRqstNo */
        SELECT LDUN_RQST_NO
        FROM ALPASSEXT.TB_CARE_LDUN
        WHERE LDUN_RQST_MGMT_NO = #{ldunRqstMgmtNo} LIMIT 1
    </select>

    <!-- Enregistrement de la rectification de demande de déchargement !==하역 신청 정정 등록 한다.==! -->
    <insert id="insertLdunRqstMdfyAsNew"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo">
        /* CarCagLdunRqstMapper.insertLdunRqstMdfyAsNew */
        INSERT INTO ALPASSEXT.tb_care_ldun_mdfy
        ( ldun_rqst_mdfy_mgrn                         /** N° De Gestion De Demande De Déchargement !== 하역신청정정관리번호 ==! */
        , ldun_rqst_no                                /** N° De Demande De Déchargement !== 하역신청번호 ==! */
        , ldun_rqst_mdfy_no                           /** !== 하역신청정정번호 ==! */
        , mrn                                         /** Mrn !== MRN ==! */
        , mdfy_dgcnt                                  /** Fréquence de rectification !== 정정차수 ==! */
        , trsn_dttm                                   /** Date et heure de transmission !== 전송일시 ==! */
        , cag_rqst_tp_cd                              /** Code de type de demande fret !== 화물신청구분코드 ==! */
        , jrsd_orgn_cd                                /** Code D'Unité Compétente !== 관할조직코드 ==! */
        , trsn_co_cd                                  /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
        , carr_cd                                     /** Code De Société De Transport !== 운송사코드 ==! */
        , real_arvl_dttm                              /** Date Et Heure D'Arrivée Effective !== 실제도착일시 ==! */
        , ldun_expc_dttm                              /** Date/Heure de déchargement prévue !== 하역예상일시 ==! */
        , prcs_dttm                                   /** Date Et Heure De Traitement !== 처리일시 ==! */
        , prcs_stts_cd                                /** Code De Statut De Traitement !== 처리상태코드 ==! */
        , infm_cn                                     /** Contenu De Notification !== 통보내용 ==! */
        , co_rqst_no                                  /** N° de demande d'entreprise !== 업체신청번호 ==! */
        , anch_dttm                                   /** Date/Heure d'accostage !== 정박일시 ==! */
        , trnp_meth_loct_nm                           /** Emplacement De Moyen De Transport !== 운송수단위치명 ==! */
        , del_yn                                      /** Suppression On !== 삭제여부 ==! */
        , frst_regst_id                               /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
        , frst_rgsr_dttm                              /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
        , last_chpr_id                                /** Id Du Modificateur Final !== 최종변경자ID ==! */
        , last_chg_dttm                               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        )
        SELECT #{ldunRqstMdfyMgrn}                    /** N° De Gestion De Demande De Déchargement !== 하역신청정정관리번호 ==! */
             , #{ldunRqstNo}                          /** N° De Demande De Déchargement !== 하역신청번호 ==! */
             , #{ldunRqstMdfyNo}                      /**  !== 하역신청정정번호 ==! */
             , A.mrn                                  /** Mrn !== MRN ==! */
             , (SELECT NVL(MAX(MDFY_DGCNT), -1) + 1
                FROM ALPASSEXT.tb_carE_ldun_mdfy
                WHERE ldun_rqst_no = #{ldunRqstNo})   /** Fréquence de rectification !== 정정차수 ==! */
             , A.trsn_dttm                            /** Date et heure de transmission !== 전송일시 ==! */
             , #{cagRqstTpCd}                         /** Code de type de demande fret !== 화물신청구분코드 ==! */
             , A.jrsd_orgn_cd                         /** Code D'Unité Compétente !== 관할조직코드 ==! */
             , A.trsn_co_cd                           /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
             , A.carr_cd                              /** Code De Société De Transport !== 업체신청번호 ==! */
             , A.real_arvl_dttm                       /** Date Et Heure D'Arrivée Effective !== 실제도착일시 ==! */
             , A.ldun_expc_dttm                       /** Date/Heure de déchargement prévue !== 하역예상일시 ==! */
             , A.prcs_dttm                            /** Date Et Heure De Traitement !== 처리일시 ==! */
             , #{prcsSttsCd}                          /** Code De Statut De Traitement !== 처리상태코드 ==! */
             , ''                                     /** Contenu De Notification !== 통보내용 ==! */
             , A.co_rqst_no                           /** N° de demande d'entreprise !== 업체신청번호 ==! */
             , A.anch_dttm                            /** Date/Heure d'accostage !== 정박일시 ==! */
             , A.trnp_meth_loct_nm                    /** Emplacement De Moyen De Transport !== 운송수단위치명 ==! */
             , 'N'                                    /** Suppression On !== 삭제여부 ==! */
             , A.frst_regst_id                        /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , SYSTIMESTAMP                           /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , A.last_chpr_id                         /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , SYSTIMESTAMP                           /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        FROM ALPASSEXT.tb_care_ldun A
        WHERE A.del_yn = 'N'                          /** Suppression ON !== 삭제여부 ==! */
          AND A.ldun_rqst_no = #{ldunRqstNo}
    </insert>

    <!-- Voir les détails de la rectification de demande de déchargement !==하역 신청 정정 조회한다.==! -->
    <select id="selectCareLdunRqstMdfy"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo"
            resultType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo">
        /* CarCagLdunRqstMapper.selectCareLdunRqstMdfy */
        SELECT LDUN.ldun_rqst_mgmt_no                                AS ldun_rqst_mgmt_no/** N° De Gestion De Demande De Déchargement !== 하역신청관리번호 ==! */
             , LDUN.ldun_rqst_no                                     AS ldun_rqst_no/** N° De Demande De Déchargement !== 하역신청번호 ==! */
             , MDFY.ldun_rqst_mdfy_mgrn                              AS ldun_rqst_mdfy_mgrn/** N° De Gestion De Demande De Déchargement !== 하역신청정정관리번호 ==! */
             , MDFY.ldun_rqst_mdfy_no                                AS ldun_rqst_mdfy_no/**  !== 하역신청정정번호 ==! */
             , MDFY.mrn                                              AS mrn /** Mrn !== MRN ==! */
             , MDFY.mdfy_dgcnt                                       AS mdfy_dgcnt /** Fréquence de rectification !== 정정차수 ==! */
             , MDFY.trsn_dttm                                        AS trsn_dttm /** Date et heure de transmission !== 전송일시 ==! */
             , MDFY.cag_rqst_tp_cd                                   AS cag_rqst_tp_cd /** Code de type de demande fret !== 화물신청구분코드 ==! */
             , MDFY.jrsd_orgn_cd                                     AS jrsd_orgn_cd /** Code D'Unité Compétente !== 관할조직코드 ==! */
             , MDFY.trsn_co_cd                                       AS trsn_co_cd /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
             , MDFY.carr_cd                                          AS carr_cd /** Code De Société De Transport !== 운송사코드 ==! */
             , MDFY.real_arvl_dttm                                   AS real_arvl_dttm /** Date Et Heure D'Arrivée Effective !== 실제도착일시 ==! */
             , MDFY.ldun_expc_dttm                                     AS ldun_expc_dttm /** Date/Heure de déchargement prévue !== 하역예상일시 ==! */
             , MDFY.prcs_dttm                                        AS prcs_dttm /** Date Et Heure De Traitement !== 처리일시 ==! */
             , MDFY.prcs_stts_cd                                     AS prcs_stts_cd /** Code De Statut De Traitement !== 처리상태코드 ==! */
             , MDFY.infm_cn                                          AS infm_cn /** Contenu De Notification !== 통보내용 ==! */
             , MDFY.co_rqst_no                                       AS co_rqst_no /** N° de demande d'entreprise !== 업체신청번호 ==! */
             , MDFY.anch_dttm                                        AS anch_dttm /** Date/Heure d'accostage !== 정박일시 ==! */
             , MDFY.del_yn                                           AS del_yn /** Suppression On !== 삭제여부 ==! */
             , MDFY.frst_regst_id                                    AS frst_regst_id /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , TO_CHAR(MDFY.frst_rgsr_dttm, 'DD/MM/YYYY HH24:MI:SS') AS frst_rgsr_dttm /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , MDFY.last_chpr_id                                     AS last_chpr_id /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , TO_CHAR(MDFY.last_chg_dttm, 'DD/MM/YYYY HH24:MI:SS')  AS last_chg_dttm /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
             , MDFY.trnp_meth_loct_nm                                AS trnp_meth_loct_nm /** Emplacement De Moyen De Transport !== 운송수단위치명 ==! */
        FROM ALPASSEXT.tb_care_ldun_mdfy MDFY
             INNER JOIN ALPASSEXT.tb_care_ldun LDUN
                ON MDFY.ldun_rqst_no = LDUN.ldun_rqst_no
        WHERE MDFY.del_yn = 'N'                                      /** Suppression ON !== 삭제여부 ==! */
          AND LDUN.del_yn = 'N'                                      /** Suppression ON !== 삭제여부 ==! */
          AND MDFY.ldun_rqst_mdfy_mgrn = #{ldunRqstMdfyMgrn}
    </select>

    <!-- Supprimer la rectification de demande de déchargement !==하역 신청 정정 삭제 한다.==! -->
    <delete id="deleteCariLdunRqstMdfy"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo">
        /* CarCagLdunRqstMapper.deleteCariLdunRqstMdfy */
        DELETE
        FROM TB_CARI_LDUN_MDFY A
        WHERE A.ldun_rqst_mdfy_no = #{ldunRqstMdfyNo}
    </delete>

    <!-- Enregistrement de la rectification de demande de déchargement !==하역 신청 정정 등록 한다.==! -->
    <insert id="insertCariLdunRqstMdfy"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo">
        /* CarCagLdunRqstMapper.insertCariLdunRqstMdfy */
        INSERT INTO TB_CARI_LDUN_MDFY
             ( ldun_rqst_mdfy_no             /**  !== 하역신청정정번호 ==! */
             , ldun_rqst_mdfy_mgrn           /** N° De Gestion De Demande De Déchargement !== 하역신청정정관리번호 ==! */
             , ldun_rqst_no                  /** N° De Demande De Déchargement !== 하역신청번호 ==! */
             , mdfy_dgcnt                    /** Fréquence de rectification !== 정정차수 ==! */
             , mrn                           /** Mrn !== MRN ==! */
             , trsn_dttm                     /** Date et heure de transmission !== 전송일시 ==! */
             , cag_rqst_tp_cd                /** Code de type de demande fret !== 화물신청구분코드 ==! */
             , jrsd_orgn_cd                  /** Code D'Unité Compétente !== 관할조직코드 ==! */
             , trsn_co_cd                    /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
             , carr_cd                       /** Code De Société De Transport !== 운송사코드 ==! */
             , real_arvl_dttm                /** Date Et Heure D'Arrivée Effective !== 실제도착일시 ==! */
             , ldun_expc_dttm                /** Date/Heure de déchargement prévue !== 하역예상일시 ==! */
             , apre_yn_cd                    /** Autorisation O/N !== 승인여부코드 ==! */
             , audt_opin_cn                  /** Contenu De L'Opinion À La Suite De La Vérification !== 심사의견내용 ==! */
             , co_rqst_no                    /** N° de demande d'entreprise !== 업체신청번호 ==! */
             , anch_dttm                     /** Date/Heure d'accostage !== 정박일시 ==! */
             , del_yn                        /** Suppression On !== 삭제여부 ==! */
             , frst_regst_id                 /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , frst_rgsr_dttm                /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , last_chpr_id                  /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , last_chg_dttm                 /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
             , trnp_meth_loct_nm             /** Emplacement De Moyen De Transport !== 운송수단위치명 ==! */
             )
        SELECT #{ldunRqstMdfyNo}             /**  !== 하역신청정정번호 ==! */
             , A.ldun_rqst_mdfy_mgrn         /** N° De Gestion De Demande De Déchargement !== 하역신청정정관리번호 ==! */
             , A.ldun_rqst_no                /** N° De Demande De Déchargement !== 하역신청번호 ==! */
             , A.mdfy_dgcnt                  /** Fréquence de rectification !== 정정차수 ==! */
             , A.mrn                         /** Mrn !== MRN ==! */
             , A.trsn_dttm                   /** Date et heure de transmission !== 전송일시 ==! */
             , A.cag_rqst_tp_cd              /** Code de type de demande fret !== 화물신청구분코드 ==! */
             , A.jrsd_orgn_cd                /** Code D'Unité Compétente !== 관할조직코드 ==! */
             , A.trsn_co_cd                  /** Code d'entreprise transmettrice !== 전송업체코드 ==! */
             , A.carr_cd                     /** Code De Société De Transport !== 운송사코드 ==! */
             , A.real_arvl_dttm              /** Date Et Heure D'Arrivée Effective !== 실제도착일시 ==! */
             , A.ldun_expc_dttm              /** Date/Heure de déchargement prévue !== 하역예상일시 ==! */
             , ''                            /** Autorisation O/N !== 승인여부코드 ==! */
             , ''                            /** Contenu De L'Opinion À La Suite De La Vérification !== 심사의견내용 ==! */
             , A.co_rqst_no                  /** N° de demande d'entreprise !== 업체신청번호 ==! */
             , A.anch_dttm                   /** Date/Heure d'accostage !== 정박일시 ==! */
             , A.del_yn                      /** Suppression On !== 삭제여부 ==! */
             , A.frst_regst_id               /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , A.frst_rgsr_dttm              /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , A.last_chpr_id                /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , A.last_chg_dttm               /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
             , A.trnp_meth_loct_nm           /** Emplacement De Moyen De Transport !== 운송수단위치명 ==! */
          FROM ALPASSEXT.TB_CARE_LDUN_MDFY A
         WHERE A.del_yn = 'N' /** Suppression ON !== 삭제여부 ==! */
           AND A.ldun_rqst_mdfy_mgrn = #{ldunRqstMdfyMgrn}
    </insert>

    <!-- Supprimer la rectification de demande de déchargement (BL) !==하역 신청 정정 BL 삭제 한다.==! -->
    <delete id="deleteCariLdunRqstMdfyBl"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo">
        /* CarCagLdunRqstMapper.deleteCariLdunRqstMdfyBl */
        DELETE
               TB_CARI_LDUN_BL_MDFY A
         WHERE 1=1
           AND A.ldun_rqst_mdfy_no = #{ldunRqstMdfyNo} /**  !== 하역신청정정번호 ==! */
    </delete>

    <!-- Enregistrement de la rectification de demande de déchargement (BL) !==하역 신청 정정 BL 등록 한다.==! -->
    <insert id="insertCariLdunRqstMdfyBl"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstVo">
        /* CarCagLdunRqstMapper.insertCariLdunRqstMdfyBl */
        INSERT INTO TB_CARI_LDUN_BL_MDFY
             ( ldun_rqst_mdfy_no                 /**  !== 하역신청정정번호 ==! */
             , bl_no                             /** N° De Bl !== BL번호 ==! */
             , ibobz_cd                          /** Code de zone sous douane !== 보세구역코드 ==! */
             , stvd_cd                           /** Code De Stevedoremanutentionnaire !== 하역업자코드 ==! */
             , del_yn                            /** Suppression On !== 삭제여부 ==! */
             , frst_regst_id                     /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , frst_rgsr_dttm                    /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , last_chpr_id                      /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , last_chg_dttm                     /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
<!--              , grdast_nm 						 /** Assistant au sol !==조업사명==! */ -->
             )
        SELECT #{ldunRqstMdfyNo}                 /**  !== 하역신청정정번호 ==! */
             , A.bl_no                           /** N° De Bl !== BL번호 ==! */
             , A.ibobz_cd                        /** Code de zone sous douane !== 보세구역코드 ==! */
             , A.stvd_cd                         /** Code De Stevedoremanutentionnaire !== 하역업자코드 ==! */
             , A.del_yn                          /** Suppression On !== 삭제여부 ==! */
             , A.frst_regst_id                   /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , A.frst_rgsr_dttm                  /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , A.last_chpr_id                    /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , A.last_chg_dttm                   /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
<!--              , A.grdast_nm						 /** Assistant au sol !==조업사명==! */ -->
          FROM ALPASSEXT.TB_CARE_LDUN_MDFY_BL A
         WHERE A.del_yn = 'N'                    /** Suppression ON !== 삭제여부 ==! */
           AND A.ldun_rqst_mdfy_mgrn = #{ldunRqstMdfyMgrn}
    </insert>

    <!-- BL Suppression BL !==BL 삭제==! -->
    <delete id="deleteCareLdunRqstMdfyBlAll"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstBlVo">
        /* CarCagLdunRqstMapper.deleteCareLdunRqstMdfyBlAll */
        DELETE ALPASSEXT.TB_CARE_LDUN_MDFY_BL A
         WHERE 1=1
           AND A.ldun_rqst_mdfy_mgrn = #{ldunRqstMdfyMgrn} /** N° De Gestion De Demande De Déchargement !== 양하신청정정관리번호 ==! */
    </delete>

    <!-- Enregistrer BL !==BL 등록==! -->
    <insert id="insertCareLdunRqstMdfyBlAll"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstBlVo">
        /* CarCagLdunRqstMapper.insertCareLdunRqstMdfyBlAll */
        INSERT INTO ALPASSEXT.tb_care_ldun_mdfy_bl
        ( ldun_rqst_mdfy_mgrn                       /** N° De Gestion De Demande De Déchargement !== 하역신청정정관리번호 ==! */
        , bl_no                                     /** N° De Bl !== BL번호 ==! */
        , mdfy_dgcnt                                /** Fréquence de rectification !== 정정차수 ==! */
        , ibobz_cd                                  /** Code de zone sous douane !== 보세구역코드 ==! */
        , stvd_cd                                   /** Code De Stevedoremanutentionnaire !== 하역업자코드 ==! */
        , del_yn                                    /** Suppression On !== 삭제여부 ==! */
        , frst_regst_id                             /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
        , frst_rgsr_dttm                            /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
        , last_chpr_id                              /** Id Du Modificateur Final !== 최종변경자ID ==! */
        , last_chg_dttm                             /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        <!--              , grdast_nm								 /** Assistant au sol !==조업사명==! */ -->
        )
        SELECT #{ldunRqstMdfyMgrn}                         /** N° De Gestion De Demande De Déchargement !== 하역신청정정관리번호 ==! */
        , A.bl_no                                   /** N° De Bl !== BL번호 ==! */
        , (SELECT NVL(MAX(mdfy_dgcnt), -1)
        FROM ALPASSEXT.tb_carE_ldun_mdfy
        WHERE ldun_rqst_no = #{ldunRqstNo})     /** Fréquence de rectification !== 정정차수 ==! */
        , A.ibobz_cd                                /** Code de zone sous douane !== 보세구역코드 ==! */
        , A.stvd_cd                                 /** Code De Stevedoremanutentionnaire !== 하역업자코드 ==! */
        , A.del_yn                                  /** Suppression On !== 삭제여부 ==! */
        , A.frst_regst_id                           /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
        , A.frst_rgsr_dttm                          /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
        , A.last_chpr_id                            /** Id Du Modificateur Final !== 최종변경자ID ==! */
        , A.last_chg_dttm                           /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
        <!--              , A.grdast_nm								 /** Assistant au sol !==조업사명==! */ -->
        FROM ALPASSEXT.tb_care_ldun_bl A
        INNER JOIN ALPASSEXT.tb_care_ldun M
        ON M.ldun_rqst_mgmt_no = A.ldun_rqst_mgmt_no
        AND M.ldun_rqst_mgmt_no = #{ldunRqstMgmtNo}
        WHERE 1 = 1
        AND A.del_yn = 'N'
        AND M.del_yn = 'N'
    </insert>

    <!-- BL Suppression BL !==BL 삭제==! -->
    <delete id="deleteCareLdunRqstMdfyBl"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstBlVo">
        /* CarCagLdunRqstMapper.deleteCareLdunRqstMdfyBl */
        DELETE ALPASSEXT.TB_CARE_LDUN_MDFY_BL A
         WHERE 1=1
           AND A.ldun_rqst_mdfy_mgrn = #{ldunRqstMdfyMgrn} /** N° De Gestion De Demande De Déchargement !== 양하신청정정관리번호 ==! */
           AND A.BL_NO= #{blNo}
    </delete>

    <!-- Enregistrer BL !==BL 등록==! -->
    <insert id="insertCareLdunRqstMdfyBl"
            parameterType="alpass.ipt.car.ldun.vo.CarCagLdunRqstBlVo">
        /* CarCagLdunRqstMapper.insertCareLdunRqstMdfyBl */
        INSERT INTO ALPASSEXT.tb_care_ldun_mdfy_bl
             ( ldun_rqst_mdfy_mgrn                       /** N° De Gestion De Demande De Déchargement !== 하역신청정정관리번호 ==! */
             , bl_no                                     /** N° De Bl !== BL번호 ==! */
             , mdfy_dgcnt                                /** Fréquence de rectification !== 정정차수 ==! */
             , ibobz_cd                                  /** Code de zone sous douane !== 보세구역코드 ==! */
             , stvd_cd                                   /** Code De Stevedoremanutentionnaire !== 하역업자코드 ==! */
             , del_yn                                    /** Suppression On !== 삭제여부 ==! */
             , frst_regst_id                             /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , frst_rgsr_dttm                            /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , last_chpr_id                              /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , last_chg_dttm                             /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
<!--              , grdast_nm								 /** Assistant au sol !==조업사명==! */ -->
             )
      SELECT #{ldunRqstMdfyMgrn}                         /** N° De Gestion De Demande De Déchargement !== 하역신청정정관리번호 ==! */
             , A.bl_no                                   /** N° De Bl !== BL번호 ==! */
             , (SELECT NVL(MAX(mdfy_dgcnt), -1)
                  FROM ALPASSEXT.tb_carE_ldun_mdfy
                 WHERE ldun_rqst_no = #{ldunRqstNo})     /** Fréquence de rectification !== 정정차수 ==! */
             , A.ibobz_cd                                /** Code de zone sous douane !== 보세구역코드 ==! */
             , A.stvd_cd                                 /** Code De Stevedoremanutentionnaire !== 하역업자코드 ==! */
             , A.del_yn                                  /** Suppression On !== 삭제여부 ==! */
             , A.frst_regst_id                           /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
             , A.frst_rgsr_dttm                          /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
             , A.last_chpr_id                            /** Id Du Modificateur Final !== 최종변경자ID ==! */
             , A.last_chg_dttm                           /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
<!--              , A.grdast_nm								 /** Assistant au sol !==조업사명==! */ -->
        FROM ALPASSEXT.tb_care_ldun_bl A
       INNER JOIN ALPASSEXT.tb_care_ldun M
          ON M.ldun_rqst_mgmt_no = A.ldun_rqst_mgmt_no
         AND M.ldun_rqst_mgmt_no = #{ldunRqstMgmtNo}
       WHERE 1 = 1
         AND A.bl_no = #{blNo}
         AND A.del_yn = 'N'
         AND M.del_yn = 'N'
    </insert>

</mapper>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="alpass.ipt.col.sale.mapper.ColSaleMgmtMapper">

    <!--
    Consulter la liste des comptablités matière !==물품재고현황목록을 조회한다==!
    -->
    <select id="selectColSaleMgmtList" parameterType="alpass.ipt.col.sale.vo.ColSaleMgmtVo" resultType="alpass.ipt.col.sale.vo.ColSaleMgmtVo">
        /** ColSaleMgmtMapper_selectColSaleMgmtList **/
        <include refid="pagination.header" />
        SELECT
        PCDN.INVN_MGMT_NO                                                       /** N° de gestion de comptabilité-matière !== 재고관리번호 ==! */
        , PCDN.CSTM_CD                                                           /** Code du bureau !== 세관코드 ==! */
        , FN_GET_ORGN_NM(PCDN.CSTM_CD) AS CSTM_NM								/** Nom Du Bureau !== 세관명 ==! */
        , PCDN.DEPT_CD
        , PCDN.CAG_MGMT_NO                                                      /** CRN !== 화물관리번호 ==! */
        , PCDN.IBOBZ_CD                                                         /** Code de zone sous douane !== 보세구역코드 ==! */
        , PCDN.SFKP_PLC_NM                                                      /** Lieu d’entreposage !== 보관장소명 ==! */
        , PCDN.REFF_NO_PT_CD                                                    /** Code de type de numero de reference !== 참조번호유형코드 ==! */
        , PCDN.REFF_NO_PT_TP_NM                                                 /** Nom du type de numéro de référence !== 참조번호유형구분명 ==! */
        , PCDN.REFF_NO                                                          /** N° de reference !== 참조번호 ==! */
        , TO_CHAR(TO_DATE(PCDN.REFF_DOC_RGSR_DT,'YYYYMMDD'),'DD/MM/YYYY') AS REFF_DOC_RGSR_DT		/** Date d'enregistrement du dossier de référence !== 참조문서등록일자 ==! */
        , TO_CHAR(TO_DATE(PCDN.UDRT_DT,'YYYYMMDD'),'DD/MM/YYYY') AS UDRT_DT       /** Date de la prise en charge !== 인수일자 ==! */
        , PCDN.PCKG_GCNT														/** Nombre de colis !== 포장개수 ==!*/
        , PCDN.WGHT							                					/** Poids !== 중량 ==! */
        , PCDN.LAST_USG_CD														/** Code d'usage définitif !== 최종용도코드 ==! */
        , PCDN.ATCH_FILE_ID														/** Date et heure de modification finale !== 첨부파일ID ==!*/
        , PCDN.APRV_ID				        									/** ID d'approbation !== 결제ID ==! */
        , PCDN.PDLS_NM						        							/** Nom de l'article !== 품목명 ==! */
        , PCDN.CNTR_SIZE							    						/** Taille du conteneur !== 컨테이너크기 ==! */
        , PCDN.SFKP_PLC_NM
        , PCDN.FRST_REGST_ID								    				/** ID du premier enregistrant !== 최초등록자ID ==! */
        , PCDN.FRST_RGSR_DTTM									    			/** Date et heure de premier enregistrement !== 생성일자 ==! */
        , PCDN.LAST_CHPR_ID														/** ID du modificateur final !== 최종변경자ID ==! */
        , PCDN.LAST_CHG_DTTM													/** Date et heure de modification finale !== 최종변경일시 ==! */
        FROM   TB_COLI_CMDT_INVN_PCDN PCDN
        WHERE  PCDN.DEL_YN = 'N'
        <if test="sctrCd != null and sctrCd != ''">
            AND  PCDN.CSTM_CD LIKE SUBSTRING(#{sctrCd},1,3) || '%'
        </if>
        <if test="uprOrgnCd != null and uprOrgnCd != ''">
            AND  PCDN.CSTM_CD = #{uprOrgnCd}
        </if>
        <if test="orgnCd != null and orgnCd != ''">
            AND (PCDN.DEPT_CD = #{orgnCd} OR PCDN.DEPT_CD IN (SELECT ORGN_CD FROM TB_POTI_ORGN WHERE (SELECT ACTV_CSTM_CD FROM TB_POTI_ORGN WHERE ORGN_CD = #{orgnCd}) LIKE '%'||ORGN_MGMT_CD||'%')
                                          OR PCDN.DEPT_CD IN (SELECT ORGN_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD IN (SELECT UNNEST(STRING_TO_ARRAY(ACTV_CSTM_CD,'|')) FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD IN (SELECT UNNEST(STRING_TO_ARRAY(ACTV_CSTM_CD,'|')) FROM TB_POTI_ORGN WHERE ORGN_CD = #{orgnCd})))
                 )
        </if>
        <if test='cstmCd != null and cstmCd !="" '>
            AND    PCDN.CSTM_CD = #{cstmCd}
        </if>
        <if test="deptCd != null and deptCd != ''">
            AND (PCDN.DEPT_CD = #{deptCd} OR PCDN.DEPT_CD IN (SELECT ORGN_CD FROM TB_POTI_ORGN WHERE (SELECT ACTV_CSTM_CD FROM TB_POTI_ORGN WHERE ORGN_CD = #{deptCd}) LIKE '%'||ORGN_MGMT_CD||'%')
                                          OR PCDN.DEPT_CD IN (SELECT ORGN_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD IN (SELECT UNNEST(STRING_TO_ARRAY(ACTV_CSTM_CD,'|')) FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD IN (SELECT UNNEST(STRING_TO_ARRAY(ACTV_CSTM_CD,'|')) FROM TB_POTI_ORGN WHERE ORGN_CD = #{deptCd}))
            OR UPR_ORGN_MGMT_CD IN (SELECT UNNEST(STRING_TO_ARRAY(ACTV_CSTM_CD,'|')) FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD IN (SELECT UNNEST(STRING_TO_ARRAY(ACTV_CSTM_CD,'|')) FROM TB_POTI_ORGN WHERE ORGN_CD = #{deptCd}))))
        </if>
        <if test='lastUsgCd != null and lastUsgCd !="" '>
            AND    PCDN.LAST_USG_CD = #{lastUsgCd}
        </if>
        <if test='reffDocRgsrDtFrom != null and reffDocRgsrDtFrom !="" and reffDocRgsrDtTo != null and reffDocRgsrDtTo !="" '>
            AND    PCDN.REFF_DOC_RGSR_DT BETWEEN TO_CHAR(TO_DATE(#{reffDocRgsrDtFrom},'DD/MM/YYYY'),'YYYYMMDD') AND TO_CHAR(TO_DATE(#{reffDocRgsrDtTo},'DD/MM/YYYY'),'YYYYMMDD')
        </if>
        <if test='reffNo != null and reffNo !="" '>
            AND    PCDN.REFF_NO = #{reffNo}
        </if>
        ORDER BY PCDN.REFF_DOC_RGSR_DT desc, PCDN.REFF_NO desc, PCDN.INVN_MGMT_NO ASC
        <include refid="pagination.footer" />
    </select>

    <!--
    Ajouter temporairement la comptablité matière !==재고현황목록을 임시 추가한다==!
    -->
    <insert id="insertColSaleMgmtTemp" parameterType="alpass.ipt.col.sale.vo.ColSaleMgmtVo">
        /** ColSaleMgmtMapper_insertColSaleMgmtTemp **/
        INSERT INTO TB_COLI_CMDT_INVN_PCDN (
            INVN_MGMT_NO                                                        /** N° de gestion de comptabilité-matière !== 재고관리번호 ==! */
            , CSTM_CD                                                           /** Code du bureau !== 세관코드 ==! */
            , DEPT_CD
            , CAG_MGMT_NO                                                       /** CRN !== 화물관리번호 ==! */
            , IBOBZ_CD                                                          /** Code de zone sous douane !== 보세구역코드 ==! */
            , SFKP_PLC_NM                                                       /** Lieu d’entreposage !== 보관장소명 ==! */
            , REFF_NO_PT_CD                                                     /** Code de type de numero de reference !== 참조번호유형코드 ==! */
            , REFF_NO_PT_TP_NM                                                  /** Nom du type de numéro de référence !== 참조번호유형구분명 ==! */
            , REFF_NO                                                           /** N° de reference !== 참조번호 ==! */
            , REFF_DOC_RGSR_DT                                                	/** Date d'enregistrement du dossier de référence !== 참조문서등록일자 ==! */
            , UDRT_DT                                                             /** Date de la prise en charge !== 인수일자 ==! */
            , PCKG_GCNT														/** Nombre De Colis !== 포장개수 ==! */
            , WGHT							                					/** Poids !== 중량 ==! */
            , LAST_USG_CD														/** Code d'usage définitif !== 최종용도코드 ==! */
            , ATCH_FILE_ID														/** Date et heure de modification finale !== 첨부파일ID ==!*/
            , APRV_ID				        									/** ID d'approbation !== 결제ID ==! */
            , PDLS_NM						        							/** Nom de l'article !== 품목명 ==! */
            , CNTR_SIZE							    						/** Taille du conteneur !== 컨테이너크기 ==! */
            , DEL_YN							    						/** Suppression ON !== 삭제여부  ==! */
            , FRST_REGST_ID								    				/** ID du premier enregistrant !== 최초등록자ID ==! */
            , FRST_RGSR_DTTM									    			/** Date et heure de premier enregistrement !== 생성일자 ==! */
            , LAST_CHPR_ID														/** ID du modificateur final !== 최종변경자ID ==! */
            , LAST_CHG_DTTM													/** Date et heure de modification finale !== 최종변경일시 ==! */
        ) VALUES (
            #{invnMgmtNo}
            , #{cstmCd}
            , #{deptCd}
            , #{cagMgmtNo}
            , #{ibobzCd}
            , #{sfkpPlcNm}
            , #{reffNoPtCd}
            , #{reffNoPtTpNm}
            , #{reffNo}
            , TO_CHAR(TO_DATE(#{reffDocRgsrDt} , 'DD/MM/YYYY'), 'YYYYMMDD')
            , TO_CHAR(TO_DATE(#{udrtDt} , 'DD/MM/YYYY'), 'YYYYMMDD')
            , #{pckgGcnt}
            , #{wght}
            , null
            , #{atchFileId}
            , #{aprvId}
            , #{pdlsNm}
            , #{cntrSize}
            , 'N'
            , #{frstRegstId}
            , SYSTIMESTAMP
            , #{lastChprId}
            , SYSTIMESTAMP
        )
    </insert>

    <!--
    Changer la comptabilité matière en état de sauvegarde temporaire !==물품재고를 임시저장상태로 변경한다==!
    -->
    <update id="updateColSaleMgmtEnd" parameterType="alpass.ipt.col.sale.vo.ColSaleMgmtVo">
        /** ColSaleMgmtMapper_updateColSaleMgmt **/
        UPDATE  TB_COLI_CMDT_INVN_PCDN SET
            LAST_USG_CD = 'A00'
            , LAST_CHPR_ID = #{lastChprId}
            , LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE INVN_MGMT_NO = #{invnMgmtNo}
    </update>

    <!--
    Remplacer le code de type de cession de la marchandise à aliéner par la sélection d'un objet de la vente aux enchères publiques (40)
    !==양도예정대상의 양도구분코드를 공매대상선정(40)으로 변경한다==!
    -->
    <update id="updateColSaleMgmtTrsfTpCd" parameterType="alpass.ipt.col.sale.vo.ColSaleMgmtVo">
        /** ColSaleMgmtMapper_updateColSaleMgmtTrsfTpCd **/
        UPDATE TB_CARI_TRSF_PRNG_TRGT
        SET    TRSF_TP_CD       = '40'
        , RELE_DTTM        = SYSTIMESTAMP
        , LAST_CHPR_ID     = #{lastChprId}
        , LAST_CHG_DTTM    = SYSTIMESTAMP
        WHERE  CAG_MGMT_NO      = #{cagMgmtNo}
        AND    IBOBZ_CD         = #{ibobzCd}
        AND    DEL_YN = 'N'
    </update>

    <!--
    Ajouter la comptablité matière !==물품재고상세를 등록한다==!
    -->
    <insert id="insertColSaleMgmtDtl" parameterType="alpass.ipt.col.com.vo.ColCmdtInvnPcdnDtlVo">
        /** ColSaleMgmtMapper_insertColSaleMgmtDtl **/
        INSERT INTO TB_COLI_CMDT_INVN_PCDN_DTL (
             INVN_MGMT_NO                                                        /** N° de gestion de comptabilité-matière !== 재고관리번호 ==! */
           , PDLS_SRNO
           , VHCL_YN
           , CAG_CN
           , CNTR_NO
           , PBAC_PRNG_AMT
           , QTY
           , REFF_NO_PT_CD
           , REFF_NO_PT_TP_NM
           , VHCL_TM_NM
           , VHCL_MDL_NM
           , CHSS_NO
           , VHCL_KND_NM
           , FL_NM
           , VNTL_AQTY
           , VHCL_OTPT
           , TTWG
           , MAX_LOAD_AQTY
           , STCNT
           , CAR_RGSR_NO
           , FRST_DRV_DD
           , RMRK_CN
           , ATCH_FILE_ID
           , RGSR_DT
           , DEL_YN					        		    						/** Suppression ON !== 삭제여부  ==! */
           , FRST_REGST_ID					    			    				/** ID du premier enregistrant !== 최초등록자ID ==! */
           , FRST_RGSR_DTTM						    			    			/** Date et heure de premier enregistrement !== 생성일자 ==! */
           , LAST_CHPR_ID														/** ID du modificateur final !== 최종변경자ID ==! */
           , LAST_CHG_DTTM							    						/** Date et heure de modification finale !== 최종변경일시 ==! */
        ) VALUES (
            #{invnMgmtNo}
            , (SELECT NVL(MAX(PDLS_SRNO), 0) + 1 FROM TB_COLI_CMDT_INVN_PCDN_DTL WHERE INVN_MGMT_NO = #{invnMgmtNo})
            , #{vhclYn}
            , #{cagCn}
            , #{cntrNo}
            , #{pbacPrngAmt}
            , #{qty}
            , #{reffNoPtCd}
            , #{reffNoPtTpNm}
            , #{vhclTmNm}
            , #{vhclMdlNm}
            , #{chssNo}
            , #{vhclKndNm}
            , #{flNm}
            , #{vntlAqty}
            , #{vhclOtpt}
            , #{ttwg}
            , #{maxLoadAqty}
            , #{stcnt}
            , #{carRgsrNo}
            , TO_CHAR(TO_DATE(#{frstDrvDd}, 'DD/MM/YYYY'), 'YYYYMMDD')
            , #{rmrkCn}
            , #{atchFileId}
            , TO_CHAR(TO_DATE(#{rgsrDt} , 'DD/MM/YYYY'), 'YYYYMMDD')
            , 'N'
            , #{frstRegstId}
            , SYSTIMESTAMP
            , #{lastChprId}
            , SYSTIMESTAMP
        )
    </insert>

    <!--
    Modifier la comptabilité matière !==물품재고를 수정한다==!
    -->
    <update id="updateColSaleMgmt" parameterType="alpass.ipt.col.sale.vo.ColSaleMgmtVo">
        /** ColSaleMgmtMapper_updateColSaleMgmt **/
        UPDATE  TB_COLI_CMDT_INVN_PCDN SET
            CAG_MGMT_NO = #{cagMgmtNo}                                                       /** CRN !== 화물관리번호 ==! */
            , IBOBZ_CD = #{ibobzCd}                                                        /** Code de zone sous douane !== 보세구역코드 ==! */
            , SFKP_PLC_NM = #{sfkpPlcNm}                                                       /** Lieu d’entreposage !== 보관장소명 ==! */
            , REFF_NO_PT_CD = #{reffNoPtCd}                                                     /** Code de type de numero de reference !== 참조번호유형코드 ==! */
            , REFF_NO_PT_TP_NM = #{reffNoPtTpNm}                                                  /** Nom du type de numéro de référence !== 참조번호유형구분명 ==! */
            , REFF_NO = #{reffNo}                                                           /** N° de reference !== 참조번호 ==! */
            , REFF_DOC_RGSR_DT = TO_CHAR(TO_DATE(#{reffDocRgsrDt}, 'DD/MM/YYYY'), 'YYYYMMDD')                                                	/** Date d'enregistrement du dossier de référence !== 참조문서등록일자 ==! */
            , UDRT_DT = TO_CHAR(TO_DATE(#{udrtDt}, 'DD/MM/YYYY'), 'YYYYMMDD')                                                             /** Date de la prise en charge !== 인수일자 ==! */
            , PCKG_GCNT = #{pckgGcnt}														/** Nombre De Colis !== 포장개수 ==! */
            , WGHT = #{wght}							                					/** Poids !== 중량 ==! */
            , LAST_USG_CD = #{lastUsgCd}														/** Code d'usage définitif !== 최종용도코드 ==! */
            , ATCH_FILE_ID = #{atchFileId}														/** Date et heure de modification finale !== 첨부파일ID ==!*/
            , APRV_ID = #{aprvId}				        									/** ID d'approbation !== 결제ID ==! */
            , PDLS_NM = #{pdlsNm}						        							/** Nom de l'article !== 품목명 ==! */
            , CNTR_SIZE = #{cntrSize}							    						/** Taille du conteneur !== 컨테이너크기 ==! */
            , LAST_CHPR_ID = #{lastChprId}
            , LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE INVN_MGMT_NO = #{invnMgmtNo}
    </update>

    <!--
    Modifier les détails de la comptabilité matière !==물품재고상세를 수정한다==!
    -->
    <update id="updateColSaleMgmtDtl" parameterType="alpass.ipt.col.com.vo.ColCmdtInvnPcdnDtlVo">
        /** ColSaleMgmtMapper_updateColSaleMgmtDtl **/
        UPDATE  TB_COLI_CMDT_INVN_PCDN_DTL SET
            VHCL_YN = #{vhclYn}
            , CAG_CN = #{cagCn}
            , CNTR_NO = #{cntrNo}
            , PBAC_PRNG_AMT = #{pbacPrngAmt}
            , QTY = #{qty}
            , REFF_NO_PT_CD = #{reffNoPtCd}
            , REFF_NO_PT_TP_NM = #{reffNoPtTpNm}
            , VHCL_TM_NM = #{vhclTmNm}
            , VHCL_MDL_NM = #{vhclMdlNm}
            , CHSS_NO = #{chssNo}
            , VHCL_KND_NM = #{vhclKndNm}
            , FL_NM = #{flNm}
            , VNTL_AQTY = #{vntlAqty}
            , VHCL_OTPT = #{vhclOtpt}
            , TTWG = #{ttwg}
            , MAX_LOAD_AQTY = #{maxLoadAqty}
            , STCNT = #{stcnt}
            , CAR_RGSR_NO = #{carRgsrNo}
            , FRST_DRV_DD = TO_CHAR(TO_DATE(#{frstDrvDd}, 'DD/MM/YYYY'), 'YYYYMMDD')
            , RMRK_CN = #{rmrkCn}
            , LAST_USG_CD = #{lastUsgCd}
            , ATCH_FILE_ID = #{atchFileId}
            , DEL_YN = 'N'
            , LAST_CHPR_ID = #{lastChprId}
            , LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE INVN_MGMT_NO = #{invnMgmtNo}
          AND PDLS_SRNO = #{pdlsSrno}
    </update>

    <!--
    Supprimer la comptabilité matière !==물품재고를 삭제한다==!
    -->
    <update id="deleteColSaleMgmt" parameterType="alpass.ipt.col.sale.vo.ColSaleMgmtVo">
        /** ColSaleMgmtMapper_deleteColSaleMgmtDtl **/
        UPDATE  TB_COLI_CMDT_INVN_PCDN SET
            DEL_YN = 'Y'
            , LAST_CHPR_ID = #{lastChprId}
            , LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE INVN_MGMT_NO = #{invnMgmtNo}
    </update>

    <!--
    Supprimer les détails de la comptabilité matière !==물품재고상세를 삭제한다==!
    -->
    <update id="deleteColSaleMgmtDtl" parameterType="alpass.ipt.col.sale.vo.ColSaleMgmtVo">
        /** ColSaleMgmtMapper_deleteColSaleMgmtDtl **/
        UPDATE  TB_COLI_CMDT_INVN_PCDN_DTL SET
            DEL_YN = 'Y'
            , LAST_CHPR_ID = #{lastChprId}
            , LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE INVN_MGMT_NO = #{invnMgmtNo}
    </update>

    <!--
    Consulter la liste des comptablités matière !==물품재고현황목록을 조회한다==!
    -->
    <select id="selectColSaleMgmtDtl" parameterType="alpass.ipt.col.com.vo.ColCmdtInvnPcdnDtlVo" resultType="alpass.ipt.col.com.vo.ColCmdtInvnPcdnDtlVo">
        /** ColSaleMgmtMapper_selectColSaleMgmtDtl **/
        SELECT
        DTL.INVN_MGMT_NO                                                       /** N° de gestion de comptabilité-matière !== 재고관리번호 ==! */
        , DTL.PDLS_SRNO
        , DTL.VHCL_YN
        , DTL.CAG_CN
        , DTL.CNTR_NO
        , DTL.PBAC_PRNG_AMT
        , DTL.QTY
        , DTL.REFF_NO_PT_CD
        , DTL.REFF_NO_PT_TP_NM
        , DTL.VHCL_TM_NM
        , DTL.VHCL_MDL_NM
        , DTL.CHSS_NO
        , DTL.VHCL_KND_NM
        , DTL.FL_NM
        , DTL.VNTL_AQTY
        , DTL.VHCL_OTPT
        , DTL.TTWG
        , DTL.MAX_LOAD_AQTY
        , DTL.STCNT
        , DTL.CAR_RGSR_NO
        , TO_CHAR(TO_DATE(DTL.FRST_DRV_DD,'YYYYMMDD'),'DD/MM/YYYY') AS FRST_DRV_DD
        , DTL.RMRK_CN
        , DTL.LAST_USG_CD
        , DTL.ATCH_FILE_ID														/** Date et heure de modification finale !== 첨부파일ID ==!*/
        , TO_CHAR(TO_DATE(DTL.RGSR_DT,'YYYYMMDD'),'DD/MM/YYYY') AS RGSR_DT
        , DTL.FRST_REGST_ID								    				/** ID du premier enregistrant !== 최초등록자ID ==! */
        , DTL.FRST_RGSR_DTTM									    			/** Date et heure de premier enregistrement !== 생성일자 ==! */
        , DTL.LAST_CHPR_ID														/** ID du modificateur final !== 최종변경자ID ==! */
        , DTL.LAST_CHG_DTTM													/** Date et heure de modification finale !== 최종변경일시 ==! */
        FROM   TB_COLI_CMDT_INVN_PCDN_DTL DTL
        WHERE  DTL.DEL_YN = 'N'
        <if test='invnMgmtNo != null and invnMgmtNo !="" '>
            AND    DTL.INVN_MGMT_NO = #{invnMgmtNo}
        </if>
        <if test='pdlsSrno != null and pdlsSrno !="" '>
            AND    DTL.PDLS_SRNO = #{pdlsSrno}
        </if>

    </select>

    <!--
    Consulter la liste des comptablités matière !==물품재고현황목록을 조회한다==!
    -->
    <select id="selectColSaleMgmtDtlNo" parameterType="alpass.ipt.col.com.vo.ColCmdtInvnPcdnDtlVo" resultType="alpass.ipt.col.sale.vo.ColSaleMgmtVo">
        /** ColSaleMgmtMapper_selectColSaleMgmtDtlNo **/
        SELECT
        PCDN.INVN_MGMT_NO                                                       /** N° de gestion de comptabilité-matière !== 재고관리번호 ==! */
        , PCDN.CSTM_CD                                                           /** Code du bureau !== 세관코드 ==! */
        , FN_GET_ORGN_NM(PCDN.CSTM_CD) AS CSTM_NM								/** Nom Du Bureau !== 세관명 ==! */
        , PCDN.DEPT_CD
        , PCDN.CAG_MGMT_NO                                                      /** CRN !== 화물관리번호 ==! */
        , PCDN.IBOBZ_CD                                                         /** Code de zone sous douane !== 보세구역코드 ==! */
        , PCDN.SFKP_PLC_NM                                                      /** Lieu d’entreposage !== 보관장소명 ==! */
        , PCDN.REFF_NO_PT_CD                                                    /** Code de type de numero de reference !== 참조번호유형코드 ==! */
        , PCDN.REFF_NO_PT_TP_NM                                                 /** Nom du type de numéro de référence !== 참조번호유형구분명 ==! */
        , PCDN.REFF_NO                                                          /** N° de reference !== 참조번호 ==! */
        , TO_CHAR(TO_DATE(PCDN.REFF_DOC_RGSR_DT,'YYYYMMDD'),'DD/MM/YYYY') AS REFF_DOC_RGSR_DT		/** Date d'enregistrement du dossier de référence !== 참조문서등록일자 ==! */
        , TO_CHAR(TO_DATE(PCDN.UDRT_DT,'YYYYMMDD'),'DD/MM/YYYY') AS UDRT_DT       /** Date de la prise en charge !== 인수일자 ==! */
        , PCDN.PCKG_GCNT														/** Nombre De Colis !== 포장개수 ==! */
        , PCDN.WGHT							                					/** Poids !== 중량 ==! */
        , PCDN.LAST_USG_CD														/** Code d'usage définitif !== 최종용도코드 ==! */
        , PCDN.ATCH_FILE_ID														/** Date et heure de modification finale !== 첨부파일ID ==!*/
        , PCDN.APRV_ID				        									/** ID d'approbation !== 결제ID ==! */
        , PCDN.PDLS_NM						        							/** Nom de l'article !== 품목명 ==! */
        , PCDN.CNTR_SIZE							    						/** Taille du conteneur !== 컨테이너크기 ==! */
        , PCDN.FRST_REGST_ID								    				/** ID du premier enregistrant !== 최초등록자ID ==! */
        , PCDN.FRST_RGSR_DTTM									    			/** Date et heure de premier enregistrement !== 생성일자 ==! */
        , PCDN.LAST_CHPR_ID														/** ID du modificateur final !== 최종변경자ID ==! */
        , PCDN.LAST_CHG_DTTM
        FROM   TB_COLI_CMDT_INVN_PCDN_DTL DTL
        , TB_COLI_CMDT_INVN_PCDN PCDN
        WHERE  DTL.INVN_MGMT_NO = PCDN.INVN_MGMT_NO
        AND     DTL.DEL_YN = 'N'
        <if test='invnMgmtNo != null and invnMgmtNo !="" '>
            AND    DTL.INVN_MGMT_NO = #{invnMgmtNo}
        </if>
        <if test='pdlsSrno != null and pdlsSrno !="" '>
            AND    DTL.PDLS_SRNO = #{pdlsSrno}
        </if>

    </select>

    <!--
    Consulter les détails de la comptabilité matière !==물품재고상세 조회한다==!
    -->
    <select id="selectColSaleMgmtDtlPdlsSrNo" parameterType="alpass.ipt.col.com.vo.ColCmdtInvnPcdnDtlVo" resultType="alpass.ipt.col.com.vo.ColCmdtInvnPcdnDtlVo">
        /** ColSaleMgmtMapper_selectColSaleMgmtDtlPdlsSrNo **/
        SELECT
        DTL.INVN_MGMT_NO                                                       /** N° de gestion de comptabilité-matière !== 재고관리번호 ==! */
        , DTL.PDLS_SRNO
        , DTL.VHCL_YN
        , DTL.CAG_CN
        , DTL.CNTR_NO
        , DTL.PBAC_PRNG_AMT
        , DTL.QTY
        , DTL.REFF_NO_PT_CD
        , DTL.REFF_NO_PT_TP_NM
        , DTL.VHCL_TM_NM
        , DTL.VHCL_MDL_NM
        , DTL.CHSS_NO
        , DTL.VHCL_KND_NM
        , DTL.FL_NM
        , DTL.VNTL_AQTY
        , DTL.VHCL_OTPT
        , DTL.TTWG
        , DTL.MAX_LOAD_AQTY
        , DTL.STCNT
        , DTL.CAR_RGSR_NO
        , TO_CHAR(TO_DATE(DTL.FRST_DRV_DD,'YYYYMMDD'),'DD/MM/YYYY') AS FRST_DRV_DD
        , DTL.RMRK_CN
        , DTL.LAST_USG_CD
        , DTL.ATCH_FILE_ID														/** Date et heure de modification finale !== 첨부파일ID ==!*/
        , TO_CHAR(TO_DATE(DTL.RGSR_DT,'YYYYMMDD'),'DD/MM/YYYY') AS RGSR_DT
        , DTL.FRST_REGST_ID								    				/** ID du premier enregistrant !== 최초등록자ID ==! */
        , DTL.FRST_RGSR_DTTM									    			/** Date et heure de premier enregistrement !== 생성일자 ==! */
        , DTL.LAST_CHPR_ID														/** ID du modificateur final !== 최종변경자ID ==! */
        , DTL.LAST_CHG_DTTM													/** Date et heure de modification finale !== 최종변경일시 ==! */
        FROM   TB_COLI_CMDT_INVN_PCDN_DTL DTL
        WHERE  DTL.DEL_YN = 'N'
        <if test='invnMgmtNo != null and invnMgmtNo !="" '>
            AND    DTL.INVN_MGMT_NO = #{invnMgmtNo}
        </if>
        <if test='pdlsSrno != null and pdlsSrno !="" '>
            AND    DTL.PDLS_SRNO = #{pdlsSrno}
        </if>

    </select>

    <!--
    Consulter la liste des comptablités matière !==물품재고현황목록을 조회한다==!
    -->
    <select id="selectColSaleMgmtInvnMgmtNo" parameterType="alpass.ipt.col.sale.vo.ColSaleMgmtVo" resultType="alpass.ipt.col.sale.vo.ColSaleMgmtVo">
        /** ColSaleMgmtMapper_selectColSaleMgmtInvnMgmtNo **/
        SELECT
        PCDN.INVN_MGMT_NO                                                       /** N° de gestion de comptabilité-matière !== 재고관리번호 ==! */
        , PCDN.CSTM_CD                                                           /** Code du bureau !== 세관코드 ==! */
        , FN_GET_ORGN_NM(PCDN.CSTM_CD) AS CSTM_NM								/** Nom Du Bureau !== 세관명 ==! */
        , PCDN.DEPT_CD
        , PCDN.CAG_MGMT_NO                                                      /** CRN !== 화물관리번호 ==! */
        , PCDN.IBOBZ_CD                                                         /** Code de zone sous douane !== 보세구역코드 ==! */
        , PCDN.SFKP_PLC_NM                                                      /** Lieu d’entreposage !== 보관장소명 ==! */
        , PCDN.REFF_NO_PT_CD                                                    /** Code de type de numero de reference !== 참조번호유형코드 ==! */
        , PCDN.REFF_NO_PT_TP_NM                                                 /** Nom du type de numéro de référence !== 참조번호유형구분명 ==! */
        , PCDN.REFF_NO                                                          /** N° de reference !== 참조번호 ==! */
        , TO_CHAR(TO_DATE(PCDN.REFF_DOC_RGSR_DT,'YYYYMMDD'),'DD/MM/YYYY') AS REFF_DOC_RGSR_DT		/** Date d'enregistrement du dossier de référence !== 참조문서등록일자 ==! */
        , TO_CHAR(TO_DATE(PCDN.UDRT_DT,'YYYYMMDD'),'DD/MM/YYYY') AS UDRT_DT       /** Date de la prise en charge !== 인수일자 ==! */
        , PCDN.PCKG_GCNT														/** Nombre De Colis !== 포장개수 ==! */
        , PCDN.WGHT							                					/** Poids !== 중량 ==! */
        , PCDN.LAST_USG_CD														/** Code d'usage définitif !== 최종용도코드 ==! */
        , PCDN.ATCH_FILE_ID														/** Date et heure de modification finale !== 첨부파일ID ==!*/
        , PCDN.APRV_ID				        									/** ID d'approbation !== 결제ID ==! */
        , PCDN.PDLS_NM						        							/** Nom de l'article !== 품목명 ==! */
        , PCDN.CNTR_SIZE							    						/** Taille du conteneur !== 컨테이너크기 ==! */
        , PCDN.FRST_REGST_ID								    				/** ID du premier enregistrant !== 최초등록자ID ==! */
        , PCDN.FRST_RGSR_DTTM									    			/** Date et heure de premier enregistrement !== 생성일자 ==! */
        , PCDN.LAST_CHPR_ID														/** ID du modificateur final !== 최종변경자ID ==! */
        , PCDN.LAST_CHG_DTTM													/** Date et heure de modification finale !== 최종변경일시 ==! */
        FROM   TB_COLI_CMDT_INVN_PCDN PCDN
        WHERE  PCDN.DEL_YN = 'N'
        AND    PCDN.INVN_MGMT_NO = #{invnMgmtNo}
        <if test='lastUsgCd != null and lastUsgCd !="" '>
            AND    PCDN.LAST_USG_CD != #{lastUsgCd}
        </if>
    </select>

    <!--
    Modifier le code d'usage définitif !==물품재고상세의 최종용도코드를 변경한다==!
    -->
    <update id="updateColSaleMgmtDtlLastUsgCd" parameterType="alpass.ipt.col.com.vo.ColCmdtInvnPcdnDtlVo">
        /** ColSaleMgmtMapper_updateColSaleMgmtDtlLastUsgCd **/
        UPDATE  TB_COLI_CMDT_INVN_PCDN_DTL SET
            LAST_USG_CD = #{lastUsgCd}
            , LAST_CHPR_ID = #{lastChprId}
            , LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE INVN_MGMT_NO = #{invnMgmtNo}
        AND PDLS_SRNO = #{pdlsSrno}
    </update>
</mapper>
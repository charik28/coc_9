<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="alpass.ipt.clr.cdm.jam.mapper.ClrAdorHnotMgmtMapper">

  <!--
    Consultation de la liste des méthodes de cotation de l'inspecteur !== 심사자 배부방법 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrAdorHnotMeanBscsList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotMeanBscsVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotMeanBscsVo">
    /* selectClrAdorHnotMeanBscsList */
     select a.dclr_pt_cd
          , a.dclr_pt_nm
          , b.cstm_cd
          , b.dept_cd
          , b.hnot_mean_cd
     from (select s1.cd_vdval as dclr_pt_cd
                , s2.cd_vdval_nm as dclr_pt_nm
                , s1.sort_ordr
           from   tb_com_comn_cd_d s1
                , tb_com_comn_cd_d_lang s2
           where  s1.comn_cd = 'CLR_0004'
            and   s1.del_yn = 'N'
            and   s1.use_yn = 'Y'
            and   s1.comn_cd = s2.comn_cd
            and   s1.cd_vdval = s2.cd_vdval
            and   s2.lang_cd = #{langCd}
            and   s2.del_yn = 'N') a
          ,  tb_clri_ador_hnot_mean_bscs b
     where  a.dclr_pt_cd = b.dclr_pt_cd(+)
       and  b.del_yn(+) = 'N'
       and  b.cstm_cd(+) = #{cstmCd}
       and  b.dept_cd(+) = #{deptCd}
     order  by a.sort_ordr
  </select>

  <!--
    Enregistrement de la Gérer le mode de cotation des inspecteurs !==심사자배부방법관리 등록 ==!
    (Song JunYoung)
    -->
  <insert id="insertClrAdorHnotMeanBscs" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotMeanBscsVo">
    /* insertClrAdorHnotMeanBscs */
    WITH UPSERT AS (
      UPDATE TB_CLRI_ADOR_HNOT_MEAN_BSCS
      SET
          HNOT_MEAN_CD = #{hnotMeanCd}                /** Code de méthode d'affectation !== 배부방법코드(C:기준,S:순차,M:수작업) ==! */
        , DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
        , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
        , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
      WHERE CSTM_CD = #{cstmCd}                       /** Code du bureau !== 세관코드 ==! */
      AND DEPT_CD = #{deptCd}                         /** Code de section !== 부서코드 ==! */
      AND DCLR_PT_CD = #{dclrPtCd}                    /** Code de type de déclaration !== 신고유형코드 ==! */
      RETURNING *
    )
    INSERT INTO TB_CLRI_ADOR_HNOT_MEAN_BSCS
      (
        CSTM_CD                      /** Code du bureau !== 세관코드 ==! */
      , DEPT_CD                      /** Code de section !== 부서코드 ==! */
      , DCLR_PT_CD                   /** Code de type de déclaration !== 신고유형코드 ==! */
      , HNOT_MEAN_CD                 /** Code de méthode d'affectation !== 배부방법코드(C:기준,A:랜덤,S:지시사항) ==! */
      , DEL_YN                       /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID                /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM               /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID                 /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM                /** Date et heure de modification finale !== 최종변경일시 ==! */
      )
      SELECT
         #{cstmCd}                    /** Code du bureau !== 세관코드 ==! */
       , #{deptCd}                    /** Code de section !== 부서코드 ==! */
       , #{dclrPtCd}                  /** Code de type de déclaration !== 신고유형코드 ==! */
       , #{hnotMeanCd}                /** Code de méthode d'affectation !== 배부방법코드(C:기준,A:랜덤,S:지시사항) ==! */
       , 'N'                          /** Suppression ON !== 삭제여부 ==! */
       , #{frstRegstId}               /** ID du premier enregistrant  !== 최초등록자ID ==! */
       , SYSTIMESTAMP                 /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
       , #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
       , SYSTIMESTAMP                 /** Date et heure de modification finale !== 최종변경일시 ==! */
      WHERE
        NOT EXISTS(SELECT * FROM UPSERT)
  </insert>

  <!--
    Voir la liste des Gérer les critères de cotation des inspecteurs !== 심사자배부기준관리 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrAdorHnotBaseList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo">
    /* selectClrAdorHnotBaseList */
    <include refid="pagination.header" ></include>
    SELECT
           A.CLUS_SRNO                  /** N° De Séquence De Champ !== 항목일련번호 ==! */
         , A.CSTM_CD                    /** Code Du Bureau !== 세관코드 ==! */
         , A.DEPT_CD                    /** Code de service !== 부서코드 ==! */
         , A.AUDT_DEPT_CD               /** Code de Section du contrôle !== 심사부서코드 ==! */
         , A.STRT_APC_CD                /** Code Apc De Début !== 시작APC코드 ==! */
         , A.END_APC_CD                 /** Code Apc De Fin !== 종료APC코드 ==! */
         , A.FROM_HS_CD                 /** Code Sh Du Champ De Début !== 시작범위HS코드 ==! */
         , A.TO_HS_CD                   /** Code Sh Du Champ De Fin !== 종료범위HS코드 ==! */
         , A.FROM_HS12_CD               /** Code Sh12 Du Champ De Début !== 시작범위HS12코드 ==! */
         , A.TO_HS12_CD                 /** Code Sh12 Du Champ De Fin !== 종료범위HS12코드 ==! */
         , A.APLY_PROR_RNK              /** Priorité De L'Application !== 적용우선순위 ==! */
         , A.DEL_YN                     /** Suppression On !== 삭제여부 ==! */
         , A.FRST_REGST_ID              /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
         , A.FRST_RGSR_DTTM             /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
         , A.LAST_CHPR_ID               /** Id Du Modificateur Final !== 최종변경자ID ==! */
         , A.LAST_CHG_DTTM              /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
    FROM   TB_CLRI_ADOR_HNOT_BASE A
    WHERE A.DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
    <if test="clusSrno != null and clusSrno != ''">
      AND  A.CLUS_SRNO = #{clusSrno}                   /** N° De Séquence De Champ !== 항목일련번호 ==! */
    </if>
    <if test="cstmCd != null and cstmCd != ''">
      AND  A.CSTM_CD = #{cstmCd}                       /** Code Du Bureau !== 세관코드 ==! */
    </if>
    <if test="deptCd != null and deptCd != ''">
      AND  A.DEPT_CD = #{deptCd}                       /** Code de service !== 부서코드 ==! */
    </if>
    <if test="audtDeptCd != null and audtDeptCd != ''">
      AND  A.AUDT_DEPT_CD = #{audtDeptCd}              /** Code de Section du contrôle !== 심사부서코드 ==! */
    </if>
    <if test="inscDeptCd != null and inscDeptCd != ''">
      AND  B.INSC_DEPT_CD = #{inscDeptCd}              /** Code de service de l'inspecteur !== 현장검사자부서코드 ==! */
    </if>
    ORDER BY  A.CSTM_CD, A.DEPT_CD, A.AUDT_DEPT_CD, A.APLY_PROR_RNK
    <include refid="pagination.footer" ></include>
  </select>

  <!--
    Consultation des critères de cotation de l'inspecteur !== 심사자배부기준관리 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrAdorHnotBase" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo">
    /* selectClrAdorHnotBase */
    SELECT
        DISTINCT A.CLUS_SRNO         /** N° De Séquence De Champ !== 항목일련번호 ==! */
      , A.CSTM_CD                    /** Code Du Bureau !== 세관코드 ==! */
      , A.DEPT_CD                    /** Code de service !== 부서코드 ==! */
      , A.AUDT_DEPT_CD               /** Code de Section du contrôle !== 심사부서코드 ==! */
      , A.STRT_APC_CD                /** Code Apc De Début !== 시작APC코드 ==! */
      , A.END_APC_CD                 /** Code Apc De Fin !== 종료APC코드 ==! */
      , A.FROM_HS_CD                 /** Code Sh Du Champ De Début !== 시작범위HS코드 ==! */
      , A.TO_HS_CD                   /** Code Sh Du Champ De Fin !== 종료범위HS코드 ==! */
      , A.FROM_HS12_CD               /** Code Sh12 Du Champ De Début !== 시작범위HS12코드 ==! */
      , A.TO_HS12_CD                 /** Code Sh12 Du Champ De Fin !== 종료범위HS12코드 ==! */
      , A.APLY_PROR_RNK              /** Priorité De L'Application !== 적용우선순위 ==! */
      , A.DEL_YN                     /** Suppression On !== 삭제여부 ==! */
      , A.FRST_REGST_ID              /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
      , A.FRST_RGSR_DTTM             /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
      , A.LAST_CHPR_ID               /** Id Du Modificateur Final !== 최종변경자ID ==! */
      , A.LAST_CHG_DTTM              /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
    FROM   TB_CLRI_ADOR_HNOT_BASE A
    WHERE   A.DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
    <if test="clusSrno != null and clusSrno != ''">
      AND  A.CLUS_SRNO = #{clusSrno}                   /** N° De Séquence De Champ !== 항목일련번호 ==! */
    </if>
    <if test="cstmCd != null and cstmCd != ''">
      AND  A.CSTM_CD = #{cstmCd}                       /** Code Du Bureau !== 세관코드 ==! */
    </if>
    <if test="deptCd != null and deptCd != ''">
      AND  A.DEPT_CD = #{deptCd}                       /** Code de service !== 부서코드 ==! */
    </if>
    <if test="audtDeptCd != null and audtDeptCd != ''">
      AND  A.AUDT_DEPT_CD = #{audtDeptCd}              /** Code de Section du contrôle !== 심사부서코드 ==! */
    </if>
    <if test="inscDeptCd != null and inscDeptCd != ''">
      AND  B.INSC_DEPT_CD = #{inscDeptCd}              /** Code de service de l'inspecteur !== 현장검사자부서코드 ==! */
    </if>
  </select>

  <!--
    Consulter la liste de priorité de la gestion des critères de la cotation des inspecteurs !== 심사자배부기준관리 우선순위 목록 조회 ==!
    (Park Byoungkyu)
    -->
  <select id="selectClrAdorHnotBaseAplyProrRnkList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo">
    /* selectClrAdorHnotBaseAplyProrRnkList */
    SELECT
        A.CSTM_CD                    /** Code Du Bureau !== 세관코드 ==! */
      , A.DEPT_CD                    /** Code de service !== 부서코드 ==! */
      , A.AUDT_DEPT_CD               /** Code de Section du contrôle !== 심사부서코드 ==! */
      , A.APLY_PROR_RNK              /** Priorité De L'Application !== 적용우선순위 ==! */
    FROM   TB_CLRI_ADOR_HNOT_BASE A
    WHERE A.DEL_YN = 'N'                              /** Suppression ON !== 삭제여부 ==! */
    AND   A.CSTM_CD = #{cstmCd}                       /** Code Du Bureau !== 세관코드 ==! */
    AND   A.DEPT_CD = #{deptCd}                       /** Code de service !== 부서코드 ==! */
    AND   A.AUDT_DEPT_CD = #{audtDeptCd}              /** Code de Section du contrôle !== 심사부서코드 ==! */
    ORDER BY  A.CSTM_CD, A.DEPT_CD, A.AUDT_DEPT_CD, A.APLY_PROR_RNK
  </select>


  <!--
    Enregistrement de la Gérer les critères de cotation des inspecteurs !== 심사자배부기준관리 등록 ==!
    (Song JunYoung)
    -->
  <insert id="insertClrAdorHnotBase" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo">
    /* insertClrAdorHnotBase */
    <selectKey keyProperty="clusSrno" resultType="BigDecimal" order="BEFORE">
      /* insertClrAdorHnotBase */
      SELECT NVL(MAX(CLUS_SRNO), 0) + 1
      FROM   TB_CLRI_ADOR_HNOT_BASE
      WHERE  CSTM_CD = #{cstmCd}
      AND    DEPT_CD = #{deptCd}
      AND    AUDT_DEPT_CD = #{audtDeptCd}
    </selectKey>
    INSERT INTO TB_CLRI_ADOR_HNOT_BASE
      (
        CSTM_CD                      /** Code du bureau !== 세관코드 ==! */
      , DEPT_CD                      /** Code de section !== 부서코드 ==! */
      , AUDT_DEPT_CD                 /** Code de Section du contrôle !== 심사부서코드 ==! */
      , CLUS_SRNO                    /** N° de séquence de champ !== 항목일련번호 ==! */
      , STRT_APC_CD                  /** Code APC de départ !== 시작APC코드 ==! */
      , END_APC_CD                   /** Code APC de fin !== 종료APC코드 ==! */
      , FROM_HS_CD                   /** Code SH du champ de départ !== 시작범위HS코드 ==! */
      , TO_HS_CD                     /** Code SH du champ de fin !== 종료범위HS코드 ==! */
      , FROM_HS12_CD                 /** Code SH12 du champ de début !== 시작범위HS12코드 ==! */
      , TO_HS12_CD                   /** Code SH12 du champ de fin !== 종료범위HS12코드 ==! */
      , APLY_PROR_RNK                /** Priorité de l'application !== 적용우선순위 ==! */
      , DEL_YN                       /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID                /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM               /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID                 /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM                /** Date et heure de modification finale !== 최종변경일시 ==! */
        )
    VALUES
      (
        #{cstmCd}                    /** Code du bureau !== 세관코드 ==! */
      , #{deptCd}                    /** Code de section !== 부서코드 ==! */
      , #{audtDeptCd}               /** Code de Section du contrôle !== 심사부서코드 ==! */
      , #{clusSrno}                  /** N° de séquence de champ !== 항목일련번호 ==! */
      , #{strtApcCd}                 /** Code APC de départ !== 시작APC코드 ==! */
      , #{endApcCd}                  /** Code APC de fin !== 종료APC코드 ==! */
      , #{fromHsCd}                  /** Code SH du champ de départ !== 시작범위HS코드 ==! */
      , #{toHsCd}                    /** Code SH du champ de fin !== 종료범위HS코드 ==! */
      , (SELECT CASE WHEN LENGTH(#{fromHsCd}) = 12 THEN #{fromHsCd}
         ELSE RPAD(#{fromHsCd}, 11, '0')||'1'
         END
         FROM DUAL)                  /** Code SH12 du champ de début !== 시작범위HS12코드 ==! */
      , (SELECT CASE WHEN LENGTH(#{toHsCd}) = 12 THEN #{fromHsCd}
         ELSE RPAD(#{toHsCd}, 12, '9')
         END
         FROM DUAL)                  /** Code SH12 du champ de fin !== 종료범위HS12코드 ==! */
      , #{aplyProrRnk}               /** Priorité de l'application !== 적용우선순위 ==! */
      , 'N'                          /** Suppression ON !== 삭제여부 ==! */
      , #{frstRegstId}               /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de modification finale !== 최종변경일시 ==! */
      )
  </insert>


  <!--
    Modifier la Gérer les critères de cotation des inspecteurs !== 심사자배부기준관리 수정 ==!
    (Song JunYoung)
    -->
  <update id="updateClrAdorHnotBase" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo">
    /* updateClrAdorHnotBase */
    UPDATE  TB_CLRI_ADOR_HNOT_BASE SET
    <trim prefixOverrides="," >
        STRT_APC_CD = #{strtApcCd}                  /** Code Apc De Début !== 시작APC코드 ==! */
      , END_APC_CD = #{endApcCd}                    /** Code Apc De Fin !== 종료APC코드 ==! */
      , FROM_HS_CD = #{fromHsCd}                    /** Code Sh Du Champ De Début !== 시작범위HS코드 ==! */
      , TO_HS_CD = #{toHsCd}                        /** Code Sh Du Champ De Fin !== 종료범위HS코드 ==! */
      , FROM_HS12_CD = (SELECT CASE WHEN LENGTH(#{fromHsCd}) = 12 THEN #{fromHsCd}
                        ELSE RPAD(#{fromHsCd}, 11, '0')||'1'
                        END
                        FROM DUAL)                  /** Code SH12 du champ de début !== 시작범위HS12코드 ==! */
      , TO_HS12_CD   = (SELECT CASE WHEN LENGTH(#{toHsCd}) = 12 THEN #{toHsCd}
                        ELSE RPAD(#{toHsCd}, 12, '9')
                        END
                        FROM DUAL)                  /** Code SH12 du champ de fin !== 종료범위HS12코드 ==! */
      , APLY_PROR_RNK = #{aplyProrRnk}              /** Priorité De L'Application !== 적용우선순위 ==! */
      , LAST_CHPR_ID = #{lastChprId}                /** Id Du Modificateur Final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
    </trim>
    WHERE  DEL_YN = 'N'                             /** Suppression ON !== 삭제여부 ==! */
    AND  CLUS_SRNO = #{clusSrno}                    /** N° De Séquence De Champ !== 항목일련번호 ==! */
    AND  CSTM_CD = #{cstmCd}                        /** Code Du Bureau !== 세관코드 ==! */
    AND  DEPT_CD = #{deptCd}                        /** Code de service !== 부서코드 ==! */
    AND  AUDT_DEPT_CD = #{audtDeptCd}               /** Code de Section du contrôle !== 심사부서코드 ==! */
  </update>


  <!--
    Supprimer la Gérer les critères de cotation des inspecteurs !== 심사자배부기준관리 삭제 ==!
    (Song JunYoung)
    -->
  <update id="deleteClrAdorHnotBase" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo">
    /* deleteClrAdorHnotBase */
    UPDATE  TB_CLRI_ADOR_HNOT_BASE SET
        DEL_YN = 'Y'                                  /** Suppression ON !== 삭제여부 ==! */
      , LAST_CHPR_ID = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE  DEL_YN = 'N'                               /** Suppression ON !== 삭제여부 ==! */
    AND    CLUS_SRNO = #{clusSrno}                    /** N° De Séquence De Champ !== 항목일련번호 ==! */
    AND    CSTM_CD = #{cstmCd}                        /** Code Du Bureau !== 세관코드 ==! */
    AND    DEPT_CD = #{deptCd}                        /** Code de service !== 부서코드 ==! */
    AND    AUDT_DEPT_CD = #{audtDeptCd}               /** Code de Section du contrôle !== 심사부서코드 ==! */
  </update>

  <!--
   Consultation de la liste des inspecteurs !== 심사자 목록 조회 ==!
   (Song JunYoung)
   -->
  <select id="selectClrAdorInqtList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo" resultType="alpass.ipt.clr.com.vo.ClrItemInfVo">
    /* selectClrAdorInqtList */
    SELECT A.PBSR_NO AS ITEM,
           A.EMP_NM AS ITEM_NM,
           'false' AS ITEMLABEL
    FROM  TB_POTI_EMP A LEFT JOIN TB_POTI_ORGN B ON A.ORGN_MGMT_CD = B.ORGN_MGMT_CD
    WHERE A.DEL_YN = 'N'
    AND   B.DEL_YN = 'N'
    AND   A.PBSR_NO IN (
                        SELECT X.PBSR_NO
                        FROM (
                              SELECT TPE.PBSR_NO
                                   , ( SELECT ORGN_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD = TPE.CSTM_MGMT_CD ) AS CSTM_CD
                                   , ( SELECT ORGN_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD = TPE.DEPT_MGMT_CD ) AS DEPT_CD
                              FROM   TB_POTI_EMP TPE
                                   , VW_POTI_ROLE_UNFC TPEA
                                   , TB_POTI_ORGN TPO1
                                   , TB_POTI_ORGN TP02
                              WHERE  TPE.DEL_YN = 'N'
                              AND    TPO1.DEL_YN = 'N'
                              AND    TP02.DEL_YN = 'N'
                              AND    TPE.PBSR_NO = TPEA.PBSR_NO
                              AND    TPEA.ROLE_ID = 'CLR003' /* CLR003 DED 신고 심사자*/
                              AND    TPE.CSTM_MGMT_CD = TPO1.ORGN_MGMT_CD
                              AND    TPE.DEPT_MGMT_CD = TP02.ORGN_MGMT_CD
                             ) X
                        WHERE  X.CSTM_CD = #{cstmCd}
                        <if test="audtDeptCd == null or audtDeptCd == ''">
                            AND    X.DEPT_CD IN (SELECT AUDT_DEPT_CD FROM TB_CLRI_DCLR_AUDT_DEPT_MPNG_BRKD WHERE CSTM_CD = #{cstmCd})
                        </if>
                        <if test="audtDeptCd != null and audtDeptCd != ''">
                            AND    X.DEPT_CD = #{audtDeptCd}
                        </if>
                        )
<!--    AND B.ORGN_CD = #{audtDeptCd}-->
    UNION ALL
    SELECT B.PBSR_NO AS ITEM,
           B.EMP_NM AS ITEM_NM,
           'true' AS ITEMLABEL
    FROM   TB_CLRI_ADOR_BHNOT_AUDT_EMP A
         , TB_POTI_EMP B
    WHERE  A.DEL_YN = 'N'
    AND    A.AUDT_EMP_ID = B.PBSR_NO
    AND    A.CSTM_CD = #{cstmCd}
    AND    A.DEPT_CD = #{deptCd}
    <if test="audtDeptCd != null and audtDeptCd != ''">
      AND    A.AUDT_DEPT_CD = #{audtDeptCd}
    </if>
    AND    B.PBSR_NO NOT IN (
                             SELECT X.PBSR_NO
                             FROM (
                                   SELECT TPE.PBSR_NO
                                        , ( SELECT ORGN_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD = TPE.CSTM_MGMT_CD ) AS CSTM_CD
                                        , ( SELECT ORGN_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD = TPE.DEPT_MGMT_CD ) AS DEPT_CD
                                   FROM   TB_POTI_EMP TPE
                                        , VW_POTI_ROLE_UNFC TPEA
                                        , TB_POTI_ORGN TPO1
                                        , TB_POTI_ORGN TP02
                                   WHERE  TPE.DEL_YN = 'N'
                                   AND    TPO1.DEL_YN = 'N'
                                   AND    TP02.DEL_YN = 'N'
                                   AND    TPE.PBSR_NO = TPEA.PBSR_NO
                                   AND    TPEA.ROLE_ID = 'CLR003' /* CLR003 DED 신고 심사자*/
                                   AND    TPE.CSTM_MGMT_CD = TPO1.ORGN_MGMT_CD
                                   AND    TPE.DEPT_MGMT_CD = TP02.ORGN_MGMT_CD
                                   ) X
                             WHERE  X.CSTM_CD = #{cstmCd}
                             <if test="audtDeptCd == null or audtDeptCd == ''">
                                 AND    X.DEPT_CD IN (SELECT AUDT_DEPT_CD FROM TB_CLRI_DCLR_AUDT_DEPT_MPNG_BRKD WHERE CSTM_CD = #{cstmCd})
                             </if>
                             <if test="audtDeptCd != null and audtDeptCd != ''">
                                 AND    X.DEPT_CD = #{audtDeptCd}
                             </if>
                            )
  </select>

  <!--
    Consultation de la liste de type déclaration des critères de cotation des inspecteurs !== 심사자 배부 기준 신고유형 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrAdorBhnotDclrPtList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorBhnotDclrPtVo">
    /* selectClrAdorBhnotDclrPtList */
    SELECT A.CSTM_CD                    /** Code du bureau !== 세관코드 ==! */
         , A.DEPT_CD                    /** Code de section !== 부서코드 ==! */
         , A.AUDT_DEPT_CD               /** Code de Section du contrôle !== 심사부서코드 ==! */
         , A.CLUS_SRNO                  /** N° de séquence de champ !== 항목일련번호 ==! */
         , A.DCLR_PT_CD                 /** Code de type de déclaration !== 신고유형코드 ==! */
         , A.DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
         , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
         , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
         , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
         , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
    FROM   TB_CLRI_ADOR_BHNOT_DCLR_PT A
    WHERE  A.DEL_YN = 'N'
    AND    A.CSTM_CD = #{cstmCd}
    AND    A.DEPT_CD = #{deptCd}
    AND    A.AUDT_DEPT_CD = #{audtDeptCd}
    AND    A.CLUS_SRNO = #{clusSrno}
  </select>

  <!--
    Enregistrement de types de déclaration dans les critères de cotation de l'inspecteur !== 심사자 배부 기준 신고유형 등록 ==!
    (Song JunYoung)
    -->
  <insert id="insertClrAdorBhnotDclrPt" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorBhnotDclrPtVo">
    /* insertClrAdorBhnotDclrPt */
    WITH UPSERT AS (
    UPDATE TB_CLRI_ADOR_BHNOT_DCLR_PT
    SET DEL_YN         = 'N'
      , FRST_REGST_ID  = #{frstRegstId} /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM = SYSTIMESTAMP /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID   = #{lastChprId} /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM  = SYSTIMESTAMP /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE CSTM_CD = #{cstmCd} /** Code du bureau !== 세관코드 ==! */
      AND DEPT_CD = #{deptCd} /** Code de section !== 부서코드 ==! */
      AND AUDT_DEPT_CD = #{audtDeptCd} /** Code de Section du contrôle !== 심사부서코드 ==! */
      AND CLUS_SRNO = #{clusSrno} /** N° de séquence de champ !== 항목일련번호 ==! */
      AND DCLR_PT_CD = #{dclrPtCd} /** Code de type de déclaration !== 신고유형코드 ==! */
      RETURNING *
    )
    INSERT
    INTO TB_CLRI_ADOR_BHNOT_DCLR_PT
      (
        CSTM_CD /** Code du bureau !== 세관코드 ==! */
      , DEPT_CD /** Code de section !== 부서코드 ==! */
      , AUDT_DEPT_CD /** Code de Section du contrôle !== 심사부서코드 ==! */
      , CLUS_SRNO /** N° de séquence de champ !== 항목일련번호 ==! */
      , DCLR_PT_CD /** Code de type de déclaration !== 신고유형코드 ==! */
      , DEL_YN /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM /** Date et heure de modification finale !== 최종변경일시 ==! */
      )
    SELECT
        #{cstmCd} /** Code du bureau !== 세관코드 ==! */
      , #{deptCd} /** Code de section !== 부서코드 ==! */
      , #{audtDeptCd} /** Code de Section du contrôle !== 심사부서코드 ==! */
      , #{clusSrno} /** N° de séquence de champ !== 항목일련번호 ==! */
      , #{dclrPtCd} /** Code de type de déclaration !== 신고유형코드 ==! */
      , 'N' /** Suppression ON !== 삭제여부 ==! */
      , #{frstRegstId} /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , SYSTIMESTAMP /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , #{lastChprId} /** ID du modificateur final !== 최종변경자ID ==! */
      , SYSTIMESTAMP /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE NOT EXISTS(SELECT * FROM UPSERT)
  </insert>

  <!--
    Suppression de types de déclaration dans les critères de cotation de l'inspecteur !== 심사자 배부 기준 신고유형 삭제 ==!
    (Song JunYoung)
    -->
  <update id="deleteClrAdorBhnotDclrPt" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo">
    /* deleteClrAdorBhnotDclrPt */
    UPDATE TB_CLRI_ADOR_BHNOT_DCLR_PT
    SET DEL_YN = 'Y'                                  /** Suppression ON !== 삭제여부 ==! */
      , LAST_CHPR_ID = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE  DEL_YN = 'N'                               /** Suppression ON !== 삭제여부 ==! */
    AND    CSTM_CD = #{cstmCd}                        /** Code du bureau !== 세관코드 ==! */
    AND    DEPT_CD = #{deptCd}                        /** Code de section !== 부서코드 ==! */
    AND    AUDT_DEPT_CD = #{audtDeptCd}               /** Code de Section du contrôle !== 심사부서코드 ==! */
    AND    CLUS_SRNO = #{clusSrno}                    /** N° de séquence de champ !== 항목일련번호 ==! */
  </update>

  <!--
    Voir les Liste d'entreprises de les critères de cotation des inspecteurs !== 심사자 배부 기준 업체 목록 조회 ==!
    -->
  <select id="selectClrAdorBhnotCoList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorBhnotCoVo">
    /* ClrAdorHnotMgmtMapper.selectClrAdorBhnotCoList */
    SELECT 'false' AS chkSel
         , ROW_NUMBER() OVER() AS rnum
         , A.CSTM_CD /** Code du bureau !== 세관코드 ==! */
         , A.DEPT_CD /** Code de section !== 부서코드 ==! */
         , A.AUDT_DEPT_CD /** Code de Section du contrôle !== 심사부서코드 ==! */
         , A.CLUS_SRNO /** N° de séquence de champ !== 항목일련번호 ==! */
         , A.NIF /** N° de registre de commerce !== 사업자등록번호 ==! */
         , decode(C.CO_NM, null, B.CO_NM, C.CO_NM) AS CO_NM /** Nom de l'entreprise !== 업체명 ==! */
      FROM TB_CLRI_ADOR_BHNOT_CO A
         , TB_POTE_NIF B
         , TB_COM_CO C
     WHERE A.DEL_YN = 'N'
       AND A.CSTM_CD = #{cstmCd}
       AND A.DEPT_CD = #{deptCd}
       AND A.AUDT_DEPT_CD = #{audtDeptCd}
       AND A.CLUS_SRNO = #{clusSrno}
       AND A.NIF = B.NIF
       AND B.NIF = C.NIF(+)
  </select>

    <!--
      Enregistrement les Liste d'entreprises de les critères de cotation des inspecteurs !== 심사자 배부 기준 업체 등록 ==!
      -->
    <insert id="insertClrAdorBhnotCo" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorBhnotCoVo">
      /* ClrAdorHnotMgmtMapper.insertClrAdorBhnotCo */
      INSERT
        INTO TB_CLRI_ADOR_BHNOT_CO
           (
             CSTM_CD /** Code du bureau !== 세관코드 ==! */
           , DEPT_CD /** Code de section !== 부서코드 ==! */
           , AUDT_DEPT_CD /** Code de Section du contrôle !== 심사부서코드 ==! */
           , CLUS_SRNO /** N° de séquence de champ !== 항목일련번호 ==! */
           , NIF /** N° de registre de commerce !== 사업자등록번호 ==! */
           , DEL_YN /** Suppression ON !== 삭제여부 ==! */
           , FRST_REGST_ID /** ID du premier enregistrant  !== 최초등록자ID ==! */
           , FRST_RGSR_DTTM /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
           , LAST_CHPR_ID /** ID du modificateur final !== 최종변경자ID ==! */
           , LAST_CHG_DTTM /** Date et heure de modification finale !== 최종변경일시 ==! */
           )
      VALUES
           (
             #{cstmCd} /** Code du bureau !== 세관코드 ==! */
           , #{deptCd} /** Code de section !== 부서코드 ==! */
           , #{audtDeptCd} /** Code de Section du contrôle !== 심사부서코드 ==! */
           , #{clusSrno} /** N° de séquence de champ !== 항목일련번호 ==! */
           , #{nif} /** N° de registre de commerce !== 사업자등록번호 ==! */
           , 'N' /** Suppression ON !== 삭제여부 ==! */
           , #{frstRegstId} /** ID du premier enregistrant  !== 최초등록자ID ==! */
           , SYSTIMESTAMP /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
           , #{lastChprId} /** ID du modificateur final !== 최종변경자ID ==! */
           , SYSTIMESTAMP /** Date et heure de modification finale !== 최종변경일시 ==! */
           )
          ON CONFLICT ON CONSTRAINT TB_CLRI_ADOR_BHNOT_CO_PK
          DO UPDATE
         SET DEL_YN = 'N' /** Suppression ON !== 삭제여부 ==! */
           , FRST_REGST_ID = #{frstRegstId} /** ID du premier enregistrant  !== 최초등록자ID ==! */
           , FRST_RGSR_DTTM = SYSTIMESTAMP /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
           , LAST_CHPR_ID = #{lastChprId} /** ID du modificateur final !== 최종변경자ID ==! */
           , LAST_CHG_DTTM = SYSTIMESTAMP /** Date et heure de modification finale !== 최종변경일시 ==! */
    </insert>

    <!--
      Supprimer les Liste d'entreprises de les critères de cotation des inspecteurs !== 심사자 배부 기준 업체 삭제 ==!
      -->
    <update id="deleteClrAdorBhnotCo" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo">
        /* ClrAdorHnotMgmtMapper.deleteClrAdorBhnotCo */
        UPDATE TB_CLRI_ADOR_BHNOT_CO
           SET DEL_YN = 'Y'                    /** Suppression ON !== 삭제여부 ==! */
             , LAST_CHPR_ID = #{lastChprId}    /** ID du modificateur final !== 최종변경자ID ==! */
             , LAST_CHG_DTTM = SYSTIMESTAMP    /** Date et heure de modification finale !== 최종변경일시 ==! */
         WHERE DEL_YN = 'N'                    /** Suppression ON !== 삭제여부 ==! */
           AND CSTM_CD = #{cstmCd}             /** Code du bureau !== 세관코드 ==! */
           AND DEPT_CD = #{deptCd}             /** Code de section !== 부서코드 ==! */
           AND AUDT_DEPT_CD = #{audtDeptCd}    /** Code de Section du contrôle !== 심사부서코드 ==! */
           AND CLUS_SRNO = #{clusSrno}         /** N° de séquence de champ !== 항목일련번호 ==! */
    </update>

  <!--
    Consultation de la liste des inspecteurs des critères de cotation des inspecteurs !== 심사자 배부 기준 심사직원 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrAdorBhnotAudtEmpList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotBaseVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorBhnotAudtEmpVo">
    /* selectClrAdorBhnotAudtEmpList */
    SELECT A.CSTM_CD                    /** Code du bureau !== 세관코드 ==! */
         , A.DEPT_CD                    /** Code de section !== 부서코드 ==! */
         , A.AUDT_DEPT_CD               /** Code de Section du contrôle !== 심사부서코드 ==! */
         , A.CLUS_SRNO                  /** N° de séquence de champ !== 항목일련번호 ==! */
         , A.AUDT_EMP_ID                /** ID de la personne vérifiant !== 심사직원ID ==! */
         , A.DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
         , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
         , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
         , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
         , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
    FROM   TB_CLRI_ADOR_BHNOT_AUDT_EMP A
    WHERE  A.DEL_YN = 'N'
    AND    A.CSTM_CD = #{cstmCd}
    AND    A.DEPT_CD = #{deptCd}
    AND    A.AUDT_DEPT_CD = #{audtDeptCd}
    AND    A.CLUS_SRNO = #{clusSrno}
    AND    A.AUDT_EMP_ID IN (
                             SELECT X.PBSR_NO
                             FROM (
                                   SELECT TPE.PBSR_NO
                                     , ( SELECT ORGN_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD = TPE.CSTM_MGMT_CD ) AS CSTM_CD
                                     , ( SELECT ORGN_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD = TPE.DEPT_MGMT_CD ) AS DEPT_CD
                                     FROM   TB_POTI_EMP TPE
                                     , VW_POTI_ROLE_UNFC TPEA
                                     , TB_POTI_ORGN TPO1
                                     , TB_POTI_ORGN TP02
                                   WHERE  TPE.DEL_YN = 'N'
                                   AND    TPO1.DEL_YN = 'N'
                                   AND    TP02.DEL_YN = 'N'
                                   AND    TPE.PBSR_NO = TPEA.PBSR_NO
                                   AND    TPEA.ROLE_ID = 'CLR003' /* CLR003 DED 신고 심사자*/
                                   AND    TPE.CSTM_MGMT_CD = TPO1.ORGN_MGMT_CD
                                   AND    TPE.DEPT_MGMT_CD = TP02.ORGN_MGMT_CD
                                   ) X
                             WHERE  X.CSTM_CD = #{cstmCd}
<!--                             AND    X.DEPT_CD = #{deptCd}-->
                             AND    X.DEPT_CD = #{audtDeptCd}       /* 심사부서 컬럼 추가후 윗줄 삭제 후 주석 해제 필요*/
                           )
  </select>

  <!--
    Enresgirement des inspecteurs des critères de cotation des inspecteurs !== 심사자 배부 기준 심사직원 등록 ==!
    (Song JunYoung)
    -->
  <insert id="insertClrAdorBhnotAudtEmp" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorBhnotAudtEmpVo">
    /* insertClrAdorBhnotAudtEmp */
    WITH UPSERT AS (
    UPDATE TB_CLRI_ADOR_BHNOT_AUDT_EMP
    SET DEL_YN         = 'N' /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID  = #{frstRegstId} /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM = SYSTIMESTAMP /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID   = #{lastChprId} /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM  = SYSTIMESTAMP /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE CSTM_CD = #{cstmCd} /** Code du bureau !== 세관코드 ==! */
      AND DEPT_CD = #{deptCd} /** Code de section !== 부서코드 ==! */
      AND AUDT_DEPT_CD = #{audtDeptCd} /** Code de Section du contrôle !== 심사부서코드 ==! */
      AND CLUS_SRNO = #{clusSrno} /** N° de séquence de champ !== 항목일련번호 ==! */
      AND AUDT_EMP_ID = #{audtEmpId} /** ID de la personne vérifiant !== 심사직원ID ==! */
      RETURNING *
      )
    INSERT
    INTO TB_CLRI_ADOR_BHNOT_AUDT_EMP
      (
       CSTM_CD /** Code du bureau !== 세관코드 ==! */
      , DEPT_CD /** Code de section !== 부서코드 ==! */
      , AUDT_DEPT_CD /** Code de Section du contrôle !== 심사부서코드 ==! */
      , CLUS_SRNO /** N° de séquence de champ !== 항목일련번호 ==! */
      , AUDT_EMP_ID /** ID de la personne vérifiant !== 심사직원ID ==! */
      , DEL_YN /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM /** Date et heure de modification finale !== 최종변경일시 ==! */
      )
    SELECT
        #{cstmCd} /** Code du bureau !== 세관코드 ==! */
      , #{deptCd} /** Code de section !== 부서코드 ==! */
      , #{audtDeptCd} /** Code de Section du contrôle !== 심사부서코드 ==! */
      , #{clusSrno} /** N° de séquence de champ !== 항목일련번호 ==! */
      , #{audtEmpId} /** ID de la personne vérifiant !== 심사직원ID ==! */
      , 'N' /** Suppression ON !== 삭제여부 ==! */
      , #{frstRegstId} /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , SYSTIMESTAMP /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , #{lastChprId} /** ID du modificateur final !== 최종변경자ID ==! */
      , SYSTIMESTAMP /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE NOT EXISTS(SELECT * FROM UPSERT)
  </insert>

  <!--
    Suppression des inspecteurs des critères de cotation des inspecteurs !== 심사자 배부 기준 심사직원 삭제 ==!
    (Song JunYoung)
    -->
  <update id="deleteClrAdorBhnotAudtEmp" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorBhnotAudtEmpVo">
    /* deleteClrAdorBhnotAudtEmp */
    UPDATE TB_CLRI_ADOR_BHNOT_AUDT_EMP
    SET DEL_YN = 'Y'                                  /** Suppression ON !== 삭제여부 ==! */
      , LAST_CHPR_ID = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE  DEL_YN = 'N'                               /** Suppression ON !== 삭제여부 ==! */
    AND    CSTM_CD = #{cstmCd}                        /** Code du bureau !== 세관코드 ==! */
    AND    DEPT_CD = #{deptCd}                        /** Code de section !== 부서코드 ==! */
    AND    AUDT_DEPT_CD = #{audtDeptCd}               /** Code de Section du contrôle !== 심사부서코드 ==! */
    AND    CLUS_SRNO = #{clusSrno}                    /** N° de séquence de champ !== 항목일련번호 ==! */
  </update>

  <!--
    Consultation de la liste des inspecteurs non cotées !==심사자 미배부 목록조회==!
    (Song JunYoung)
    -->
  <select id="selectClrAdorNhnotList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo">
    /*selectClrAdorNhnotList*/
    <include refid="pagination.header" ></include>
    SELECT A.DTL_DCSH_NO                /** Numéro du DAU !== DED번호 ==! */
         , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT  /** Date de DAU !== DED일자 ==! */
         , A.DCLR_PT_CD                 /** Code de type de declaration !== 신고유형코드 ==! */
         , A.DCLR_CSTM_CD AS CSTM_CD    /** Code de bureau de declaration !== 신고세관코드 ==! */
         , A.DEPT_CD
         , A.AUDT_DEPT_CD               /** Code de Section du contrôle !== 심사부서코드 ==! */
         , A.AUDT_EMP_ID
         , A.INSC_EMP_ID
         , A.PRCS_STTS_CD
         , A.CSCL_PLN_CD                /** Code de plan de dedouanement !== 통관계획코드 ==! */
         , A.EXPPN_IDFY_NO_TP_CD        /** Code de type du N° d'identification de l'exportateur !== 수출자식별번호구분코드 ==! */
         , A.EXPPN_IDFY_NO              /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
         , A.IMPPN_IDFY_NO_TP_CD        /** Code de type du N° d'identification de l'importateur !== 수입자식별번호구분코드 ==! */
         , A.IMPPN_IDFY_NO              /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
         , A.DCER_CD                    /** Code du declarant !== 신고인코드 ==! */
         , A.DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
         , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
         , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
         , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
         , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
         , A.SELC_RSLT_CD
         , ( CASE WHEN A.EXPPN_IDFY_NO_TP_CD = 'T' THEN ( SELECT DECODE(BX.CO_NM, NULL, TX.CO_NM, BX.CO_NM) AS CO_NM
                                                              FROM   TB_POTE_NIF TX, TB_COM_CO BX
                                                              WHERE  TX.NIF = BX.NIF(+)
                                                              AND    TX.NIF = A.EXPPN_IDFY_NO
                                                              AND    TX.DEL_YN = 'N'
                                                              AND    BX.DEL_YN(+) = 'N'
                                                              AND    TX.NIF_STTS_CD != '0' )
                  WHEN A.EXPPN_IDFY_NO_TP_CD = 'F' THEN ( SELECT OVRS_BUCN_CO_NM
                                                          FROM   TB_COM_OVBC
                                                          WHERE  OVRS_BUCN_CD = A.EXPPN_IDFY_NO
                                                        )
             END) AS EXPPN_NM
         , ( CASE WHEN A.IMPPN_IDFY_NO_TP_CD = 'T' THEN ( SELECT DECODE(BX.CO_NM, NULL, TX.CO_NM, BX.CO_NM) AS CO_NM
                                                              FROM   TB_POTE_NIF TX, TB_COM_CO BX
                                                              WHERE  TX.NIF = BX.NIF(+)
                                                              AND    TX.NIF = A.IMPPN_IDFY_NO
                                                              AND    TX.DEL_YN = 'N'
                                                              AND    BX.DEL_YN(+) = 'N'
                                                              AND    TX.NIF_STTS_CD != '0' )
                  WHEN A.IMPPN_IDFY_NO_TP_CD = 'F' THEN ( SELECT OVRS_BUCN_CO_NM
                                                          FROM   TB_COM_OVBC
                                                          WHERE  OVRS_BUCN_CD = A.IMPPN_IDFY_NO
                                                        )
              END) AS IMPPN_NM
         , (SELECT DCER_CO_NM FROM TB_CLRI_DED_CO WHERE DTL_DCSH_NO = A.DTL_DCSH_NO) AS DCER_NM
         , (SELECT A.DCLR_CSTM_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.DCLR_CSTM_CD AND ROWNUM=1)  AS CSTM_NM
         , (SELECT A.DEPT_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.DEPT_CD AND ROWNUM=1) AS DEPT_NM
         , (SELECT A.INSC_EMP_ID||' | '||EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.INSC_EMP_ID ) AS INSC_EMP_NM
         , (SELECT A.AUDT_EMP_ID||' | '||EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.AUDT_EMP_ID ) AS AUDT_EMP_NM
         , (SELECT A.AUDT_DEPT_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.AUDT_DEPT_CD AND ROWNUM=1) AS AUDT_DEPT_NM
         , (SELECT 'Y'
            FROM   TB_POTI_ORGN TPO
                 , TB_POTI_ORGN TPO2
            WHERE  TPO.DEL_YN = 'N'
            AND    TPO2.DEL_YN = 'N'
            AND    TPO.UPR_ORGN_MGMT_CD = TPO2.ORGN_MGMT_CD
            AND    TPO2.ORGN_TP_CD = 'INS' /* 사후심사세관 */
            AND    TPO2.ORGN_CD = A.DCLR_CSTM_CD
            AND    TPO.ORGN_CD = A.DEPT_CD ) AS AFFC_AUDT_YN
         , DECODE (NVL(A.DPHD_APRV_RSOF_YN, NULL), NULL, 'N', A.DPHD_APRV_RSOF_YN) AS DPHD_APRV_RSOF_YN
    FROM   TB_CLRI_DED_COMN A
    WHERE  A.DEL_YN = 'N'
    AND    (     A.PRCS_STTS_CD IN ('B01', 'C02',  'F01', 'G01') /* 20181030 세관 부서 분리로 변경 B04 부서배부 */
         AND (
                     ( A.ADOR_HNOT_PRCS_YN = 'Y' AND A.AUDT_EMP_ID IS NULL ) /* 1 배치 수행 후 심사자 미배부된 경우 */
                  /*OR (
                          A.AUDT_EMP_ID IS NULL    /* 2 심사자배부방법이 S (지시사항배부)인 경우 배치에서 심사자 배부 패스됨 */
                      AND EXISTS ( SELECT HNOT_MEAN_CD
                                   FROM   TB_CLRI_ADOR_HNOT_MEAN_BSCS
                                   WHERE  CSTM_CD = A.DCLR_CSTM_CD
                     AND    DEPT_CD = A.DEPT_CD
                                   AND    DCLR_PT_CD = A.DCLR_PT_CD
                                   AND    HNOT_MEAN_CD = 'S' )
                     )*/
                 )
           )

    <if test="cstmCd != null and cstmCd != ''">
    AND    A.DCLR_CSTM_CD = #{cstmCd}
    </if>
    <if test="deptCd != null and deptCd != ''">
    AND    A.DEPT_CD = #{deptCd}
    </if>
    <if test="audtDeptCd != null and audtDeptCd != ''">
    AND    AUDT_DEPT_CD = #{audtDeptCd}
    </if>
    <if test="dtlDcshNo != null and dtlDcshNo != ''">
    AND    A.DTL_DCSH_NO = #{dtlDcshNo}
    </if>
    <if test="rqstDtFrom != null and rqstDtFrom != ''">
    AND	   A.DCLR_DT <![CDATA[ >= ]]> TO_CHAR(TO_DATE(#{rqstDtFrom},'DD/MM/YYYY'), 'YYYYMMDD')
    AND	   A.DCLR_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE(#{rqstDtTo},'DD/MM/YYYY'), 'YYYYMMDD')
    </if>
    ORDER BY A.DCLR_DT DESC, A.DTL_DCSH_NO
    <include refid="pagination.footer" ></include>
  </select>

  <!--
	Consultation des inspecteurs faisant objet de la cotation séquentielle !== 순차 배부 심사자 대상 조회 ==!
	(Song JunYoung)
	-->
  <select id="selectAdorBySeqHnot" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotInfoVo">
    /* selectAdorBySeqHnot */
    with vw_ador_list as (
        select s2.cstm_cd
             , s1.dept_cd
             , s2.audt_dept_cd
             , s2.audt_emp_id
             , count(*) over() as ador_tgcnt
          from tb_clri_ded_comn s1
             , ( select (select orgn_cd
                           from tb_poti_orgn
                          where del_yn = 'N'
                            and orgn_tp_cd = 'INS'  /**지역관할세관*/
                            and rownum = 1
                          start with orgn_mgmt_cd = p2.orgn_mgmt_cd
                        connect by prior upr_orgn_mgmt_cd = orgn_mgmt_cd) as cstm_cd
                      , (select orgn_cd
                           from tb_poti_orgn
                          where del_yn = 'N'
                            and orgn_tp_cd = 'INP'  /**수석심사실*/
                            and rownum = 1
                          start with orgn_mgmt_cd = p2.orgn_mgmt_cd
                        connect by prior upr_orgn_mgmt_cd = orgn_mgmt_cd) as audt_dept_cd
                      , p2.pbsr_no as audt_emp_id
                   from vw_poti_role_unfc p1
                      , tb_poti_emp p2
                  where p1.role_id = 'CLR003'  /**DED신고서심사자 권한*/
                    and p1.pbsr_no = p2.pbsr_no
                    and p2.del_yn = 'N'
                      and fn_get_emp_bwrk_stts(p2.pbsr_no,'Y') = 'TRUE'   /** 부재중건이 없으면 근무중 상태로 봄 */
               ) s2
         where s1.dtl_dcsh_no = #{dtlDcshNo}
          <if test="audtEmpId != null and audtEmpId != ''">
           and s2.audt_emp_id != #{audtEmpId}
          </if>
           and s1.dclr_cstm_cd = s2.cstm_cd
           and exists(select 1
                        from tb_clri_dclr_audt_dept_mpng_brkd
                       where del_yn = 'N'
                         and cstm_cd = s1.dclr_cstm_cd
                         and dept_cd = s1.dept_cd
                         and audt_dept_cd = s2.audt_dept_cd)
        <if test='hldyYn != null and hldyYn.equals("Y")'>
          and case when nvl((select prmt_val_cn
                           from tb_com_prmt
                          where prmt_id = 'CLR_0018'  /** Application O/N des agents permanenciers lors !==당직자적용여부==! */
                            and #{prcsDt} between aply_strt_dt and aply_end_dt),'N') = 'Y'
                   then exists(select 1
                                 from tb_poti_wtchr  /** 당직자관리 */
                                where del_yn = 'N'
                                  and papo_strt_dttm <![CDATA[ < ]]> to_date(#{prcsDt},'yyyymmdd') + 1
                                  and papo_end_dttm <![CDATA[ >= ]]> to_date(#{prcsDt},'yyyymmdd')
                                  and pbsr_no = s2.audt_emp_id)
                   else true
              end
        </if>
    )
    select f1.audt_dept_cd
         , f1.audt_emp_id
           /** 전체 배부 건수가 심사자수보다 크면 당일 배부 건수로, 작으면 전체 배부 건수로 균등 배부 */
         , case when sum(f1.hnot_gcnt) over() <![CDATA[ > ]]> f1.ador_tgcnt then f1.tday_hnot_gcnt else f1.hnot_gcnt end as hnot_gcnt
         , round(dbms_random.value() * 1000) + 1 as random_num
      from (
           select m.audt_dept_cd
                , m.audt_emp_id
                , max(m.ador_tgcnt) as ador_tgcnt
                , nvl(sum(n.hnot_gcnt),0) as hnot_gcnt
                , nvl(sum(n.tday_hnot_gcnt),0) as tday_hnot_gcnt
            from vw_ador_list m
               , (
                 select t1.audt_dept_cd
                      , t1.audt_emp_id
                      , t2.hnot_gcnt
                      , case when t2.hnot_dt = #{prcsDt} then t2.hnot_gcnt else 0 end as tday_hnot_gcnt
                      , t2.hnot_dt
                      , dense_rank() over(order by t2.hnot_dt desc) as rnk
                   from vw_ador_list t1
                      , tb_clri_ador_hnot_stats_bscs t2
                  where t1.cstm_cd = t2.cstm_cd
                    and t1.dept_cd = t2.dept_cd
                    and t1.audt_dept_cd = t2.audt_dept_cd
                    and t1.audt_emp_id = t2.audt_emp_id
                    and t2.ador_ispr_tp_cd = 'A'  /** 심사자검사자구분코드:심사자 */
                    and t2.hnot_dt <![CDATA[ <= ]]> #{prcsDt}  /** 배부이전일자에서만 조회 */
                    and t2.del_yn = 'N'
           ) n
           where m.audt_dept_cd = n.audt_dept_cd(+)
             and m.audt_emp_id = n.audt_emp_id(+)
             and m.ador_tgcnt <![CDATA[ >= ]]> n.rnk(+)  /** 심사자수 만큼 이전 날짜만 합산 */
           group
              by m.audt_dept_cd
               , m.audt_emp_id
         ) f1
   order
      by hnot_gcnt, random_num
   limit 1
  </select>

  <!--
    Cotation de la déclaration non cotée aux inspecteurs !== 심사자 미배부 신고서 배부 ==!
    (Song JunYoung)
    -->
  <update id="updateClrAdorHnot" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedComnVo">
    /*updateClrAdorHnot*/
    UPDATE TB_CLRI_DED_COMN
    SET
        AUDT_EMP_ID = #{audtEmpId}
      , AUDT_DEPT_CD = #{audtDeptCd}
      , ADOR_HNOT_OPIN_CN = #{adorHnotOpinCn}
      <if test="inscEmpId != null and inscEmpId != ''">
        , INSC_EMP_ID    = #{inscEmpId}
      </if>
      <if test="prcsSttsCd != null and prcsSttsCd != ''">
        , PRCS_STTS_CD   = #{prcsSttsCd}
      </if>
      , DPHD_APRV_RSOF_YN = #{dphdAprvRsofYn}
      , LAST_CHPR_ID   = #{lastChprId}
      , LAST_CHG_DTTM  = SYSTIMESTAMP
    WHERE  DEL_YN = 'N'
    AND    DTL_DCSH_NO = #{dtlDcshNo}
  </update>

  <!--
    Mise à jour du nombre de la cotation !== 배부 건수 업데이트 ==!
    -->
  <update id="updateClrAdorHnotCnt" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotStatsBscsVo">
    /* updateClrAdorHnotCnt */
    WITH UPSERT AS (
      UPDATE TB_CLRI_ADOR_HNOT_STATS_BSCS
      SET
          HNOT_GCNT = HNOT_GCNT + 1                   /** Nombre d'affectations !== 배부개수 ==! */
        , LAST_CHPR_ID = #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
        , LAST_CHG_DTTM = SYSTIMESTAMP                /** Date et heure de modification finale !== 최종변경일시 ==! */
      WHERE
            CSTM_CD = #{cstmCd}                       /** Code du bureau !== 세관코드 ==! */
        AND DEPT_CD = #{deptCd}                       /** Code de section !== 부서코드 ==! */
        AND AUDT_DEPT_CD = #{audtDeptCd}              /** Code de Section du contrôle !== 심사부서코드 ==! */
        AND AUDT_EMP_ID = #{audtEmpId}                /** ID de la personne vérifiant !== 심사직원ID ==! */
        AND HNOT_DT = #{hnotDt}                       /** Date de cotation !== 배부일자 ==! */
        RETURNING *
    )
    INSERT INTO TB_CLRI_ADOR_HNOT_STATS_BSCS
    (
        CSTM_CD                      /** Code du bureau !== 세관코드 ==! */
      , DEPT_CD                      /** Code de section !== 부서코드 ==! */
      , AUDT_DEPT_CD                 /** Code de Section du contrôle !== 심사부서코드 ==! */
      , ADOR_ISPR_TP_CD              /** Code de division inpsecteur/vérificateur !== 심사자검사자구분코드 ==! */
      , AUDT_EMP_ID                  /** ID de la personne vérifiant !== 심사직원ID ==! */
      , HNOT_DT                      /** Date de cotation !== 배부일자 ==! */
      , HNOT_GCNT                    /** Nombre d'affectations !== 배부개수 ==! */
      , DEL_YN                       /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID                /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM               /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID                 /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM                /** Date et heure de modification finale !== 최종변경일시 ==! */
      )
    SELECT
        #{cstmCd}                    /** Code du bureau !== 세관코드 ==! */
      , #{deptCd}                    /** Code de section !== 부서코드 ==! */
      , #{audtDeptCd}                /** Code de Section du contrôle !== 심사부서코드 ==! */
      , #{adorIsprTpCd}              /** Code de division inpsecteur/vérificateur !== 심사자검사자구분코드 ==! */
      , #{audtEmpId}                 /** ID de la personne vérifiant !== 심사직원ID ==! */
      , #{hnotDt}                    /** Date de cotation !== 배부일자 ==! */
      , 1                            /** Nombre d'affectations !== 배부개수 ==! */
      , 'N'                          /** Suppression ON !== 삭제여부 ==! */
      , #{frstRegstId}               /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE
      NOT EXISTS(SELECT * FROM UPSERT)
  </update>

  <!--
    Consultation de la liste des enregistrement de la modification des inspecteurs !==심사자 변경등록 목록조회==!
    (Song JunYoung)
    -->
  <select id="selectClrAdorChgList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo">
    /*selectClrAdorChgList*/
    <include refid="pagination.header" ></include>
    SELECT A.DTL_DCSH_NO                /** Numéro du DAU !== DED번호 ==! */
         , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT  /** Date de DAU !== DED일자 ==! */
         , A.DCLR_PT_CD                 /** Code de type de declaration !== 신고유형코드 ==! */
         , A.DCLR_CSTM_CD AS CSTM_CD    /** Code de bureau de declaration !== 신고세관코드 ==! */
         , A.DEPT_CD
         , A.AUDT_DEPT_CD               /** Code de Section du contrôle !== 심사부서코드 ==! */
         , A.AUDT_EMP_ID
         , A.INSC_EMP_ID
         , A.PRCS_STTS_CD
         , A.CSCL_PLN_CD                /** Code de plan de dedouanement !== 통관계획코드 ==! */
         , A.EXPPN_IDFY_NO_TP_CD        /** Code de type du N° d'identification de l'exportateur !== 수출자식별번호구분코드 ==! */
         , A.EXPPN_IDFY_NO              /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
         , A.IMPPN_IDFY_NO_TP_CD        /** Code de type du N° d'identification de l'importateur !== 수입자식별번호구분코드 ==! */
         , A.IMPPN_IDFY_NO              /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
         , A.DCER_CD                    /** Code du declarant !== 신고인코드 ==! */
         , A.DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
         , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
         , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
         , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
         , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
         , A.SELC_RSLT_CD
         , ( CASE WHEN A.EXPPN_IDFY_NO_TP_CD = 'T' THEN ( SELECT DECODE(BX.CO_NM, NULL, TX.CO_NM, BX.CO_NM) AS CO_NM
                                                              FROM   TB_POTE_NIF TX, TB_COM_CO BX
                                                              WHERE  TX.NIF = BX.NIF(+)
                                                              AND    TX.NIF = A.EXPPN_IDFY_NO
                                                              AND    TX.DEL_YN = 'N'
                                                              AND    BX.DEL_YN(+) = 'N'
                                                              AND    TX.NIF_STTS_CD != '0' )
                  WHEN A.EXPPN_IDFY_NO_TP_CD = 'F' THEN ( SELECT OVRS_BUCN_CO_NM
                                                          FROM   TB_COM_OVBC
                                                          WHERE  OVRS_BUCN_CD = A.EXPPN_IDFY_NO
                                                        )
             END) AS EXPPN_NM
         , ( CASE WHEN A.IMPPN_IDFY_NO_TP_CD = 'T' THEN ( SELECT DECODE(BX.CO_NM, NULL, TX.CO_NM, BX.CO_NM) AS CO_NM
                                                              FROM   TB_POTE_NIF TX, TB_COM_CO BX
                                                              WHERE  TX.NIF = BX.NIF(+)
                                                              AND    TX.NIF = A.IMPPN_IDFY_NO
                                                              AND    TX.DEL_YN = 'N'
                                                              AND    BX.DEL_YN(+) = 'N'
                                                              AND    TX.NIF_STTS_CD != '0' )
                  WHEN A.IMPPN_IDFY_NO_TP_CD = 'F' THEN ( SELECT OVRS_BUCN_CO_NM
                                                          FROM   TB_COM_OVBC
                                                          WHERE  OVRS_BUCN_CD = A.IMPPN_IDFY_NO
                                                        )
              END) AS IMPPN_NM
         , (SELECT DCER_CO_NM FROM TB_CLRI_DED_CO WHERE DTL_DCSH_NO = A.DTL_DCSH_NO) AS DCER_NM
         , (SELECT A.DCLR_CSTM_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.DCLR_CSTM_CD AND ROWNUM=1) AS CSTM_NM
         , (SELECT A.DEPT_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.DEPT_CD AND ROWNUM=1) AS DEPT_NM
         , (SELECT A.INSC_EMP_ID||' | '||EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.INSC_EMP_ID ) AS INSC_EMP_NM
         , (SELECT A.AUDT_EMP_ID||' | '||EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.AUDT_EMP_ID ) AS AUDT_EMP_NM
         , (SELECT A.AUDT_DEPT_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.AUDT_DEPT_CD AND ROWNUM=1) AS AUDT_DEPT_NM
         , (SELECT 'Y'
            FROM   TB_POTI_ORGN TPO
                 , TB_POTI_ORGN TPO2
            WHERE  A.DEL_YN = 'N'
            AND    TPO2.DEL_YN = 'N'
            AND    TPO.UPR_ORGN_MGMT_CD = TPO2.ORGN_MGMT_CD
            AND    TPO2.ORGN_TP_CD = 'INS'  /* 사후심사 세관 */
            AND    TPO2.ORGN_CD = A.DCLR_CSTM_CD
            AND    TPO.ORGN_CD = A.DEPT_CD ) AS AFFC_AUDT_YN
    FROM   TB_CLRI_DED_COMN A
         , TB_POTI_EMP B
    WHERE  A.DEL_YN = 'N'
    AND    A.AUDT_EMP_ID = B.PBSR_NO
    AND (FN_GET_EMP_BWRK_STTS(B.PBSR_NO,'Y') = 'FALSE' /* 직원근무상태가 근무중이 아닌 경우만 심사자 배부 변경 대상 */
      OR B.ORGN_MGMT_CD NOT IN (SELECT ORGN_MGMT_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD IN ( SELECT UNNEST(STRING_TO_ARRAY(ACTV_CSTM_CD,'|')) FROM TB_POTI_ORGN WHERE ORGN_CD = A.DEPT_CD AND ORGN_TP_CD = 'BUD' ))) /* 직원이 근무지를 이동한경우 */
    AND    A.PRCS_STTS_CD IN ('D01', 'D02', 'D03', 'D04', 'E02', 'F01', 'F02', 'F03', 'G01', 'G02', 'D07') /* D01접수 D02심사중 D03평가 D04수리 E02검사완료 F01정정접수 F02정정거절 G01취소접수 G02취소거절 F03 정정완료 */
    <if test="cstmCd != null and cstmCd != ''">
    AND    A.DCLR_CSTM_CD = #{cstmCd}
    </if>
    <if test="deptCd != null and deptCd != ''">
    AND    A.DEPT_CD = #{deptCd}
    </if>
    <if test="audtDeptCd != null and audtDeptCd != ''">
    AND    A.AUDT_DEPT_CD = #{audtDeptCd}
    </if>
    <choose>
        <when test="dtlDcshNo != null and dtlDcshNo != ''">
            AND A.DTL_DCSH_NO = #{dtlDcshNo}
        </when>
        <otherwise>
            <if test="rqstDtFrom != null and rqstDtFrom != ''">
                AND	   A.DCLR_DT <![CDATA[ >= ]]> TO_CHAR(TO_DATE(#{rqstDtFrom},'DD/MM/YYYY'), 'YYYYMMDD')
                AND	   A.DCLR_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE(#{rqstDtTo},'DD/MM/YYYY'), 'YYYYMMDD')
            </if>
        </otherwise>
    </choose>
    /*  AND    NOT (A.SELC_RSLT_CD = 'G' AND A.MDFY_DGCNT = 0) 선별결과 G 이면 자동수리로 심사자 없으나 정정은 심사자 지정함 20181205 주석처리함 반출전 취소한 경우 심사자를 지정할 수 있음*/
    ORDER BY A.DCLR_DT DESC, A.DTL_DCSH_NO
    <include refid="pagination.footer" ></include>
  </select>


  <!--
   Enregistrement de la modification de la cotation des inspecteurs !== 심사자 배부 변경 등록 ==!
   (Song JunYoung)
   -->
  <insert id="insertClrAdorChgBrkd" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorChgBrkdVo">
    /* insertClrAdorChgBrkd */
    INSERT INTO TB_CLRI_ADOR_CHG_BRKD
      (
        DTL_DCSH_NO                  /** Numéro du DAU !== DED번호 ==! */
      , CHG_SRNO                     /** N° de modification !== 변경일련번호 ==! */
      , ADOR_ISPR_TP_CD              /** Code de division inpsecteur/vérificateur !== 심사자검사자구분코드 ==! */
      , BFCH_AUDT_EMP_ID             /** ID de l'inspecteur avant la modification !== 변경전심사직원ID ==! */
      , AFCH_AUDT_EMP_ID             /** ID du vérificateur modifié !== 변경후심사직원ID ==! */
<!--      , BFCH_INSC_EMP_ID-->
<!--      , AFCH_INSC_EMP_ID-->
      , ADOR_CHG_RSN_CD              /** Code de motif de la modification de vérificateur !== 심사자변경사유코드 ==! */
      , CHG_RSN_CN                   /** Motif de la modification !== 변경사유내용 ==! */
      , CHG_DT                       /** Date de modification !== 변경일자 ==! */
      , CHG_EMP_ID                   /** ID de la personne modifiant !== 변경직원ID ==! */
      , DEL_YN                       /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID                /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM               /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID                 /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM                /** Date et heure de modification finale !== 최종변경일시 ==! */
      )
    VALUES
      (
        #{dtlDcshNo}                 /** Numéro du DAU !== DED번호 ==! */
      , (SELECT NVL(MAX(CHG_SRNO), 0) + 1 FROM TB_CLRI_ADOR_CHG_BRKD WHERE DTL_DCSH_NO = #{dtlDcshNo})  /** N° de modification !== 변경일련번호 ==! */
      , #{adorIsprTpCd}              /** Code de division inpsecteur/vérificateur !== 심사자검사자구분코드 ==! */
      , #{bfchAudtEmpId}             /** ID de l'inspecteur avant la modification !== 변경전심사직원ID ==! */
      , #{afchAudtEmpId}             /** ID du vérificateur modifié !== 변경후심사직원ID ==! */
<!--      , #{bfchInscEmpId}-->
<!--      , #{afchInscEmpId}-->
      , #{adorChgRsnCd}              /** Code de motif de la modification de vérificateur !== 심사자변경사유코드 ==! */
      , #{chgRsnCn}                  /** Motif de la modification !== 변경사유내용 ==! */
      , TO_CHAR(SYSDATE, 'YYYYMMDD') /** Date de modification !== 변경일자 ==! */
      , #{chgEmpId}                  /** ID de la personne modifiant !== 변경직원ID ==! */
      , 'N'                          /** Suppression ON !== 삭제여부 ==! */
      , #{frstRegstId}               /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , #{lastChprId}                /** ID du modificateur final !== 최종변경자ID ==! */
      , SYSTIMESTAMP                 /** Date et heure de modification finale !== 최종변경일시 ==! */
      )
  </insert>

  <!--
    Modification des inspecteur de la DED commun !== DED공통 심사자 변경 ==!
    (Song JunYoung)
    -->
  <update id="updateClrAudtEmpChgDedComn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedComnVo">
	/*updateClrAudtEmpChgDedComn*/
	UPDATE TB_CLRI_DED_COMN
	SET    AUDT_EMP_ID    = #{audtEmpId}
         , AUDT_DEPT_CD   = #{audtDeptCd}
<!--	     , INSC_EMP_ID    = #{inscEmpId}-->
	     , LAST_CHPR_ID   = #{lastChprId}
         , LAST_CHG_DTTM  = SYSTIMESTAMP
	WHERE  DEL_YN = 'N'
	AND    DTL_DCSH_NO = #{dtlDcshNo}
</update>

  <!--
    Consultation de l'historique de changements de cotation de l'inspecteur !== 심사자 배부 변경 이력조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrAdorChgBrkdList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorChgBrkdVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorChgBrkdVo">
    /* selectClrAdorChgBrkdList */
    SELECT A.DTL_DCSH_NO                  /** Numéro du DAU !== DED번호 ==! */
         , A.CHG_SRNO                     /** N° de modification !== 변경일련번호 ==! */
         , A.BFCH_AUDT_EMP_ID             /** ID de l'inspecteur avant la modification !== 변경전심사직원ID ==! */
         , A.AFCH_AUDT_EMP_ID             /** ID du vérificateur modifié !== 변경후심사직원ID ==! */
<!--         , A.BFCH_INSC_EMP_ID-->
<!--         , A.AFCH_INSC_EMP_ID-->
         , A.ADOR_CHG_RSN_CD              /** Code de motif de la modification de vérificateur !== 심사자변경사유코드 ==! */
         , A.CHG_RSN_CN                   /** Motif de la modification !== 변경사유내용 ==! */
         , TO_CHAR( TO_DATE(A.CHG_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS CHG_DT /** Date de modification !== 변경일자 ==! */
         , A.CHG_EMP_ID                   /** ID de la personne modifiant !== 변경직원ID ==! */
         , (SELECT A.BFCH_AUDT_EMP_ID||' | '||EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.BFCH_AUDT_EMP_ID ) AS BFCH_AUDT_EMP_NM
         , (SELECT A.AFCH_AUDT_EMP_ID||' | '||EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.AFCH_AUDT_EMP_ID ) AS AFCH_AUDT_EMP_NM
<!--         , (SELECT A.BFCH_INSC_EMP_ID||' | '||EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.BFCH_INSC_EMP_ID ) AS BFCH_INSC_EM_NM-->
<!--         , (SELECT A.AFCH_INSC_EMP_ID||' | '||EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.AFCH_INSC_EMP_ID ) AS AFCH_INSC_EMP_NM-->
         , (SELECT A.CHG_EMP_ID||' | '||EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.CHG_EMP_ID ) AS CHG_EMP_NM
    FROM   TB_CLRI_ADOR_CHG_BRKD A
    WHERE  A.DEL_YN = 'N'
    AND    A.DTL_DCSH_NO = #{dtlDcshNo}
    AND    A.ADOR_ISPR_TP_CD = 'A'        /** Code de division inpsecteur/vérificateur !== 심사자검사자구분코드 ==! */
    ORDER  BY TO_NUMBER(A.CHG_SRNO) DESC
  </select>

  <!--
    Consultation de la liste d'état de cotation de l'inspecteur !== 심사자 배부 현황 목록조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrAdorHnotList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo">
    /* selectClrAdorHnotList */
    <include refid="pagination.header" ></include>
	SELECT
           A.DTL_DCSH_NO                /** Numéro du DAU !== DED번호 ==! */
         , TO_CHAR(TO_DATE(A.DCLR_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS DCLR_DT  /** Date de DAU !== DED일자 ==! */
         , A.DCLR_PT_CD                 /** Code de type de declaration !== 신고유형코드 ==! */
         , A.DCLR_CSTM_CD               /** Code de bureau de declaration !== 신고세관코드 ==! */
         , A.DEPT_CD
         , A.AUDT_DEPT_CD               /** Code de Section du contrôle !== 심사부서코드 ==! */
         , A.AUDT_EMP_ID
         , A.INSC_EMP_ID
         , A.SELC_RSLT_CD
         , A.PDLS_GCNT
         , A.CSCL_PLN_CD                /** Code de plan de dedouanement !== 통관계획코드 ==! */
         , A.EXPPN_IDFY_NO_TP_CD        /** Code de type du N° d'identification de l'exportateur !== 수출자식별번호구분코드 ==! */
         , A.EXPPN_IDFY_NO              /** N° d'identification de l'exportateur !== 수출자식별번호 ==! */
         , A.IMPPN_IDFY_NO_TP_CD        /** Code de type du N° d'identification de l'importateur !== 수입자식별번호구분코드 ==! */
         , A.IMPPN_IDFY_NO              /** N° d'identification de l'importateur !== 수입자식별번호 ==! */
         , A.DCER_CD                    /** Code du declarant !== 신고인코드 ==! */
         , A.DEL_YN                     /** Suppression ON !== 삭제여부 ==! */
         , A.FRST_REGST_ID              /** ID du premier enregistrant  !== 최초등록자ID ==! */
         , A.FRST_RGSR_DTTM             /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
         , A.LAST_CHPR_ID               /** ID du modificateur final !== 최종변경자ID ==! */
         , A.LAST_CHG_DTTM              /** Date et heure de modification finale !== 최종변경일시 ==! */
         , ( CASE WHEN A.EXPPN_IDFY_NO_TP_CD = 'T' THEN (SELECT DECODE(BX.CO_NM, NULL, TX.CO_NM, BX.CO_NM) AS CO_NM
                                                         FROM   TB_POTE_NIF TX, TB_COM_CO BX
                                                         WHERE  TX.NIF = BX.NIF(+)
                                                         AND    TX.NIF = A.EXPPN_IDFY_NO
                                                         AND    TX.DEL_YN = 'N'
                                                         AND    BX.DEL_YN(+) = 'N'
                                                         AND    TX.NIF_STTS_CD != '0' )
           WHEN A.EXPPN_IDFY_NO_TP_CD = 'F' THEN (SELECT OVRS_BUCN_CO_NM
                                                  FROM   TB_COM_OVBC
                                                  WHERE  OVRS_BUCN_CD = A.EXPPN_IDFY_NO )
           END) AS EXPPN_NM
         , ( CASE WHEN A.IMPPN_IDFY_NO_TP_CD = 'T' THEN (SELECT DECODE(BX.CO_NM, NULL, TX.CO_NM, BX.CO_NM) AS CO_NM
                                                         FROM   TB_POTE_NIF TX, TB_COM_CO BX
                                                         WHERE  TX.NIF = BX.NIF(+)
                                                         AND    TX.NIF = A.IMPPN_IDFY_NO
                                                         AND    TX.DEL_YN = 'N'
                                                         AND    BX.DEL_YN(+) = 'N'
                                                         AND    TX.NIF_STTS_CD != '0' )
           WHEN A.IMPPN_IDFY_NO_TP_CD = 'F' THEN (SELECT OVRS_BUCN_CO_NM
                                                  FROM   TB_COM_OVBC
                                                  WHERE  OVRS_BUCN_CD = A.IMPPN_IDFY_NO)
           END) AS IMPPN_NM
         , (SELECT DCER_CO_NM FROM TB_CLRI_DED_CO WHERE DTL_DCSH_NO = A.DTL_DCSH_NO) AS DCER_NM
         , (SELECT A.DCLR_CSTM_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.DCLR_CSTM_CD AND ROWNUM=1) AS DCLR_CSTM_NM
         , (SELECT A.DEPT_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.DEPT_CD AND ROWNUM=1) AS DEPT_NM
         , (SELECT A.INSC_EMP_ID||' | '||EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.INSC_EMP_ID ) AS INSC_EMP_NM
         , (SELECT A.AUDT_EMP_ID||' | '||EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.AUDT_EMP_ID ) AS AUDT_EMP_NM
         , (SELECT A.AUDT_DEPT_CD||' | '||ORGN_NM FROM TB_POTI_ORGN WHERE ORGN_CD = A.AUDT_DEPT_CD AND ROWNUM=1) AS AUDT_DEPT_NM
         , A.DEPT_HNOT_OPIN_CN
         , A.ADOR_HNOT_OPIN_CN
         , A.PRCS_STTS_CD
         , FN_GET_CD_VDVAL_NM('CLR_0011', A.PRCS_STTS_CD, #{langCd}) AS PRCS_STTS_NM
         , B.AUDT_CMPL_APRV_YN
         , B.APRV_RSN_CN
    FROM   TB_CLRI_DED_COMN A
         , TB_CLRI_DED_ADIT_ATRB B
    WHERE  A.DEL_YN = 'N'
    AND	   A.DTL_DCSH_NO = B.DTL_DCSH_NO (+)
    AND    B.DEL_YN(+) = 'N'
    AND	   A.PRCS_STTS_CD >= 'B01'
    /* AND    A.AUDT_EMP_ID IS NOT NULL 심사자가 미배부된 건도 일단은 조회는 가능하도록 허용함. */
    AND    A.AUDT_EMP_ID IS NOT NULL
    <if test="rqstDtFrom != null and rqstDtFrom != ''">
      AND    A.DCLR_DT <![CDATA[ >= ]]> TO_CHAR(TO_DATE(#{rqstDtFrom},'DD/MM/YYYY'), 'YYYYMMDD')
      AND    A.DCLR_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE(#{rqstDtTo},'DD/MM/YYYY'), 'YYYYMMDD')
    </if>
    <if test="cstmCd != null and cstmCd != ''">
      AND    A.DCLR_CSTM_CD = #{cstmCd}
    </if>
    <if test="deptCd != null and deptCd != ''">
      AND    A.DEPT_CD = #{deptCd}
    </if>
    <if test="audtDeptCd != null and audtDeptCd != ''">
      AND    A.AUDT_DEPT_CD = #{audtDeptCd}
    </if>
    <if test="audtEmpId != null and audtEmpId != ''">
      AND    A.AUDT_EMP_ID = #{audtEmpId}
    </if>
    <if test="dclrPtCd != null and dclrPtCd != ''">
      AND    A.DCLR_PT_CD = #{dclrPtCd}
    </if>
    <if test="csclPlnCd != null and csclPlnCd != ''">
      AND    A.CSCL_PLN_CD = #{csclPlnCd}
    </if>
    <if test="dtlDcshNo != null and dtlDcshNo != ''">
      AND    A.DTL_DCSH_NO = #{dtlDcshNo}
    </if>
    <!-- 2020.01.10 김선구 요구사항에 의한 수출자 수입자 신고인 조회조건 추가. -->
    <if test="exppnIdfyNo != null and exppnIdfyNo != ''">
      AND    A.EXPPN_IDFY_NO = #{exppnIdfyNo}
    </if>
    <if test="imppnIdfyNo != null and imppnIdfyNo != ''">
      AND    A.IMPPN_IDFY_NO = #{imppnIdfyNo}
    </if>
    <if test="dcerCd != null and dcerCd != ''">
      AND    A.DCER_CD = #{dcerCd}
    </if>
    ORDER BY A.DTL_DCSH_NO DESC
    <include refid="pagination.footer" ></include>
  </select>

  <!--
    Consultation le nombre de déclarations cotées par inspecteur!== 심사자별 할당량 목록조회 ==!
    (Song JunYoung)
    -->
  <select id="selectClrAdorAlctInqtList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo">
    /* selectClrAdorAlctInqtList */
    <include refid="pagination.header" ></include>
      SELECT DCLR_CSTM_CD
          , DCLR_CSTM_NM
          , DEPT_CD
          , DEPT_NM
          , AUDT_EMP_ID
          , AUDT_EMP_NM
          , AUDT_DEPT_CD
          , AUDT_DEPT_NM
          , SUM(HNOT_CNT) HNOT_CNT
          , SUM(AUDT_PRGS) AS AUDT_PRGS
          , SUM(CSCL_PSTP) AS CSCL_PSTP
          , SUM(AUDT_CMPL) AS AUDT_CMPL
      FROM (
          SELECT DCLR_CSTM_CD
              , FN_GET_ORGN_NM(A.DCLR_CSTM_CD) AS DCLR_CSTM_NM
              , DEPT_CD
              , FN_GET_ORGN_NM(A.DEPT_CD) AS DEPT_NM
              , AUDT_EMP_ID
              , (SELECT S.EMP_NM FROM TB_POTI_EMP S WHERE S.PBSR_NO = A.AUDT_EMP_ID AND S.DEL_YN = 'N') AS AUDT_EMP_NM
              , AUDT_DEPT_CD
              , FN_GET_ORGN_NM(A.AUDT_DEPT_CD) AS AUDT_DEPT_NM
              , 1 AS HNOT_CNT
              , CASE WHEN ((B.PRCS_STTS_CD NOT IN ('D03', 'D04', 'D07', 'G03', 'G04') OR B.PRCS_STTS_CD IS NULL) AND CSCL_PSTP_YN != 'Y') THEN 1 ELSE 0 END AS AUDT_PRGS
              , CASE WHEN ((B.PRCS_STTS_CD NOT IN ('G03', 'G04')) AND CSCL_PSTP_YN = 'Y') THEN 1 ELSE 0 END AS CSCL_PSTP
              , CASE WHEN ((B.PRCS_STTS_CD IN ('D03', 'D04', 'D07') AND CSCL_PSTP_YN != 'Y') OR (B.PRCS_STTS_CD IN ('G03', 'G04'))) THEN 1 ELSE 0 END AS AUDT_CMPL
          FROM
             TB_CLRI_DED_COMN A
            ,TB_CLRI_DED_PRCS_BRKD B
          WHERE A.DEL_YN = 'N'
          AND A.DTL_DCSH_NO = B.DTL_DCSH_NO
          AND A.HIST_SRNO = B.HIST_SRNO
          AND ADOR_HNOT_PRCS_YN != 'N'
          AND NVL(A.AUDT_EMP_ID,'') != ''
          <if test="rqstDtFrom != null and rqstDtFrom != '' and rqstDtTo != null and rqstDtTo != ''">
              AND A.DCLR_DT <![CDATA[ >= ]]> TO_CHAR(TO_DATE(#{rqstDtFrom},'DD/MM/YYYY'), 'YYYYMMDD')
              AND A.DCLR_DT <![CDATA[ <= ]]> TO_CHAR(TO_DATE(#{rqstDtTo},'DD/MM/YYYY'), 'YYYYMMDD')
          </if>
          <if test="dclrCstmCd != null and dclrCstmCd != ''">
              AND DCLR_CSTM_CD = #{dclrCstmCd}
          </if>
          <if test="deptCd != null and deptCd != ''">
              AND DEPT_CD = #{deptCd}
          </if>
          <if test="audtDeptCd != null and audtDeptCd != ''">
              AND AUDT_DEPT_CD = #{audtDeptCd}
          </if>
          <if test="audtEmpId != null and audtEmpId != ''">
              AND AUDT_EMP_ID = #{audtEmpId}
          </if>
          AND B.PRCS_SRNO(+) = (SELECT MAX(PRCS_SRNO)
                                FROM TB_CLRI_DED_PRCS_BRKD
                                WHERE DEL_YN = 'N'
                                AND DTL_DCSH_NO = B.DTL_DCSH_NO)
          AND B.DEL_YN(+) = 'N'
          )
      GROUP
          BY DCLR_CSTM_CD
          , DCLR_CSTM_NM
          , DEPT_CD
          , DEPT_NM
          , AUDT_EMP_ID
          , AUDT_EMP_NM
          , AUDT_DEPT_CD
          , AUDT_DEPT_NM
      ORDER
          BY DCLR_CSTM_CD
          , DEPT_CD
          , AUDT_EMP_ID
    <include refid="pagination.footer" ></include>
  </select>

  <!--
   Consulter si le mode de cotation est la cotation manuelle !== 심사자배부방법이 수작업배부인지 조회 ==!
    (Song JunYoung)
  -->
  <select id="selectExstAdorHnwrHnot" parameterType="String" resultType="String">
    /* selectExstAdorHnwrHnot */
    SELECT A.DTL_DCSH_NO
    FROM   TB_CLRI_DED_COMN A
         , TB_CLRI_ADOR_HNOT_MEAN_BSCS B
    WHERE  A.DEL_YN = 'N'
    AND    B.DEL_YN = 'N'
    AND    B.CSTM_CD = A.DCLR_CSTM_CD
    AND    B.DEPT_CD = A.DEPT_CD
    AND    B.DCLR_PT_CD = A.DCLR_PT_CD
    AND    B.HNOT_MEAN_CD = 'S'  /* M:지시사항배부 */
    AND    A.DTL_DCSH_NO = #{dtlDcshNo}
  </select>

  <!--
    Consultation de la liste des agents de dédouanement !== 통관직원 목록 조회 ==!
    (Song JunYoung)
    -->
  <select id="selectCsclEmpList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAdorHnotComnVo">
  	/* selectCsclEmpList */
    <include refid="pagination.header" ></include>
    SELECT X.PBSR_NO
       , X.EMP_NM
    FROM (
          SELECT A.PBSR_NO
             , A.EMP_NM
             , ( SELECT ORGN_CD FROM TB_POTI_ORGN WHERE ORGN_MGMT_CD = A.SCTR_MGMT_CD ) AS SCTR_CD
             , C.ORGN_CD AS CSTM_CD
             , D.ORGN_CD AS DEPT_CD
        FROM   TB_POTI_EMP A
             , VW_POTI_ROLE_UNFC B
             , TB_POTI_ORGN C
             , TB_POTI_ORGN D
        WHERE  A.DEL_YN = 'N'
        AND    C.DEL_YN = 'N'
        AND    D.DEL_YN = 'N'
        AND    A.PBSR_NO = B.PBSR_NO
        AND    A.CSTM_MGMT_CD = C.ORGN_MGMT_CD
        AND    A.DEPT_MGMT_CD = D.ORGN_MGMT_CD
        AND    ( B.ROLE_ID = #{roleId} OR B.ROLE_ID = 'CLR045' ) /*CLR003 DED 신고 심사자 CLR045 DED 현장 검사원*/
        AND    FN_GET_EMP_BWRK_STTS(A.PBSR_NO,'Y') = 'TRUE'   /** 부재중건이 없으면 근무중 상태로 봄 */
                GROUP BY
                       A.PBSR_NO
                     , A.EMP_NM
                     , A.SCTR_MGMT_CD
                     , C.ORGN_CD
                     , D.ORGN_CD
      ) X
    WHERE 1=1
    <if test="cstmCd != null and cstmCd != ''">
      AND    X.CSTM_CD = #{cstmCd}
    </if>
    <if test="deptCd != null and deptCd != ''">
      AND    X.DEPT_CD = #{deptCd}
    </if>
    <if test="pbsrNo != null and pbsrNo != ''">
      AND    X.PBSR_NO = #{pbsrNo}
    </if>
    <if test="empNm != null and empNm != ''">
      AND    UPPER(X.EMP_NM) LIKE '%'||UPPER(#{empNm})||'%'
    </if>
    ORDER  BY X.PBSR_NO
    <include refid="pagination.footer" ></include>
  </select>

  <!--
    Consultation de la liste de mappage des services de contrôle de dédouanement !== 신고심사부서매핑 목록 조회 ==!
    (Park Byoungkyu)
    -->
  <select id="selectClrAudtDeptMpngList" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAudtDeptMpngVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAudtDeptMpngVo">
    /* selectClrAudtDeptMpngList */
    <include refid="pagination.header" ></include>
    SELECT
        CSTM_CD           /** Bureau de douane !== 세관 ==! */
      , (SELECT CSTM_CD || ' | ' || A.ORGN_NM FROM TB_POTI_ORGN A WHERE A.DEL_YN = 'N' AND A.ORGN_CD = CSTM_CD ) AS CSTM_NM  /** Code Du Bureau !== 세관코드명 ==! */
      , DEPT_CD           /** Service concerné !== 신고부서 ==! */
      , (SELECT DEPT_CD || ' | ' || A.ORGN_NM FROM TB_POTI_ORGN A WHERE A.DEL_YN = 'N' AND A.ORGN_CD = DEPT_CD ) AS DEPT_NM  /** Code de service !== 부서코드명 ==! */
      , AUDT_DEPT_CD      /** Section du contrôle !== 심사부서 ==! */
      , (SELECT AUDT_DEPT_CD || ' | ' || A.ORGN_NM FROM TB_POTI_ORGN A WHERE A.DEL_YN = 'N' AND A.ORGN_CD = AUDT_DEPT_CD ) AS AUDT_DEPT_NM  /** Nom Du Section du contrôle !== 심사부서코드명 ==! */
      , INSC_DEPT_CD      /** Code de service de vérification !== 검사부서코드 ==! */
      , (SELECT INSC_DEPT_CD || ' | ' || A.ORGN_NM FROM TB_POTI_ORGN A WHERE A.DEL_YN = 'N' AND A.ORGN_CD = INSC_DEPT_CD ) AS INSC_DEPT_NM  /** Nom de service de vérification !== 검사부서명 ==! */
      , IMEX_TP_CD        /** Code de type de l'importation/exportation !== 수출입구분코드 ==! */
      , DEL_YN            /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID     /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM    /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID      /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM     /** Date et heure de modification finale !== 최종변경일시 ==! */
    FROM   TB_CLRI_DCLR_AUDT_DEPT_MPNG_BRKD
    WHERE  DEL_YN = 'N'
    <if test="cstmCd != null and cstmCd != ''">
      AND    CSTM_CD = #{cstmCd}
    </if>
    <if test="deptCd != null and deptCd != ''">
      AND    DEPT_CD = #{deptCd}
    </if>
    <if test="audtDeptCd != null and audtDeptCd != ''">
      AND    AUDT_DEPT_CD = #{audtDeptCd}
    </if>
    <if test="inscDeptCd != null and inscDeptCd != ''">
      AND    INSC_DEPT_CD = #{inscDeptCd}
    </if>
    ORDER  BY  CSTM_CD
    <include refid="pagination.footer" ></include>
  </select>

  <!--
    Enregistrement du mappage des services de contrôle de dédouanement !== 신고심사부서매핑 등록 ==!
    (Park Byoungkyu)
    -->
  <insert id="insertClrAudtDeptMpng" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAudtDeptMpngVo">
    /* insertClrAudtDeptMpng */
    WITH UPSERT AS (
    UPDATE TB_CLRI_DCLR_AUDT_DEPT_MPNG_BRKD
    SET
        LAST_CHPR_ID = #{lastChprId}              /** Id Du Modificateur Final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP              /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
      , DEL_YN = 'N'                              /** Suppression On !== 삭제여부 ==! */
    WHERE
        CSTM_CD = #{cstmCd}                       /** Bureau de douane !== 세관 ==! */
    AND DEPT_CD = #{deptCd}                       /** Service concerné !== 신고부서 ==! */
    AND AUDT_DEPT_CD = #{audtDeptCd}              /** Section du contrôle !== 심사부서 ==! */
    AND INSC_DEPT_CD = #{inscDeptCd}              /** Code de service de vérification !== 검사부서코드 ==! */
    AND IMEX_TP_CD = #{imexTpCd}                  /** Code de type de l'importation/exportation !== 수출입구분코드 ==! */
    RETURNING*
    )
    INSERT INTO TB_CLRI_DCLR_AUDT_DEPT_MPNG_BRKD
      (
        CSTM_CD                                   /** Bureau de douane !== 세관 ==! */
      , DEPT_CD                                   /** Service concerné !== 신고부서 ==! */
      , AUDT_DEPT_CD                              /** Section du contrôle !== 심사부서 ==! */
      , INSC_DEPT_CD                              /** Code de service de vérification !== 검사부서코드 ==! */
      , IMEX_TP_CD                                /** Code de type de l'importation/exportation !== 수출입구분코드 ==! */
      , DEL_YN                                    /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID                             /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM                            /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID                              /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM                             /** Date et heure de modification finale !== 최종변경일시 ==! */
      )
    SELECT
        #{cstmCd}                                 /** Numéro du DAU !== DED번호 ==! */
      , #{deptCd}                                 /** N° de modification !== 변경일련번호 ==! */
      , #{audtDeptCd}                             /** Section du contrôle !== 심사부서 ==! */
      , #{inscDeptCd}                             /** Code de service de vérification !== 검사부서코드 ==! */
      , #{imexTpCd}                               /** Code de type de l'importation/exportation !== 수출입구분코드 ==! */
      , 'N'                                       /** Suppression ON !== 삭제여부 ==! */
      , #{frstRegstId}                            /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , SYSTIMESTAMP                              /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , #{lastChprId}                             /** ID du modificateur final !== 최종변경자ID ==! */
      , SYSTIMESTAMP                              /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE
    NOT EXISTS(SELECT * FROM UPSERT)
  </insert>

  <!--
    Vérification de l'enregistrement O/N du mappage des services de contrôle de dédounanement !== 신고심사부서매핑 등록 여부 확인 ==!
    (Park Byoungkyu)
    -->
  <select id="selectClrAudtDeptMpngCheck" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAudtDeptMpngVo" resultType="alpass.ipt.clr.cdm.jam.vo.ClrAudtDeptMpngVo">
    /* selectClrAudtDeptMpngCheck */
    SELECT
        CSTM_CD           /** Bureau de douane !== 세관 ==! */
      , DEPT_CD           /** Service concerné !== 신고부서 ==! */
      , AUDT_DEPT_CD      /** Section du contrôle !== 심사부서 ==! */
      , INSC_DEPT_CD      /** Code de service de vérification !== 검사부서코드 ==! */
      , DEL_YN            /** Suppression ON !== 삭제여부 ==! */
      , FRST_REGST_ID     /** ID du premier enregistrant  !== 최초등록자ID ==! */
      , FRST_RGSR_DTTM    /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
      , LAST_CHPR_ID      /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM     /** Date et heure de modification finale !== 최종변경일시 ==! */
    FROM   TB_CLRI_DCLR_AUDT_DEPT_MPNG_BRKD
    WHERE  DEL_YN = 'N'
    AND CSTM_CD = #{cstmCd}
    AND DEPT_CD = #{deptCd}
    AND AUDT_DEPT_CD = #{audtDeptCd}
    AND INSC_DEPT_CD = #{inscDeptCd}
    AND IMEX_TP_CD = #{imexTpCd}
  </select>

 <!--
  Vérification de l'enregistrement O/N du mappage des services de contrôle de dédounanement !== 신고심사부서매핑 수정 ==!
  (Park Byoungkyu)
  -->
  <update id="updateClrAudtDeptMpng" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAudtDeptMpngVo">
    /* updateClrAudtDeptMpng */
    UPDATE  TB_CLRI_DCLR_AUDT_DEPT_MPNG_BRKD SET
        CSTM_CD = #{cstmCd}                            /** Code Du Bureau !== 세관코드 ==! */
      , AND  DEPT_CD = #{deptCd}                       /** Code de service !== 부서코드 ==! */
      , AUDT_DEPT_CD = #{audtDeptCd}                   /** Section du contrôle !== 심사부서 ==! */
      , INSC_DEPT_CD = #{inscDeptCd}                   /** Code de service de vérification !== 검사부서코드 ==! */
      , IMEX_TP_CD = #{imexTpCd}                       /** Code de type de l'importation/exportation !== 수출입구분코드 ==! */
      , DEL_YN = 'Y'                                   /** Suppression ON !== 삭제여부 ==! */
      , LAST_CHPR_ID = #{lastChprId}                   /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                   /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE  DEL_YN = 'N'                                /** Suppression ON !== 삭제여부 ==! */
    AND CSTM_CD = #{cstmCd}                            /** Code Du Bureau !== 세관코드 ==! */
    AND DEPT_CD = #{deptCd}                            /** Code de service !== 부서코드 ==! */
    AND AUDT_DEPT_CD = #{audtDeptCd}                   /** Section du contrôle !== 심사부서 ==! */
    AND INSC_DEPT_CD = #{inscDeptCd}                   /** Code de service de vérification !== 검사부서코드 ==! */
    AND IMEX_TP_CD = #{imexTpCd}                       /** Code de type de l'importation/exportation !== 수출입구분코드 ==! */
  </update>

  <!--
    Suppression du mappage des services de contrôle de dédouanement !== 신고심사부서매핑 삭제 ==!
    (Park Byoungkyu)
    -->
  <update id="deleteClrAudtDeptMpng" parameterType="alpass.ipt.clr.cdm.jam.vo.ClrAudtDeptMpngVo">
    /* deleteClrAudtDeptMpng */
    UPDATE  TB_CLRI_DCLR_AUDT_DEPT_MPNG_BRKD SET
        DEL_YN = 'Y'                                  /** Suppression ON !== 삭제여부 ==! */
      , LAST_CHPR_ID = #{lastChprId}                  /** ID du modificateur final !== 최종변경자ID ==! */
      , LAST_CHG_DTTM = SYSTIMESTAMP                  /** Date et heure de modification finale !== 최종변경일시 ==! */
    WHERE  DEL_YN = 'N'                               /** Suppression ON !== 삭제여부 ==! */
    AND CSTM_CD = #{cstmCd}                           /** Code Du Bureau !== 세관코드 ==! */
    AND DEPT_CD = #{deptCd}                           /** Code de service !== 부서코드 ==! */
    AND AUDT_DEPT_CD = #{audtDeptCd}                  /** Section du contrôle !== 심사부서 ==! */
    AND INSC_DEPT_CD = #{inscDeptCd}                  /** Code de service de vérification !== 검사부서코드 ==! */
    AND IMEX_TP_CD = #{imexTpCd}                      /** Code de type de l'importation/exportation !== 수출입구분코드 ==! */
  </update>

    <!--
      Enregistrement de l'approbation O/N de l'achèvement de contrôle !== 심사완료결재여부 등록 ==!
      (Park Byoungkyu)
      -->
    <insert id="insertAudtCmplAprvYn" parameterType="alpass.ipt.clr.pdr.dre.vo.ClrDedComnDcshVo">
      /* insertAudtCmplAprvYn */
      WITH UPSERT AS (
      UPDATE TB_CLRI_DED_ADIT_ATRB
      SET
        AUDT_CMPL_APRV_YN = #{audtCmplAprvYn}     /** Que l'examen soit terminé ou non !== 심사완료결재여부 ==! */
        , APRV_RSN_CN = #{aprvRsnCn}              /** Contenu du motif de l’approbation !== 결재사유내용 ==! */
        , LAST_CHPR_ID = #{lastChprId}              /** Id Du Modificateur Final !== 최종변경자ID ==! */
        , LAST_CHG_DTTM = SYSTIMESTAMP              /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
      WHERE
          DTL_DCSH_NO = #{dtlDcshNo}                /** Numéro du DAU !== DED번호 ==! */
      RETURNING*
      )
      INSERT INTO TB_CLRI_DED_ADIT_ATRB
        (
          DTL_DCSH_NO                               /** Numéro du DAU !== DED번호 ==! */
        , AUDT_CMPL_APRV_YN                         /** Que l'examen soit terminé ou non !== 심사완료결재여부 ==! */
        , APRV_RSN_CN                               /** Contenu du motif de l’approbation !== 결재사유내용 ==! */
        , DEL_YN                                    /** Suppression ON !== 삭제여부 ==! */
        , FRST_REGST_ID                             /** ID du premier enregistrant  !== 최초등록자ID ==! */
        , FRST_RGSR_DTTM                            /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
        , LAST_CHPR_ID                              /** ID du modificateur final !== 최종변경자ID ==! */
        , LAST_CHG_DTTM                             /** Date et heure de modification finale !== 최종변경일시 ==! */
        )
        SELECT
          #{dtlDcshNo}                              /** Numéro du DAU !== DED번호 ==! */
        , #{audtCmplAprvYn}                         /** Que l'examen soit terminé ou non !== 심사완료결재여부 ==! */
        , #{aprvRsnCn}                              /** Contenu du motif de l’approbation !== 결재사유내용 ==! */
        , 'N'                                       /** Suppression ON !== 삭제여부 ==! */
        , #{frstRegstId}                            /** ID du premier enregistrant  !== 최초등록자ID ==! */
        , SYSTIMESTAMP                              /** Date et heure de premier enregistrement !== 최초등록일시 ==! */
        , #{lastChprId}                             /** ID du modificateur final !== 최종변경자ID ==! */
        , SYSTIMESTAMP                              /** Date et heure de modification finale !== 최종변경일시 ==! */
      WHERE
      NOT EXISTS(SELECT * FROM UPSERT)
    </insert>

</mapper>

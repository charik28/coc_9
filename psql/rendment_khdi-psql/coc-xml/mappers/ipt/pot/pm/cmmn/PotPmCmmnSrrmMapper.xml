<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="alpass.ipt.pot.pm.cmmn.mapper.PotPmCmmnSrrmMapper">

    <!--
        Consulter la liste de la gestion du téléchargement !==자료실 관리 목록을 조회한다.==!
    -->
    <select id="selectSrrmList" parameterType="alpass.ipt.pot.pm.cmmn.vo.PotPmCmmnSrrmVo" resultType="alpass.ipt.pot.pm.cmmn.vo.PotPmCmmnSrrmVo">
        /* selectSrrmList */
        <include refid="pagination.header"/>
        SELECT
        A.SRRM_SRNO
        , A.TRGT_APP_CLSF_CD
        , A.SRRM_TP_CD
        , A.SRRM_TTLE
        , A.SRRM_CN
        , A.MDPN_ID
        , ( SELECT CONCAT(U.EMP_FMNM, ' ', U.EMP_NM) FROM TB_POTI_EMP U WHERE PBSR_NO = A.MDPN_ID) AS MDPN_NM
        , TO_CHAR(A.MAKE_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS MAKE_DTTM
        , ROWNUM AS ORDER_NO
        , A.INQT_CNT
        , A.PRTL_BLTN_YN
        , A.ATCH_FILE_ID
        , A.DEL_YN
        , A.FRST_REGST_ID
        , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:MI:SS') AS FRST_RGSR_DTTM
        , A.LAST_CHPR_ID
        , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:MI:SS') AS  LAST_CHG_DTTM
        FROM   TB_POTI_SRRM A
        WHERE  DEL_YN = 'N'
        <if test="searchKeywordFrom != null and searchKeywordFrom != '' ">
            AND A.MAKE_DTTM BETWEEN TO_DATE(#{searchKeywordFrom}, 'DD/MM/YYYY') AND TO_DATE(#{searchKeywordTo}, 'DD/MM/YYYY') + 0.99999
        </if>
        <if test="srrmTtle != null and srrmTtle != '' ">
            AND UPPER(A.SRRM_TTLE) like '%' || UPPER(#{srrmTtle}) || '%'
        </if>
        <if test="srrmTpCd != null and srrmTpCd != '' ">
            AND A.SRRM_TP_CD = #{srrmTpCd}
        </if>
        <if test="trgtAppClsfCd != null and trgtAppClsfCd != '' ">
            AND A.TRGT_APP_CLSF_CD = #{trgtAppClsfCd}
        </if>
        <if test="pblsDeptNm != null and pblsDeptNm != '' ">
            AND A.PBLS_DEPT_NM LIKE '%' || #{pblsDeptNm} || '%'
        </if>
        ORDER BY A.SRRM_SRNO DESC
        <include refid="pagination.footer"/>
    </select>

    <!--
        Consulter un article de la gestion du téléchargement !==자료실 관리 게시물을 조회한다.==!
    -->
    <select id="selectSrrm"  parameterType="alpass.ipt.pot.pm.cmmn.vo.PotPmCmmnSrrmVo" resultType="alpass.ipt.pot.pm.cmmn.vo.PotPmCmmnSrrmVo">
        /* selectSrrm */
        SELECT
            A.SRRM_SRNO
             , A.TRGT_APP_CLSF_CD
             , A.SRRM_TP_CD
             , A.SRRM_TTLE
             , A.SRRM_CN
             , A.PBLS_DEPT_NM
             , A.MDPN_ID
             , (SELECT CONCAT(U.EMP_FMNM, ' ', U.EMP_NM) FROM TB_POTI_EMP U WHERE PBSR_NO = A.MDPN_ID) AS MDPN_NM
             , TO_CHAR(A.MAKE_DTTM, 'DD/MM/YYYY HH24:mi:ss') AS MAKE_DTTM
             , A.INQT_CNT
             , A.PRTL_BLTN_YN
             , A.ATCH_FILE_ID
             , A.DEL_YN
             , A.FRST_REGST_ID
             , TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY HH24:MI:SS') AS FRST_RGSR_DTTM
             , A.LAST_CHPR_ID
             , TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY HH24:MI:SS') AS  LAST_CHG_DTTM
        FROM   TB_POTI_SRRM A
        WHERE  DEL_YN = 'N'
          AND    SRRM_SRNO = #{srrmSrno}
    </select>

    <!--
        Modifier le nombre de vues de la gestion du téléchargement !==자료실 관리 조회수를 수정한다.==!
    -->
    <update id="updateView" parameterType="alpass.ipt.pot.pm.cmmn.vo.PotPmCmmnSrrmVo">
        /* updateView */
        UPDATE  TB_POTI_SRRM SET
            INQT_CNT = INQT_CNT+1
        WHERE	SRRM_SRNO = #{srrmSrno}
    </update>

    <!--
        Enregistrer un article de la gestion du téléchargement !==자료실 관리 게시물을 등록한다.==!
    -->
    <insert id="insertSrrm" parameterType="alpass.ipt.pot.pm.cmmn.vo.PotPmCmmnSrrmVo">
        <selectKey keyProperty="srrmSrno" keyColumn="SRRM_SRNO" resultType="java.math.BigDecimal" order="BEFORE">
            SELECT NVL(MAX(SRRM_SRNO),0) +1 FROM TB_POTI_SRRM
        </selectKey>
        /* insertSrrm */
        INSERT INTO TB_POTI_SRRM
        (
        SRRM_SRNO
        , TRGT_APP_CLSF_CD
        , SRRM_TP_CD
        , SRRM_TTLE
        , SRRM_CN
        , PBLS_DEPT_NM
        , MDPN_ID
        , MAKE_DTTM
        , INQT_CNT
        , PRTL_BLTN_YN
        , ATCH_FILE_ID
        , DEL_YN
        , FRST_REGST_ID
        , FRST_RGSR_DTTM
        , LAST_CHPR_ID
        , LAST_CHG_DTTM
        )
        VALUES
        (
        #{srrmSrno}
        , #{trgtAppClsfCd}
        , #{srrmTpCd}
        , #{srrmTtle}
        , #{srrmCn}
        , #{pblsDeptNm}
        , #{mdpnId}
        , SYSTIMESTAMP
        , #{inqtCnt}
        , #{prtlBltnYn}
        , #{atchFileId}
        , 'N'
        , #{frstRegstId}
        , SYSTIMESTAMP
        , #{lastChprId}
        , SYSTIMESTAMP
        )
    </insert>

    <!--
        Modifier un article de la gestion du téléchargement !==자료실 관리 게시물을 수정한다.==!
    -->
    <update id="updateSrrm" parameterType="alpass.ipt.pot.pm.cmmn.vo.PotPmCmmnSrrmVo">
        /* updateSrrm */
        UPDATE  TB_POTI_SRRM
        <trim prefix="SET" prefixOverrides="," >
            <if test="srrmTpCd != null and srrmTpCd != '' ">, SRRM_TP_CD = #{srrmTpCd}</if>
            <if test="trgtAppClsfCd != null and trgtAppClsfCd != '' ">, TRGT_APP_CLSF_CD = #{trgtAppClsfCd}</if>
            <if test="srrmTtle != null and srrmTtle != '' ">, SRRM_TTLE = #{srrmTtle}</if>
            <if test="srrmCn != null and srrmCn != '' ">, SRRM_CN = #{srrmCn}</if>
            <if test="pblsDeptNm != null and pblsDeptNm != '' ">, PBLS_DEPT_NM  = #{pblsDeptNm}</if>
            <if test="inqtCnt != null and inqtCnt != '' ">, INQT_CNT = #{inqtCnt}</if>
            <if test="prtlBltnYn != null and prtlBltnYn != '' ">, PRTL_BLTN_YN = #{prtlBltnYn}</if>
            <if test="atchFileId != null and atchFileId != '' ">, ATCH_FILE_ID = #{atchFileId}</if>
            <if test="lastChprId != null and lastChprId != '' ">, LAST_CHPR_ID = #{lastChprId}</if>
            <if test="lastChprId != null and lastChprId != '' ">, LAST_CHG_DTTM = SYSTIMESTAMP</if>
        </trim>
        WHERE  DEL_YN = 'N'
        AND    SRRM_SRNO = #{srrmSrno}
    </update>

    <!--
        Supprimer un article de la gestion du téléchargement !==자료실 관리 게시물을 삭제한다.==!
    -->
    <update id="deleteSrrm" parameterType="alpass.ipt.pot.pm.cmmn.vo.PotPmCmmnSrrmVo">
        /* deleteSrrm */
        UPDATE  TB_POTI_SRRM SET
            DEL_YN = 'Y'
         ,  LAST_CHPR_ID = #{lastChprId}
         ,  LAST_CHG_DTTM = SYSTIMESTAMP
        WHERE  DEL_YN = 'N'
          AND    SRRM_SRNO = #{srrmSrno}
    </update>

</mapper>

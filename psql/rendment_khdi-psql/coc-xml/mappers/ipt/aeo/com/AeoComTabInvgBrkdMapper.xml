<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
Mapper : [OEA commun] L'onglet Enquête de la demande d'agrément !== [AEO 공통] 공인신청서 의견서 탭 Mapper ==!
(wonjun.cha)
-->
<mapper namespace="alpass.ipt.aeo.com.mapper.AeoComTabInvgBrkdMapper">

    <!--
    [OEA commun] Consulter la liste des enquêtes !==[AEO 공통] 조사내역 목록 조회==!
    -->
	<select id="selectAeoComInvgBrkdList"
	    parameterType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo"
	    resultType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo">
		/* selectAeoComInvgBrkdList */
	    <include refid="pagination.header"/>
		SELECT
				  A.INVG_MGMT_NO               /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
                , A.ATHR_RQST_TP_CD            /** Code de type de demande d'agrément !== 공인신청구분코드 ==! */
                , FN_GET_CD_VDVAL_NM('AEO_0004', A.ATHR_RQST_TP_CD, #{langCd}) AS ATHR_RQST_TP_NM                 /** Code de type de demande d'agrément !== 공인신청구분코드 ==! */
                , A.AEO_RQST_NO                /** Numéro de demande du statut OEA !== AEO신청번호 ==! */
                , A.AEO_ATHR_NO                /** Numéro d'OEA !== AEO공인번호 ==! */
                , A.PRCS_STTS_CD               /** Code De Statut De Traitement !== 처리상태코드 ==! */
                , FN_GET_CD_VDVAL_NM((CASE A.ATHR_RQST_TP_CD WHEN 'ARQ' THEN 'AEO_0015' ELSE 'AEO_0016' END), A.PRCS_STTS_CD, #{langCd}) AS PRCS_STTS_NM               /** Code De Statut De Traitement !== 처리상태코드 ==! */
                , A.DTL_PRCS_STTS_CD           /** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
                , FN_GET_CD_VDVAL_NM((CASE A.ATHR_RQST_TP_CD WHEN 'ARQ' THEN 'AEO_0017' ELSE 'AEO_0018' END), A.DTL_PRCS_STTS_CD, #{langCd}) AS DTL_PRCS_STTS_NM               /** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
                , A.INVG_RQSTR_ID              /** ID du demandeur d'enquête !== 조사요청자ID ==! */
                , (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.INVG_RQSTR_ID) AS INVG_RQSTR_NM              /** ID du demandeur d'enquête !== 조사요청자ID ==! */
                , TO_CHAR(TO_DATE(A.INVG_REQST_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS INVG_REQST_DT             /** Date de demande d'enquête !== 조사요청일자 ==! */
                , A.INVG_REQST_CN              /** Contenu de demande d'enquête !== 조사요청내용 ==! */
                , A.INVG_REQST_CN AS mgmtRqstTpCd              /** Contenu de demande d'enquête !== 조사요청내용 ==! */
                , A.INVG_RSLT_CN               /** Résultat de demande d'enquête !== 조사결과내용 ==! */
                , A.INVG_IDTN_ATCH_FILE_ID     /** ID de la pièce jointe pour l'ordre d'enquête !== 조사지시첨부파일ID ==! */
		        , A.INVG_RSLT_ATCH_FILE_ID     /** ID de la pièce jointe pour le résultat d'enquête !== 조사결과첨부파일ID ==! */
				, A.RTRN_RSN_CN                 /** Motif De Rejet !== 반려사유내용 ==! */
                , TO_CHAR(A.SBMT_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS SBMT_DTTM                  /** Date Et Heure De Soumission !== 제출일시 ==! */
				, A.DEL_YN					/** Suppression On !== 삭제여부 ==! */
                , A.FRST_REGST_ID              /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
				, (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.FRST_REGST_ID) AS FRST_REGST_NM
				, TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS frstRgsrDttm			/** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
				, A.LAST_CHPR_ID				/** Id Du Modificateur Final !== 최종변경자ID ==! */
				, (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.LAST_CHPR_ID) AS LAST_CHPR_NM
				, TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS lastChgDttm				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		  FROM
		  		  TB_AEOI_INVG_BRKD A    /** AEOI_HISTORIQUE D'ENQUÊTE !== AEOI_조사내역 ==! */
		 WHERE
		 		  A.DEL_YN = 'N'									/** Suppression ON !== 삭제여부 ==! */
	    <choose>
	    	<when test="aeoRqstNoList.size != 0">
           AND	  A.AEO_RQST_NO IN 									/** Numéro de demande du statut OEA !== AEO신청번호 ==! */
	       		<foreach collection="aeoRqstNoList" item="item" index="index" separator="," open="(" close=")">
	       			#{item}
	       		</foreach>
	    	</when>
	    </choose>
		 <if test='aeoAthrNo != null and !"".equals(aeoAthrNo)'>
            OR	  (
            		A.AEO_ATHR_NO = #{aeoAthrNo}					/** Numéro d'OEA !== AEO공인번호 ==! */
            	AND A.DEL_YN = 'N'									/** Suppression ON !== 삭제여부 ==! */
            	  )
         </if>
         ORDER BY A.LAST_CHG_DTTM DESC
		<include refid="pagination.footer"/>
	</select>
	
    <!--
    [OEA commun] Consulter l'enquête !==[AEO 공통] 조사내역 조회==!
    -->
	<select id="selectAeoComInvgBrkd"
	    parameterType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo"
	    resultType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo">
		/* selectAeoComInvgBrkd */
		SELECT
				  A.INVG_MGMT_NO               /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
                , A.ATHR_RQST_TP_CD            /** Code de type de demande d'agrément !== 공인신청구분코드 ==! */
                , FN_GET_CD_VDVAL_NM('AEO_0004', A.ATHR_RQST_TP_CD, #{langCd}) AS ATHR_RQST_TP_NM                 /** Code de type de demande d'agrément !== 공인신청구분코드 ==! */
                , A.AEO_RQST_NO                /** Numéro de demande du statut OEA !== AEO신청번호 ==! */
                , A.AEO_ATHR_NO                /** Numéro d'OEA !== AEO공인번호 ==! */
                , A.PRCS_STTS_CD               /** Code De Statut De Traitement !== 처리상태코드 ==! */
                , FN_GET_CD_VDVAL_NM((CASE A.ATHR_RQST_TP_CD WHEN 'ARQ' THEN 'AEO_0015' ELSE 'AEO_0016' END), A.PRCS_STTS_CD, #{langCd}) AS PRCS_STTS_NM               /** Code De Statut De Traitement !== 처리상태코드 ==! */
                , A.DTL_PRCS_STTS_CD           /** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
                , FN_GET_CD_VDVAL_NM((CASE A.ATHR_RQST_TP_CD WHEN 'ARQ' THEN 'AEO_0017' ELSE 'AEO_0018' END), A.DTL_PRCS_STTS_CD, #{langCd}) AS DTL_PRCS_STTS_NM               /** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
                , A.INVG_RQSTR_ID              /** ID du demandeur d'enquête !== 조사요청자ID ==! */
                , (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.INVG_RQSTR_ID) AS INVG_RQSTR_NM              /** ID du demandeur d'enquête !== 조사요청자ID ==! */
                , TO_CHAR(TO_DATE(A.INVG_REQST_DT, 'YYYYMMDD'), 'DD/MM/YYYY') AS INVG_REQST_DT             /** Date de demande d'enquête !== 조사요청일자 ==! */
                , A.INVG_REQST_CN              /** Contenu de demande d'enquête !== 조사요청내용 ==! */
                , A.INVG_RSLT_CN               /** Résultat de demande d'enquête !== 조사결과내용 ==! */
                , A.INVG_IDTN_ATCH_FILE_ID     /** ID de la pièce jointe pour l'ordre d'enquête !== 조사지시첨부파일ID ==! */
		        , A.INVG_RSLT_ATCH_FILE_ID     /** ID de la pièce jointe pour le résultat d'enquête !== 조사결과첨부파일ID ==! */
                , TO_CHAR(A.SBMT_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS SBMT_DTTM                  /** Date Et Heure De Soumission !== 제출일시 ==! */
				, A.DEL_YN						/** Suppression On !== 삭제여부 ==! */
		        , A.RTRN_RSN_CN                 /** Motif De Rejet !== 반려사유내용 ==! */
                , A.FRST_REGST_ID              	/** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
				, (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.FRST_REGST_ID) AS FRST_REGST_NM
				, TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS frstRgsrDttm			/** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
				, A.LAST_CHPR_ID				/** Id Du Modificateur Final !== 최종변경자ID ==! */
				, (SELECT EMP_NM FROM TB_POTI_EMP WHERE PBSR_NO = A.LAST_CHPR_ID) AS LAST_CHPR_NM
				, TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS lastChgDttm				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
				, (SELECT AR.MGMT_RQST_TP_CD FROM TB_AEOI_AFFC_RQST AR WHERE AR.AEO_AFFC_MGMT_RQST_NO = A.AEO_RQST_NO AND AR.AEO_ATHR_NO = A.AEO_ATHR_NO AND AR.DEL_YN = 'N') AS MGMT_RQST_TP_CD         /** Code de classification de gestion ultérieure d'OEA !== 사후관리신청구분코드 ==! */
		FROM
		  		  TB_AEOI_INVG_BRKD A    /** AEOI_HISTORIQUE D'ENQUÊTE !== AEOI_조사내역 ==! */
		 WHERE
		 		  A.DEL_YN = 'N'									/** Suppression ON !== 삭제여부 ==! */
		 <if test='aeoRqstNo != null and !"".equals(aeoRqstNo)'>
           AND	  A.AEO_RQST_NO = #{aeoRqstNo}       				/** Numéro de demande du statut OEA !== AEO공인신청번호 ==! */
         </if>
		 <if test='invgMgmtNo != null and !"".equals(invgMgmtNo)'>
           AND	  A.INVG_MGMT_NO = #{invgMgmtNo}       				/** Numéro de gestion d'enquête !== 조사관리번호 ==! */
         </if>
		 <if test='prcsSttsCd != null and !"".equals(prcsSttsCd)'>
		   AND	  A.PRCS_STTS_CD = #{prcsSttsCd}                    /** Code De Statut De Traitement !== 처리상태코드 ==! */
		 </if>
		 <if test='dtlPrcsSttsCd != null and !"".equals(dtlPrcsSttsCd)'>
		   AND    A.DTL_PRCS_STTS_CD = #{dtlPrcsSttsCd}             /** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
		 </if>
	</select>
	
    <!--
    [OEA commun] Enregistrer l'enquête !==[AEO 공통] 조사내역 등록==!
    -->
	<insert id="insertAeoComInvgBrkd"
		parameterType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo">
		/* insertAeoComInvgBrkd */
        INSERT INTO TB_AEOI_INVG_BRKD (        /** AEOI_HISTORIQUE D'ENQUÊTE !== AEOI_조사내역 ==! */
				  INVG_MGMT_NO                 /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
                , ATHR_RQST_TP_CD              /** Code de type de demande d'agrément !== 공인신청구분코드 ==! */
                , AEO_RQST_NO                  /** Numéro de demande du statut OEA !== AEO신청번호 ==! */
                , AEO_ATHR_NO                  /** Numéro d'OEA !== AEO공인번호 ==! */
                , PRCS_STTS_CD                 /** Code De Statut De Traitement !== 처리상태코드 ==! */
                , DTL_PRCS_STTS_CD             /** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
                , INVG_RQSTR_ID                /** ID du demandeur d'enquête !== 조사요청자ID ==! */
                , INVG_REQST_DT                /** Date de demande d'enquête !== 조사요청일자 ==! */
                , INVG_REQST_CN                /** Contenu de demande d'enquête !== 조사요청내용 ==! */
                , INVG_RSLT_CN                 /** Résultat de demande d'enquête !== 조사결과내용 ==! */
                , INVG_IDTN_ATCH_FILE_ID       /** ID de la pièce jointe pour l'ordre d'enquête !== 조사지시첨부파일ID ==! */
		        , INVG_RSLT_ATCH_FILE_ID       /** ID de la pièce jointe pour le résultat d'enquête !== 조사결과첨부파일ID ==! */
                , DEL_YN                       /** Suppression On !== 삭제여부 ==! */
                , FRST_REGST_ID                /** Id Du Premier Enregistrant  !== 최초등록자ID ==! */
                , FRST_RGSR_DTTM               /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
                , LAST_CHPR_ID                 /** Id Du Modificateur Final !== 최종변경자ID ==! */
                , LAST_CHG_DTTM                /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		)
		VALUES
		(
				  #{invgMgmtNo}                /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
                , #{athrRqstTpCd}              /** Code de type de demande d'agrément !== 공인신청구분코드 ==! */
                , #{aeoRqstNo}                 /** Numéro de demande du statut OEA !== AEO신청번호 ==! */
                , #{aeoAthrNo}                 /** Numéro d'OEA !== AEO공인번호 ==! */
                , #{prcsSttsCd}                /** Code De Statut De Traitement !== 처리상태코드 ==! */
                , #{dtlPrcsSttsCd}             /** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
                , #{invgRqstrId}               /** ID du demandeur d'enquête !== 조사요청자ID ==! */
                , #{invgReqstDt}               /** Date de demande d'enquête !== 조사요청일자 ==! */
		 <if test='invgReqstCn != null and !"".equals(invgReqstCn) and "ARQ".equals(athrRqstTpCd)'>
                , #{invgReqstCn}               /** Contenu de demande d'enquête !== 조사요청내용 ==! */
         </if>
		 <if test='mgmtRqstTpCd != null and !"".equals(mgmtRqstTpCd) and "PSM".equals(athrRqstTpCd)'>
                , #{mgmtRqstTpCd}
         </if>
		 <if test='invgReqstCn != null and !"".equals(invgReqstCn) and "PSM".equals(athrRqstTpCd)'>
			    , #{invgReqstCn}               /** Contenu de demande d'enquête !== 조사요청내용 ==! */
		 </if>
                , #{invgRsltCn}                /** Résultat de demande d'enquête !== 조사결과내용 ==! */
                , #{invgIdtnAtchFileId}        /** ID de la pièce jointe pour l'ordre d'enquête !== 조사지시첨부파일ID ==! */
		        , #{invgRsltAtchFileId}        /** ID de la pièce jointe pour le résultat d'enquête !== 조사결과첨부파일ID ==! */
                , 'N'                          /** Suppression On !== 삭제여부 ==! */
                , #{frstRegstId}               /** Id Du Premier Enregistrant !== 최초등록자ID ==! */
                , CURRENT_TIMESTAMP            /** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
                , #{lastChprId}                /** Id Du Modificateur Final !== 최종변경자ID ==! */
                , CURRENT_TIMESTAMP            /** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		)
	</insert>

    <!--
    [OEA commun] Modifier l'enquête !==[AEO 공통] 조사내역 수정==!
    -->
	<update id="updateAeoComInvgBrkd"
		parameterType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo">
		/* updateAeoComInvgBrkd */
		UPDATE	  TB_AEOI_INVG_BRKD                             /** AEOI_HISTORIQUE D'ENQUÊTE !== AEOI_조사내역 ==! */
		   SET
				  LAST_CHPR_ID = #{lastChprId}          		/** Id Du Modificateur Final !== 최종변경자ID ==! */            
				, LAST_CHG_DTTM = CURRENT_TIMESTAMP				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */ 
	    	<if test='athrRqstTpCd != null and !"".equals(athrRqstTpCd)'>
				, ATHR_RQST_TP_CD = #{athrRqstTpCd}              /** Code de type de demande d'agrément !== 공인신청구분코드 ==! */
            </if>
	    	<if test='aeoRqstNo != null and !"".equals(aeoRqstNo)'>
                , AEO_RQST_NO = #{aeoRqstNo}                /** Numéro de demande du statut OEA !== AEO신청번호 ==! */
            </if>
	    	<if test='aeoAthrNo != null and !"".equals(aeoAthrNo)'>
                , AEO_ATHR_NO = #{aeoAthrNo}                /** Numéro d'OEA !== AEO공인번호 ==! */
            </if>
	    	<if test='prcsSttsCd != null and !"".equals(prcsSttsCd)'>
                , PRCS_STTS_CD = #{prcsSttsCd}              /** Code De Statut De Traitement !== 처리상태코드 ==! */
            </if>
	    	<if test='dtlPrcsSttsCd != null and !"".equals(dtlPrcsSttsCd)'>
                , DTL_PRCS_STTS_CD = #{dtlPrcsSttsCd}       /** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
            </if>
	    	<if test='invgRqstrId != null and !"".equals(invgRqstrId)'>
                , INVG_RQSTR_ID = #{invgRqstrId}              /** ID du demandeur d'enquête !== 조사요청자ID ==! */
            </if>
		 	<if test='invgReqstCn != null and !"".equals(invgReqstCn) and "ARQ".equals(athrRqstTpCd)'>
                , INVG_REQST_CN = #{invgReqstCn}              /** Contenu de demande d'enquête !== 조사요청내용 ==! */
            </if>
		 	<if test='mgmtRqstTpCd != null and !"".equals(mgmtRqstTpCd) and "PSM".equals(athrRqstTpCd)'>
	            , INVG_REQST_CN = #{mgmtRqstTpCd}               /** Contenu de demande d'enquête !== 조사요청내용 ==! */
	        </if>
			<if test='invgReqstCn != null and !"".equals(invgReqstCn) and "PSM".equals(athrRqstTpCd)'>
				, INVG_REQST_CN = #{invgReqstCn}              /** Contenu de demande d'enquête !== 조사요청내용 ==! */
			</if>
	    	<if test='invgRsltCn != null and !"".equals(invgRsltCn)'>
                , INVG_RSLT_CN = #{invgRsltCn}                /** Résultat de demande d'enquête !== 조사결과내용 ==! */
            </if>
	    	<if test='invgIdtnAtchFileId != null and !"".equals(invgIdtnAtchFileId)'>
                , INVG_IDTN_ATCH_FILE_ID = #{invgIdtnAtchFileId}              /** ID de la pièce jointe pour l'ordre d'enquête !== 조사지시첨부파일ID ==! */
            </if>
			<if test='invgRsltAtchFileId != null and !"".equals(invgRsltAtchFileId)'>
				, INVG_RSLT_ATCH_FILE_ID = #{invgRsltAtchFileId}              /** ID de la pièce jointe pour le résultat d'enquête !== 조사결과첨부파일ID ==! */
			</if>
		 WHERE
		 		  DEL_YN = 'N'									/** Suppression ON !== 삭제여부 ==! */
           AND	  INVG_MGMT_NO = #{invgMgmtNo}                  /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
	</update>

	<!--
    [OEA commun] Renvoyer l'enquête !==[AEO 공통] 조사내역 반려==!
    -->
	<update id="updateAeoComInvgRsltRtrn"
		parameterType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo">
		/* updateAeoComInvgRsltRtrn */
		UPDATE	TB_AEOI_INVG_BRKD                           /** AEOI_HISTORIQUE D'ENQUÊTE !== AEOI_조사내역 ==! */
		SET
			  LAST_CHPR_ID = #{lastChprId}          		/** Id Du Modificateur Final !== 최종변경자ID ==! */
			, LAST_CHG_DTTM = CURRENT_TIMESTAMP				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		    , RTRN_RSN_CN = #{rtrnRsnCn}
		<if test='prcsSttsCd != null and !"".equals(prcsSttsCd)'>
			, PRCS_STTS_CD = #{prcsSttsCd}              	/** Code De Statut De Traitement !== 처리상태코드 ==! */
		</if>
		<if test='dtlPrcsSttsCd != null and !"".equals(dtlPrcsSttsCd)'>
			, DTL_PRCS_STTS_CD = #{dtlPrcsSttsCd}       	/** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
		</if>
		WHERE  DEL_YN = 'N'									/** Suppression ON !== 삭제여부 ==! */
		AND	   INVG_MGMT_NO = #{invgMgmtNo}                 /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
	</update>

	<!--
    [OEA commun] Confirmer l'enquête !==[AEO 공통] 조사내역 확인==!
    -->
	<update id="updateAeoComInvgRsltCfrm"
		parameterType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo">
		/* updateAeoComInvgRsltCfrm */
		UPDATE	TB_AEOI_INVG_BRKD                           /** AEOI_HISTORIQUE D'ENQUÊTE !== AEOI_조사내역 ==! */
		SET     LAST_CHPR_ID = #{lastChprId}          		/** Id Du Modificateur Final !== 최종변경자ID ==! */
		      , LAST_CHG_DTTM = CURRENT_TIMESTAMP			/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
			<if test='prcsSttsCd != null and !"".equals(prcsSttsCd)'>
			  , PRCS_STTS_CD = #{prcsSttsCd}              	/** Code De Statut De Traitement !== 처리상태코드 ==! */
			</if>
			<if test='dtlPrcsSttsCd != null and !"".equals(dtlPrcsSttsCd)'>
			  , DTL_PRCS_STTS_CD = #{dtlPrcsSttsCd}       	/** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
			</if>
		WHERE   DEL_YN = 'N'								/** Suppression ON !== 삭제여부 ==! */
		AND	    INVG_MGMT_NO = #{invgMgmtNo}                /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
	</update>

    <!--
    [OEA commun] Supprimer l'enquête !==[AEO 공통] 조사내역 삭제==!
    -->
	<update id="deleteAeoComInvgBrkd"
		parameterType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo">
		  /* deleteAeoComInvgBrkd */
		  UPDATE  TB_AEOI_INVG_BRKD                             /** AEOI_HISTORIQUE D'ENQUÊTE !== AEOI_조사내역 ==! */
		     SET
				  LAST_CHPR_ID = #{lastChprId}          		/** Id Du Modificateur Final !== 최종변경자ID ==! */            
				, LAST_CHG_DTTM = CURRENT_TIMESTAMP				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */ 
		  		, DEL_YN = 'Y'									/** Suppression On !== 삭제여부 ==! */ 
		   WHERE
		 		  DEL_YN = 'N'									/** Suppression ON !== 삭제여부 ==! */
             AND  INVG_MGMT_NO = #{invgMgmtNo}                  /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
	</update>

    <!--
    [OEA commun] Ordonner l'enquête !==[AEO 공통] 조사내역 지시==!
    -->
	<update id="updateAeoComInvgBrkdIdtn"
		parameterType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo">
		/* updateAeoComInvgBrkdIdtn */
		UPDATE	  TB_AEOI_INVG_BRKD                             /** AEOI_HISTORIQUE D'ENQUÊTE !== AEOI_조사내역 ==! */
		   SET
				  LAST_CHPR_ID = #{lastChprId}          		/** Id Du Modificateur Final !== 최종변경자ID ==! */            
				, LAST_CHG_DTTM = CURRENT_TIMESTAMP				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */ 
                , PRCS_STTS_CD = #{prcsSttsCd}              	/** Code De Statut De Traitement !== 처리상태코드 ==! */
                , DTL_PRCS_STTS_CD = #{dtlPrcsSttsCd}       	/** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
                , INVG_RQSTR_ID = #{invgRqstrId}              	/** ID du demandeur d'enquête !== 조사요청자ID ==! */
                , INVG_REQST_DT = TO_CHAR(CURRENT_TIMESTAMP, 'yyyyMMdd')              	/** Date de demande d'enquête !== 조사요청일자 ==! */
                , INVG_REQST_CN = #{invgReqstCn}              	/** Contenu de demande d'enquête !== 조사요청내용 ==! */
			<if test='aeoRqstNo != null and !"".equals(aeoRqstNo)'>
				, AEO_RQST_NO = #{aeoRqstNo}                	/** Numéro de demande du statut OEA !== AEO신청번호 ==! */
			</if>
			<if test='invgIdtnAtchFileId != null and !"".equals(invgIdtnAtchFileId)'>
				, INVG_IDTN_ATCH_FILE_ID = #{invgIdtnAtchFileId}	/** ID de la pièce jointe pour l'ordre d'enquête !== 조사지시첨부파일ID ==! */
			</if>
		 WHERE
           		  DEL_YN = 'N'                                	/** Suppression ON !== 삭제여부 ==! */
           AND	  INVG_MGMT_NO = #{invgMgmtNo}                  /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
	</update>

    <!--
    [OEA commun] Déposer l'enquête !==[AEO 공통] 조사내역 제출==!
    -->
	<update id="updateAeoComInvgBrkdSbmt"
		parameterType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo">
		/* updateAeoComInvgBrkdSbmt */
		UPDATE	  TB_AEOI_INVG_BRKD                             /** AEOI_HISTORIQUE D'ENQUÊTE !== AEOI_조사내역 ==! */
		   SET
				  LAST_CHPR_ID = #{lastChprId}          		/** Id Du Modificateur Final !== 최종변경자ID ==! */            
				, LAST_CHG_DTTM = CURRENT_TIMESTAMP				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */ 
                , PRCS_STTS_CD = #{prcsSttsCd}              	/** Code De Statut De Traitement !== 처리상태코드 ==! */
                , DTL_PRCS_STTS_CD = #{dtlPrcsSttsCd}       	/** Code d'état détaillé du traitement !== 상세처리상태코드 ==! */
		 	<if test='mgmtRqstTpCd != null and !"".equals(mgmtRqstTpCd) and "PSM".equals(athrRqstTpCd)'>
	            , INVG_REQST_CN = #{mgmtRqstTpCd}               /** Contenu de demande d'enquête !== 조사요청내용 ==! */
	        </if>
                , INVG_RSLT_CN = #{invgRsltCn}                		/** Résultat de demande d'enquête !== 조사결과내용 ==! */
			<if test='invgIdtnAtchFileId != null and !"".equals(invgIdtnAtchFileId)'>
				, INVG_IDTN_ATCH_FILE_ID = #{invgIdtnAtchFileId}              /** ID de la pièce jointe pour l'ordre d'enquête !== 조사지시첨부파일ID ==! */
			</if>
			<if test='invgRsltAtchFileId != null and !"".equals(invgRsltAtchFileId)'>
				, INVG_RSLT_ATCH_FILE_ID = #{invgRsltAtchFileId}              /** ID de la pièce jointe pour le résultat d'enquête !== 조사결과첨부파일ID ==! */
			</if>
                , SBMT_DTTM = CURRENT_TIMESTAMP                 	/** Date Et Heure De Soumission !== 제출일시 ==! */
	    	<if test='aeoRqstNo != null and !"".equals(aeoRqstNo)'>
                , AEO_RQST_NO = #{aeoRqstNo}                /** Numéro de demande du statut OEA !== AEO신청번호 ==! */
            </if>
		 WHERE
           		  DEL_YN = 'N'                                	/** Suppression ON !== 삭제여부 ==! */
           AND	  INVG_MGMT_NO = #{invgMgmtNo}                  /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
	</update>

    <!--
    [Enquête.Personne en charge] Consulter la liste !== [조사내역.담당자] 목록조회 ==!
    -->
	<select id="selectAeoComInvgChpnList"
	    parameterType="alpass.ipt.aeo.com.vo.AeoComInvgBrkdVo"
	    resultType="alpass.ipt.aeo.com.vo.AeoComInvgChpnVo">
		/* selectAeoComInvgChpnList */
		SELECT
				  A.INVG_MGMT_NO               /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
                , A.INVG_EMP_ID                /** ID de l'enquêteur !== 조사직원ID ==! */
                , B.EMP_NM AS INVG_EMP_NM      /** ID de l'enquêteur !== 조사직원ID ==! */
                , (SELECT O.ORGN_NM FROM TB_POTI_ORGN O WHERE ORGN_MGMT_CD = B.ORGN_MGMT_CD) AS ORGN_NM    /** Nom D'Organisme !== 조직명 ==! */
                , B.EML                         /** Email !== 이메일 ==! */
				, A.DEL_YN						/** Suppression On !== 삭제여부 ==! */
                , A.FRST_REGST_ID              	/** Id Du Premier Enregistrant !== 최초등록자ID ==! */
				, TO_CHAR(A.FRST_RGSR_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS frstRgsrDttm			/** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
				, A.LAST_CHPR_ID				/** Id Du Modificateur Final !== 최종변경자ID ==! */
				, TO_CHAR(A.LAST_CHG_DTTM, 'DD/MM/YYYY hh24:mi:ss') AS lastChgDttm				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		  FROM
		  		  TB_AEOI_INVG_CHPN A           /** AEOI_ENQUÊTEUR !== AEOI_조사담당자 ==! */
		  		, TB_POTI_EMP B                 /** POTI_EMPLOYÉ !== POTI_직원 ==! */
		 WHERE
		 		  A.DEL_YN = 'N'				/** Suppression ON !== 삭제여부 ==! */
		   AND	  A.INVG_EMP_ID = B.PBSR_NO
           AND	  A.INVG_MGMT_NO = #{invgMgmtNo}       				/** Numéro de gestion d'enquête !== 조사관리번호 ==! */
	</select>

    <!--
    [Enquête.Personne en charge] Enregistrer !== [조사내역.담당자] 등록==!
    -->
	<insert id="insertAeoComInvgChpn"
		parameterType="alpass.ipt.aeo.com.vo.AeoComInvgChpnVo">
		/* insertAeoComInvgChpn */
        WITH UPSERT AS  (
			UPDATE	  TB_AEOI_INVG_CHPN                     /** AEOI_ENQUÊTEUR !== AEOI_조사담당자 ==! */
			   SET
					  LAST_CHPR_ID = #{lastChprId}          /** Id Du Modificateur Final !== 최종변경자ID ==! */            
					, LAST_CHG_DTTM = CURRENT_TIMESTAMP		/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
					, DEL_YN = 'N'                       	/** Suppression On !== 삭제여부 ==! */
			 WHERE
            		  INVG_MGMT_NO = #{invgMgmtNo}          /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
		  	   AND    INVG_EMP_ID = #{invgEmpId}       		/** ID de l'enquêteur !== 조사직원ID ==! */
		     RETURNING *
        )
		INSERT INTO   TB_AEOI_INVG_CHPN (           /** AEOI_ENQUÊTEUR !== AEOI_조사담당자 ==! */
				      INVG_MGMT_NO               	/** Numéro de gestion d'enquête !== 조사관리번호 ==! */
					, INVG_EMP_ID					/** ID de l'enquêteur !== 조사직원ID ==! */
	                , DEL_YN                       	/** Suppression On !== 삭제여부 ==! */
					, FRST_REGST_ID					/** Id Du Premier Enregistrant !== 최초등록자ID ==! */
					, FRST_RGSR_DTTM				/** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */
					, LAST_CHPR_ID					/** Id Du Modificateur Final !== 최종변경자ID ==! */
					, LAST_CHG_DTTM					/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		)
		SELECT
				      #{invgMgmtNo}					/** N° réunion du comité !== 위원회회의번호 ==! */
					, #{invgEmpId}					/** ID de l'enquêteur !== 조사직원ID ==! */
	                , 'N'                          	/** Suppression On !== 삭제여부 ==! */
					, #{frstRegstId}          		/** Id Du Premier Enregistrant !== 최초등록자ID ==! */
					, CURRENT_TIMESTAMP          	/** Date Et Heure De Premier Enregistrement !== 최초등록일시 ==! */   
					, #{lastChprId}          		/** Id Du Modificateur Final !== 최종변경자ID ==! */                 
					, CURRENT_TIMESTAMP          	/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */
		 WHERE	NOT EXISTS (SELECT * FROM UPSERT)
	</insert>
	
    <!--
    [Enquête.Personne en charge] Supprimer !== [조사내역.담당자] 삭제==!
    -->
	<update id="deleteAeoComInvgChpn"
		parameterType="alpass.ipt.aeo.com.vo.AeoComInvgChpnVo">
		  /* deleteAeoComInvgChpn */
		  UPDATE  TB_AEOI_INVG_CHPN                             /** AEOI_ENQUÊTEUR !== AEOI_조사담당자 ==! */
		     SET
				  LAST_CHPR_ID = #{lastChprId}          		/** Id Du Modificateur Final !== 최종변경자ID ==! */            
				, LAST_CHG_DTTM = CURRENT_TIMESTAMP				/** Date Et Heure De Modification Finale !== 최종변경일시 ==! */ 
		  		, DEL_YN = 'Y'									/** Suppression On !== 삭제여부 ==! */ 
		   WHERE
		 		  DEL_YN = 'N'									/** Suppression ON !== 삭제여부 ==! */
             AND  INVG_MGMT_NO = #{invgMgmtNo}                  /** Numéro de gestion d'enquête !== 조사관리번호 ==! */
		 <if test='invgEmpId != null and !"".equals(invgEmpId)'>
             AND  INVG_EMP_ID = #{invgEmpId}       				/** ID de l'enquêteur !== 조사직원ID ==! */
         </if>
	</update>
	
</mapper>